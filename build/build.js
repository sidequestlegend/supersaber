(function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.i=function(value){return value},__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default']}:function getModuleExports(){return module};return __webpack_require__.d(getter,'a',getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p='',__webpack_require__(__webpack_require__.s=133)})([function(module){var g=function(){return this}();try{g=g||Function('return this')()||(1,eval)('this')}catch(e){'object'==typeof window&&(g=window)}module.exports=g},function(module){module.exports=function clone(obj){return JSON.parse(JSON.stringify(obj))}},function(module){module.exports.getS3FileUrl=function getS3FileUrl(id,name){return`${'https://saber.supermedium.com'}/${id}-${name}?v=1`}},function(module){var hasOwn=Object.prototype.hasOwnProperty,toString=Object.prototype.toString;module.exports=function forEach(obj,fn,ctx){if('[object Function]'!==toString.call(fn))throw new TypeError('iterator must be a function');var l=obj.length;if(l===+l)for(var i=0;i<l;i++)fn.call(ctx,obj[i],i,obj);else for(var k in obj)hasOwn.call(obj,k)&&fn.call(ctx,obj[k],k,obj)}},function(module){function defaultSetTimout(){throw new Error('setTimeout has not been defined')}function defaultClearTimeout(){throw new Error('clearTimeout has not been defined')}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var process=module.exports={},cachedSetTimeout,cachedClearTimeout;(function(){try{cachedSetTimeout='function'==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout='function'==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}})();var queue=[],draining=!1,queueIndex=-1,currentQueue;process.nextTick=function(fun){var args=Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title='browser',process.browser=!0,process.env={},process.argv=[],process.version='',process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(){return[]},process.binding=function(){throw new Error('process.binding is not supported')},process.cwd=function(){return'/'},process.chdir=function(){throw new Error('process.chdir is not supported')},process.umask=function(){return 0}},function(module,exports,__webpack_require__){'use strict';function AlgoliaSearchError(message,extraProperties){var forEach=__webpack_require__(3),error=this;'function'==typeof Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):error.stack=new Error().stack||'Cannot get a stacktrace, browser is too old',this.name='AlgoliaSearchError',this.message=message||'Unknown error',extraProperties&&forEach(extraProperties,function addToErrorObject(value,key){error[key]=value})}function createCustomError(name,message){function AlgoliaSearchCustomError(){var args=Array.prototype.slice.call(arguments,0);'string'!=typeof args[0]&&args.unshift(message),AlgoliaSearchError.apply(this,args),this.name='AlgoliaSearch'+name+'Error'}return inherits(AlgoliaSearchCustomError,AlgoliaSearchError),AlgoliaSearchCustomError}var inherits=__webpack_require__(18);inherits(AlgoliaSearchError,Error),module.exports={AlgoliaSearchError:AlgoliaSearchError,UnparsableJSON:createCustomError('UnparsableJSON','Could not parse the incoming response as JSON, see err.more for details'),RequestTimeout:createCustomError('RequestTimeout','Request timedout before getting a response'),Network:createCustomError('Network','Network issue, see err.more for details'),JSONPScriptFail:createCustomError('JSONPScriptFail','<script> was loaded but did not call our provided callback'),JSONPScriptError:createCustomError('JSONPScriptError','<script> unable to load due to an `error` event on it'),Unknown:createCustomError('Unknown','Unknown error occured')}},function(module,exports,__webpack_require__){var foreach=__webpack_require__(3);module.exports=function map(arr,fn){var newArr=[];return foreach(arr,function(item,itemIndex){newArr.push(fn(item,itemIndex,arr))}),newArr}},function(module){module.exports={OFF:'#111',RED:'#ff3a7b',BLUE:'#08bfa2',UI_ACCENT:'#08bfa2',UI_ACCENT2:'#f01978',SKY_OFF:'#297547',SKY_BLUE:'#840d42',SKY_RED:'#154136',BG_OFF:'#081a0f',BG_BLUE:'#379f5e',BG_BRIGHTBLUE:'#4fd983',BG_RED:'#ff1f81',BG_BRIGHTRED:'#ff6bb0',NEON_OFF:'#000',NEON_BLUE:'#008a70',NEON_BRIGHTBLUE:'#87c2ff',NEON_RED:'#f01978',NEON_BRIGHTRED:'#ff70b5',TEXT_OFF:'#000',TEXT_NORMAL:'#444',TEXT_BOLD:'#888',BEAT_RED:'#660338',BEAT_BLUE:'#036657',MINE_RED:'#1c060e',MINE_RED_EMISSION:'#2a0d1b',MINE_BLUE:'#011114',MINE_BLUE_EMISSION:'#072020'}},function(module,exports,__webpack_require__){(function(process){exports.log=function log(...args){return'object'==typeof console&&console.log&&console.log(...args)},exports.formatArgs=function formatArgs(args){if(args[0]=(this.useColors?'%c':'')+this.namespace+(this.useColors?' %c':' ')+args[0]+(this.useColors?'%c ':' ')+'+'+module.exports.humanize(this.diff),!this.useColors)return;const c='color: '+this.color;args.splice(1,0,c,'color: inherit');let index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,match=>{'%%'===match||(index++,'%c'===match&&(lastC=index))}),args.splice(lastC,0,c)},exports.save=function save(namespaces){try{namespaces?exports.storage.setItem('debug',namespaces):exports.storage.removeItem('debug')}catch(error){}},exports.load=function load(){let r;try{r=exports.storage.getItem('debug')}catch(error){}return!r&&'undefined'!=typeof process&&'env'in process&&(r=process.env.DEBUG),r},exports.useColors=function useColors(){return'undefined'!=typeof window&&window.process&&('renderer'===window.process.type||window.process.__nwjs)||('undefined'!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:'undefined'!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||'undefined'!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||'undefined'!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||'undefined'!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},exports.storage=function localstorage(){try{return localStorage}catch(error){}}(),exports.colors=['#0000CC','#0000FF','#0033CC','#0033FF','#0066CC','#0066FF','#0099CC','#0099FF','#00CC00','#00CC33','#00CC66','#00CC99','#00CCCC','#00CCFF','#3300CC','#3300FF','#3333CC','#3333FF','#3366CC','#3366FF','#3399CC','#3399FF','#33CC00','#33CC33','#33CC66','#33CC99','#33CCCC','#33CCFF','#6600CC','#6600FF','#6633CC','#6633FF','#66CC00','#66CC33','#9900CC','#9900FF','#9933CC','#9933FF','#99CC00','#99CC33','#CC0000','#CC0033','#CC0066','#CC0099','#CC00CC','#CC00FF','#CC3300','#CC3333','#CC3366','#CC3399','#CC33CC','#CC33FF','#CC6600','#CC6633','#CC9900','#CC9933','#CCCC00','#CCCC33','#FF0000','#FF0033','#FF0066','#FF0099','#FF00CC','#FF00FF','#FF3300','#FF3333','#FF3366','#FF3399','#FF33CC','#FF33FF','#FF6600','#FF6633','#FF9900','#FF9933','#FFCC00','#FFCC33'],module.exports=__webpack_require__(139)(exports);const{formatters}=module.exports;formatters.j=function(v){try{return JSON.stringify(v)}catch(error){return'[UnexpectedJSONParseError]: '+error.message}}}).call(exports,__webpack_require__(4))},function(module){module.exports=Array.isArray||function(arr){return'[object Array]'==Object.prototype.toString.call(arr)}},function(module,__webpack_exports__){'use strict';const BEAT_WARMUP_SPEED=155;__webpack_exports__.a=BEAT_WARMUP_SPEED;__webpack_exports__.b=1e3*(25/BEAT_WARMUP_SPEED)},function(module){function getGridUvs(row,column,totalRows,totalColumns){const columnWidth=1/totalColumns,rowHeight=1/totalRows;return uvs[0].set(columnWidth*column,rowHeight*row+rowHeight),uvs[1].set(columnWidth*column,rowHeight*row),uvs[2].set(columnWidth*column+columnWidth,rowHeight*row),uvs[3].set(columnWidth*column+columnWidth,rowHeight*row+rowHeight),uvs}var uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];AFRAME.registerComponent('atlas-uvs',{dependencies:['geometry'],schema:{totalColumns:{type:'int',default:1},totalRows:{type:'int',default:1},column:{type:'int',default:1},row:{type:'int',default:1}},update:function(){const data=this.data,uvs=getGridUvs(data.row-1,data.column-1,data.totalRows,data.totalColumns),geometry=this.el.getObject3D('mesh').geometry;geometry.faceVertexUvs[0][0][0].copy(uvs[0]),geometry.faceVertexUvs[0][0][1].copy(uvs[1]),geometry.faceVertexUvs[0][0][2].copy(uvs[3]),geometry.faceVertexUvs[0][1][0].copy(uvs[1]),geometry.faceVertexUvs[0][1][1].copy(uvs[2]),geometry.faceVertexUvs[0][1][2].copy(uvs[3]),geometry.uvsNeedUpdate=!0}}),AFRAME.registerComponent('dynamic-texture-atlas',{schema:{canvasId:{default:'dynamicAtlas'},canvasHeight:{default:1024},canvasWidth:{default:1024},debug:{default:!1},numColumns:{default:8},numRows:{default:8}},multiple:!0,init:function(){const canvas=this.canvas=document.createElement('canvas');canvas.id=this.data.canvasId,canvas.height=this.data.canvasHeight,canvas.width=this.data.canvasWidth,this.ctx=canvas.getContext('2d'),document.body.appendChild(canvas),this.data.debug&&(canvas.style.left=0,canvas.style.top=0,canvas.style.position='fixed',canvas.style.zIndex=9999999999)},drawTexture:function(image,row,column,width,height){const canvas=this.canvas,data=this.data;image.complete||(image.onload=()=>{this.drawTexture(image,row,column)});const gridHeight=height||canvas.height/data.numRows,gridWidth=width||canvas.width/data.numColumns;return this.ctx.drawImage(image,gridWidth*row,gridWidth*column,gridWidth,gridHeight),getGridUvs(row,column,data.numRows,data.numColumns)}}),module.exports.getGridUvs=getGridUvs},function(){THREE.BufferGeometryUtils={computeTangents:function(geometry){function handleTriangle(a,b,c){vA.fromArray(positions,3*a),vB.fromArray(positions,3*b),vC.fromArray(positions,3*c),uvA.fromArray(uvs,2*a),uvB.fromArray(uvs,2*b),uvC.fromArray(uvs,2*c);var x1=vB.x-vA.x,x2=vC.x-vA.x,y1=vB.y-vA.y,y2=vC.y-vA.y,z1=vB.z-vA.z,z2=vC.z-vA.z,s1=uvB.x-uvA.x,s2=uvC.x-uvA.x,t1=uvB.y-uvA.y,t2=uvC.y-uvA.y,r=1/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r),tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r),tan1[a].add(sdir),tan1[b].add(sdir),tan1[c].add(sdir),tan2[a].add(tdir),tan2[b].add(tdir),tan2[c].add(tdir)}function handleVertex(v){n.fromArray(normals,3*v),n2.copy(n),t=tan1[v],tmp.copy(t),tmp.sub(n.multiplyScalar(n.dot(t))).normalize(),tmp2.crossVectors(n2,t),test=tmp2.dot(tan2[v]),w=0>test?-1:1,tangents[4*v]=tmp.x,tangents[4*v+1]=tmp.y,tangents[4*v+2]=tmp.z,tangents[4*v+3]=w}var index=geometry.index,attributes=geometry.attributes;if(null===index||void 0===attributes.position||void 0===attributes.normal||void 0===attributes.uv)return void console.warn('THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()');var indices=index.array,positions=attributes.position.array,normals=attributes.normal.array,uvs=attributes.uv.array,nVertices=positions.length/3;attributes.tangent===void 0&&geometry.addAttribute('tangent',new THREE.BufferAttribute(new Float32Array(4*nVertices),4));for(var tangents=attributes.tangent.array,tan1=[],tan2=[],k=0;k<nVertices;k++)tan1[k]=new THREE.Vector3,tan2[k]=new THREE.Vector3;var vA=new THREE.Vector3,vB=new THREE.Vector3,vC=new THREE.Vector3,uvA=new THREE.Vector2,uvB=new THREE.Vector2,uvC=new THREE.Vector2,sdir=new THREE.Vector3,tdir=new THREE.Vector3,groups=geometry.groups;0===groups.length&&(groups=[{start:0,count:indices.length}]);for(var j=0,jl=groups.length;j<jl;++j)for(var group=groups[j],start=group.start,count=group.count,i=start,il=start+count;i<il;i+=3)handleTriangle(indices[i+0],indices[i+1],indices[i+2]);for(var tmp=new THREE.Vector3,tmp2=new THREE.Vector3,n=new THREE.Vector3,n2=new THREE.Vector3,j=0,jl=groups.length,w,t,test;j<jl;++j)for(var group=groups[j],start=group.start,count=group.count,i=start,il=start+count;i<il;i+=3)handleVertex(indices[i+0]),handleVertex(indices[i+1]),handleVertex(indices[i+2])},mergeBufferGeometries:function(geometries,useGroups){for(var isIndexed=null!==geometries[0].index,attributesUsed=new Set(Object.keys(geometries[0].attributes)),morphAttributesUsed=new Set(Object.keys(geometries[0].morphAttributes)),attributes={},morphAttributes={},mergedGeometry=new THREE.BufferGeometry,offset=0,i=0,geometry;i<geometries.length;++i){if(geometry=geometries[i],isIndexed!=(null!==geometry.index))return null;for(var name in geometry.attributes){if(!attributesUsed.has(name))return null;void 0===attributes[name]&&(attributes[name]=[]),attributes[name].push(geometry.attributes[name])}for(var name in geometry.morphAttributes){if(!morphAttributesUsed.has(name))return null;void 0===morphAttributes[name]&&(morphAttributes[name]=[]),morphAttributes[name].push(geometry.morphAttributes[name])}if(mergedGeometry.userData.mergedUserData=mergedGeometry.userData.mergedUserData||[],mergedGeometry.userData.mergedUserData.push(geometry.userData),useGroups){var count;if(isIndexed)count=geometry.index.count;else if(void 0!==geometry.attributes.position)count=geometry.attributes.position.count;else return null;mergedGeometry.addGroup(offset,count,i),offset+=count}}if(isIndexed){for(var indexOffset=0,indexList=[],i=0,index;i<geometries.length;++i){if(index=geometries[i].index,0<indexOffset){index=index.clone();for(var j=0;j<index.count;++j)index.setX(j,index.getX(j)+indexOffset)}indexList.push(index),indexOffset+=geometries[i].attributes.position.count}var mergedIndex=this.mergeBufferAttributes(indexList);if(!mergedIndex)return null;mergedGeometry.index=mergedIndex}for(var name in attributes){var mergedAttribute=this.mergeBufferAttributes(attributes[name]);if(!mergedAttribute)return null;mergedGeometry.addAttribute(name,mergedAttribute)}for(var name in morphAttributes){var numMorphTargets=morphAttributes[name][0].length;if(0===numMorphTargets)break;mergedGeometry.morphAttributes=mergedGeometry.morphAttributes||{},mergedGeometry.morphAttributes[name]=[];for(var i=0,morphAttributesToMerge;i<numMorphTargets;++i){morphAttributesToMerge=[];for(var j=0;j<morphAttributes[name].length;++j)morphAttributesToMerge.push(morphAttributes[name][j][i]);var mergedMorphAttribute=this.mergeBufferAttributes(morphAttributesToMerge);if(!mergedMorphAttribute)return null;mergedGeometry.morphAttributes[name].push(mergedMorphAttribute)}}return mergedGeometry},mergeBufferAttributes:function(attributes){for(var arrayLength=0,i=0,TypedArray,itemSize,normalized,attribute;i<attributes.length;++i){if(attribute=attributes[i],attribute.isInterleavedBufferAttribute)return null;if(void 0==TypedArray&&(TypedArray=attribute.array.constructor),TypedArray!==attribute.array.constructor)return null;if(void 0==itemSize&&(itemSize=attribute.itemSize),itemSize!==attribute.itemSize)return null;if(void 0==normalized&&(normalized=attribute.normalized),normalized!==attribute.normalized)return null;arrayLength+=attribute.array.length}for(var array=new TypedArray(arrayLength),offset=0,j=0;j<attributes.length;++j)array.set(attributes[j].array,offset),offset+=attributes[j].array.length;return new THREE.BufferAttribute(array,itemSize,normalized)}}},function(module,exports,__webpack_require__){'use strict';function createFirebaseNamespace(){function app(name){return name=name||DEFAULT_ENTRY_NAME,contains(apps_,name)||error('no-app',{name:name}),apps_[name]}function getApps(){return Object.keys(apps_).map(function(name){return apps_[name]})}function callAppHooks(app,eventName){Object.keys(factories).forEach(function(serviceName){var factoryName=useAsService(app,serviceName);null===factoryName||appHooks[factoryName]&&appHooks[factoryName](eventName,app)})}function useAsService(app,name){if('serverAuth'===name)return null;app.options;return name}var apps_={},factories={},appHooks={},namespace={__esModule:!0,initializeApp:function initializeApp(options,rawConfig){if(void 0===rawConfig&&(rawConfig={}),'object'!=typeof rawConfig||null===rawConfig){var name_1=rawConfig;rawConfig={name:name_1}}var config=rawConfig;void 0===config.name&&(config.name=DEFAULT_ENTRY_NAME);var name=config.name;'string'==typeof name&&name||error('bad-app-name',{name:name+''}),contains(apps_,name)&&error('duplicate-app',{name:name});var app=new FirebaseAppImpl(options,config,namespace);return apps_[name]=app,callAppHooks(app,'create'),app},app:app,apps:null,Promise:Promise,SDK_VERSION:'5.5.0',INTERNAL:{registerService:function registerService(name,createService,serviceProperties,appHook,allowMultipleInstances){factories[name]&&error('duplicate-service',{name:name}),factories[name]=createService,appHook&&(appHooks[name]=appHook,getApps().forEach(function(app){appHook('create',app)}));var serviceNamespace=function(appArg){return void 0===appArg&&(appArg=app()),'function'!=typeof appArg[name]&&error('invalid-app-argument',{name:name}),appArg[name]()};return void 0!==serviceProperties&&util.deepExtend(serviceNamespace,serviceProperties),namespace[name]=serviceNamespace,FirebaseAppImpl.prototype[name]=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var serviceFxn=this._getService.bind(this,name);return serviceFxn.apply(this,allowMultipleInstances?args:[])},serviceNamespace},createFirebaseNamespace:createFirebaseNamespace,extendNamespace:function extendNamespace(props){util.deepExtend(namespace,props)},createSubscribe:util.createSubscribe,ErrorFactory:util.ErrorFactory,removeApp:function removeApp(name){var app=apps_[name];callAppHooks(app,'delete'),delete apps_[name]},factories:factories,useAsService:useAsService,Promise:Promise,deepExtend:util.deepExtend}};return util.patchProperty(namespace,'default',namespace),Object.defineProperty(namespace,'apps',{get:getApps}),util.patchProperty(app,'App',FirebaseAppImpl),namespace}function error(code,args){throw appErrors.create(code,args)}Object.defineProperty(exports,'__esModule',{value:!0});var util=__webpack_require__(38),contains=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)},DEFAULT_ENTRY_NAME='[DEFAULT]',tokenListeners=[],FirebaseAppImpl=function(){function FirebaseAppImpl(options,config,firebase_){this.firebase_=firebase_,this.isDeleted_=!1,this.services_={},this.name_=config.name,this._automaticDataCollectionEnabled=config.automaticDataCollectionEnabled||!1,this.options_=util.deepCopy(options),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(callback){tokenListeners.push(callback),setTimeout(function(){return callback(null)},0)},removeAuthTokenListener:function(callback){tokenListeners=tokenListeners.filter(function(listener){return listener!==callback})}}}return Object.defineProperty(FirebaseAppImpl.prototype,'automaticDataCollectionEnabled',{get:function(){return this.checkDestroyed_(),this._automaticDataCollectionEnabled},set:function(val){this.checkDestroyed_(),this._automaticDataCollectionEnabled=val},enumerable:!0,configurable:!0}),Object.defineProperty(FirebaseAppImpl.prototype,'name',{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(FirebaseAppImpl.prototype,'options',{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),FirebaseAppImpl.prototype.delete=function(){var _this=this;return new Promise(function(resolve){_this.checkDestroyed_(),resolve()}).then(function(){_this.firebase_.INTERNAL.removeApp(_this.name_);var services=[];return Object.keys(_this.services_).forEach(function(serviceKey){Object.keys(_this.services_[serviceKey]).forEach(function(instanceKey){services.push(_this.services_[serviceKey][instanceKey])})}),Promise.all(services.map(function(service){return service.INTERNAL.delete()}))}).then(function(){_this.isDeleted_=!0,_this.services_={}})},FirebaseAppImpl.prototype._getService=function(name,instanceIdentifier){if(void 0===instanceIdentifier&&(instanceIdentifier=DEFAULT_ENTRY_NAME),this.checkDestroyed_(),this.services_[name]||(this.services_[name]={}),!this.services_[name][instanceIdentifier]){var instanceSpecifier=instanceIdentifier===DEFAULT_ENTRY_NAME?void 0:instanceIdentifier,service=this.firebase_.INTERNAL.factories[name](this,this.extendApp.bind(this),instanceSpecifier);this.services_[name][instanceIdentifier]=service}return this.services_[name][instanceIdentifier]},FirebaseAppImpl.prototype.extendApp=function(props){var _this=this;util.deepExtend(this,props),props.INTERNAL&&props.INTERNAL.addAuthTokenListener&&(tokenListeners.forEach(function(listener){_this.INTERNAL.addAuthTokenListener(listener)}),tokenListeners=[])},FirebaseAppImpl.prototype.checkDestroyed_=function(){this.isDeleted_&&error('app-deleted',{name:this.name_})},FirebaseAppImpl}();FirebaseAppImpl.prototype.name&&FirebaseAppImpl.prototype.options||FirebaseAppImpl.prototype.delete||console.log('dc');var appErrors=new util.ErrorFactory('app','Firebase',{"no-app":'No Firebase App \'{$name}\' has been created - '+'call Firebase App.initializeApp()',"bad-app-name":'Illegal App name: \'{$name}',"duplicate-app":'Firebase App named \'{$name}\' already exists',"app-deleted":'Firebase App named \'{$name}\' already deleted',"duplicate-service":'Firebase service named \'{$name}\' already registered',"sa-not-supported":'Initializing the Firebase SDK with a service '+'account is only allowed in a Node.js environment. On client '+'devices, you should instead initialize the SDK with an api key and '+'auth domain',"invalid-app-argument":'firebase.{$name}() takes either no argument or a '+'Firebase App instance.'}),firebase=createFirebaseNamespace();exports.firebase=firebase,exports.default=firebase},function(module){const decorations=function(){const funcMap=new WeakMap;return{add:function add(func,decorator){const parent=funcMap.has(func)?func:void 0,decoratedFunc=function(){func.apply(this,arguments)};return funcMap.set(decoratedFunc,{parent:parent,decorator:decorator}),decoratedFunc},getAll:function getAll(func){for(var iter=funcMap.get(func),decorators=[];iter!==void 0;)decorators.push(iter.decorator),iter=iter.parent;return decorators},isFunctionDecorated:function isFunctionDecorated(func){return funcMap.has(func)}}}();(function(){function executeDecoratorsOnNewComponent(component){const prot=Object.getPrototypeOf(component);Object.getOwnPropertyNames(prot).forEach(function(name){const prop=prot[name];'function'==typeof prop&&decorations.isFunctionDecorated(prop)&&decorations.getAll(prop).forEach(function(decorator){component[name]=decorator.call(component,name,prop)})})}function wrapComponent(name){const orig=AFRAME.components[name].Component;AFRAME.components[name].Component=function(){this.init=function(){delete this.init,executeDecoratorsOnNewComponent(this),this.init.apply(this,arguments)},orig.apply(this,arguments)},AFRAME.components[name].Component.prototype=orig.prototype}Object.keys(AFRAME.components).forEach(function(c){wrapComponent(c)}),function wrapRegister(){const origRegister=AFRAME.registerComponent;AFRAME.registerComponent=function(name){return origRegister.apply(AFRAME,arguments),wrapComponent(name)}}()})(),module.exports.decorate=function decorate(func,decoratorFunc){return decorations.add(func,decoratorFunc)}},function(module,exports,__webpack_require__){if('undefined'==typeof AFRAME)throw new Error('aframe-event-decorators was loaded before AFRAME was available');const eventBinder=__webpack_require__(40),decorate=__webpack_require__(14).decorate;module.exports.bindEvent=eventBinder.bindEvent,module.exports.bindEventPlayPause=eventBinder.bindEventPlayPause,module.exports.decorate=decorate},function(module,exports,__webpack_require__){module.exports=function buildSearchMethod(queryParam,url){return function search(query,args,callback){if('function'==typeof query&&'object'==typeof args||'object'==typeof callback)throw new errors.AlgoliaSearchError('index.search usage is index.search(query, params, cb)');0===arguments.length||'function'==typeof query?(callback=query,query=''):(1===arguments.length||'function'==typeof args)&&(callback=args,args=void 0),'object'==typeof query&&null!==query?(args=query,query=void 0):(void 0===query||null===query)&&(query='');var params='';void 0!==query&&(params+=queryParam+'='+encodeURIComponent(query));var additionalUA;return void 0!==args&&(args.additionalUA&&(additionalUA=args.additionalUA,delete args.additionalUA),params=this.as._getSearchParams(args,params)),this._search(params,url,callback,additionalUA)}};var errors=__webpack_require__(5)},function(module,exports,__webpack_require__){module.exports=function omit(obj,test){var keys=__webpack_require__(145),foreach=__webpack_require__(3),filtered={};return foreach(keys(obj),function doFilter(keyName){!0!==test(keyName)&&(filtered[keyName]=obj[keyName])}),filtered}},function(module){module.exports='function'==typeof Object.create?function inherits(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},function(module,__webpack_exports__,__webpack_require__){'use strict';function __values(o){var m='function'==typeof Symbol&&o[Symbol.iterator],i=0;return m?m.call(o):{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}}}function __read(o,n){var m='function'==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),ar=[],r,e;try{for(;(void 0===n||0<n--)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error:error}}finally{try{r&&!r.done&&(m=i['return'])&&m.call(i)}finally{if(e)throw e.error}}return ar}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}Object.defineProperty(__webpack_exports__,'__esModule',{value:!0}),__webpack_exports__.__extends=function __extends(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},__webpack_require__.d(__webpack_exports__,'__assign',function(){return __assign}),__webpack_exports__.__rest=function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&0>e.indexOf(p)&&(t[p]=s[p]);if(null!=s&&'function'==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)0>e.indexOf(p[i])&&(t[p[i]]=s[p[i]]);return t},__webpack_exports__.__decorate=function __decorate(decorators,target,key,desc){var c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;0<=i;i--)(d=decorators[i])&&(r=(3>c?d(r):3<c?d(target,key,r):d(target,key))||r);return 3<c&&r&&Object.defineProperty(target,key,r),r},__webpack_exports__.__param=function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}},__webpack_exports__.__metadata=function __metadata(metadataKey,metadataValue){if('object'==typeof Reflect&&'function'==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)},__webpack_exports__.__awaiter=function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator['throw'](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__webpack_exports__.__generator=function __generator(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError('Generator is already executing.');for(;_;)try{if(f=1,y&&(t=y[2&op[0]?'return':op[0]?'throw':'next'])&&!(t=t.call(y,op[1])).done)return t;switch((y=0,t)&&(op=[0,t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if((t=_.trys,!(t=0<t.length&&t[t.length-1]))&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue;}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},'function'==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g},__webpack_exports__.__exportStar=function __exportStar(m,exports){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])},__webpack_exports__.__values=__values,__webpack_exports__.__read=__read,__webpack_exports__.__spread=function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar},__webpack_exports__.__await=__await,__webpack_exports__.__asyncGenerator=function __asyncGenerator(thisArg,_arguments,generator){function verb(n){g[n]&&(i[n]=function(v){return new Promise(function(a,b){1<q.push([n,v,a,b])||resume(n,v)})})}function resume(n,v){try{step(g[n](v))}catch(e){settle(q[0][3],e)}}function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}function fulfill(value){resume('next',value)}function reject(value){resume('throw',value)}function settle(f,v){(f(v),q.shift(),q.length)&&resume(q[0][0],q[0][1])}if(!Symbol.asyncIterator)throw new TypeError('Symbol.asyncIterator is not defined.');var g=generator.apply(thisArg,_arguments||[]),q=[],i;return i={},verb('next'),verb('throw'),verb('return'),i[Symbol.asyncIterator]=function(){return this},i},__webpack_exports__.__asyncDelegator=function __asyncDelegator(o){function verb(n,f){o[n]&&(i[n]=function(v){return(p=!p)?{value:__await(o[n](v)),done:'return'===n}:f?f(v):v})}var i,p;return i={},verb('next'),verb('throw',function(e){throw e}),verb('return'),i[Symbol.iterator]=function(){return this},i},__webpack_exports__.__asyncValues=function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError('Symbol.asyncIterator is not defined.');var m=o[Symbol.asyncIterator];return m?m.call(o):'function'==typeof __values?__values(o):o[Symbol.iterator]()},__webpack_exports__.__makeTemplateObject=function __makeTemplateObject(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,'raw',{value:raw}):cooked.raw=raw,cooked},__webpack_exports__.__importStar=function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result},__webpack_exports__.__importDefault=function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])},__assign=Object.assign||function __assign(t){for(var i=1,n=arguments.length,s;i<n;i++)for(var p in s=arguments[i],s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}},function(){function copyArray(dest,source){var i;for(dest.length=0,i=0;i<source.length;i++)dest[i]=source[i]}if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');var OBSERVER_CONFIG={childList:!0,attributes:!0,subtree:!0};AFRAME.registerComponent('aabb-collider',{schema:{collideNonVisible:{default:!1},debug:{default:!1},enabled:{default:!0},interval:{default:80},objects:{default:''}},init:function(){this.centerDifferenceVec3=new THREE.Vector3,this.clearedIntersectedEls=[],this.closestIntersectedEl=null,this.boundingBox=new THREE.Box3,this.boxCenter=new THREE.Vector3,this.boxHelper=new THREE.BoxHelper,this.boxMax=new THREE.Vector3,this.boxMin=new THREE.Vector3,this.hitClosestClearEventDetail={},this.hitClosestEventDetail={},this.intersectedEls=[],this.objectEls=[],this.newIntersectedEls=[],this.prevCheckTime=void 0,this.previousIntersectedEls=[],this.setDirty=this.setDirty.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.hitStartEventDetail={intersectedEls:this.newIntersectedEls}},play:function(){this.observer.observe(this.el.sceneEl,OBSERVER_CONFIG),this.el.sceneEl.addEventListener('object3dset',this.setDirty),this.el.sceneEl.addEventListener('object3dremove',this.setDirty)},remove:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener('object3dset',this.setDirty),this.el.sceneEl.removeEventListener('object3dremove',this.setDirty)},tick:function(time){var boundingBox=this.boundingBox,centerDifferenceVec3=this.centerDifferenceVec3,clearedIntersectedEls=this.clearedIntersectedEls,intersectedEls=this.intersectedEls,el=this.el,newIntersectedEls=this.newIntersectedEls,objectEls=this.objectEls,prevCheckTime=this.prevCheckTime,previousIntersectedEls=this.previousIntersectedEls,self=this,boxHelper,closestCenterDifference,newClosestEl,i;if(this.data.enabled&&!(prevCheckTime&&time-prevCheckTime<this.data.interval)){for(this.prevCheckTime=time,this.dirty&&this.refreshObjects(),boundingBox.setFromObject(el.object3D),this.boxMin.copy(boundingBox.min),this.boxMax.copy(boundingBox.max),boundingBox.getCenter(this.boxCenter),this.data.debug&&(this.boxHelper.setFromObject(el.object3D),!this.boxHelper.parent&&el.sceneEl.object3D.add(this.boxHelper)),copyArray(previousIntersectedEls,intersectedEls),intersectedEls.length=0,i=0;i<objectEls.length;i++)if(objectEls[i]!==this.el){if(!this.data.collideNonVisible&&!objectEls[i].getAttribute('visible')){this.data.debug&&(boxHelper=objectEls[i].object3D.boxHelper,boxHelper&&(el.sceneEl.object3D.remove(boxHelper),objectEls[i].object3D.boxHelper=null));continue}this.isIntersecting(objectEls[i])&&intersectedEls.push(objectEls[i])}for(newIntersectedEls.length=0,i=0;i<intersectedEls.length;i++)-1===previousIntersectedEls.indexOf(intersectedEls[i])&&newIntersectedEls.push(intersectedEls[i]);for(clearedIntersectedEls.length=0,i=0;i<previousIntersectedEls.length;i++)-1===intersectedEls.indexOf(previousIntersectedEls[i])&&(previousIntersectedEls[i].hasAttribute('aabb-collider')||previousIntersectedEls[i].emit('hitend'),clearedIntersectedEls.push(previousIntersectedEls[i]));for(i=0;i<newIntersectedEls.length;i++)newIntersectedEls[i]!==this.el&&(newIntersectedEls[i].hasAttribute('aabb-collider')||newIntersectedEls[i].emit('hitstart'));for(i=0;i<intersectedEls.length;i++)intersectedEls[i]!==this.el&&(centerDifferenceVec3.copy(intersectedEls[i].object3D.boundingBoxCenter).sub(this.boxCenter),(void 0==closestCenterDifference||centerDifferenceVec3.length()<closestCenterDifference)&&(closestCenterDifference=centerDifferenceVec3.length(),newClosestEl=intersectedEls[i]));!intersectedEls.length&&this.closestIntersectedEl?(this.hitClosestClearEventDetail.el=this.closestIntersectedEl,this.closestIntersectedEl.emit('hitclosestclear'),this.closestIntersectedEl=null,el.emit('hitclosestclear',this.hitClosestClearEventDetail)):newClosestEl!==this.closestIntersectedEl&&(this.closestIntersectedEl&&(this.hitClosestClearEventDetail.el=this.closestIntersectedEl,this.closestIntersectedEl.emit('hitclosestclear',this.hitClosestClearEventDetail)),newClosestEl&&(newClosestEl.emit('hitclosest'),this.closestIntersectedEl=newClosestEl,this.hitClosestEventDetail.el=newClosestEl,el.emit('hitclosest',this.hitClosestEventDetail))),clearedIntersectedEls.length&&el.emit('hitend'),newIntersectedEls.length&&el.emit('hitstart',this.hitStartEventDetail)}},isIntersecting:function(){var boundingBox=new THREE.Box3;return function(el){var boxMin,boxMax;return boundingBox.setFromObject(el.object3D),this.data.debug&&(!el.object3D.boxHelper&&(el.object3D.boxHelper=new THREE.BoxHelper(el.object3D,new THREE.Color(Math.random(),Math.random(),Math.random())),el.sceneEl.object3D.add(el.object3D.boxHelper)),el.object3D.boxHelper.setFromObject(el.object3D)),boxMin=boundingBox.min,boxMax=boundingBox.max,el.object3D.boundingBoxCenter=el.object3D.boundingBoxCenter||new THREE.Vector3,boundingBox.getCenter(el.object3D.boundingBoxCenter),this.boxMin.x<=boxMax.x&&this.boxMax.x>=boxMin.x&&this.boxMin.y<=boxMax.y&&this.boxMax.y>=boxMin.y&&this.boxMin.z<=boxMax.z&&this.boxMax.z>=boxMin.z}}(),setDirty:function(){this.dirty=!0},refreshObjects:function(){var data=this.data;this.objectEls=data.objects?this.el.sceneEl.querySelectorAll(data.objects):this.el.sceneEl.children,this.dirty=!1}})},function(){if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');var audioBufferCache={};AFRAME.registerComponent('audioanalyser',{schema:{buffer:{default:!1},beatDetectionDecay:{default:0.99},beatDetectionMinVolume:{default:15},beatDetectionThrottle:{default:250},enabled:{default:!0},enableBeatDetection:{default:!0},enableLevels:{default:!0},enableWaveform:{default:!0},enableVolume:{default:!0},fftSize:{default:2048},smoothingTimeConstant:{default:0.8},src:{parse:function(val){return val.constructor===String?val.startsWith('#')||val.startsWith('.')?document.querySelector(val):val:val}},unique:{default:!1}},init:function(){var data=this.data,analyser,gainNode;this.audioEl=null,this.context=new AudioContext,this.levels=null,this.waveform=null,this.volume=0,this.xhr=null,analyser=this.analyser=this.context.createAnalyser(),gainNode=this.gainNode=this.context.createGain(),gainNode.connect(analyser),analyser.connect(this.context.destination),analyser.fftSize=data.fftSize,analyser.smoothingTimeConstant=data.smoothingTimeConstant,this.levels=new Uint8Array(analyser.frequencyBinCount),this.waveform=new Uint8Array(analyser.fftSize)},update:function(oldData){var analyser=this.analyser,data=this.data;(oldData.fftSize!==data.fftSize||oldData.smoothingTimeConstant!==data.smoothingTimeConstant)&&(analyser.fftSize=data.fftSize,analyser.smoothingTimeConstant=data.smoothingTimeConstant,this.levels=new Uint8Array(analyser.frequencyBinCount),this.waveform=new Uint8Array(analyser.fftSize));data.src&&this.refreshSource()},tick:function(t,dt){var data=this.data,volume;if(data.enabled){if((data.enableLevels||data.enableVolume)&&this.analyser.getByteFrequencyData(this.levels),data.enableWaveform&&this.analyser.getByteTimeDomainData(this.waveform),data.enableVolume||data.enableBeatDetection){for(var sum=0,i=0;i<this.levels.length;i++)sum+=this.levels[i];this.volume=sum/this.levels.length}data.enableBeatDetection&&(volume=this.volume,!this.beatCutOff&&(this.beatCutOff=volume),volume>this.beatCutOff&&volume>this.data.beatDetectionMinVolume?(this.el.emit('audioanalyserbeat',null,!1),this.beatCutOff=1.5*volume,this.beatTime=0):this.beatTime<=this.data.beatDetectionThrottle?this.beatTime+=dt:(this.beatCutOff*=this.data.beatDetectionDecay,this.beatCutOff=Math.max(this.beatCutOff,this.data.beatDetectionMinVolume)))}},refreshSource:function(){var analyser=this.analyser,data=this.data;data.buffer&&data.src.constructor===String?this.getBufferSource().then(source=>{this.source=source,this.source.connect(this.gainNode)}):(this.source=this.getMediaSource(),this.source.connect(this.gainNode))},suspendContext:function(){this.context.suspend()},resumeContext:function(){this.context.resume()},fetchAudioBuffer:function(src){return audioBufferCache[src]?audioBufferCache[src].constructor===Promise?audioBufferCache[src]:Promise.resolve(audioBufferCache[src]):(audioBufferCache[src]=new Promise(resolve=>{const xhr=this.xhr=new XMLHttpRequest;xhr.open('GET',src),xhr.responseType='arraybuffer',xhr.addEventListener('load',()=>{this.context.decodeAudioData(xhr.response).then(audioBuffer=>{audioBufferCache[src]=audioBuffer,resolve(audioBuffer)}).catch(console.error)}),xhr.send()}),audioBufferCache[src])},getBufferSource:function(){var data=this.data;return this.fetchAudioBuffer(data.src).then(()=>{var source;return source=this.context.createBufferSource(),source.buffer=audioBufferCache[data.src],this.el.emit('audioanalyserbuffersource',source,!1),source}).catch(console.error)},getMediaSource:function(){return this.data.src.constructor===String?(!this.audio&&(this.audio=document.createElement('audio'),this.audio.crossOrigin='anonymous'),this.audio.setAttribute('src',this.data.src)):this.audio=this.data.src,this.context.createMediaElementSource(this.audio)}})},function(){var styleParser=AFRAME.utils.styleParser;if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');AFRAME.registerComponent('event-set',{schema:{default:'',parse:function(value){return styleParser.parse(value)}},multiple:!0,init:function(){this.eventHandler=null,this.eventName=null},update:function(){this.removeEventListener(),this.updateEventListener(),this.addEventListener()},remove:function(){this.removeEventListener()},pause:function(){this.removeEventListener()},play:function(){this.addEventListener()},updateEventListener:function(){var data=this.data,el=this.el,event,target,targetEl;event=data._event||this.id,target=data._target,targetEl=target?el.sceneEl.querySelector(target):el,this.eventName=event,this.eventHandler=function handler(){for(var propName in data)'_event'!==propName&&'_target'!==propName&&AFRAME.utils.entity.setComponentProperty.call(this,targetEl,propName,data[propName])}},addEventListener:function(){this.el.addEventListener(this.eventName,this.eventHandler)},removeEventListener:function(){this.el.removeEventListener(this.eventName,this.eventHandler)}})},function(module,exports,__webpack_require__){THREE.BufferGeometryUtils||__webpack_require__(41),AFRAME.registerComponent('geometry-merger',{schema:{preserveOriginal:{default:!1}},init:function(){var self=this;this.geometry=new THREE.Geometry,this.mesh=new THREE.Mesh(this.geometry),this.el.setObject3D('mesh',this.mesh),this.faceIndex={},this.vertexIndex={},this.el.object3D.traverse(function(mesh){'Mesh'!==mesh.type||mesh===self.mesh||(self.faceIndex[mesh.parent.uuid]=[self.geometry.faces.length,self.geometry.faces.length+mesh.geometry.faces.length-1],self.vertexIndex[mesh.parent.uuid]=[self.geometry.vertices.length,self.geometry.vertices.length+mesh.geometry.vertices.length-1],mesh.parent.updateMatrix(),self.geometry.merge(mesh.geometry,mesh.parent.matrix),!self.data.preserveOriginal&&mesh.parent.remove(mesh))})}}),AFRAME.registerComponent('buffer-geometry-merger',{schema:{preserveOriginal:{default:!1}},init:function(){var geometries=[];this.el.sceneEl.object3D.updateMatrixWorld(),this.el.object3D.traverse(function(mesh){'Mesh'!==mesh.type||mesh.el===self.el||(mesh.geometry.applyMatrix(mesh.matrixWorld),geometries.push(mesh.geometry.clone()),mesh.parent.remove(mesh))});const geometry=THREE.BufferGeometryUtils.mergeBufferGeometries(geometries);this.mesh=new THREE.Mesh(geometry),this.el.setObject3D('mesh',this.mesh)}})},function(){if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');AFRAME.registerComponent('haptics',{dependencies:['tracked-controls'],schema:{actuatorIndex:{default:0},dur:{default:100},enabled:{default:!0},events:{type:'array'},eventsFrom:{type:'string'},force:{default:1}},multiple:!0,init:function(){var data=this.data,self=this;if(this.callPulse=function(){self.pulse()},this.el.components['tracked-controls'].controller){if(this.gamepad=this.el.components['tracked-controls'].controller,!this.gamepad||!this.gamepad.hapticActuators.length)return;this.addEventListeners()}else this.el.addEventListener('controllerconnected',function init(){setTimeout(function(){self.gamepad=self.el.components['tracked-controls'].controller,self.gamepad&&self.gamepad.hapticActuators.length&&self.addEventListeners()},150)})},remove:function(){this.removeEventListeners()},pulse:function(force,dur){var data=this.data,actuator;data.enabled&&this.gamepad&&this.gamepad.hapticActuators&&(actuator=this.gamepad.hapticActuators[data.actuatorIndex],actuator.pulse(force||data.force,dur||data.dur))},addEventListeners:function(){var data=this.data,i,listenTarget;for(listenTarget=data.eventsFrom?document.querySelector(data.eventsFrom):this.el,i=0;i<data.events.length;i++)listenTarget.addEventListener(data.events[i],this.callPulse)},removeEventListeners:function(){var data=this.data,i,listenTarget;for(listenTarget=data.eventsFrom?document.querySelector(data.eventsFrom):this.el,i=0;i<data.events.length;i++)listenTarget.removeEventListener(data.events[i],this.callPulse)}})},function(module){function getBoxPositions(data,numChildren,marginDefined){var rows=Math.ceil(numChildren/data.columns),column,marginColumn,marginRow,offsetColumn,offsetRow,row;for(marginColumn=data.marginColumn,marginRow=data.marginRow,marginDefined&&(marginColumn=data.margin,marginRow=data.margin),offsetRow=getOffsetItemIndex(data.align,rows),offsetColumn=getOffsetItemIndex(data.align,data.columns),row=0;row<rows;row++)for(column=0;column<data.columns;column++)positionHelper.set(0,0,0),0===data.plane.indexOf('x')&&(positionHelper.x=(column-offsetColumn)*marginColumn),0===data.plane.indexOf('y')&&(positionHelper.y=(column-offsetColumn)*marginColumn),1===data.plane.indexOf('y')&&(positionHelper.y=(row-offsetRow)*marginRow),1===data.plane.indexOf('z')&&(positionHelper.z=(row-offsetRow)*marginRow),pushPositionVec3(positionHelper);return positions}function getCirclePositions(data,numChildren){var i,rad;for(i=0;i<numChildren;i++)rad,rad=isNaN(data.angle)?i*(2*Math.PI)/numChildren:0.01745329252*(i*data.angle),positionHelper.set(0,0,0),0===data.plane.indexOf('x')&&(positionHelper.x=data.radius*_Mathcos(rad)),0===data.plane.indexOf('y')&&(positionHelper.y=data.radius*_Mathcos(rad)),1===data.plane.indexOf('y')&&(positionHelper.y=data.radius*_Mathsin(rad)),1===data.plane.indexOf('z')&&(positionHelper.z=data.radius*_Mathsin(rad)),pushPositionVec3(positionHelper);return positions}function getLinePositions(data,numChildren){return data.columns=numChildren,getBoxPositions(data,numChildren,!0)}function getCubePositions(data){return pushPositions(1,0,0,0,1,0,0,0,1,-1,0,0,0,-1,0,0,0,-1),scalePositions(data.radius/2),positions}function getDodecahedronPositions(data){var PHI=(1+2.23606797749979)/2,B=1/PHI,C=2-PHI,NB=-1*B,NC=-1*C;return pushPositions(-1,C,0,-1,NC,0,0,-1,C,0,-1,NC,0,1,C,0,1,NC,1,C,0,1,NC,0,B,B,B,B,B,NB,B,NB,B,B,NB,NB,C,0,1,C,0,-1,NB,B,B,NB,B,NB,NB,NB,B,NB,NB,NB,NC,0,1,NC,0,-1),scalePositions(data.radius/2),positions}function getPyramidPositions(data){var NEG_SQRT_1_3=-1/1.7320508075688772;return pushPositions(0,0,1.7320508075688772+NEG_SQRT_1_3,-1,0,NEG_SQRT_1_3,1,0,NEG_SQRT_1_3,0,2*0.816496580927726,0),scalePositions(data.radius/2),positions}function getOffsetItemIndex(align,numItems){return'start'===align?numItems-1:'center'===align?(numItems-1)/2:'end'===align?0:void 0}function scalePositions(scale){var i;for(i=0;i<positions.length;i++)positions[i]*=scale}function setPositions(els,positions,orderAttribute){var value,i,orderIndex;if(orderAttribute){for(i=0;i<els.length;i++)(value=els[i].getAttribute(orderAttribute),null!==value&&void 0!==value)&&(orderIndex=3*parseInt(value,10),els[i].object3D.position.set(positions[orderIndex],positions[orderIndex+1],positions[orderIndex+2]));return}for(i=0;i<positions.length;i+=3){if(!els[i/3])return;els[i/3].object3D.position.set(positions[i],positions[i+1],positions[i+2])}}function pushPositions(){var i;for(i=0;i<arguments.length;i++)positions.push(i)}function pushPositionVec3(vec3){positions.push(vec3.x),positions.push(vec3.y),positions.push(vec3.z)}var _Mathsin=Math.sin,_Mathcos=Math.cos,positions=[],positionHelper=new THREE.Vector3;AFRAME.registerComponent('layout',{schema:{angle:{type:'number',default:!1,min:0,max:360,if:{type:['circle']}},columns:{default:1,min:0,if:{type:['box']}},margin:{default:1,min:0,if:{type:['box','line']}},marginColumn:{default:1,min:0,if:{type:['box']}},marginRow:{default:1,min:0,if:{type:['box']}},orderAttribute:{default:''},plane:{default:'xy'},radius:{default:1,min:0,if:{type:['circle','cube','dodecahedron','pyramid']}},reverse:{default:!1},type:{default:'line',oneOf:['box','circle','cube','dodecahedron','line','pyramid']},fill:{default:!0,if:{type:['circle']}},align:{default:'end',oneOf:['start','center','end']}},init:function(){var self=this,el=this.el;this.children=el.getChildEntities(),this.initialPositions=[],this.children.forEach(function getInitialPositions(childEl){function _getPositions(){self.initialPositions.push(childEl.object3D.position.x),self.initialPositions.push(childEl.object3D.position.y),self.initialPositions.push(childEl.object3D.position.z)}return childEl.hasLoaded?_getPositions():void childEl.addEventListener('loaded',_getPositions)}),this.handleChildAttached=this.handleChildAttached.bind(this),this.handleChildDetached=this.handleChildDetached.bind(this),el.addEventListener('child-attached',this.handleChildAttached),el.addEventListener('child-detached',this.handleChildDetached),el.addEventListener('layoutrefresh',this.update.bind(this))},update:function(){var children=this.children,data=this.data,el=this.el,definedData,numChildren,positionFn;switch(numChildren=children.length,data.type){case'box':{positionFn=getBoxPositions;break}case'circle':{positionFn=getCirclePositions;break}case'cube':{positionFn=getCubePositions;break}case'dodecahedron':{positionFn=getDodecahedronPositions;break}case'pyramid':{positionFn=getPyramidPositions;break}default:positionFn=getLinePositions;}definedData=el.getDOMAttribute('layout'),positions.length=0,positions=positionFn(data,numChildren,'string'==typeof definedData?-1!==definedData.indexOf('margin'):'margin'in definedData),data.reverse&&positions.reverse(),setPositions(children,positions,data.orderAttribute)},remove:function(){this.el.removeEventListener('child-attached',this.handleChildAttached),this.el.removeEventListener('child-detached',this.handleChildDetached),setPositions(this.children,this.initialPositions)},handleChildAttached:function(evt){var el=this.el;evt.detail.el.parentNode!==el||(this.children.push(evt.detail.el),this.update())},handleChildDetached:function(evt){-1===this.children.indexOf(evt.detail.el)||(this.children.splice(this.children.indexOf(evt.detail.el),1),this.initialPositions.splice(this.children.indexOf(evt.detail.el),1),this.update())}}),module.exports.getBoxPositions=getBoxPositions,module.exports.getCirclePositions=getCirclePositions,module.exports.getLinePositions=getLinePositions,module.exports.getCubePositions=getCubePositions,module.exports.getDodecahedronPositions=getDodecahedronPositions,module.exports.getPyramidPositions=getPyramidPositions},function(module,exports,__webpack_require__){__webpack_require__(42),AFRAME.registerComponent('orbit-controls',{dependencies:['camera'],schema:{autoRotate:{type:'boolean'},autoRotateSpeed:{default:2},dampingFactor:{default:0.1},enabled:{default:!0},enableDamping:{default:!0},enableKeys:{default:!0},enablePan:{default:!0},enableRotate:{default:!0},enableZoom:{default:!0},initialPosition:{type:'vec3'},keyPanSpeed:{default:7},minAzimuthAngle:{type:'number',default:Infinity},maxAzimuthAngle:{type:'number',default:Infinity},maxDistance:{default:1e3},maxPolarAngle:{default:AFRAME.utils.device.isMobile()?90:120},minDistance:{default:1},minPolarAngle:{default:0},minZoom:{default:0},panSpeed:{default:1},rotateSpeed:{default:0.05},screenSpacePanning:{default:!1},target:{type:'vec3'},zoomSpeed:{default:0.5}},init:function(){var el=this.el,oldPosition;this.controls=new THREE.OrbitControls(el.getObject3D('camera'),el.sceneEl.renderer.domElement),oldPosition=new THREE.Vector3,el.sceneEl.addEventListener('enter-vr',()=>{(AFRAME.utils.device.checkHeadsetConnected()||AFRAME.utils.device.isMobile())&&(this.controls.enabled=!1,el.hasAttribute('look-controls')&&(el.setAttribute('look-controls','enabled',!0),oldPosition.copy(el.getObject3D('camera').position),el.getObject3D('camera').position.set(0,0,0)))}),el.sceneEl.addEventListener('exit-vr',()=>{(AFRAME.utils.device.checkHeadsetConnected()||AFRAME.utils.device.isMobile())&&(this.controls.enabled=!0,el.getObject3D('camera').position.copy(oldPosition),el.hasAttribute('look-controls')&&el.setAttribute('look-controls','enabled',!1))}),document.body.style.cursor='grab',document.addEventListener('mousedown',()=>{document.body.style.cursor='grabbing'}),document.addEventListener('mouseup',()=>{document.body.style.cursor='grab'}),this.target=new THREE.Vector3,el.getObject3D('camera').position.copy(this.data.initialPosition)},update:function(){var controls=this.controls,data=this.data;controls.target=this.target.copy(data.target),controls.autoRotate=data.autoRotate,controls.autoRotateSpeed=data.autoRotateSpeed,controls.dampingFactor=data.dampingFactor,controls.enabled=data.enabled,controls.enableDamping=data.enableDamping,controls.enableKeys=data.enableKeys,controls.enablePan=data.enablePan,controls.enableRotate=data.enableRotate,controls.enableZoom=data.enableZoom,controls.keyPanSpeed=data.keyPanSpeed,controls.maxPolarAngle=THREE.Math.degToRad(data.maxPolarAngle),controls.maxDistance=data.maxDistance,controls.minDistance=data.minDistance,controls.minPolarAngle=THREE.Math.degToRad(data.minPolarAngle),controls.minZoom=data.minZoom,controls.panSpeed=data.panSpeed,controls.rotateSpeed=data.rotateSpeed,controls.screenSpacePanning=data.screenSpacePanning,controls.zoomSpeed=data.zoomSpeed},tick:function(){var controls=this.controls,data=this.data;!data.enabled||controls.enabled&&(controls.enableDamping||controls.autoRotate)&&this.controls.update()}})},function(){AFRAME.registerComponent('proxy-event',{schema:{captureBubbles:{default:!1},enabled:{default:!0},event:{type:'string'},from:{type:'string'},to:{type:'string'},as:{type:'string'},bubbles:{default:!1}},multiple:!0,init:function(){var data=this.data,el=this.el,self=this,from,i,to;if(data.from?'PARENT'===data.from?from=[el.parentNode]:from=document.querySelectorAll(data.from):'CHILDREN'===data.to?to=el.querySelectorAll('*'):'SELF'===data.to?to=[el]:to=document.querySelectorAll(data.to),data.from)for(i=0;i<from.length;i++)this.addEventListenerFrom(from[i]);else el.addEventListener(data.event,function(evt){var data=self.data;if(data.enabled&&(data.captureBubbles||evt.target===el))for(i=0;i<to.length;i++)to[i].emit(data.as||data.event,evt.detail?evt.detail:null,data.bubbles)})},addEventListenerFrom:function(fromEl){var data=this.data,self=this;fromEl.addEventListener(data.event,function(evt){var data=self.data;data.enabled&&(data.captureBubbles||evt.target===fromEl)&&self.el.emit(data.as||data.event,evt.detail?evt.detail:null,!1)})}})},function(module){(function webpackUniversalModuleDefinition(root,factory){module.exports=factory()})('undefined'==typeof self?this:self,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default']}:function getModuleExports(){return module};return __webpack_require__.d(getter,'a',getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p='',__webpack_require__(__webpack_require__.s=0)}([function(module,exports,__webpack_require__){if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');AFRAME.registerShader('ring',{schema:{blur:{default:0.01,is:'uniform'},color:{type:'color',is:'uniform'},progress:{default:0,is:'uniform'},radiusInner:{default:0.85,is:'uniform'},radiusOuter:{default:1,is:'uniform'}},vertexShader:__webpack_require__(1),fragmentShader:__webpack_require__(2)})},function(module){module.exports='varying vec2 vUv;\n\nvoid main () {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n'},function(module){module.exports='#define PI 3.14159265358979\nuniform float blur;\nuniform float progress;\nuniform float radiusInner;\nuniform float radiusOuter;\nuniform vec3 color;\n\nvarying vec2 vUv;\n\nvoid main () {\n  vec2 uv = vec2(vUv.x * 2. - 1., vUv.y * 2. - 1.);\n  float r = uv.x * uv.x + uv.y * uv.y;\n  float col = (1.0 - smoothstep(radiusOuter, radiusOuter + blur, r)) * smoothstep(radiusInner, radiusInner + blur, r);\n  float a = smoothstep(-PI, PI, atan(uv.y, uv.x));\n  float p = 1.0 - progress - blur;\n  col *= smoothstep(p, p + blur, a);\n  gl_FragColor = vec4(color * col, col);\n}\n'}])})},function(){function parseSide(side){return'back'===side?THREE.BackSide:'double'===side?THREE.DoubleSide:THREE.FrontSide}if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');AFRAME.registerComponent('slice9',{schema:{width:{default:1,min:0},height:{default:1,min:0},left:{default:0,min:0},right:{default:0,min:0},bottom:{default:0,min:0},top:{default:0,min:0},side:{default:'front',oneOf:['front','back','double']},padding:{default:0.1,min:0.01},color:{type:'color',default:'#fff'},opacity:{default:1,min:0,max:1},transparent:{default:!0},debug:{default:!1},src:{type:'map'}},multiple:!1,init:function(){var data=this.data,material=this.material=new THREE.MeshBasicMaterial({color:data.color,opacity:data.opacity,transparent:data.transparent,wireframe:data.debug}),geometry=this.geometry=new THREE.PlaneBufferGeometry(data.width,data.height,3,3),textureLoader=new THREE.TextureLoader;this.plane=new THREE.Mesh(geometry,material),this.el.setObject3D('mesh',this.plane),this.textureSrc=null},updateMap:function(){function setMap(texture){this.material.map=texture,this.material.needsUpdate=!0,this.regenerateMesh()}var src=this.data.src;return src?src===this.textureSrc?void 0:(this.textureSrc=src,void this.el.sceneEl.systems.material.loadTexture(src,{src:src},setMap.bind(this))):void(!this.material.map||setMap(null))},regenerateMesh:function(){function setPos(id,x,y){pos[3*id]=x,pos[3*id+1]=y}function setUV(id,u,v){uvs[2*id]=u,uvs[2*id+1]=v}var data=this.data,pos=this.geometry.attributes.position.array,uvs=this.geometry.attributes.uv.array,image=this.material.map.image;if(image){var uv={left:data.left/image.width,right:data.right/image.width,top:data.top/image.height,bottom:data.bottom/image.height};setUV(1,uv.left,1),setUV(2,uv.right,1),setUV(4,0,uv.bottom),setUV(5,uv.left,uv.bottom),setUV(6,uv.right,uv.bottom),setUV(7,1,uv.bottom),setUV(8,0,uv.top),setUV(9,uv.left,uv.top),setUV(10,uv.right,uv.top),setUV(11,1,uv.top),setUV(13,uv.left,0),setUV(14,uv.right,0);var w2=data.width/2,h2=data.height/2,left=-w2+data.padding,right=w2-data.padding,top=h2-data.padding,bottom=-h2+data.padding;setPos(0,-w2,h2),setPos(1,left,h2),setPos(2,right,h2),setPos(3,w2,h2),setPos(4,-w2,top),setPos(5,left,top),setPos(6,right,top),setPos(7,w2,top),setPos(8,-w2,bottom),setPos(9,left,bottom),setPos(10,right,bottom),setPos(11,w2,bottom),setPos(13,left,-h2),setPos(14,right,-h2),setPos(12,-w2,-h2),setPos(15,w2,-h2),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0}},update:function(oldData){var data=this.data;this.material.color.setStyle(data.color),this.material.opacity=data.opacity,this.material.transparent=data.transparent,this.material.wireframe=data.debug,this.material.side=parseSide(data.side);var diff=AFRAME.utils.diff(data,oldData);'src'in diff?this.updateMap():('width'in diff||'height'in diff||'padding'in diff||'left'in diff||'top'in diff||'bottom'in diff||'right'in diff)&&this.regenerateMesh()},remove:function(){},pause:function(){},play:function(){}})},function(module){(function webpackUniversalModuleDefinition(root,factory){module.exports=factory()})('undefined'==typeof self?this:self,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default']}:function getModuleExports(){return module};return __webpack_require__.d(getter,'a',getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p='',__webpack_require__(__webpack_require__.s=1)}([function(module){'use strict';function generateExpression(str){return str=str.replace(DOT_NOTATION_RE,'["$1"]'),str=str.replace(ROOT_STATE_SELECTOR_RE,'$1state["$2"]'),str=str.replace(STATE_SELECTOR_RE,'$1$2$3state["$4"]'),str=str.replace(ITEM_RE,'item'),str}function composeFunctions(){var functions=arguments;return function(){var i;for(i=0;i<functions.length;i++)functions[i].apply(this,arguments)}}function parseKeyToWatch(str){var dotIndex;return str=stripNot(str.trim()),dotIndex=str.indexOf('.'),-1===dotIndex?str:str.substring(0,str.indexOf('.'))}function stripNot(str){if(0===str.indexOf('!!'))return str.replace('!!','');return 0===str.indexOf('!')?str.replace('!',''):str}function split(str,delimiter){return(SPLIT_CACHE[delimiter]||(SPLIT_CACHE[delimiter]={}),SPLIT_CACHE[delimiter][str])?SPLIT_CACHE[delimiter][str]:(SPLIT_CACHE[delimiter][str]=str.split(delimiter),SPLIT_CACHE[delimiter][str])}var selectFunctions={};module.exports.select=function select(state,selector,item){return selectFunctions[selector]||(selectFunctions[selector]=new Function('state','item','return '+generateExpression(selector)+';')),selectFunctions[selector](state,item)};var DOT_NOTATION_RE=/\.([A-Za-z][\w_-]*)/g,WHITESPACE_RE=/\s/g,STATE_SELECTOR_RE=/([=&|!?:+-])(\s*)([\(]?)([A-Za-z][\w_-]*)/g,ROOT_STATE_SELECTOR_RE=/^([\(]?)([A-Za-z][\w_-]*)/g,ITEM_RE=/state\["item"\]/g;module.exports.generateExpression=generateExpression,module.exports.clearObject=function clearObject(obj){for(var key in obj)delete obj[key]},module.exports.composeHandlers=function composeHandlers(){var inputHandlers=arguments,actionName,i,outputHandlers;for(outputHandlers={},i=0;i<inputHandlers.length;i++)for(actionName in inputHandlers[i])actionName in outputHandlers?outputHandlers[actionName].constructor===Array?outputHandlers[actionName].push(inputHandlers[i][actionName]):outputHandlers[actionName]=[outputHandlers[actionName],inputHandlers[i][actionName]]:outputHandlers[actionName]=inputHandlers[i][actionName];for(actionName in outputHandlers)outputHandlers[actionName].constructor===Array&&(outputHandlers[actionName]=composeFunctions.apply(this,outputHandlers[actionName]));return outputHandlers},module.exports.composeFunctions=composeFunctions;var NO_WATCH_TOKENS=['||','&&','!=','!==','==','===','>','<','<=','>='],WHITESPACE_PLUS_RE=/\s+/;module.exports.parseKeysToWatch=function parseKeysToWatch(keys,str,isBindItem){var i,tokens;for(tokens=split(str,WHITESPACE_PLUS_RE),i=0;i<tokens.length;i++)if(-1===NO_WATCH_TOKENS.indexOf(tokens[i])&&!tokens[i].startsWith('\'')&&-1===keys.indexOf(tokens[i])){if(isBindItem&&'item'===tokens[i])continue;keys.push(parseKeyToWatch(tokens[i]))}};var SPLIT_CACHE={};module.exports.split=split,module.exports.copyArray=function copyArray(dest,src){var i;for(dest.length=0,i=0;i<src.length;i++)dest[i]=src[i]}},function(module,exports,__webpack_require__){'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&'function'==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};__webpack_require__(2);var diff=__webpack_require__(3),lib=__webpack_require__(0),wrapArray=__webpack_require__(4).wrapArray,State={initialState:{},nonBindedStateKeys:[],handlers:{},computeState:function computeState(){}},TYPE_OBJECT='object',WHITESPACE_REGEX=/s+/;AFRAME.registerState=function(definition){AFRAME.utils.extend(State,definition)},AFRAME.registerSystem('state',{init:function init(){var _this=this,key;for(key in this.arrays=[],this.dirtyArrays=[],this.diff={},this.state=AFRAME.utils.clone(State.initialState),this.subscriptions=[],this.initEventHandlers(),this.state)this.state[key]&&this.state[key].constructor===Array&&(this.arrays.push(key),this.state[key].__dirty=!0,wrapArray(this.state[key]));this.lastState=AFRAME.utils.clone(this.state),this.eventDetail={lastState:this.lastState,state:this.state},this.el.addEventListener('loaded',function(){var i;for(State.computeState(_this.state,'@@INIT'),i=0;i<_this.subscriptions.length;i++)_this.subscriptions[i].onStateUpdate(_this.state)})},dispatch:function dispatch(actionName,payload){var i,key;for(key in State.handlers[actionName](this.state,payload),State.computeState(this.state,actionName,payload),this.diff)delete this.diff[key];for(diff(this.lastState,this.state,this.diff,State.nonBindedStateKeys),this.dirtyArrays.length=0,i=0;i<this.arrays.length;i++)this.state[this.arrays[i]].__dirty&&this.dirtyArrays.push(this.arrays[i]);for(i=0;i<this.subscriptions.length;i++){if('bind-for'===this.subscriptions[i].name){if(!this.state[this.subscriptions[i].keysToWatch[0]].__dirty)continue;}else if(!this.shouldUpdate(this.subscriptions[i].keysToWatch,this.diff,this.dirtyArrays))continue;this.subscriptions[i].onStateUpdate()}for(key in this.state)this.state[key]&&this.state[key].constructor===Array&&(this.state[key].__dirty=!1);this.copyState(this.lastState,this.state),this.eventDetail.action=actionName,this.eventDetail.payload=payload,this.el.emit('stateupdate',this.eventDetail)},copyState:function copyState(lastState,state,isRecursive){for(var key in state)if(isRecursive||-1===State.nonBindedStateKeys.indexOf(key)){if(state[key]&&state[key].constructor===Object){if(!(key in lastState)){lastState[key]=AFRAME.utils.clone(state[key]);continue}this.copyState(lastState[key],state[key],!0);continue}lastState[key]=state[key]}},subscribe:function subscribe(component){this.subscriptions.push(component)},unsubscribe:function unsubscribe(component){this.subscriptions.splice(this.subscriptions.indexOf(component),1)},shouldUpdate:function shouldUpdate(keysToWatch,diff,dirtyArrays){for(var i=0;i<keysToWatch.length;i++)if(keysToWatch[i]in diff||-1!==dirtyArrays.indexOf(keysToWatch[i]))return!0;return!1},initEventHandlers:function initEventHandlers(){function registerListener(actionName){var _this2=this;this.el.addEventListener(actionName,function(evt){_this2.dispatch(actionName,evt.detail)})}var registeredActions=[],self=this,actionName;for(actionName in registerListener=registerListener.bind(this),State.handlers)-1===registeredActions.indexOf(actionName)&&(registeredActions.push(actionName),registerListener(actionName))},renderTemplate:function(){var interpRegex=/{{\s*(\w*\.)?([\w.]+)\s*}}/g;return function(template,data,asString){var match,str;if(str=template,data)for(;match=interpRegex.exec(template);)str=str.replace(match[0],('undefined'==typeof data?'undefined':_typeof(data))===TYPE_OBJECT?lib.select(data,match[2])||'':data);return asString?str:document.createRange().createContextualFragment(str)}}(),select:lib.select}),AFRAME.registerComponent('bind',{schema:{default:{},parse:function parse(value){var data,i,properties,pair;if(value.constructor===Object)return value;if(-1===value.indexOf(':'))return value;for(data={},properties=lib.split(value,';'),i=0;i<properties.length;i++)pair=lib.split(properties[i].trim(),':'),data[pair[0]]=pair[1].trim();return data}},multiple:!0,init:function init(){var data=this.data,componentId;this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system=this.el.sceneEl.systems.state,this.id&&(componentId=lib.split(this.id,'__')[0]),this.isNamespacedBind=this.id&&componentId in AFRAME.components&&!AFRAME.components[componentId].isSingleProp||componentId in AFRAME.systems,this.lastData={},this.updateObj={},this.system.subscribe(this),this.onStateUpdate=this.onStateUpdate.bind(this)},update:function update(){var data=this.data,key;if(this.keysToWatch.length=0,'string'==typeof data)lib.parseKeysToWatch(this.keysToWatch,data);else for(key in data)lib.parseKeysToWatch(this.keysToWatch,data[key]);this.onStateUpdate()},onStateUpdate:function onStateUpdate(){var hasKeys=!1,el=this.el,propertyName,stateSelector,state,value;if(el.parentNode){if(this.isNamespacedBind&&lib.clearObject(this.updateObj),state=this.system.state,_typeof(this.data)!==TYPE_OBJECT){try{value=lib.select(state,this.data)}catch(e){throw new Error('[aframe-state-component] Key \''+this.data+'\' not found in state.'+(' #'+this.el.getAttribute('id')+'['+this.attrName+']'))}return('undefined'==typeof value?'undefined':_typeof(value))!==TYPE_OBJECT&&_typeof(this.lastData)!==TYPE_OBJECT&&this.lastData===value?void 0:(AFRAME.utils.entity.setComponentProperty(el,this.id,value),void(this.lastData=value))}for(propertyName in this.data){stateSelector=this.data[propertyName].trim();try{value=lib.select(state,stateSelector)}catch(e){throw console.log(e),new Error('[aframe-state-component] Key \''+stateSelector+'\' not found in state.'+(' #'+this.el.getAttribute('id')+'['+this.attrName+']'))}if(('undefined'==typeof value?'undefined':_typeof(value))===TYPE_OBJECT||_typeof(this.lastData[propertyName])===TYPE_OBJECT||this.lastData[propertyName]!==value){if(propertyName in AFRAME.components&&void 0===value)return void el.removeAttribute(propertyName);this.isNamespacedBind?this.updateObj[propertyName]=value:AFRAME.utils.entity.setComponentProperty(el,propertyName,value),this.lastData[propertyName]=value}}for(hasKeys in this.updateObj);this.isNamespacedBind&&hasKeys&&el.setAttribute(this.id,this.updateObj)}},remove:function remove(){this.system.unsubscribe(this)}}),AFRAME.registerComponent('bind-toggle',{schema:{type:'string'},multiple:!0,init:function init(){this.system=this.el.sceneEl.systems.state,this.keysToWatch=[],this.onStateUpdate=this.onStateUpdate.bind(this),this.system.subscribe(this),this.onStateUpdate()},update:function update(){this.keysToWatch.length=0,lib.parseKeysToWatch(this.keysToWatch,this.data)},onStateUpdate:function onStateUpdate(){var el=this.el,state,value;state=this.system.state;try{value=lib.select(state,this.data)}catch(e){throw new Error('[aframe-state-component] Key \''+this.data+'\' not found in state.'+(' #'+this.el.getAttribute('id')+'['+this.attrName+']'))}value?el.setAttribute(this.id,''):el.removeAttribute(this.id)},remove:function remove(){this.system.unsubscribe(this)}}),module.exports={composeFunctions:lib.composeFunctions,composeHandlers:lib.composeHandlers,select:lib.select}},function(module,exports,__webpack_require__){'use strict';var lib=__webpack_require__(0),ITEM_RE=/item/,ITEM_PREFIX_RE=/item./,ITEM_SELECTOR_RE=/item.(\w+)/;AFRAME.registerComponent('bind-for',{schema:{delay:{default:0},for:{type:'string',default:'item'},in:{type:'string'},key:{type:'string'},pool:{default:0},template:{type:'string'},updateInPlace:{default:!1}},init:function init(){this.system=this.el.sceneEl.systems.state,this.onStateUpdate=this.onStateUpdate.bind(this),this.keysToWatch=[],this.renderedKeys=[],this.system.subscribe(this),this.template=this.el.children[0]&&'TEMPLATE'===this.el.children[0].tagName?this.el.children[0].innerHTML.trim():document.querySelector(this.data.template).innerHTML.trim();for(var i=0;i<this.data.pool;i++)this.el.appendChild(this.generateFromTemplate(null,i))},update:function update(){this.keysToWatch[0]=lib.split(this.data.in,'.')[0],this.onStateUpdate()},onStateUpdateNaive:function(){var activeKeys=[];return function(){var data=this.data,el=this.el,list;try{list=lib.select(this.system.state,data.in)}catch(e){throw new Error('[aframe-state-component] Key \''+data.in+'\' not found in state.'+(' #'+el.getAttribute('id')+'['+this.attrName+']'))}activeKeys.length=0;for(var i=0,item;i<list.length;i++)item=list[i],activeKeys.push(data.key?item[data.key].toString():item.toString());for(var toRemoveEls=this.getElsToRemove(activeKeys,this.renderedKeys),_i=0;_i<toRemoveEls.length;_i++)toRemoveEls[_i].parentNode.removeChild(toRemoveEls[_i]);list.length&&this.renderItems(list,activeKeys,0)}}(),renderItems:function renderItems(list,activeKeys,i){var _this=this,data=this.data,el=this.el,item=list[i],keyValue=data.key?item[data.key].toString():item.toString(),itemEl;if(-1===this.renderedKeys.indexOf(keyValue))itemEl=this.generateFromTemplate(item,i),el.appendChild(itemEl),this.renderedKeys.push(keyValue);else{if(list.length&&list[0].constructor===String){var _keyValue=data.key?item[data.key].toString():item.toString();itemEl=el.querySelector('[data-bind-for-value="'+_keyValue+'"]'),itemEl.setAttribute('data-bind-for-key',i)}else{var bindForKey=this.getBindForKey(item,i);itemEl=el.querySelector('[data-bind-for-key="'+bindForKey+'"]')}itemEl.emit('bindforupdate',item,!1)}list[i+1]&&(this.data.delay?setTimeout(function(){_this.renderItems(list,activeKeys,i+1)},this.data.delay):this.renderItems(list,activeKeys,i+1))},onStateUpdateInPlace:function(){var activeKeys=[];return function(){var data=this.data,el=this.el,list,keyValue;try{list=lib.select(this.system.state,data.in)}catch(e){throw console.log(e),new Error('[aframe-state-component] Key \''+data.in+'\' not found in state.'+(' #'+el.getAttribute('id')+'['+this.attrName+']'))}activeKeys.length=0;for(var i=0,item;i<list.length;i++)item=list[i],keyValue=data.key?item[data.key].toString():item.toString(),activeKeys.push(keyValue);for(var toRemoveEls=this.getElsToRemove(activeKeys,this.renderedKeys),_i2=0;_i2<toRemoveEls.length;_i2++)toRemoveEls[_i2].object3D.visible=!1,toRemoveEls[_i2].setAttribute('data-bind-for-active','false'),toRemoveEls[_i2].removeAttribute('data-bind-for-key'),toRemoveEls[_i2].removeAttribute('data-bind-for-value'),toRemoveEls[_i2].emit('bindfordeactivate',null,!1),toRemoveEls[_i2].pause();list.length&&this.renderItemsInPlace(list,activeKeys,0)}}(),renderItemsInPlace:function renderItemsInPlace(list,activeKeys,i){var _this2=this,data=this.data,el=this.el,item=list[i],bindForKey=this.getBindForKey(item,i),keyValue=data.key?item[data.key].toString():item.toString(),itemEl;if(-1===this.renderedKeys.indexOf(keyValue)){if(!el.querySelector(':scope > [data-bind-for-active="false"]')){var _itemEl=this.generateFromTemplate(item,i);_itemEl.addEventListener('loaded',function(){_itemEl.emit('bindforupdateinplace',item,!1)}),el.appendChild(_itemEl)}else itemEl=el.querySelector('[data-bind-for-active="false"]'),itemEl.setAttribute('data-bind-for-key',bindForKey),itemEl.setAttribute('data-bind-for-value',keyValue),itemEl.object3D.visible=!0,itemEl.play(),itemEl.setAttribute('data-bind-for-active','true'),itemEl.emit('bindforupdateinplace',item,!1);this.renderedKeys.push(keyValue)}else-1!==activeKeys.indexOf(keyValue)&&(list.length&&list[0].constructor===String?(itemEl=el.querySelector('[data-bind-for-value="'+keyValue+'"]'),itemEl.setAttribute('data-bind-for-key',i)):itemEl=el.querySelector('[data-bind-for-key="'+bindForKey+'"]'),itemEl.emit('bindforupdateinplace',item,!1));list[i+1]&&(this.data.delay?setTimeout(function(){_this2.renderItemsInPlace(list,activeKeys,i+1)},this.data.delay):this.renderItemsInPlace(list,activeKeys,i+1))},generateFromTemplate:function generateFromTemplate(item,i){var data=this.data;this.el.appendChild(this.system.renderTemplate(this.template,item));var newEl=this.el.children[this.el.children.length-1];if(!item)return newEl.setAttribute('data-bind-for-key',''),newEl.setAttribute('data-bind-for-active','false'),newEl;var bindForKey=this.getBindForKey(item,i);return newEl.setAttribute('data-bind-for-key',bindForKey),data.key||newEl.setAttribute('data-bind-for-value',item),newEl.setAttribute('data-bind-for-active','true'),newEl},getElsToRemove:function(){var toRemove=[];return function(activeKeys,renderedKeys){var data=this.data,el=this.el;toRemove.length=0;for(var i=0;i<el.children.length;i++)if('TEMPLATE'!==el.children[i].tagName){var key=data.key?el.children[i].getAttribute('data-bind-for-key'):el.children[i].getAttribute('data-bind-for-value');-1===activeKeys.indexOf(key)&&-1!==renderedKeys.indexOf(key)&&(toRemove.push(el.children[i]),renderedKeys.splice(renderedKeys.indexOf(key),1))}return toRemove}}(),getBindForKey:function getBindForKey(item,i){return this.data.key?item[this.data.key].toString():i.toString()},onStateUpdate:function onStateUpdate(){this.data.updateInPlace?this.onStateUpdateInPlace():this.onStateUpdateNaive()}}),AFRAME.registerComponent('bind-item',{schema:{type:'string'},multiple:!0,init:function init(){this.itemData=null,this.keysToWatch=[],this.prevValues={};var rootEl=this.rootEl=this.el.closest('[data-bind-for-key]');if(!rootEl)throw new Error('bind-item component must be attached to entity under a bind-for item.');rootEl.addEventListener('bindforupdateinplace',this.updateInPlace.bind(this)),rootEl.addEventListener('bindfordeactivate',this.deactivate.bind(this)),this.el.sceneEl.systems.state.subscribe(this)},update:function update(){this.parseSelector()},updateInPlace:function updateInPlace(evt){var propertyMap=this.propertyMap;if('false'!==this.rootEl.getAttribute('data-bind-for-active'))for(var property in evt&&(this.itemData=evt.detail),propertyMap){var value=this.select(this.itemData,propertyMap[property]);value!==this.prevValues[property]&&(AFRAME.utils.entity.setComponentProperty(this.el,property,value),this.prevValues[property]=value)}},onStateUpdate:function onStateUpdate(){this.updateInPlace()},select:function select(itemData,selector){return lib.select(this.el.sceneEl.systems.state.state,selector,itemData)},deactivate:function deactivate(){this.prevValues={}},parseSelector:function parseSelector(){var propertyMap=this.propertyMap={};this.keysToWatch.length=0;var componentName=lib.split(this.id,'__')[0];if(componentName in AFRAME.components&&!AFRAME.components[componentName].isSingleProp){for(var propertySplitList=lib.split(this.data,';'),i=0,propertySplit;i<propertySplitList.length;i++)propertySplit=lib.split(propertySplitList[i],':'),propertyMap[this.id+'.'+propertySplit[0].trim()]=propertySplit[1].trim(),lib.parseKeysToWatch(this.keysToWatch,propertySplit[1].trim(),!0);return}propertyMap[this.id]=this.data,lib.parseKeysToWatch(this.keysToWatch,this.data,!0)}})},function(module){'use strict';module.exports=function(){var keys=[];return function(a,b,targetObject,ignoreKeys){var aVal,bVal,bKey,diff,key,i,isComparingObjects;for(key in diff=targetObject||{},keys.length=0,a)keys.push(key);if(!b)return diff;for(bKey in b)-1===keys.indexOf(bKey)&&keys.push(bKey);for(i=0;i<keys.length;i++)(key=keys[i],!(ignoreKeys&&-1!==ignoreKeys.indexOf(key)))&&(aVal=a[key],bVal=b[key],isComparingObjects=aVal&&bVal&&aVal.constructor===Object&&bVal.constructor===Object,(!isComparingObjects||AFRAME.utils.deepEqual(aVal,bVal))&&(isComparingObjects||aVal===bVal)||(diff[key]=bVal));return diff}}()},function(module){'use strict';function makeCallDirty(arr,fn){var originalFn=arr[fn];arr[fn]=function(){originalFn.apply(arr,arguments),arr.__dirty=!0}}var fns=['push','pop','shift','unshift','splice'];module.exports.wrapArray=function wrapArray(arr){var i;if(!arr.__wrapped){for(i=0;i<fns.length;i++)makeCallDirty(arr,fns[i]);arr.__wrapped=!0}}}])})},function(){var TYPE_PAD='PAD',TYPE_STICK='STICK',ANGLES=[0,90,180,270],DIRECTIONS=['right','up','left','down'],EVENTS={NULL:{START:'thumbstart',END:'thumbend'}};DIRECTIONS.forEach(direction=>{EVENTS[direction]={},EVENTS[direction].START='thumb'+direction+'start',EVENTS[direction].END='thumb'+direction+'end'});var SIZE=240;AFRAME.registerComponent('thumb-controls',{dependencies:['tracked-controls'],schema:{thresholdAngle:{default:89.5},thresholdPad:{default:0.05},thresholdStick:{default:0.75}},init:function(){var el=this.el;this.onTrackpadDown=this.onTrackpadDown.bind(this),this.onTrackpadUp=this.onTrackpadUp.bind(this),this.directionStick='',this.directionTrackpad='',this.type=TYPE_STICK,el.addEventListener('controllerconnected',evt=>'oculus-touch-controls'===evt.detail.name||'windows-motion-controls'===evt.detail.name?void(this.type=TYPE_STICK):void(this.type=TYPE_PAD)),this.axis=el.components['tracked-controls'].axis},play:function(){var el=this.el;el.addEventListener('trackpaddown',this.onTrackpadDown),el.addEventListener('trackpadup',this.onTrackpadUp)},pause:function(){var el=this.el;el.removeEventListener('trackpaddown',this.onTrackpadDown),el.removeEventListener('trackpadup',this.onTrackpadUp)},onTrackpadDown:function(){var el=this.el,direction;this.getDistance()<this.data.thresholdPad||(direction=this.getDirection(),direction&&(this.directionTrackpad=direction,el.emit(EVENTS.NULL.START,null,!1),el.emit(EVENTS[this.directionTrackpad].START,null,!1)))},onTrackpadUp:function(){var el=this.el;this.directionTrackpad&&(el.emit(EVENTS.NULL.END,null,!1),el.emit(EVENTS[this.directionTrackpad].END,null,!1),this.directionTrackpad='')},tick:function(){var el=this.el,direction;return this.type===TYPE_PAD?void 0:!this.directionStick&&this.getDistance()>this.data.thresholdStick?(direction=this.getDirection(),!direction)?void 0:(this.directionStick=direction,el.emit(EVENTS.NULL.START,null,!1),void el.emit(EVENTS[this.directionStick].START,null,!1)):void(this.directionStick&&this.getDistance()<this.data.thresholdStick&&(el.emit(EVENTS.NULL.END,null,!1),el.emit(EVENTS[this.directionStick].END,null,!1),this.directionStick=''))},getDistance:function(){var axis=this.axis;return Math.sqrt(axis[1]*axis[1]+axis[0]*axis[0])},getDirection:function(){var angle,bottomThreshold,i,threshold,topThreshold;for(angle=this.getAngle(),threshold=this.data.thresholdAngle/2,i=0;i<ANGLES.length;i++){if(topThreshold=ANGLES[i]+threshold,360<topThreshold&&(topThreshold-=360),bottomThreshold=ANGLES[i]-threshold,0>bottomThreshold&&(angle>=360+bottomThreshold&&360>=angle||0<=angle&&angle<=topThreshold))return DIRECTIONS[i];if(angle>=bottomThreshold&&angle<=topThreshold)return DIRECTIONS[i]}},getAngle:function(){var axis=this.axis,angle,flipY;return flipY=this.type===TYPE_STICK?-1:1,angle=Math.atan2(axis[1]*flipY,axis[0]),0>angle&&(angle=2*Math.PI+angle),THREE.Math.radToDeg(angle)}}),AFRAME.registerComponent('thumb-controls-debug',{dependencies:['thumb-controls','tracked-controls'],schema:{controllerType:{type:'string'},hand:{type:'string'},enabled:{default:!1}},init:function(){var el=this.el,data=this.data,isActive,axis,axisMoveEventDetail,canvas;(data.enabled||AFRAME.utils.getUrlParameter('debug-thumb'))&&(console.log('%c debug-thumb','background: #111; color: red'),el.components['tracked-controls'].handleAxes=()=>{},axis=[0,0,0],axisMoveEventDetail={axis:axis},el.components['tracked-controls'].axis=axis,el.components['thumb-controls'].axis=axis,canvas=this.createCanvas(),canvas.addEventListener('click',()=>{'vive-controls'===this.data.controllerType?isActive?el.emit('trackpadup'):el.emit('trackpaddown'):isActive&&(axis[0]=0,axis[1]=0,el.emit('axismove',axisMoveEventDetail,!1)),isActive=!isActive}),canvas.addEventListener('mousemove',evt=>{var rect;isActive&&(rect=canvas.getBoundingClientRect(),axis[0]=2*((evt.clientX-rect.left)/SIZE)-1,axis[1]=2*((evt.clientY-rect.top)/SIZE)-1,el.emit('axismove',axisMoveEventDetail,!1))}),canvas.addEventListener('mouseleave',()=>{isActive&&(axis[0]=0,axis[1]=0,el.emit('axismove',axisMoveEventDetail,!1))}))},createCanvas:function(){var canvas,ctx;return canvas=document.createElement('canvas'),canvas.classList.add('debugThumb'),canvas.height=SIZE,canvas.width=SIZE,canvas.style.bottom=0,canvas.style.borderRadius='250px',canvas.style.opacity=0.5,canvas.style.position='fixed',canvas.style.zIndex=999999999,'left'===this.data.hand?canvas.style.left=0:canvas.style.right=0,ctx=canvas.getContext('2d'),ctx.fillStyle='#333',ctx.fillRect(0,0,SIZE,SIZE),document.body.appendChild(canvas),canvas}})},function(module,exports,__webpack_require__){var content=__webpack_require__(136);'string'==typeof content&&(content=[[module.i,content,'']]);var options={hmr:!0},transform;options.transform=transform,options.insertInto=void 0;__webpack_require__(149)(content,options);content.locals&&(module.exports=content.locals),!1},function(module,exports,__webpack_require__){function webpackContext(req){return __webpack_require__(webpackContextResolve(req))}function webpackContextResolve(req){var id=map[req];if(!(id+1))throw new Error('Cannot find module \''+req+'\'.');return id}var map={"./active-color.js":59,"./audio-columns.js":60,"./beams.js":61,"./beat-hit-sound.js":62,"./beat-loader.js":63,"./beat.js":64,"./console-shortcuts.js":65,"./copy-texture.js":66,"./cursor-laser.js":67,"./cursor-mesh.js":68,"./debug-beat-loader.js":69,"./debug-controller.js":70,"./debug-cursor.js":71,"./debug-song-time.js":72,"./debug-state.js":73,"./difficulty-background.js":74,"./fake-glow.js":75,"./floor-shader.js":76,"./gameover.js":77,"./gpu-preloader.js":78,"./hack.js":79,"./hand-swapper.js":80,"./haptics-saber.js":81,"./haptics-wall.js":82,"./history.js":83,"./intro-song.js":84,"./keyboard-raycastable.js":85,"./leaderboard.js":86,"./logo-light.js":87,"./logoflicker.js":88,"./materials.js":89,"./menu-controls.js":90,"./menu-difficulty-select.js":91,"./menu-selected-challenge-image.js":92,"./menu-slide-animation.js":93,"./mine-fragments-loader.js":94,"./multiplier-ring.js":95,"./particleplayer.js":96,"./pause.js":97,"./pauser.js":98,"./play-sound.js":99,"./raycaster-target.js":100,"./recenter.js":101,"./saber-controls.js":102,"./saber-particles.js":103,"./score-beat.js":104,"./score-texts.js":105,"./search-thumbnail-atlas.js":106,"./search.js":107,"./song-preview.js":108,"./song-progress-ring.js":109,"./song.js":110,"./stage-colors.js":111,"./stage-lasers.js":112,"./stage-shader.js":113,"./stats-param.js":114,"./stepback.js":115,"./sub-object.js":116,"./super-keyboard.js":117,"./supercutfx-shader.js":118,"./supercutfx.js":119,"./text-counter.js":120,"./text-uppercase.js":121,"./toggle-pause-play.js":122,"./trail.js":123,"./tutorial-2d.js":124,"./twister.js":125,"./vertex-colors-buffer.js":126,"./victory-accuracy-ring.js":127,"./victory-rank.js":128,"./visible-raycastable.js":129,"./wall-shader.js":130,"./wall.js":131};webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=33},function(module,exports,__webpack_require__){function webpackContext(req){return __webpack_require__(webpackContextResolve(req))}function webpackContextResolve(req){var id=map[req];if(!(id+1))throw new Error('Cannot find module \''+req+'\'.');return id}var map={"./index.js":135};webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=34},function(module,exports,__webpack_require__){'use strict';var _Mathmin=Math.min,_Mathfloor=Math.floor,_Mathmax=Math.max;(function(process){function getLogLevel(){return logClient.logLevel===logger.LogLevel.DEBUG?LogLevel.DEBUG:logClient.logLevel===logger.LogLevel.SILENT?LogLevel.SILENT:LogLevel.ERROR}function setLogLevel(newLevel){newLevel===LogLevel.DEBUG?logClient.logLevel=logger.LogLevel.DEBUG:newLevel===LogLevel.ERROR?logClient.logLevel=logger.LogLevel.ERROR:newLevel===LogLevel.SILENT?logClient.logLevel=logger.LogLevel.SILENT:logClient.error('Firestore ('+SDK_VERSION+'): Invalid value passed to `setLogLevel`')}function debug(tag,msg){for(var obj=[],_i=2;_i<arguments.length;_i++)obj[_i-2]=arguments[_i];if(logClient.logLevel<=logger.LogLevel.DEBUG){var args=obj.map(argToString);logClient.debug.apply(logClient,['Firestore ('+SDK_VERSION+') ['+tag+']: '+msg].concat(args))}}function error(msg){for(var obj=[],_i=1;_i<arguments.length;_i++)obj[_i-1]=arguments[_i];if(logClient.logLevel<=logger.LogLevel.ERROR){var args=obj.map(argToString);logClient.error.apply(logClient,['Firestore ('+SDK_VERSION+'): '+msg].concat(args))}}function argToString(obj){if('string'==typeof obj)return obj;var platform=PlatformSupport.getPlatform();try{return platform.formatJSON(obj)}catch(e){return obj}}function fail(failure){var message='FIRESTORE ('+SDK_VERSION+') INTERNAL ASSERTION FAILED: '+failure;throw error(message),new Error(message)}function assert(assertion,message){assertion||fail(message)}function emptyByteString(){return PlatformSupport.getPlatform().emptyByteString}function makeConstructorPrivate(cls,optionalMessage){function PublicConstructor(){var error='This constructor is private.';throw optionalMessage&&(error+=' ',error+=optionalMessage),new FirestoreError(Code.INVALID_ARGUMENT,error)}for(var staticProperty in PublicConstructor.prototype=cls.prototype,cls)cls.hasOwnProperty(staticProperty)&&(PublicConstructor[staticProperty]=cls[staticProperty]);return PublicConstructor}function contains(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function defaulted(value,defaultValue){return value===void 0?defaultValue:value}function forEachNumber(obj,fn){for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var num=+key;isNaN(num)||fn(num,obj[key])}}function values(obj){var vs=[];return forEach(obj,function(_,v){return vs.push(v)}),vs}function forEach(obj,fn){for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&fn(key,obj[key])}function isEmpty(obj){for(var key in assert(null!=obj&&'object'==typeof obj,'isEmpty() expects object parameter.'),obj)if(Object.prototype.hasOwnProperty.call(obj,key))return!1;return!0}function shallowCopy(obj){assert(obj&&'object'==typeof obj,'shallowCopy() expects object parameter.');var result={};for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&(result[key]=obj[key]);return result}function validateExactNumberOfArgs(functionName,args,numberOfArgs){if(args.length!==numberOfArgs)throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+functionName+'() requires '+formatPlural(numberOfArgs,'argument')+', but was called with '+formatPlural(args.length,'argument')+'.')}function validateAtLeastNumberOfArgs(functionName,args,minNumberOfArgs){if(args.length<minNumberOfArgs)throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+functionName+'() requires at least '+formatPlural(minNumberOfArgs,'argument')+', but was called with '+formatPlural(args.length,'argument')+'.')}function validateBetweenNumberOfArgs(functionName,args,minNumberOfArgs,maxNumberOfArgs){if(args.length<minNumberOfArgs||args.length>maxNumberOfArgs)throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+functionName+'() requires between '+minNumberOfArgs+' and '+(maxNumberOfArgs+' arguments, but was called with ')+formatPlural(args.length,'argument')+'.')}function validateNamedArrayAtLeastNumberOfElements(functionName,value,name,minNumberOfElements){if(!(value instanceof Array)||value.length<minNumberOfElements)throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+functionName+'() requires its '+name+' argument to be an '+'array with at least '+(formatPlural(minNumberOfElements,'element')+'.'))}function validateArgType(functionName,type,position,argument){validateType(functionName,type,ordinal(position)+' argument',argument)}function validateOptionalArgType(functionName,type,position,argument){argument!==void 0&&validateArgType(functionName,type,position,argument)}function validateNamedType(functionName,type,optionName,argument){validateType(functionName,type,optionName+' option',argument)}function validateNamedOptionalType(functionName,type,optionName,argument){argument!==void 0&&validateNamedType(functionName,type,optionName,argument)}function validateArrayElements(functionName,optionName,typeDescription,argument,validator){if(!(argument instanceof Array))throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+functionName+'() requires its '+optionName+' '+('option to be an array, but it was: '+valueDescription(argument)));for(var i=0;i<argument.length;++i)if(!validator(argument[i]))throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+functionName+'() requires all '+optionName+' '+('elements to be '+typeDescription+', but the value at index '+i+' ')+('was: '+valueDescription(argument[i])))}function validateOptionalArrayElements(functionName,optionName,typeDescription,argument,validator){argument!==void 0&&validateArrayElements(functionName,optionName,typeDescription,argument,validator)}function validateNamedPropertyEquals(functionName,inputName,optionName,input,expected){for(var expectedDescription=[],_i=0,expected_1=expected,val;_i<expected_1.length;_i++){if(val=expected_1[_i],val===input)return;expectedDescription.push(valueDescription(val))}var actualDescription=valueDescription(input);throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid value '+actualDescription+' provided to function '+functionName+'() for option '+('"'+optionName+'". Acceptable values: '+expectedDescription.join(', ')))}function validateNamedOptionalPropertyEquals(functionName,inputName,optionName,input,expected){input!==void 0&&validateNamedPropertyEquals(functionName,inputName,optionName,input,expected)}function validateType(functionName,type,inputName,input){var valid=!1;if(valid='object'===type?isPlainObject(input):'non-empty string'===type?'string'==typeof input&&''!==input:typeof input==type,!valid){var description=valueDescription(input);throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+functionName+'() requires its '+inputName+' '+('to be of type '+type+', but it was: '+description))}}function isPlainObject(input){return'object'==typeof input&&null!==input&&(Object.getPrototypeOf(input)===Object.prototype||null===Object.getPrototypeOf(input))}function valueDescription(input){if(input===void 0)return'undefined';if(null===input)return'null';if('string'==typeof input)return 20<input.length&&(input=input.substring(0,20)+'...'),JSON.stringify(input);if('number'==typeof input||'boolean'==typeof input)return''+input;if('object'==typeof input){if(input instanceof Array)return'an array';var customObjectName=tryGetCustomObjectType(input);return customObjectName?'a custom '+customObjectName+' object':'an object'}return'function'==typeof input?'a function':fail('Unknown wrong type: '+typeof input)}function tryGetCustomObjectType(input){if(input.constructor){var funcNameRegex=/function\s+([^\s(]+)\s*\(/,results=funcNameRegex.exec(input.constructor.toString());if(results&&1<results.length)return results[1]}return null}function validateDefined(functionName,position,argument){if(argument===void 0)throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+functionName+'() requires a valid '+ordinal(position)+' '+'argument, but it was undefined.')}function validateOptionNames(functionName,options,optionNames){forEach(options,function(key){if(0>optionNames.indexOf(key))throw new FirestoreError(Code.INVALID_ARGUMENT,'Unknown option \''+key+'\' passed to function '+functionName+'(). '+'Available options: '+optionNames.join(', '))})}function invalidClassError(functionName,type,position,argument){var description=valueDescription(argument);return new FirestoreError(Code.INVALID_ARGUMENT,'Function '+functionName+'() requires its '+ordinal(position)+' '+('argument to be a '+type+', but it was: '+description))}function ordinal(num){return 1===num?'first':2===num?'second':3===num?'third':num+'th'}function formatPlural(num,str){return num+' '+str+(1===num?'':'s')}function primitiveComparator(left,right){return left<right?-1:left>right?1:0}function equals(left,right){return null!==left&&void 0!==left?!!(right&&left.isEqual(right)):left===right}function arrayEquals(left,right){if(left.length!==right.length)return!1;for(var i=0;i<left.length;i++)if(!left[i].isEqual(right[i]))return!1;return!0}function immediateSuccessor(s){return s+'\0'}function assertUint8ArrayAvailable(){if('undefined'==typeof Uint8Array)throw new FirestoreError(Code.UNIMPLEMENTED,'Uint8Arrays are not available in this environment.')}function assertBase64Available(){if(!PlatformSupport.getPlatform().base64Available)throw new FirestoreError(Code.UNIMPLEMENTED,'Blobs are unavailable in Firestore in this environment.')}function numericComparator(left,right){return left<right?-1:left>right?1:left===right?0:isNaN(left)?isNaN(right)?0:-1:1}function numericEquals(left,right){return left===right?0!==left||1/left==1/right:left!==left&&right!==right}function isNullOrUndefined(value){return null===value||value===void 0}function isSafeInteger(value){return isInteger(value)&&value<=MAX_SAFE_INTEGER&&value>=MIN_SAFE_INTEGER}function coercedFieldValuesArray(value){return value instanceof ArrayValue?value.internalValue.slice():[]}function isPermanentError(code){return code===Code.OK?fail('Treated status OK as error'):code===Code.CANCELLED||code===Code.UNKNOWN||code===Code.DEADLINE_EXCEEDED||code===Code.RESOURCE_EXHAUSTED||code===Code.INTERNAL||code===Code.UNAVAILABLE||code===Code.UNAUTHENTICATED?!1:code===Code.INVALID_ARGUMENT||code===Code.NOT_FOUND||code===Code.ALREADY_EXISTS||code===Code.PERMISSION_DENIED||code===Code.FAILED_PRECONDITION||code===Code.ABORTED||code===Code.OUT_OF_RANGE||code===Code.UNIMPLEMENTED||code===Code.DATA_LOSS||fail('Unknown status code: '+code)}function mapCodeFromRpcStatus(status){var code=RpcCode[status];return void 0===code?void 0:mapCodeFromRpcCode(code)}function mapCodeFromRpcCode(code){if(void 0===code)return error('GRPC error has no .code'),Code.UNKNOWN;return code===RpcCode.OK?Code.OK:code===RpcCode.CANCELLED?Code.CANCELLED:code===RpcCode.UNKNOWN?Code.UNKNOWN:code===RpcCode.DEADLINE_EXCEEDED?Code.DEADLINE_EXCEEDED:code===RpcCode.RESOURCE_EXHAUSTED?Code.RESOURCE_EXHAUSTED:code===RpcCode.INTERNAL?Code.INTERNAL:code===RpcCode.UNAVAILABLE?Code.UNAVAILABLE:code===RpcCode.UNAUTHENTICATED?Code.UNAUTHENTICATED:code===RpcCode.INVALID_ARGUMENT?Code.INVALID_ARGUMENT:code===RpcCode.NOT_FOUND?Code.NOT_FOUND:code===RpcCode.ALREADY_EXISTS?Code.ALREADY_EXISTS:code===RpcCode.PERMISSION_DENIED?Code.PERMISSION_DENIED:code===RpcCode.FAILED_PRECONDITION?Code.FAILED_PRECONDITION:code===RpcCode.ABORTED?Code.ABORTED:code===RpcCode.OUT_OF_RANGE?Code.OUT_OF_RANGE:code===RpcCode.UNIMPLEMENTED?Code.UNIMPLEMENTED:code===RpcCode.DATA_LOSS?Code.DATA_LOSS:fail('Unknown status code: '+code)}function mapRpcCodeFromCode(code){if(code===void 0)return RpcCode.OK;return code===Code.OK?RpcCode.OK:code===Code.CANCELLED?RpcCode.CANCELLED:code===Code.UNKNOWN?RpcCode.UNKNOWN:code===Code.DEADLINE_EXCEEDED?RpcCode.DEADLINE_EXCEEDED:code===Code.RESOURCE_EXHAUSTED?RpcCode.RESOURCE_EXHAUSTED:code===Code.INTERNAL?RpcCode.INTERNAL:code===Code.UNAVAILABLE?RpcCode.UNAVAILABLE:code===Code.UNAUTHENTICATED?RpcCode.UNAUTHENTICATED:code===Code.INVALID_ARGUMENT?RpcCode.INVALID_ARGUMENT:code===Code.NOT_FOUND?RpcCode.NOT_FOUND:code===Code.ALREADY_EXISTS?RpcCode.ALREADY_EXISTS:code===Code.PERMISSION_DENIED?RpcCode.PERMISSION_DENIED:code===Code.FAILED_PRECONDITION?RpcCode.FAILED_PRECONDITION:code===Code.ABORTED?RpcCode.ABORTED:code===Code.OUT_OF_RANGE?RpcCode.OUT_OF_RANGE:code===Code.UNIMPLEMENTED?RpcCode.UNIMPLEMENTED:code===Code.DATA_LOSS?RpcCode.DATA_LOSS:fail('Unknown status code: '+code)}function mapCodeFromHttpStatus(status){return 200===status?Code.OK:400===status?Code.INVALID_ARGUMENT:401===status?Code.UNAUTHENTICATED:403===status?Code.PERMISSION_DENIED:404===status?Code.NOT_FOUND:409===status?Code.ABORTED:416===status?Code.OUT_OF_RANGE:429===status?Code.RESOURCE_EXHAUSTED:499===status?Code.CANCELLED:500===status?Code.UNKNOWN:501===status?Code.UNIMPLEMENTED:503===status?Code.UNAVAILABLE:504===status?Code.DEADLINE_EXCEEDED:200<=status&&300>status?Code.OK:400<=status&&500>status?Code.FAILED_PRECONDITION:500<=status&&600>status?Code.INTERNAL:Code.UNKNOWN}function maybeDocumentMap(){return EMPTY_MAYBE_DOCUMENT_MAP}function documentMap(){return EMPTY_DOCUMENT_MAP}function documentVersionMap(){return EMPTY_DOCUMENT_VERSION_MAP}function documentKeySet(){return EMPTY_DOCUMENT_KEY_SET}function targetIdSet(){return EMPTY_TARGET_ID_SET}function documentTargetMap(){return new SortedMap(DocumentKey.comparator)}function snapshotChangesMap(){return new SortedMap(DocumentKey.comparator)}function assertPresent(value,description){assert(!isNullOrUndefined(value),description+' is missing')}function parseInt64(value){return'number'==typeof value?value:'string'==typeof value?+value:fail('can\'t parse '+value)}function hasTag(obj,type,tag){return type===tag||!type&&tag in obj}function encode(path){for(var result='',i=0;i<path.length;i++)0<result.length&&(result=encodeSeparator(result)),result=encodeSegment(path.get(i),result);return encodeSeparator(result)}function encodeSegment(segment,resultBuf){for(var result=resultBuf,length=segment.length,i=0,c;i<length;i++)c=segment.charAt(i),result+='\0'===c?escapeChar+encodedNul:c===escapeChar?escapeChar+encodedEscape:c;return result}function encodeSeparator(result){return result+escapeChar+encodedSeparatorChar}function decode$1(path){var length=path.length;if(assert(2<=length,'Invalid path '+path),2===length)return assert(path.charAt(0)===escapeChar&&path.charAt(1)===encodedSeparatorChar,'Non-empty path '+path+' had length 2'),ResourcePath.EMPTY_PATH;for(var segments=[],segmentBuilder='',start=0,end;start<length;){end=path.indexOf(escapeChar,start),(0>end||end>length-2)&&fail('Invalid encoded resource path: "'+path+'"');var next=path.charAt(end+1);switch(next){case encodedSeparatorChar:var currentPiece=path.substring(start,end),segment=void 0;0===segmentBuilder.length?segment=currentPiece:(segmentBuilder+=currentPiece,segment=segmentBuilder,segmentBuilder=''),segments.push(segment);break;case encodedNul:segmentBuilder+=path.substring(start,end),segmentBuilder+='\0';break;case encodedEscape:segmentBuilder+=path.substring(start,end+1);break;default:fail('Invalid encoded resource path: "'+path+'"');}start=end+2}return new ResourcePath(segments)}function wrapRequest(request){return new PersistencePromise(function(resolve,reject){request.onsuccess=function(event){var result=event.target.result;resolve(result)},request.onerror=function(event){reject(event.target.error)}})}function documentGlobalStore(txn){return IndexedDbPersistence.getStore(txn,DbRemoteDocumentGlobal.store)}function isDocumentChangeMissingError(err){return err.code===Code.DATA_LOSS&&err.message===REMOTE_DOCUMENT_CHANGE_MISSING_ERR_MSG}function remoteDocumentsStore(txn){return IndexedDbPersistence.getStore(txn,DbRemoteDocument.store)}function documentChangesStore(txn){return IndexedDbPersistence.getStore(txn,DbRemoteDocumentChanges.store)}function dbKey(docKey){return docKey.path.toArray()}function dbDocumentSize(doc){var value;if(doc.document)value=doc.document;else if(doc.unknownDocument)value=doc.unknownDocument;else if(doc.noDocument)value=doc.noDocument;else throw fail('Unknown remote document type');return JSON.stringify(value).length}function createPrimaryClientStore(db){db.createObjectStore(DbPrimaryClient.store)}function createMutationQueue(db){db.createObjectStore(DbMutationQueue.store,{keyPath:DbMutationQueue.keyPath});var mutationBatchesStore=db.createObjectStore(DbMutationBatch.store,{keyPath:DbMutationBatch.keyPath,autoIncrement:!0});mutationBatchesStore.createIndex(DbMutationBatch.userMutationsIndex,DbMutationBatch.userMutationsKeyPath,{unique:!0}),db.createObjectStore(DbDocumentMutation.store)}function upgradeMutationBatchSchemaAndMigrateData(db,txn){var v1MutationsStore=txn.store(DbMutationBatch.store);return v1MutationsStore.loadAll().next(function(existingMutations){db.deleteObjectStore(DbMutationBatch.store);var mutationsStore=db.createObjectStore(DbMutationBatch.store,{keyPath:DbMutationBatch.keyPath,autoIncrement:!0});mutationsStore.createIndex(DbMutationBatch.userMutationsIndex,DbMutationBatch.userMutationsKeyPath,{unique:!0});var v3MutationsStore=txn.store(DbMutationBatch.store),writeAll=existingMutations.map(function(mutation){return v3MutationsStore.put(mutation)});return PersistencePromise.waitFor(writeAll)})}function createRemoteDocumentCache(db){db.createObjectStore(DbRemoteDocument.store)}function createDocumentGlobalStore(db){db.createObjectStore(DbRemoteDocumentGlobal.store)}function createQueryCache(db){var targetDocumentsStore=db.createObjectStore(DbTargetDocument.store,{keyPath:DbTargetDocument.keyPath});targetDocumentsStore.createIndex(DbTargetDocument.documentTargetsIndex,DbTargetDocument.documentTargetsKeyPath,{unique:!0});var targetStore=db.createObjectStore(DbTarget.store,{keyPath:DbTarget.keyPath});targetStore.createIndex(DbTarget.queryTargetsIndexName,DbTarget.queryTargetsKeyPath,{unique:!0}),db.createObjectStore(DbTargetGlobal.store)}function dropQueryCache(db){db.deleteObjectStore(DbTargetDocument.store),db.deleteObjectStore(DbTarget.store),db.deleteObjectStore(DbTargetGlobal.store)}function writeEmptyTargetGlobalEntry(txn){var globalStore=txn.store(DbTargetGlobal.store),metadata=new DbTargetGlobal(0,0,SnapshotVersion.MIN.toTimestamp(),0);return globalStore.put(DbTargetGlobal.key,metadata)}function createRemoteDocumentChangesStore(db){db.createObjectStore(DbRemoteDocumentChanges.store,{keyPath:'id',autoIncrement:!0})}function createClientMetadataStore(db){db.createObjectStore(DbClientMetadata.store,{keyPath:DbClientMetadata.keyPath})}function mutationQueueContainsKey(txn,userId,key){var indexKey=DbDocumentMutation.prefixForPath(userId,key.path),encodedPath=indexKey[1],startRange=IDBKeyRange.lowerBound(indexKey),containsKey=!1;return documentMutationsStore(txn).iterate({range:startRange,keysOnly:!0},function(key,value,control){var userID=key[0],keyPath=key[1],_=key[2];userID===userId&&keyPath===encodedPath&&(containsKey=!0),control.done()}).next(function(){return containsKey})}function mutationQueuesContainKey(txn,docKey){var found=!1;return mutationQueuesStore(txn).iterateSerial(function(userId){return mutationQueueContainsKey(txn,userId,docKey).next(function(containsKey){return containsKey&&(found=!0),PersistencePromise.resolve(!containsKey)})}).next(function(){return found})}function removeMutationBatch(txn,userId,batch){var mutationStore=txn.store(DbMutationBatch.store),indexTxn=txn.store(DbDocumentMutation.store),promises=[],range=IDBKeyRange.only(batch.batchId),numDeleted=0,removePromise=mutationStore.iterate({range:range},function(key,value,control){return numDeleted++,control.delete()});promises.push(removePromise.next(function(){assert(1==numDeleted,'Dangling document-mutation reference found: Missing batch '+batch.batchId)}));for(var removedDocuments=[],_i=0,_a=batch.mutations;_i<_a.length;_i++){var mutation=_a[_i],indexKey=DbDocumentMutation.key(userId,mutation.key.path,batch.batchId);promises.push(indexTxn.delete(indexKey)),removedDocuments.push(mutation.key)}return PersistencePromise.waitFor(promises).next(function(){return removedDocuments})}function convertStreamToken(token){return token instanceof Uint8Array?(assert('YES'===process.env.USE_MOCK_PERSISTENCE,'Persisting non-string stream tokens is only supported with mock persistence.'),token.toString()):token}function mutationsStore(txn){return IndexedDbPersistence.getStore(txn,DbMutationBatch.store)}function documentMutationsStore(txn){return IndexedDbPersistence.getStore(txn,DbDocumentMutation.store)}function mutationQueuesStore(txn){return IndexedDbPersistence.getStore(txn,DbMutationQueue.store)}function targetsStore(txn){return IndexedDbPersistence.getStore(txn,DbTarget.store)}function globalTargetStore(txn){return IndexedDbPersistence.getStore(txn,DbTargetGlobal.store)}function retrieveMetadata(txn){var globalStore=SimpleDb.getStore(txn,DbTargetGlobal.store);return globalStore.get(DbTargetGlobal.key).next(function(metadata){return assert(null!==metadata,'Missing metadata row.'),metadata})}function getHighestListenSequenceNumber(txn){return retrieveMetadata(txn).next(function(targetGlobal){return targetGlobal.highestListenSequenceNumber})}function documentTargetStore(txn){return IndexedDbPersistence.getStore(txn,DbTargetDocument.store)}function isDocumentQuery(dbQuery){return dbQuery.documents!==void 0}function bufferEntryComparator(_a,_b){var aSequence=_a[0],aIndex=_a[1],bSequence=_b[0],bIndex=_b[1],seqCmp=primitiveComparator(aSequence,bSequence);return 0===seqCmp?primitiveComparator(aIndex,bIndex):seqCmp}function isPrimaryLeaseLostError(err){return err.code===Code.FAILED_PRECONDITION&&err.message===PRIMARY_LEASE_LOST_ERROR_MSG}function primaryClientStore(txn){return txn.store(DbPrimaryClient.store)}function clientMetadataStore(txn){return txn.store(DbClientMetadata.store)}function sentinelKey(key){return[0,encode(key.path)]}function sentinelRow(key,sequenceNumber){return new DbTargetDocument(0,encode(key.path),sequenceNumber)}function writeSentinelKey(txn,key){return documentTargetStore(txn).put(sentinelRow(key,txn.currentSequenceNumber))}function documentSizeMap(){return new SortedMap(DocumentKey.comparator)}function compareChangeType(c1,c2){var order=function(change){return change===ChangeType.Added?1:change===ChangeType.Modified?2:change===ChangeType.Metadata?2:change===ChangeType.Removed?0:fail('Unknown ChangeType: '+change)};return order(c1)-order(c2)}function fromWebStorageSequenceNumber(seqString){var sequenceNumber=ListenSequence.INVALID;if(null!=seqString)try{var parsed=JSON.parse(seqString);assert('number'==typeof parsed,'Found non-numeric sequence number'),sequenceNumber=parsed}catch(e){error(LOG_TAG$10,'Failed to read sequence number from WebStorage',e)}return sequenceNumber}function fromDotSeparatedString(path){var found=path.search(RESERVED);if(0<=found)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid field path ('+path+'). Paths must not contain '+'\'~\', \'*\', \'/\', \'[\', or \']\'');try{return new(FieldPath$1.bind.apply(FieldPath$1,[void 0].concat(path.split('.'))))}catch(e){throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid field path ('+path+'). Paths must not be empty, '+'begin with \'.\', end with \'.\', or contain \'..\'')}}function makeCredentialsProvider(credentials){if(!credentials)return new EmptyCredentialsProvider;switch(credentials.type){case'gapi':return new FirstPartyCredentialsProvider(credentials.client,credentials.sessionIndex||'0');case'provider':return credentials.client;default:throw new FirestoreError(Code.INVALID_ARGUMENT,'makeCredentialsProvider failed due to invalid credential type');}}function isPartialObserver(obj){return implementsAnyMethods$1(obj,['next','error','complete'])}function implementsAnyMethods$1(obj,methods){if('object'!=typeof obj||null===obj)return!1;for(var object=obj,_i=0,methods_1=methods,method;_i<methods_1.length;_i++)if(method=methods_1[_i],method in object&&'function'==typeof object[method])return!0;return!1}function isWrite(dataSource){switch(dataSource){case UserDataSource.Set:case UserDataSource.MergeSet:case UserDataSource.Update:return!0;case UserDataSource.Argument:return!1;default:throw fail('Unexpected case for UserDataSource: '+dataSource);}}function looksLikeJsonObject(input){return'object'==typeof input&&null!==input&&!(input instanceof Array)&&!(input instanceof Date)&&!(input instanceof Timestamp)&&!(input instanceof GeoPoint)&&!(input instanceof Blob)&&!(input instanceof DocumentKeyReference)&&!(input instanceof FieldValueImpl)}function validatePlainObject(message,context,input){if(!looksLikeJsonObject(input)||!isPlainObject(input)){var description=valueDescription(input);if('an object'===description)throw context.createError(message+' a custom object');else throw context.createError(message+' '+description)}}function fieldPathFromArgument(methodName,path){if(path instanceof FieldPath$1)return path._internalPath;if('string'==typeof path)return fieldPathFromDotSeparatedString(methodName,path);throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+methodName+'() called with invalid data. '+'Field path arguments must be of type string or FieldPath.')}function fieldPathFromDotSeparatedString(methodName,path){try{return fromDotSeparatedString(path)._internalPath}catch(e){var message=errorMessage(e);throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+methodName+'() called with invalid data. '+message)}}function errorMessage(error){return error instanceof Error?error.message:error.toString()}function throwDocChangesMethodError(){throw new FirestoreError(Code.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a '+'method, so usages like "querySnapshot.docChanges" should become '+'"querySnapshot.docChanges()"')}function validateSetOptions(methodName,options){if(void 0===options)return{merge:!1};if(validateOptionNames(methodName,options,['merge','mergeFields']),validateNamedOptionalType(methodName,'boolean','merge',options.merge),validateOptionalArrayElements(methodName,'mergeFields','a string or a FieldPath',options.mergeFields,function(element){return'string'==typeof element||element instanceof FieldPath$1}),void 0!==options.mergeFields&&void 0!==options.merge)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid options passed to function '+methodName+'(): You cannot specify both "merge" '+'and "mergeFields".');return options}function validateSnapshotOptions(methodName,options){return void 0===options?{}:(validateOptionNames(methodName,options,['serverTimestamps']),validateNamedOptionalPropertyEquals(methodName,'options','serverTimestamps',options.serverTimestamps,['estimate','previous','none']),options)}function validateGetOptions(methodName,options){validateOptionalArgType(methodName,'object',1,options),options&&(validateOptionNames(methodName,options,['source']),validateNamedOptionalPropertyEquals(methodName,'options','source',options.source,['default','server','cache']))}function validateReference(methodName,documentRef,firestore){if(!(documentRef instanceof DocumentReference))throw invalidClassError(methodName,'DocumentReference',1,documentRef);else if(documentRef.firestore!==firestore)throw new FirestoreError(Code.INVALID_ARGUMENT,'Provided document reference is from a different Firestore instance.');else return documentRef}function changesFromSnapshot(firestore,includeMetadataChanges,snapshot){if(snapshot.oldDocs.isEmpty()){var index_1=0,lastDoc_1;return snapshot.docChanges.map(function(change){var doc=new QueryDocumentSnapshot(firestore,change.doc.key,change.doc,snapshot.fromCache,snapshot.mutatedKeys.has(change.doc.key));return assert(change.type===ChangeType.Added,'Invalid event type for first snapshot'),assert(!lastDoc_1||0>snapshot.query.docComparator(lastDoc_1,change.doc),'Got added events in wrong order'),lastDoc_1=change.doc,{type:'added',doc:doc,oldIndex:-1,newIndex:index_1++}})}var indexTracker_1=snapshot.oldDocs;return snapshot.docChanges.filter(function(change){return includeMetadataChanges||change.type!==ChangeType.Metadata}).map(function(change){var doc=new QueryDocumentSnapshot(firestore,change.doc.key,change.doc,snapshot.fromCache,snapshot.mutatedKeys.has(change.doc.key)),oldIndex=-1,newIndex=-1;return change.type!==ChangeType.Added&&(oldIndex=indexTracker_1.indexOf(change.doc.key),assert(0<=oldIndex,'Index for document not found'),indexTracker_1=indexTracker_1.delete(change.doc.key)),change.type!==ChangeType.Removed&&(indexTracker_1=indexTracker_1.add(change.doc),newIndex=indexTracker_1.indexOf(change.doc.key)),{type:resultChangeType(change.type),doc:doc,oldIndex:oldIndex,newIndex:newIndex}})}function resultChangeType(type){return type===ChangeType.Added?'added':type===ChangeType.Modified||type===ChangeType.Metadata?'modified':type===ChangeType.Removed?'removed':fail('Unknown change type: '+type)}function configureForFirebase(firebase$$1){firebase$$1.INTERNAL.registerService('firestore',function(app){return new Firestore(app)},shallowCopy(firestoreNamespace))}function registerFirestore(instance){configureForFirebase(instance)}var _NumberPOSITIVE_INFINITY=Number.POSITIVE_INFINITY,_NumberNEGATIVE_INFINITY=Number.NEGATIVE_INFINITY;Object.defineProperty(exports,'__esModule',{value:!0});var firebase=function _interopDefault(ex){return ex&&'object'==typeof ex&&'default'in ex?ex['default']:ex}(__webpack_require__(13)),logger=__webpack_require__(36),tslib_1=__webpack_require__(19),webchannelWrapper=__webpack_require__(39),SDK_VERSION=firebase.SDK_VERSION,logClient=new logger.Logger('@firebase/firestore'),LogLevel;(function(LogLevel){LogLevel[LogLevel.DEBUG=0]='DEBUG',LogLevel[LogLevel.ERROR=1]='ERROR',LogLevel[LogLevel.SILENT=2]='SILENT'})(LogLevel||(LogLevel={}));var PlatformSupport=function(){function PlatformSupport(){}return PlatformSupport.setPlatform=function(platform){PlatformSupport.platform&&fail('Platform already defined'),PlatformSupport.platform=platform},PlatformSupport.getPlatform=function(){return PlatformSupport.platform||fail('Platform not set'),PlatformSupport.platform},PlatformSupport}(),Code={OK:'ok',CANCELLED:'cancelled',UNKNOWN:'unknown',INVALID_ARGUMENT:'invalid-argument',DEADLINE_EXCEEDED:'deadline-exceeded',NOT_FOUND:'not-found',ALREADY_EXISTS:'already-exists',PERMISSION_DENIED:'permission-denied',UNAUTHENTICATED:'unauthenticated',RESOURCE_EXHAUSTED:'resource-exhausted',FAILED_PRECONDITION:'failed-precondition',ABORTED:'aborted',OUT_OF_RANGE:'out-of-range',UNIMPLEMENTED:'unimplemented',INTERNAL:'internal',UNAVAILABLE:'unavailable',DATA_LOSS:'data-loss'},FirestoreError=function(_super){function FirestoreError(code,message){var _this=_super.call(this,message)||this;return _this.code=code,_this.message=message,_this.name='FirebaseError',_this.toString=function(){return _this.name+': [code='+_this.code+']: '+_this.message},_this}return tslib_1.__extends(FirestoreError,_super),FirestoreError}(Error),AutoId=function(){function AutoId(){}return AutoId.newId=function(){for(var chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',autoId='',i=0;20>i;i++)autoId+=chars.charAt(_Mathfloor(Math.random()*chars.length));return assert(20===autoId.length,'Invalid auto ID: '+autoId),autoId},AutoId}(),Blob=function(){function Blob(binaryString){assertBase64Available(),this._binaryString=binaryString}return Blob.fromBase64String=function(base64){validateExactNumberOfArgs('Blob.fromBase64String',arguments,1),validateArgType('Blob.fromBase64String','string',1,base64),assertBase64Available();try{var binaryString=PlatformSupport.getPlatform().atob(base64);return new Blob(binaryString)}catch(e){throw new FirestoreError(Code.INVALID_ARGUMENT,'Failed to construct Blob from Base64 string: '+e)}},Blob.fromUint8Array=function(array){if(validateExactNumberOfArgs('Blob.fromUint8Array',arguments,1),assertUint8ArrayAvailable(),!(array instanceof Uint8Array))throw invalidClassError('Blob.fromUint8Array','Uint8Array',1,array);var binaryString=Array.prototype.map.call(array,function(char){return String.fromCharCode(char)}).join('');return new Blob(binaryString)},Blob.prototype.toBase64=function(){return validateExactNumberOfArgs('Blob.toBase64',arguments,0),assertBase64Available(),PlatformSupport.getPlatform().btoa(this._binaryString)},Blob.prototype.toUint8Array=function(){validateExactNumberOfArgs('Blob.toUint8Array',arguments,0),assertUint8ArrayAvailable();for(var buffer=new Uint8Array(this._binaryString.length),i=0;i<this._binaryString.length;i++)buffer[i]=this._binaryString.charCodeAt(i);return buffer},Blob.prototype.toString=function(){return'Blob(base64: '+this.toBase64()+')'},Blob.prototype.isEqual=function(other){return this._binaryString===other._binaryString},Blob.prototype._compareTo=function(other){return primitiveComparator(this._binaryString,other._binaryString)},Blob}(),PublicBlob=makeConstructorPrivate(Blob,'Use Blob.fromUint8Array() or Blob.fromBase64String() instead.'),GeoPoint=function(){function GeoPoint(latitude,longitude){if(validateExactNumberOfArgs('GeoPoint',arguments,2),validateArgType('GeoPoint','number',1,latitude),validateArgType('GeoPoint','number',2,longitude),!isFinite(latitude)||-90>latitude||90<latitude)throw new FirestoreError(Code.INVALID_ARGUMENT,'Latitude must be a number between -90 and 90, but was: '+latitude);if(!isFinite(longitude)||-180>longitude||180<longitude)throw new FirestoreError(Code.INVALID_ARGUMENT,'Longitude must be a number between -180 and 180, but was: '+longitude);this._lat=latitude,this._long=longitude}return Object.defineProperty(GeoPoint.prototype,'latitude',{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(GeoPoint.prototype,'longitude',{get:function(){return this._long},enumerable:!0,configurable:!0}),GeoPoint.prototype.isEqual=function(other){return this._lat===other._lat&&this._long===other._long},GeoPoint.prototype._compareTo=function(other){return primitiveComparator(this._lat,other._lat)||primitiveComparator(this._long,other._long)},GeoPoint}(),Timestamp=function(){function Timestamp(seconds,nanoseconds){if(this.seconds=seconds,this.nanoseconds=nanoseconds,0>nanoseconds)throw new FirestoreError(Code.INVALID_ARGUMENT,'Timestamp nanoseconds out of range: '+nanoseconds);if(1e9<=nanoseconds)throw new FirestoreError(Code.INVALID_ARGUMENT,'Timestamp nanoseconds out of range: '+nanoseconds);if(-62135596800>seconds)throw new FirestoreError(Code.INVALID_ARGUMENT,'Timestamp seconds out of range: '+seconds);if(253402300800<=seconds)throw new FirestoreError(Code.INVALID_ARGUMENT,'Timestamp seconds out of range: '+seconds)}return Timestamp.now=function(){return Timestamp.fromMillis(Date.now())},Timestamp.fromDate=function(date){return Timestamp.fromMillis(date.getTime())},Timestamp.fromMillis=function(milliseconds){var seconds=_Mathfloor(milliseconds/1e3);return new Timestamp(seconds,1e6*(milliseconds-1e3*seconds))},Timestamp.prototype.toDate=function(){return new Date(this.toMillis())},Timestamp.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Timestamp.prototype._compareTo=function(other){return this.seconds===other.seconds?primitiveComparator(this.nanoseconds,other.nanoseconds):primitiveComparator(this.seconds,other.seconds)},Timestamp.prototype.isEqual=function(other){return other.seconds===this.seconds&&other.nanoseconds===this.nanoseconds},Timestamp.prototype.toString=function(){return'Timestamp(seconds='+this.seconds+', nanoseconds='+this.nanoseconds+')'},Timestamp}(),DatabaseInfo=function(){return function DatabaseInfo(databaseId,persistenceKey,host,ssl){this.databaseId=databaseId,this.persistenceKey=persistenceKey,this.host=host,this.ssl=ssl}}(),DEFAULT_DATABASE_NAME='(default)',DatabaseId=function(){function DatabaseId(projectId,database){this.projectId=projectId,this.database=database?database:DEFAULT_DATABASE_NAME}return Object.defineProperty(DatabaseId.prototype,'isDefaultDatabase',{get:function(){return this.database===DEFAULT_DATABASE_NAME},enumerable:!0,configurable:!0}),DatabaseId.prototype.isEqual=function(other){return other instanceof DatabaseId&&other.projectId===this.projectId&&other.database===this.database},DatabaseId.prototype.compareTo=function(other){return primitiveComparator(this.projectId,other.projectId)||primitiveComparator(this.database,other.database)},DatabaseId}(),DOCUMENT_KEY_NAME='__name__',Path=function(){function Path(segments,offset,length){this.init(segments,offset,length)}return Path.prototype.init=function(segments,offset,length){void 0===offset?offset=0:offset>segments.length&&fail('offset '+offset+' out of range '+segments.length),void 0===length?length=segments.length-offset:length>segments.length-offset&&fail('length '+length+' out of range '+(segments.length-offset)),this.segments=segments,this.offset=offset,this.len=length},Path.prototype.construct=function(segments,offset,length){var path=Object.create(Object.getPrototypeOf(this));return path.init(segments,offset,length),path},Object.defineProperty(Path.prototype,'length',{get:function(){return this.len},enumerable:!0,configurable:!0}),Path.prototype.isEqual=function(other){return 0===Path.comparator(this,other)},Path.prototype.child=function(nameOrPath){var segments=this.segments.slice(this.offset,this.limit());return nameOrPath instanceof Path?nameOrPath.forEach(function(segment){segments.push(segment)}):'string'==typeof nameOrPath?segments.push(nameOrPath):fail('Unknown parameter type for Path.child(): '+nameOrPath),this.construct(segments)},Path.prototype.limit=function(){return this.offset+this.length},Path.prototype.popFirst=function(size){return size=void 0===size?1:size,assert(this.length>=size,'Can\'t call popFirst() with less segments'),this.construct(this.segments,this.offset+size,this.length-size)},Path.prototype.popLast=function(){return assert(!this.isEmpty(),'Can\'t call popLast() on empty path'),this.construct(this.segments,this.offset,this.length-1)},Path.prototype.firstSegment=function(){return assert(!this.isEmpty(),'Can\'t call firstSegment() on empty path'),this.segments[this.offset]},Path.prototype.lastSegment=function(){return assert(!this.isEmpty(),'Can\'t call lastSegment() on empty path'),this.segments[this.limit()-1]},Path.prototype.get=function(index){return assert(index<this.length,'Index out of range'),this.segments[this.offset+index]},Path.prototype.isEmpty=function(){return 0===this.length},Path.prototype.isPrefixOf=function(other){if(other.length<this.length)return!1;for(var i=0;i<this.length;i++)if(this.get(i)!==other.get(i))return!1;return!0},Path.prototype.isImmediateParentOf=function(potentialChild){if(this.length+1!==potentialChild.length)return!1;for(var i=0;i<this.length;i++)if(this.get(i)!==potentialChild.get(i))return!1;return!0},Path.prototype.forEach=function(fn){for(var i=this.offset,end=this.limit();i<end;i++)fn(this.segments[i])},Path.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Path.comparator=function(p1,p2){for(var len=_Mathmin(p1.length,p2.length),i=0;i<len;i++){var left=p1.get(i),right=p2.get(i);if(left<right)return-1;if(left>right)return 1}return p1.length<p2.length?-1:p1.length>p2.length?1:0},Path}(),ResourcePath=function(_super){function ResourcePath(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(ResourcePath,_super),ResourcePath.prototype.canonicalString=function(){return this.toArray().join('/')},ResourcePath.prototype.toString=function(){return this.canonicalString()},ResourcePath.fromString=function(path){if(0<=path.indexOf('//'))throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid path ('+path+'). Paths must not contain // in them.');var segments=path.split('/').filter(function(segment){return 0<segment.length});return new ResourcePath(segments)},ResourcePath.EMPTY_PATH=new ResourcePath([]),ResourcePath}(Path),identifierRegExp=/^[_a-zA-Z][_a-zA-Z0-9]*$/,FieldPath=function(_super){function FieldPath(){return null!==_super&&_super.apply(this,arguments)||this}return tslib_1.__extends(FieldPath,_super),FieldPath.isValidIdentifier=function(segment){return identifierRegExp.test(segment)},FieldPath.prototype.canonicalString=function(){return this.toArray().map(function(str){return str=str.replace('\\','\\\\').replace('`','\\`'),FieldPath.isValidIdentifier(str)||(str='`'+str+'`'),str}).join('.')},FieldPath.prototype.toString=function(){return this.canonicalString()},FieldPath.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===DOCUMENT_KEY_NAME},FieldPath.keyField=function(){return new FieldPath([DOCUMENT_KEY_NAME])},FieldPath.fromServerFormat=function(path){for(var segments=[],current='',i=0,addCurrentSegment=function(){if(0===current.length)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid field path ('+path+'). Paths must not be empty, begin '+'with \'.\', end with \'.\', or contain \'..\'');segments.push(current),current=''},inBackticks=!1,c;i<path.length;)if(c=path[i],'\\'===c){if(i+1===path.length)throw new FirestoreError(Code.INVALID_ARGUMENT,'Path has trailing escape character: '+path);var next=path[i+1];if('\\'!==next&&'.'!==next&&'`'!==next)throw new FirestoreError(Code.INVALID_ARGUMENT,'Path has invalid escape sequence: '+path);current+=next,i+=2}else'`'===c?(inBackticks=!inBackticks,i++):'.'!==c||inBackticks?(current+=c,i++):(addCurrentSegment(),i++);if(addCurrentSegment(),inBackticks)throw new FirestoreError(Code.INVALID_ARGUMENT,'Unterminated ` in path: '+path);return new FieldPath(segments)},FieldPath.EMPTY_PATH=new FieldPath([]),FieldPath}(Path),DocumentKey=function(){function DocumentKey(path){this.path=path,assert(DocumentKey.isDocumentKey(path),'Invalid DocumentKey with an odd number of segments: '+path.toArray().join('/'))}return DocumentKey.prototype.isEqual=function(other){return null!==other&&0===ResourcePath.comparator(this.path,other.path)},DocumentKey.prototype.toString=function(){return this.path.toString()},DocumentKey.comparator=function(k1,k2){return ResourcePath.comparator(k1.path,k2.path)},DocumentKey.isDocumentKey=function(path){return 0==path.length%2},DocumentKey.fromSegments=function(segments){return new DocumentKey(new ResourcePath(segments.slice()))},DocumentKey.fromPathString=function(path){return new DocumentKey(ResourcePath.fromString(path))},DocumentKey.EMPTY=new DocumentKey(new ResourcePath([])),DocumentKey}(),MaybeDocument=function(){function MaybeDocument(key,version){this.key=key,this.version=version}return MaybeDocument.compareByKey=function(d1,d2){return DocumentKey.comparator(d1.key,d2.key)},MaybeDocument}(),Document=function(_super){function Document(key,version,data,options){var _this=_super.call(this,key,version)||this;return _this.data=data,_this.hasLocalMutations=!!options.hasLocalMutations,_this.hasCommittedMutations=!!options.hasCommittedMutations,_this}return tslib_1.__extends(Document,_super),Document.prototype.field=function(path){return this.data.field(path)},Document.prototype.fieldValue=function(path){var field=this.field(path);return field?field.value():void 0},Document.prototype.value=function(){return this.data.value()},Document.prototype.isEqual=function(other){return other instanceof Document&&this.key.isEqual(other.key)&&this.version.isEqual(other.version)&&this.data.isEqual(other.data)&&this.hasLocalMutations===other.hasLocalMutations&&this.hasCommittedMutations===other.hasCommittedMutations},Document.prototype.toString=function(){return'Document('+this.key+', '+this.version+', '+this.data.toString()+', '+('{hasLocalMutations: '+this.hasLocalMutations+'}), ')+('{hasCommittedMutations: '+this.hasCommittedMutations+'})')},Object.defineProperty(Document.prototype,'hasPendingWrites',{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Document.compareByField=function(field,d1,d2){var v1=d1.field(field),v2=d2.field(field);return void 0!==v1&&void 0!==v2?v1.compareTo(v2):fail('Trying to compare documents on fields that don\'t exist')},Document}(MaybeDocument),NoDocument=function(_super){function NoDocument(key,version,options){var _this=_super.call(this,key,version)||this;return _this.hasCommittedMutations=!!(options&&options.hasCommittedMutations),_this}return tslib_1.__extends(NoDocument,_super),NoDocument.prototype.toString=function(){return'NoDocument('+this.key+', '+this.version+')'},Object.defineProperty(NoDocument.prototype,'hasPendingWrites',{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),NoDocument.prototype.isEqual=function(other){return other instanceof NoDocument&&other.hasCommittedMutations===this.hasCommittedMutations&&other.version.isEqual(this.version)&&other.key.isEqual(this.key)},NoDocument}(MaybeDocument),UnknownDocument=function(_super){function UnknownDocument(key,version){return _super.call(this,key,version)||this}return tslib_1.__extends(UnknownDocument,_super),UnknownDocument.prototype.toString=function(){return'UnknownDocument('+this.key+', '+this.version+')'},Object.defineProperty(UnknownDocument.prototype,'hasPendingWrites',{get:function(){return!0},enumerable:!0,configurable:!0}),UnknownDocument.prototype.isEqual=function(other){return other instanceof UnknownDocument&&other.version.isEqual(this.version)&&other.key.isEqual(this.key)},UnknownDocument}(MaybeDocument),SortedMap=function(){function SortedMap(comparator,root){this.comparator=comparator,this.root=root?root:LLRBNode.EMPTY}return SortedMap.prototype.insert=function(key,value){return new SortedMap(this.comparator,this.root.insert(key,value,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))},SortedMap.prototype.remove=function(key){return new SortedMap(this.comparator,this.root.remove(key,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))},SortedMap.prototype.get=function(key){for(var node=this.root,cmp;!node.isEmpty();){if(cmp=this.comparator(key,node.key),0===cmp)return node.value;0>cmp?node=node.left:0<cmp&&(node=node.right)}return null},SortedMap.prototype.indexOf=function(key){for(var prunedNodes=0,node=this.root,cmp;!node.isEmpty();){if(cmp=this.comparator(key,node.key),0===cmp)return prunedNodes+node.left.size;0>cmp?node=node.left:(prunedNodes+=node.left.size+1,node=node.right)}return-1},SortedMap.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(SortedMap.prototype,'size',{get:function(){return this.root.size},enumerable:!0,configurable:!0}),SortedMap.prototype.minKey=function(){return this.root.minKey()},SortedMap.prototype.maxKey=function(){return this.root.maxKey()},SortedMap.prototype.inorderTraversal=function(action){return this.root.inorderTraversal(action)},SortedMap.prototype.forEach=function(fn){this.inorderTraversal(function(k,v){return fn(k,v),!1})},SortedMap.prototype.reverseTraversal=function(action){return this.root.reverseTraversal(action)},SortedMap.prototype.getIterator=function(){return new SortedMapIterator(this.root,null,this.comparator,!1)},SortedMap.prototype.getIteratorFrom=function(key){return new SortedMapIterator(this.root,key,this.comparator,!1)},SortedMap.prototype.getReverseIterator=function(){return new SortedMapIterator(this.root,null,this.comparator,!0)},SortedMap.prototype.getReverseIteratorFrom=function(key){return new SortedMapIterator(this.root,key,this.comparator,!0)},SortedMap}(),SortedMapIterator=function(){function SortedMapIterator(node,startKey,comparator,isReverse){this.isReverse=isReverse,this.nodeStack=[];for(var cmp=1;!node.isEmpty();)if(cmp=startKey?comparator(node.key,startKey):1,isReverse&&(cmp*=-1),0>cmp)node=this.isReverse?node.left:node.right;else if(0===cmp){this.nodeStack.push(node);break}else this.nodeStack.push(node),node=this.isReverse?node.right:node.left}return SortedMapIterator.prototype.getNext=function(){assert(0<this.nodeStack.length,'getNext() called on iterator when hasNext() is false.');var node=this.nodeStack.pop(),result={key:node.key,value:node.value};if(this.isReverse)for(node=node.left;!node.isEmpty();)this.nodeStack.push(node),node=node.right;else for(node=node.right;!node.isEmpty();)this.nodeStack.push(node),node=node.left;return result},SortedMapIterator.prototype.hasNext=function(){return 0<this.nodeStack.length},SortedMapIterator.prototype.peek=function(){if(0===this.nodeStack.length)return null;var node=this.nodeStack[this.nodeStack.length-1];return{key:node.key,value:node.value}},SortedMapIterator}(),LLRBNode=function(){function LLRBNode(key,value,color,left,right){this.key=key,this.value=value,this.color=null==color?LLRBNode.RED:color,this.left=null==left?LLRBNode.EMPTY:left,this.right=null==right?LLRBNode.EMPTY:right,this.size=this.left.size+1+this.right.size}return LLRBNode.prototype.copy=function(key,value,color,left,right){return new LLRBNode(null==key?this.key:key,null==value?this.value:value,null==color?this.color:color,null==left?this.left:left,null==right?this.right:right)},LLRBNode.prototype.isEmpty=function(){return!1},LLRBNode.prototype.inorderTraversal=function(action){return this.left.inorderTraversal(action)||action(this.key,this.value)||this.right.inorderTraversal(action)},LLRBNode.prototype.reverseTraversal=function(action){return this.right.reverseTraversal(action)||action(this.key,this.value)||this.left.reverseTraversal(action)},LLRBNode.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},LLRBNode.prototype.minKey=function(){return this.min().key},LLRBNode.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},LLRBNode.prototype.insert=function(key,value,comparator){var n=this,cmp=comparator(key,n.key);return n=0>cmp?n.copy(null,null,null,n.left.insert(key,value,comparator),null):0===cmp?n.copy(null,value,null,null,null):n.copy(null,null,null,null,n.right.insert(key,value,comparator)),n.fixUp()},LLRBNode.prototype.removeMin=function(){if(this.left.isEmpty())return LLRBNode.EMPTY;var n=this;return n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.removeMin(),null),n.fixUp()},LLRBNode.prototype.remove=function(key,comparator){var n=this,smallest;if(0>comparator(key,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(key,comparator),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===comparator(key,n.key)){if(n.right.isEmpty())return LLRBNode.EMPTY;smallest=n.right.min(),n=n.copy(smallest.key,smallest.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(key,comparator))}return n.fixUp()},LLRBNode.prototype.isRed=function(){return this.color},LLRBNode.prototype.fixUp=function(){var n=this;return n.right.isRed()&&!n.left.isRed()&&(n=n.rotateLeft()),n.left.isRed()&&n.left.left.isRed()&&(n=n.rotateRight()),n.left.isRed()&&n.right.isRed()&&(n=n.colorFlip()),n},LLRBNode.prototype.moveRedLeft=function(){var n=this.colorFlip();return n.right.left.isRed()&&(n=n.copy(null,null,null,null,n.right.rotateRight()),n=n.rotateLeft(),n=n.colorFlip()),n},LLRBNode.prototype.moveRedRight=function(){var n=this.colorFlip();return n.left.left.isRed()&&(n=n.rotateRight(),n=n.colorFlip()),n},LLRBNode.prototype.rotateLeft=function(){var nl=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,nl,null)},LLRBNode.prototype.rotateRight=function(){var nr=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,nr)},LLRBNode.prototype.colorFlip=function(){var left=this.left.copy(null,null,!this.left.color,null,null),right=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,left,right)},LLRBNode.prototype.checkMaxDepth=function(){var blackDepth=this.check();return!!(Math.pow(2,blackDepth)<=this.size+1)},LLRBNode.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw fail('Red node has red child('+this.key+','+this.value+')');if(this.right.isRed())throw fail('Right child of ('+this.key+','+this.value+') is red');var blackDepth=this.left.check();if(blackDepth!==this.right.check())throw fail('Black depths differ');else return blackDepth+(this.isRed()?0:1)},LLRBNode.EMPTY=null,LLRBNode.RED=!0,LLRBNode.BLACK=!1,LLRBNode}(),LLRBEmptyNode=function(){function LLRBEmptyNode(){this.size=0}return LLRBEmptyNode.prototype.copy=function(){return this},LLRBEmptyNode.prototype.insert=function(key,value){return new LLRBNode(key,value)},LLRBEmptyNode.prototype.remove=function(){return this},LLRBEmptyNode.prototype.isEmpty=function(){return!0},LLRBEmptyNode.prototype.inorderTraversal=function(){return!1},LLRBEmptyNode.prototype.reverseTraversal=function(){return!1},LLRBEmptyNode.prototype.minKey=function(){return null},LLRBEmptyNode.prototype.maxKey=function(){return null},LLRBEmptyNode.prototype.isRed=function(){return!1},LLRBEmptyNode.prototype.checkMaxDepth=function(){return!0},LLRBEmptyNode.prototype.check=function(){return 0},LLRBEmptyNode}();LLRBNode.EMPTY=new LLRBEmptyNode;var TypeOrder;(function(TypeOrder){TypeOrder[TypeOrder.NullValue=0]='NullValue',TypeOrder[TypeOrder.BooleanValue=1]='BooleanValue',TypeOrder[TypeOrder.NumberValue=2]='NumberValue',TypeOrder[TypeOrder.TimestampValue=3]='TimestampValue',TypeOrder[TypeOrder.StringValue=4]='StringValue',TypeOrder[TypeOrder.BlobValue=5]='BlobValue',TypeOrder[TypeOrder.RefValue=6]='RefValue',TypeOrder[TypeOrder.GeoPointValue=7]='GeoPointValue',TypeOrder[TypeOrder.ArrayValue=8]='ArrayValue',TypeOrder[TypeOrder.ObjectValue=9]='ObjectValue'})(TypeOrder||(TypeOrder={}));var ServerTimestampBehavior;(function(ServerTimestampBehavior){ServerTimestampBehavior[ServerTimestampBehavior.Default=0]='Default',ServerTimestampBehavior[ServerTimestampBehavior.Estimate=1]='Estimate',ServerTimestampBehavior[ServerTimestampBehavior.Previous=2]='Previous'})(ServerTimestampBehavior||(ServerTimestampBehavior={}));var FieldValueOptions=function(){function FieldValueOptions(serverTimestampBehavior,timestampsInSnapshots){this.serverTimestampBehavior=serverTimestampBehavior,this.timestampsInSnapshots=timestampsInSnapshots}return FieldValueOptions.fromSnapshotOptions=function(options,timestampsInSnapshots){switch(options.serverTimestamps){case'estimate':return new FieldValueOptions(ServerTimestampBehavior.Estimate,timestampsInSnapshots);case'previous':return new FieldValueOptions(ServerTimestampBehavior.Previous,timestampsInSnapshots);case'none':case void 0:return new FieldValueOptions(ServerTimestampBehavior.Default,timestampsInSnapshots);default:return fail('fromSnapshotOptions() called with invalid options.');}},FieldValueOptions}(),FieldValue=function(){function FieldValue(){}return FieldValue.prototype.toString=function(){var val=this.value();return null===val?'null':val.toString()},FieldValue.prototype.defaultCompareTo=function(other){assert(this.typeOrder!==other.typeOrder,'Default compareTo should not be used for values of same type.');var cmp=primitiveComparator(this.typeOrder,other.typeOrder);return cmp},FieldValue}(),NullValue=function(_super){function NullValue(){var _this=_super.call(this)||this;return _this.typeOrder=TypeOrder.NullValue,_this.internalValue=null,_this}return tslib_1.__extends(NullValue,_super),NullValue.prototype.value=function(){return null},NullValue.prototype.isEqual=function(other){return other instanceof NullValue},NullValue.prototype.compareTo=function(other){return other instanceof NullValue?0:this.defaultCompareTo(other)},NullValue.INSTANCE=new NullValue,NullValue}(FieldValue),BooleanValue=function(_super){function BooleanValue(internalValue){var _this=_super.call(this)||this;return _this.internalValue=internalValue,_this.typeOrder=TypeOrder.BooleanValue,_this}return tslib_1.__extends(BooleanValue,_super),BooleanValue.prototype.value=function(){return this.internalValue},BooleanValue.prototype.isEqual=function(other){return other instanceof BooleanValue&&this.internalValue===other.internalValue},BooleanValue.prototype.compareTo=function(other){return other instanceof BooleanValue?primitiveComparator(this,other):this.defaultCompareTo(other)},BooleanValue.of=function(value){return value?BooleanValue.TRUE:BooleanValue.FALSE},BooleanValue.TRUE=new BooleanValue(!0),BooleanValue.FALSE=new BooleanValue(!1),BooleanValue}(FieldValue),NumberValue=function(_super){function NumberValue(internalValue){var _this=_super.call(this)||this;return _this.internalValue=internalValue,_this.typeOrder=TypeOrder.NumberValue,_this}return tslib_1.__extends(NumberValue,_super),NumberValue.prototype.value=function(){return this.internalValue},NumberValue.prototype.compareTo=function(other){return other instanceof NumberValue?numericComparator(this.internalValue,other.internalValue):this.defaultCompareTo(other)},NumberValue}(FieldValue),IntegerValue=function(_super){function IntegerValue(internalValue){return _super.call(this,internalValue)||this}return tslib_1.__extends(IntegerValue,_super),IntegerValue.prototype.isEqual=function(other){return!!(other instanceof IntegerValue)&&numericEquals(this.internalValue,other.internalValue)},IntegerValue}(NumberValue),DoubleValue=function(_super){function DoubleValue(internalValue){var _this=_super.call(this,internalValue)||this;return _this.internalValue=internalValue,_this}return tslib_1.__extends(DoubleValue,_super),DoubleValue.prototype.isEqual=function(other){return!!(other instanceof DoubleValue)&&numericEquals(this.internalValue,other.internalValue)},DoubleValue.NAN=new DoubleValue(NaN),DoubleValue.POSITIVE_INFINITY=new DoubleValue(Infinity),DoubleValue.NEGATIVE_INFINITY=new DoubleValue(-Infinity),DoubleValue}(NumberValue),StringValue=function(_super){function StringValue(internalValue){var _this=_super.call(this)||this;return _this.internalValue=internalValue,_this.typeOrder=TypeOrder.StringValue,_this}return tslib_1.__extends(StringValue,_super),StringValue.prototype.value=function(){return this.internalValue},StringValue.prototype.isEqual=function(other){return other instanceof StringValue&&this.internalValue===other.internalValue},StringValue.prototype.compareTo=function(other){return other instanceof StringValue?primitiveComparator(this.internalValue,other.internalValue):this.defaultCompareTo(other)},StringValue}(FieldValue),TimestampValue=function(_super){function TimestampValue(internalValue){var _this=_super.call(this)||this;return _this.internalValue=internalValue,_this.typeOrder=TypeOrder.TimestampValue,_this}return tslib_1.__extends(TimestampValue,_super),TimestampValue.prototype.value=function(options){return options&&options.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},TimestampValue.prototype.isEqual=function(other){return other instanceof TimestampValue&&this.internalValue.isEqual(other.internalValue)},TimestampValue.prototype.compareTo=function(other){return other instanceof TimestampValue?this.internalValue._compareTo(other.internalValue):other instanceof ServerTimestampValue?-1:this.defaultCompareTo(other)},TimestampValue}(FieldValue),ServerTimestampValue=function(_super){function ServerTimestampValue(localWriteTime,previousValue){var _this=_super.call(this)||this;return _this.localWriteTime=localWriteTime,_this.previousValue=previousValue,_this.typeOrder=TypeOrder.TimestampValue,_this}return tslib_1.__extends(ServerTimestampValue,_super),ServerTimestampValue.prototype.value=function(options){return options&&options.serverTimestampBehavior===ServerTimestampBehavior.Estimate?new TimestampValue(this.localWriteTime).value(options):options&&options.serverTimestampBehavior===ServerTimestampBehavior.Previous?this.previousValue?this.previousValue.value(options):null:null},ServerTimestampValue.prototype.isEqual=function(other){return other instanceof ServerTimestampValue&&this.localWriteTime.isEqual(other.localWriteTime)},ServerTimestampValue.prototype.compareTo=function(other){return other instanceof ServerTimestampValue?this.localWriteTime._compareTo(other.localWriteTime):other instanceof TimestampValue?1:this.defaultCompareTo(other)},ServerTimestampValue.prototype.toString=function(){return'<ServerTimestamp localTime='+this.localWriteTime.toString()+'>'},ServerTimestampValue}(FieldValue),BlobValue=function(_super){function BlobValue(internalValue){var _this=_super.call(this)||this;return _this.internalValue=internalValue,_this.typeOrder=TypeOrder.BlobValue,_this}return tslib_1.__extends(BlobValue,_super),BlobValue.prototype.value=function(){return this.internalValue},BlobValue.prototype.isEqual=function(other){return other instanceof BlobValue&&this.internalValue.isEqual(other.internalValue)},BlobValue.prototype.compareTo=function(other){return other instanceof BlobValue?this.internalValue._compareTo(other.internalValue):this.defaultCompareTo(other)},BlobValue}(FieldValue),RefValue=function(_super){function RefValue(databaseId,key){var _this=_super.call(this)||this;return _this.databaseId=databaseId,_this.key=key,_this.typeOrder=TypeOrder.RefValue,_this}return tslib_1.__extends(RefValue,_super),RefValue.prototype.value=function(){return this.key},RefValue.prototype.isEqual=function(other){return!!(other instanceof RefValue)&&this.key.isEqual(other.key)&&this.databaseId.isEqual(other.databaseId)},RefValue.prototype.compareTo=function(other){if(other instanceof RefValue){var cmp=this.databaseId.compareTo(other.databaseId);return 0===cmp?DocumentKey.comparator(this.key,other.key):cmp}return this.defaultCompareTo(other)},RefValue}(FieldValue),GeoPointValue=function(_super){function GeoPointValue(internalValue){var _this=_super.call(this)||this;return _this.internalValue=internalValue,_this.typeOrder=TypeOrder.GeoPointValue,_this}return tslib_1.__extends(GeoPointValue,_super),GeoPointValue.prototype.value=function(){return this.internalValue},GeoPointValue.prototype.isEqual=function(other){return other instanceof GeoPointValue&&this.internalValue.isEqual(other.internalValue)},GeoPointValue.prototype.compareTo=function(other){return other instanceof GeoPointValue?this.internalValue._compareTo(other.internalValue):this.defaultCompareTo(other)},GeoPointValue}(FieldValue),ObjectValue=function(_super){function ObjectValue(internalValue){var _this=_super.call(this)||this;return _this.internalValue=internalValue,_this.typeOrder=TypeOrder.ObjectValue,_this}return tslib_1.__extends(ObjectValue,_super),ObjectValue.prototype.value=function(options){var result={};return this.internalValue.inorderTraversal(function(key,val){result[key]=val.value(options)}),result},ObjectValue.prototype.forEach=function(action){this.internalValue.inorderTraversal(action)},ObjectValue.prototype.isEqual=function(other){if(other instanceof ObjectValue){for(var it1=this.internalValue.getIterator(),it2=other.internalValue.getIterator();it1.hasNext()&&it2.hasNext();){var next1=it1.getNext(),next2=it2.getNext();if(next1.key!==next2.key||!next1.value.isEqual(next2.value))return!1}return!it1.hasNext()&&!it2.hasNext()}return!1},ObjectValue.prototype.compareTo=function(other){if(other instanceof ObjectValue){for(var it1=this.internalValue.getIterator(),it2=other.internalValue.getIterator();it1.hasNext()&&it2.hasNext();){var next1=it1.getNext(),next2=it2.getNext(),cmp=primitiveComparator(next1.key,next2.key)||next1.value.compareTo(next2.value);if(cmp)return cmp}return primitiveComparator(it1.hasNext(),it2.hasNext())}return this.defaultCompareTo(other)},ObjectValue.prototype.set=function(path,to){if(assert(!path.isEmpty(),'Cannot set field for empty path on ObjectValue'),1===path.length)return this.setChild(path.firstSegment(),to);var child=this.child(path.firstSegment());child instanceof ObjectValue||(child=ObjectValue.EMPTY);var newChild=child.set(path.popFirst(),to);return this.setChild(path.firstSegment(),newChild)},ObjectValue.prototype.delete=function(path){if(assert(!path.isEmpty(),'Cannot delete field for empty path on ObjectValue'),1===path.length)return new ObjectValue(this.internalValue.remove(path.firstSegment()));var child=this.child(path.firstSegment());if(child instanceof ObjectValue){var newChild=child.delete(path.popFirst());return new ObjectValue(this.internalValue.insert(path.firstSegment(),newChild))}return this},ObjectValue.prototype.contains=function(path){return void 0!==this.field(path)},ObjectValue.prototype.field=function(path){assert(!path.isEmpty(),'Can\'t get field of empty path');var field=this;return path.forEach(function(pathSegment){field=field instanceof ObjectValue?field.internalValue.get(pathSegment)||void 0:void 0}),field},ObjectValue.prototype.toString=function(){return JSON.stringify(this.value())},ObjectValue.prototype.child=function(childName){return this.internalValue.get(childName)||void 0},ObjectValue.prototype.setChild=function(childName,value){return new ObjectValue(this.internalValue.insert(childName,value))},ObjectValue.EMPTY=new ObjectValue(new SortedMap(primitiveComparator)),ObjectValue}(FieldValue),ArrayValue=function(_super){function ArrayValue(internalValue){var _this=_super.call(this)||this;return _this.internalValue=internalValue,_this.typeOrder=TypeOrder.ArrayValue,_this}return tslib_1.__extends(ArrayValue,_super),ArrayValue.prototype.value=function(options){return this.internalValue.map(function(v){return v.value(options)})},ArrayValue.prototype.forEach=function(action){this.internalValue.forEach(action)},ArrayValue.prototype.isEqual=function(other){if(other instanceof ArrayValue){if(this.internalValue.length!==other.internalValue.length)return!1;for(var i=0;i<this.internalValue.length;i++)if(!this.internalValue[i].isEqual(other.internalValue[i]))return!1;return!0}return!1},ArrayValue.prototype.compareTo=function(other){if(other instanceof ArrayValue){for(var minLength=_Mathmin(this.internalValue.length,other.internalValue.length),i=0,cmp;i<minLength;i++)if(cmp=this.internalValue[i].compareTo(other.internalValue[i]),cmp)return cmp;return primitiveComparator(this.internalValue.length,other.internalValue.length)}return this.defaultCompareTo(other)},ArrayValue.prototype.toString=function(){return JSON.stringify(this.value())},ArrayValue}(FieldValue),NumberAsAny=Number,MIN_SAFE_INTEGER=NumberAsAny.MIN_SAFE_INTEGER||-(9007199254740992-1),MAX_SAFE_INTEGER=NumberAsAny.MAX_SAFE_INTEGER||9007199254740992-1,isInteger=NumberAsAny.isInteger||function(value){return'number'==typeof value&&isFinite(value)&&_Mathfloor(value)===value},Query=function(){function Query(path,explicitOrderBy,filters,limit,startAt,endAt){void 0===explicitOrderBy&&(explicitOrderBy=[]),void 0===filters&&(filters=[]),void 0===limit&&(limit=null),void 0===startAt&&(startAt=null),void 0===endAt&&(endAt=null),this.path=path,this.explicitOrderBy=explicitOrderBy,this.filters=filters,this.limit=limit,this.startAt=startAt,this.endAt=endAt,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return Query.atPath=function(path){return new Query(path)},Object.defineProperty(Query.prototype,'orderBy',{get:function(){if(null===this.memoizedOrderBy){var inequalityField=this.getInequalityFilterField(),firstOrderByField=this.getFirstOrderByField();if(null!==inequalityField&&null===firstOrderByField)this.memoizedOrderBy=inequalityField.isKeyField()?[KEY_ORDERING_ASC]:[new OrderBy(inequalityField),KEY_ORDERING_ASC];else{assert(null===inequalityField||null!==firstOrderByField&&inequalityField.isEqual(firstOrderByField),'First orderBy should match inequality field.'),this.memoizedOrderBy=[];for(var foundKeyOrdering=!1,_i=0,_a=this.explicitOrderBy,orderBy;_i<_a.length;_i++)orderBy=_a[_i],this.memoizedOrderBy.push(orderBy),orderBy.field.isKeyField()&&(foundKeyOrdering=!0);if(!foundKeyOrdering){var lastDirection=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Direction.ASCENDING;this.memoizedOrderBy.push(lastDirection===Direction.ASCENDING?KEY_ORDERING_ASC:KEY_ORDERING_DESC)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),Query.prototype.addFilter=function(filter){assert(null==this.getInequalityFilterField()||!(filter instanceof RelationFilter)||!filter.isInequality()||filter.field.isEqual(this.getInequalityFilterField()),'Query must only have one inequality field.'),assert(!DocumentKey.isDocumentKey(this.path),'No filtering allowed for document query');var newFilters=this.filters.concat([filter]);return new Query(this.path,this.explicitOrderBy.slice(),newFilters,this.limit,this.startAt,this.endAt)},Query.prototype.addOrderBy=function(orderBy){assert(!DocumentKey.isDocumentKey(this.path),'No ordering allowed for document query'),assert(!this.startAt&&!this.endAt,'Bounds must be set after orderBy');var newOrderBy=this.explicitOrderBy.concat([orderBy]);return new Query(this.path,newOrderBy,this.filters.slice(),this.limit,this.startAt,this.endAt)},Query.prototype.withLimit=function(limit){return new Query(this.path,this.explicitOrderBy.slice(),this.filters.slice(),limit,this.startAt,this.endAt)},Query.prototype.withStartAt=function(bound){return new Query(this.path,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,bound,this.endAt)},Query.prototype.withEndAt=function(bound){return new Query(this.path,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,bound)},Query.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var canonicalId=this.path.canonicalString();canonicalId+='|f:';for(var _i=0,_a=this.filters,filter;_i<_a.length;_i++)filter=_a[_i],canonicalId+=filter.canonicalId(),canonicalId+=',';canonicalId+='|ob:';for(var _b=0,_c=this.orderBy,orderBy;_b<_c.length;_b++)orderBy=_c[_b],canonicalId+=orderBy.canonicalId(),canonicalId+=',';isNullOrUndefined(this.limit)||(canonicalId+='|l:',canonicalId+=this.limit),this.startAt&&(canonicalId+='|lb:',canonicalId+=this.startAt.canonicalId()),this.endAt&&(canonicalId+='|ub:',canonicalId+=this.endAt.canonicalId()),this.memoizedCanonicalId=canonicalId}return this.memoizedCanonicalId},Query.prototype.toString=function(){var str='Query('+this.path.canonicalString();return 0<this.filters.length&&(str+=', filters: ['+this.filters.join(', ')+']'),isNullOrUndefined(this.limit)||(str+=', limit: '+this.limit),0<this.explicitOrderBy.length&&(str+=', orderBy: ['+this.explicitOrderBy.join(', ')+']'),this.startAt&&(str+=', startAt: '+this.startAt.canonicalId()),this.endAt&&(str+=', endAt: '+this.endAt.canonicalId()),str+')'},Query.prototype.isEqual=function(other){if(this.limit!==other.limit)return!1;if(this.orderBy.length!==other.orderBy.length)return!1;for(var i=0;i<this.orderBy.length;i++)if(!this.orderBy[i].isEqual(other.orderBy[i]))return!1;if(this.filters.length!==other.filters.length)return!1;for(var i=0;i<this.filters.length;i++)if(!this.filters[i].isEqual(other.filters[i]))return!1;return!!this.path.isEqual(other.path)&&(null===this.startAt?null===other.startAt:!!this.startAt.isEqual(other.startAt))&&(null===this.endAt?null===other.endAt:this.endAt.isEqual(other.endAt))},Query.prototype.docComparator=function(d1,d2){for(var comparedOnKeyField=!1,_i=0,_a=this.orderBy;_i<_a.length;_i++){var orderBy=_a[_i],comp=orderBy.compare(d1,d2);if(0!==comp)return comp;comparedOnKeyField=comparedOnKeyField||orderBy.field.isKeyField()}return assert(comparedOnKeyField,'orderBy used that doesn\'t compare on key field'),0},Query.prototype.matches=function(doc){return this.matchesAncestor(doc)&&this.matchesOrderBy(doc)&&this.matchesFilters(doc)&&this.matchesBounds(doc)},Query.prototype.hasLimit=function(){return!isNullOrUndefined(this.limit)},Query.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},Query.prototype.getInequalityFilterField=function(){for(var _i=0,_a=this.filters,filter;_i<_a.length;_i++)if(filter=_a[_i],filter instanceof RelationFilter&&filter.isInequality())return filter.field;return null},Query.prototype.hasArrayContainsFilter=function(){return void 0!==this.filters.find(function(filter){return filter instanceof RelationFilter&&filter.op===RelationOp.ARRAY_CONTAINS})},Query.prototype.isDocumentQuery=function(){return DocumentKey.isDocumentKey(this.path)&&0===this.filters.length},Query.prototype.matchesAncestor=function(doc){var docPath=doc.key.path;return DocumentKey.isDocumentKey(this.path)?this.path.isEqual(docPath):this.path.isPrefixOf(docPath)&&this.path.length===docPath.length-1},Query.prototype.matchesOrderBy=function(doc){for(var _i=0,_a=this.explicitOrderBy,orderBy;_i<_a.length;_i++)if(orderBy=_a[_i],!orderBy.field.isKeyField()&&void 0===doc.field(orderBy.field))return!1;return!0},Query.prototype.matchesFilters=function(doc){for(var _i=0,_a=this.filters,filter;_i<_a.length;_i++)if(filter=_a[_i],!filter.matches(doc))return!1;return!0},Query.prototype.matchesBounds=function(doc){return this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,doc)?!1:this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,doc)?!1:!0},Query.prototype.assertValidBound=function(bound){assert(bound.position.length<=this.orderBy.length,'Bound is longer than orderBy')},Query}(),Filter=function(){function Filter(){}return Filter.create=function(field,op,value){if(value.isEqual(NullValue.INSTANCE)){if(op!==RelationOp.EQUAL)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid query. You can only perform equals comparisons on null.');return new NullFilter(field)}if(value.isEqual(DoubleValue.NAN)){if(op!==RelationOp.EQUAL)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid query. You can only perform equals comparisons on NaN.');return new NanFilter(field)}return new RelationFilter(field,op,value)},Filter}(),RelationOp=function(){function RelationOp(name){this.name=name}return RelationOp.fromString=function(op){return'<'===op?RelationOp.LESS_THAN:'<='===op?RelationOp.LESS_THAN_OR_EQUAL:'=='===op?RelationOp.EQUAL:'>='===op?RelationOp.GREATER_THAN_OR_EQUAL:'>'===op?RelationOp.GREATER_THAN:'array-contains'===op?RelationOp.ARRAY_CONTAINS:fail('Unknown relation: '+op)},RelationOp.prototype.toString=function(){return this.name},RelationOp.prototype.isEqual=function(other){return this.name===other.name},RelationOp.LESS_THAN=new RelationOp('<'),RelationOp.LESS_THAN_OR_EQUAL=new RelationOp('<='),RelationOp.EQUAL=new RelationOp('=='),RelationOp.GREATER_THAN=new RelationOp('>'),RelationOp.GREATER_THAN_OR_EQUAL=new RelationOp('>='),RelationOp.ARRAY_CONTAINS=new RelationOp('array-contains'),RelationOp}(),RelationFilter=function(_super){function RelationFilter(field,op,value){var _this=_super.call(this)||this;return _this.field=field,_this.op=op,_this.value=value,_this}return tslib_1.__extends(RelationFilter,_super),RelationFilter.prototype.matches=function(doc){if(this.field.isKeyField()){assert(this.value instanceof RefValue,'Comparing on key, but filter value not a RefValue'),assert(this.op!==RelationOp.ARRAY_CONTAINS,'array-contains queries don\'t make sense on document keys.');var refValue=this.value,comparison=DocumentKey.comparator(doc.key,refValue.key);return this.matchesComparison(comparison)}var val=doc.field(this.field);return void 0!==val&&this.matchesValue(val)},RelationFilter.prototype.matchesValue=function(value){var _this=this;return this.op===RelationOp.ARRAY_CONTAINS?value instanceof ArrayValue&&void 0!==value.internalValue.find(function(element){return element.isEqual(_this.value)}):this.value.typeOrder===value.typeOrder&&this.matchesComparison(value.compareTo(this.value))},RelationFilter.prototype.matchesComparison=function(comparison){switch(this.op){case RelationOp.LESS_THAN:return 0>comparison;case RelationOp.LESS_THAN_OR_EQUAL:return 0>=comparison;case RelationOp.EQUAL:return 0===comparison;case RelationOp.GREATER_THAN:return 0<comparison;case RelationOp.GREATER_THAN_OR_EQUAL:return 0<=comparison;default:return fail('Unknown relation op'+this.op);}},RelationFilter.prototype.isInequality=function(){return this.op!==RelationOp.EQUAL&&this.op!==RelationOp.ARRAY_CONTAINS},RelationFilter.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},RelationFilter.prototype.isEqual=function(other){return!!(other instanceof RelationFilter)&&this.op.isEqual(other.op)&&this.field.isEqual(other.field)&&this.value.isEqual(other.value)},RelationFilter.prototype.toString=function(){return this.field.canonicalString()+' '+this.op+' '+this.value.value()},RelationFilter}(Filter),NullFilter=function(_super){function NullFilter(field){var _this=_super.call(this)||this;return _this.field=field,_this}return tslib_1.__extends(NullFilter,_super),NullFilter.prototype.matches=function(doc){var val=doc.field(this.field);return void 0!==val&&null===val.value()},NullFilter.prototype.canonicalId=function(){return this.field.canonicalString()+' IS null'},NullFilter.prototype.toString=function(){return this.field.canonicalString()+' IS null'},NullFilter.prototype.isEqual=function(other){return!!(other instanceof NullFilter)&&this.field.isEqual(other.field)},NullFilter}(Filter),NanFilter=function(_super){function NanFilter(field){var _this=_super.call(this)||this;return _this.field=field,_this}return tslib_1.__extends(NanFilter,_super),NanFilter.prototype.matches=function(doc){var field=doc.field(this.field),val=field&&field.value();return'number'==typeof val&&isNaN(val)},NanFilter.prototype.canonicalId=function(){return this.field.canonicalString()+' IS NaN'},NanFilter.prototype.toString=function(){return this.field.canonicalString()+' IS NaN'},NanFilter.prototype.isEqual=function(other){return!!(other instanceof NanFilter)&&this.field.isEqual(other.field)},NanFilter}(Filter),Direction=function(){function Direction(name){this.name=name}return Direction.prototype.toString=function(){return this.name},Direction.ASCENDING=new Direction('asc'),Direction.DESCENDING=new Direction('desc'),Direction}(),Bound=function(){function Bound(position,before){this.position=position,this.before=before}return Bound.prototype.canonicalId=function(){for(var canonicalId=this.before?'b:':'a:',_i=0,_a=this.position,component;_i<_a.length;_i++)component=_a[_i],canonicalId+=component.toString();return canonicalId},Bound.prototype.sortsBeforeDocument=function(orderBy,doc){assert(this.position.length<=orderBy.length,'Bound has more components than query\'s orderBy');for(var comparison=0,i=0;i<this.position.length;i++){var orderByComponent=orderBy[i],component=this.position[i];if(orderByComponent.field.isKeyField())assert(component instanceof RefValue,'Bound has a non-key value where the key path is being used.'),comparison=DocumentKey.comparator(component.key,doc.key);else{var docValue=doc.field(orderByComponent.field);assert(void 0!==docValue,'Field should exist since document matched the orderBy already.'),comparison=component.compareTo(docValue)}if(orderByComponent.dir===Direction.DESCENDING&&(comparison*=-1),0!==comparison)break}return this.before?0>=comparison:0>comparison},Bound.prototype.isEqual=function(other){if(null===other)return!1;if(this.before!==other.before||this.position.length!==other.position.length)return!1;for(var i=0;i<this.position.length;i++){var thisPosition=this.position[i],otherPosition=other.position[i];return thisPosition.isEqual(otherPosition)}return!0},Bound}(),OrderBy=function(){function OrderBy(field,dir){this.field=field,void 0===dir&&(dir=Direction.ASCENDING),this.dir=dir,this.isKeyOrderBy=field.isKeyField()}return OrderBy.prototype.compare=function(d1,d2){var comparison=this.isKeyOrderBy?Document.compareByKey(d1,d2):Document.compareByField(this.field,d1,d2);switch(this.dir){case Direction.ASCENDING:return comparison;case Direction.DESCENDING:return-1*comparison;default:return fail('Unknown direction: '+this.dir);}},OrderBy.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},OrderBy.prototype.toString=function(){return this.field.canonicalString()+' ('+this.dir+')'},OrderBy.prototype.isEqual=function(other){return this.dir===other.dir&&this.field.isEqual(other.field)},OrderBy}(),KEY_ORDERING_ASC=new OrderBy(FieldPath.keyField(),Direction.ASCENDING),KEY_ORDERING_DESC=new OrderBy(FieldPath.keyField(),Direction.DESCENDING),SnapshotVersion=function(){function SnapshotVersion(timestamp){this.timestamp=timestamp}return SnapshotVersion.fromMicroseconds=function(value){var seconds=_Mathfloor(value/1e6);return new SnapshotVersion(new Timestamp(seconds,1e3*(value%1e6)))},SnapshotVersion.fromTimestamp=function(value){return new SnapshotVersion(value)},SnapshotVersion.forDeletedDoc=function(){return SnapshotVersion.MIN},SnapshotVersion.prototype.compareTo=function(other){return this.timestamp._compareTo(other.timestamp)},SnapshotVersion.prototype.isEqual=function(other){return this.timestamp.isEqual(other.timestamp)},SnapshotVersion.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},SnapshotVersion.prototype.toString=function(){return'SnapshotVersion('+this.timestamp.toString()+')'},SnapshotVersion.prototype.toTimestamp=function(){return this.timestamp},SnapshotVersion.MIN=new SnapshotVersion(new Timestamp(0,0)),SnapshotVersion}(),QueryPurpose;(function(QueryPurpose){QueryPurpose[QueryPurpose.Listen=0]='Listen',QueryPurpose[QueryPurpose.ExistenceFilterMismatch=1]='ExistenceFilterMismatch',QueryPurpose[QueryPurpose.LimboResolution=2]='LimboResolution'})(QueryPurpose||(QueryPurpose={}));var QueryData=function(){function QueryData(query,targetId,purpose,sequenceNumber,snapshotVersion,resumeToken){void 0===snapshotVersion&&(snapshotVersion=SnapshotVersion.MIN),void 0===resumeToken&&(resumeToken=emptyByteString()),this.query=query,this.targetId=targetId,this.purpose=purpose,this.sequenceNumber=sequenceNumber,this.snapshotVersion=snapshotVersion,this.resumeToken=resumeToken}return QueryData.prototype.copy=function(overwrite){return new QueryData(this.query,this.targetId,this.purpose,void 0===overwrite.sequenceNumber?this.sequenceNumber:overwrite.sequenceNumber,void 0===overwrite.snapshotVersion?this.snapshotVersion:overwrite.snapshotVersion,void 0===overwrite.resumeToken?this.resumeToken:overwrite.resumeToken)},QueryData.prototype.isEqual=function(other){return this.targetId===other.targetId&&this.purpose===other.purpose&&this.sequenceNumber===other.sequenceNumber&&this.snapshotVersion.isEqual(other.snapshotVersion)&&this.resumeToken===other.resumeToken&&this.query.isEqual(other.query)},QueryData}(),FieldMask=function(){function FieldMask(fields){this.fields=fields}return FieldMask.prototype.covers=function(fieldPath){for(var _i=0,_a=this.fields,fieldMaskPath;_i<_a.length;_i++)if(fieldMaskPath=_a[_i],fieldMaskPath.isPrefixOf(fieldPath))return!0;return!1},FieldMask.prototype.isEqual=function(other){return arrayEquals(this.fields,other.fields)},FieldMask}(),FieldTransform=function(){function FieldTransform(field,transform){this.field=field,this.transform=transform}return FieldTransform.prototype.isEqual=function(other){return this.field.isEqual(other.field)&&this.transform.isEqual(other.transform)},FieldTransform}(),MutationResult=function(){return function MutationResult(version,transformResults){this.version=version,this.transformResults=transformResults}}(),MutationType;(function(MutationType){MutationType[MutationType.Set=0]='Set',MutationType[MutationType.Patch=1]='Patch',MutationType[MutationType.Transform=2]='Transform',MutationType[MutationType.Delete=3]='Delete'})(MutationType||(MutationType={}));var Precondition=function(){function Precondition(updateTime,exists){this.updateTime=updateTime,this.exists=exists,assert(void 0===updateTime||void 0===exists,'Precondition can specify "exists" or "updateTime" but not both')}return Precondition.exists=function(exists){return new Precondition(void 0,exists)},Precondition.updateTime=function(version){return new Precondition(version)},Object.defineProperty(Precondition.prototype,'isNone',{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Precondition.prototype.isValidFor=function(maybeDoc){return void 0===this.updateTime?void 0===this.exists?(assert(this.isNone,'Precondition should be empty'),!0):this.exists===maybeDoc instanceof Document:maybeDoc instanceof Document&&maybeDoc.version.isEqual(this.updateTime)},Precondition.prototype.isEqual=function(other){return equals(this.updateTime,other.updateTime)&&this.exists===other.exists},Precondition.NONE=new Precondition,Precondition}(),Mutation=function(){function Mutation(){}return Mutation.prototype.verifyKeyMatches=function(maybeDoc){null!=maybeDoc&&assert(maybeDoc.key.isEqual(this.key),'Can only apply a mutation to a document with the same key')},Mutation.getPostMutationVersion=function(maybeDoc){return maybeDoc instanceof Document?maybeDoc.version:SnapshotVersion.MIN},Mutation}(),SetMutation=function(_super){function SetMutation(key,value,precondition){var _this=_super.call(this)||this;return _this.key=key,_this.value=value,_this.precondition=precondition,_this.type=MutationType.Set,_this}return tslib_1.__extends(SetMutation,_super),SetMutation.prototype.applyToRemoteDocument=function(maybeDoc,mutationResult){this.verifyKeyMatches(maybeDoc),assert(null==mutationResult.transformResults,'Transform results received by SetMutation.');var version=mutationResult.version;return new Document(this.key,version,this.value,{hasCommittedMutations:!0})},SetMutation.prototype.applyToLocalView=function(maybeDoc){if(this.verifyKeyMatches(maybeDoc),!this.precondition.isValidFor(maybeDoc))return maybeDoc;var version=Mutation.getPostMutationVersion(maybeDoc);return new Document(this.key,version,this.value,{hasLocalMutations:!0})},SetMutation.prototype.isEqual=function(other){return other instanceof SetMutation&&this.key.isEqual(other.key)&&this.value.isEqual(other.value)&&this.precondition.isEqual(other.precondition)},SetMutation}(Mutation),PatchMutation=function(_super){function PatchMutation(key,data,fieldMask,precondition){var _this=_super.call(this)||this;return _this.key=key,_this.data=data,_this.fieldMask=fieldMask,_this.precondition=precondition,_this.type=MutationType.Patch,_this}return tslib_1.__extends(PatchMutation,_super),PatchMutation.prototype.applyToRemoteDocument=function(maybeDoc,mutationResult){if(this.verifyKeyMatches(maybeDoc),assert(null==mutationResult.transformResults,'Transform results received by PatchMutation.'),!this.precondition.isValidFor(maybeDoc))return new UnknownDocument(this.key,mutationResult.version);var newData=this.patchDocument(maybeDoc);return new Document(this.key,mutationResult.version,newData,{hasCommittedMutations:!0})},PatchMutation.prototype.applyToLocalView=function(maybeDoc){if(this.verifyKeyMatches(maybeDoc),!this.precondition.isValidFor(maybeDoc))return maybeDoc;var version=Mutation.getPostMutationVersion(maybeDoc),newData=this.patchDocument(maybeDoc);return new Document(this.key,version,newData,{hasLocalMutations:!0})},PatchMutation.prototype.isEqual=function(other){return other instanceof PatchMutation&&this.key.isEqual(other.key)&&this.fieldMask.isEqual(other.fieldMask)&&this.precondition.isEqual(other.precondition)},PatchMutation.prototype.patchDocument=function(maybeDoc){var data;return data=maybeDoc instanceof Document?maybeDoc.data:ObjectValue.EMPTY,this.patchObject(data)},PatchMutation.prototype.patchObject=function(data){for(var _i=0,_a=this.fieldMask.fields,fieldPath;_i<_a.length;_i++)if(fieldPath=_a[_i],!fieldPath.isEmpty()){var newValue=this.data.field(fieldPath);data=void 0===newValue?data.delete(fieldPath):data.set(fieldPath,newValue)}return data},PatchMutation}(Mutation),TransformMutation=function(_super){function TransformMutation(key,fieldTransforms){var _this=_super.call(this)||this;return _this.key=key,_this.fieldTransforms=fieldTransforms,_this.type=MutationType.Transform,_this.precondition=Precondition.exists(!0),_this}return tslib_1.__extends(TransformMutation,_super),TransformMutation.prototype.applyToRemoteDocument=function(maybeDoc,mutationResult){if(this.verifyKeyMatches(maybeDoc),assert(null!=mutationResult.transformResults,'Transform results missing for TransformMutation.'),!this.precondition.isValidFor(maybeDoc))return new UnknownDocument(this.key,mutationResult.version);var doc=this.requireDocument(maybeDoc),transformResults=this.serverTransformResults(maybeDoc,mutationResult.transformResults),version=mutationResult.version,newData=this.transformObject(doc.data,transformResults);return new Document(this.key,version,newData,{hasCommittedMutations:!0})},TransformMutation.prototype.applyToLocalView=function(maybeDoc,baseDoc,localWriteTime){if(this.verifyKeyMatches(maybeDoc),!this.precondition.isValidFor(maybeDoc))return maybeDoc;var doc=this.requireDocument(maybeDoc),transformResults=this.localTransformResults(localWriteTime,baseDoc),newData=this.transformObject(doc.data,transformResults);return new Document(this.key,doc.version,newData,{hasLocalMutations:!0})},TransformMutation.prototype.isEqual=function(other){return other instanceof TransformMutation&&this.key.isEqual(other.key)&&arrayEquals(this.fieldTransforms,other.fieldTransforms)&&this.precondition.isEqual(other.precondition)},TransformMutation.prototype.requireDocument=function(maybeDoc){assert(maybeDoc instanceof Document,'Unknown MaybeDocument type '+maybeDoc);var doc=maybeDoc;return assert(doc.key.isEqual(this.key),'Can only transform a document with the same key'),doc},TransformMutation.prototype.serverTransformResults=function(baseDoc,serverTransformResults){var transformResults=[];assert(this.fieldTransforms.length===serverTransformResults.length,'server transform result count ('+serverTransformResults.length+') '+('should match field transform count ('+this.fieldTransforms.length+')'));for(var i=0;i<serverTransformResults.length;i++){var fieldTransform=this.fieldTransforms[i],transform=fieldTransform.transform,previousValue=null;baseDoc instanceof Document&&(previousValue=baseDoc.field(fieldTransform.field)||null),transformResults.push(transform.applyToRemoteDocument(previousValue,serverTransformResults[i]))}return transformResults},TransformMutation.prototype.localTransformResults=function(localWriteTime,baseDoc){for(var transformResults=[],_i=0,_a=this.fieldTransforms;_i<_a.length;_i++){var fieldTransform=_a[_i],transform=fieldTransform.transform,previousValue=null;baseDoc instanceof Document&&(previousValue=baseDoc.field(fieldTransform.field)||null),transformResults.push(transform.applyToLocalView(previousValue,localWriteTime))}return transformResults},TransformMutation.prototype.transformObject=function(data,transformResults){assert(transformResults.length===this.fieldTransforms.length,'TransformResults length mismatch.');for(var i=0;i<this.fieldTransforms.length;i++){var fieldTransform=this.fieldTransforms[i],fieldPath=fieldTransform.field;data=data.set(fieldPath,transformResults[i])}return data},TransformMutation}(Mutation),DeleteMutation=function(_super){function DeleteMutation(key,precondition){var _this=_super.call(this)||this;return _this.key=key,_this.precondition=precondition,_this.type=MutationType.Delete,_this}return tslib_1.__extends(DeleteMutation,_super),DeleteMutation.prototype.applyToRemoteDocument=function(maybeDoc,mutationResult){return this.verifyKeyMatches(maybeDoc),assert(null==mutationResult.transformResults,'Transform results received by DeleteMutation.'),new NoDocument(this.key,mutationResult.version,{hasCommittedMutations:!0})},DeleteMutation.prototype.applyToLocalView=function(maybeDoc){return(this.verifyKeyMatches(maybeDoc),!this.precondition.isValidFor(maybeDoc))?maybeDoc:(maybeDoc&&assert(maybeDoc.key.isEqual(this.key),'Can only apply mutation to document with same key'),new NoDocument(this.key,SnapshotVersion.forDeletedDoc()))},DeleteMutation.prototype.isEqual=function(other){return other instanceof DeleteMutation&&this.key.isEqual(other.key)&&this.precondition.isEqual(other.precondition)},DeleteMutation}(Mutation),ServerTimestampTransform=function(){function ServerTimestampTransform(){}return ServerTimestampTransform.prototype.applyToLocalView=function(previousValue,localWriteTime){return new ServerTimestampValue(localWriteTime,previousValue)},ServerTimestampTransform.prototype.applyToRemoteDocument=function(previousValue,transformResult){return transformResult},ServerTimestampTransform.prototype.isEqual=function(other){return other instanceof ServerTimestampTransform},ServerTimestampTransform.instance=new ServerTimestampTransform,ServerTimestampTransform}(),ArrayUnionTransformOperation=function(){function ArrayUnionTransformOperation(elements){this.elements=elements}return ArrayUnionTransformOperation.prototype.applyToLocalView=function(previousValue){return this.apply(previousValue)},ArrayUnionTransformOperation.prototype.applyToRemoteDocument=function(previousValue){return this.apply(previousValue)},ArrayUnionTransformOperation.prototype.apply=function(previousValue){for(var result=coercedFieldValuesArray(previousValue),_loop_1=function(toUnion){result.find(function(element){return element.isEqual(toUnion)})||result.push(toUnion)},_i=0,_a=this.elements,toUnion;_i<_a.length;_i++)toUnion=_a[_i],_loop_1(toUnion);return new ArrayValue(result)},ArrayUnionTransformOperation.prototype.isEqual=function(other){return other instanceof ArrayUnionTransformOperation&&arrayEquals(other.elements,this.elements)},ArrayUnionTransformOperation}(),ArrayRemoveTransformOperation=function(){function ArrayRemoveTransformOperation(elements){this.elements=elements}return ArrayRemoveTransformOperation.prototype.applyToLocalView=function(previousValue){return this.apply(previousValue)},ArrayRemoveTransformOperation.prototype.applyToRemoteDocument=function(previousValue){return this.apply(previousValue)},ArrayRemoveTransformOperation.prototype.apply=function(previousValue){for(var result=coercedFieldValuesArray(previousValue),_loop_2=function(toRemove){result=result.filter(function(element){return!element.isEqual(toRemove)})},_i=0,_a=this.elements,toRemove;_i<_a.length;_i++)toRemove=_a[_i],_loop_2(toRemove);return new ArrayValue(result)},ArrayRemoveTransformOperation.prototype.isEqual=function(other){return other instanceof ArrayRemoveTransformOperation&&arrayEquals(other.elements,this.elements)},ArrayRemoveTransformOperation}(),ExistenceFilter=function(){function ExistenceFilter(count){this.count=count}return ExistenceFilter.prototype.isEqual=function(other){return other&&other.count===this.count},ExistenceFilter}(),RpcCode;(function(RpcCode){RpcCode[RpcCode.OK=0]='OK',RpcCode[RpcCode.CANCELLED=1]='CANCELLED',RpcCode[RpcCode.UNKNOWN=2]='UNKNOWN',RpcCode[RpcCode.INVALID_ARGUMENT=3]='INVALID_ARGUMENT',RpcCode[RpcCode.DEADLINE_EXCEEDED=4]='DEADLINE_EXCEEDED',RpcCode[RpcCode.NOT_FOUND=5]='NOT_FOUND',RpcCode[RpcCode.ALREADY_EXISTS=6]='ALREADY_EXISTS',RpcCode[RpcCode.PERMISSION_DENIED=7]='PERMISSION_DENIED',RpcCode[RpcCode.UNAUTHENTICATED=16]='UNAUTHENTICATED',RpcCode[RpcCode.RESOURCE_EXHAUSTED=8]='RESOURCE_EXHAUSTED',RpcCode[RpcCode.FAILED_PRECONDITION=9]='FAILED_PRECONDITION',RpcCode[RpcCode.ABORTED=10]='ABORTED',RpcCode[RpcCode.OUT_OF_RANGE=11]='OUT_OF_RANGE',RpcCode[RpcCode.UNIMPLEMENTED=12]='UNIMPLEMENTED',RpcCode[RpcCode.INTERNAL=13]='INTERNAL',RpcCode[RpcCode.UNAVAILABLE=14]='UNAVAILABLE',RpcCode[RpcCode.DATA_LOSS=15]='DATA_LOSS'})(RpcCode||(RpcCode={}));var SortedSet=function(){function SortedSet(comparator){this.comparator=comparator,this.data=new SortedMap(this.comparator)}return SortedSet.fromMapKeys=function(map){var keys=new SortedSet(map.comparator);return map.forEach(function(key){keys=keys.add(key)}),keys},SortedSet.prototype.has=function(elem){return null!==this.data.get(elem)},SortedSet.prototype.first=function(){return this.data.minKey()},SortedSet.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(SortedSet.prototype,'size',{get:function(){return this.data.size},enumerable:!0,configurable:!0}),SortedSet.prototype.indexOf=function(elem){return this.data.indexOf(elem)},SortedSet.prototype.forEach=function(cb){this.data.inorderTraversal(function(k){return cb(k),!1})},SortedSet.prototype.forEachInRange=function(range,cb){for(var iter=this.data.getIteratorFrom(range[0]),elem;iter.hasNext();){if(elem=iter.getNext(),0<=this.comparator(elem.key,range[1]))return;cb(elem.key)}},SortedSet.prototype.forEachWhile=function(cb,start){var iter;for(iter=void 0===start?this.data.getIterator():this.data.getIteratorFrom(start);iter.hasNext();){var elem=iter.getNext(),result=cb(elem.key);if(!result)return}},SortedSet.prototype.firstAfterOrEqual=function(elem){var iter=this.data.getIteratorFrom(elem);return iter.hasNext()?iter.getNext().key:null},SortedSet.prototype.add=function(elem){return this.copy(this.data.remove(elem).insert(elem,!0))},SortedSet.prototype.delete=function(elem){return this.has(elem)?this.copy(this.data.remove(elem)):this},SortedSet.prototype.isEmpty=function(){return this.data.isEmpty()},SortedSet.prototype.unionWith=function(other){var result=this;return other.forEach(function(elem){result=result.add(elem)}),result},SortedSet.prototype.isEqual=function(other){if(!(other instanceof SortedSet))return!1;if(this.size!==other.size)return!1;for(var thisIt=this.data.getIterator(),otherIt=other.data.getIterator();thisIt.hasNext();){var thisElem=thisIt.getNext().key,otherElem=otherIt.getNext().key;if(0!==this.comparator(thisElem,otherElem))return!1}return!0},SortedSet.prototype.toArray=function(){var res=[];return this.forEach(function(targetId){res.push(targetId)}),res},SortedSet.prototype.toString=function(){var result=[];return this.forEach(function(elem){return result.push(elem)}),'SortedSet('+result.toString()+')'},SortedSet.prototype.copy=function(data){var result=new SortedSet(this.comparator);return result.data=data,result},SortedSet}(),EMPTY_MAYBE_DOCUMENT_MAP=new SortedMap(DocumentKey.comparator),EMPTY_DOCUMENT_MAP=new SortedMap(DocumentKey.comparator),EMPTY_DOCUMENT_VERSION_MAP=new SortedMap(DocumentKey.comparator),EMPTY_DOCUMENT_KEY_SET=new SortedSet(DocumentKey.comparator),EMPTY_TARGET_ID_SET=new SortedSet(primitiveComparator),DocumentSet=function(){function DocumentSet(comp){this.comparator=comp?function(d1,d2){return comp(d1,d2)||DocumentKey.comparator(d1.key,d2.key)}:function(d1,d2){return DocumentKey.comparator(d1.key,d2.key)},this.keyedMap=documentMap(),this.sortedSet=new SortedMap(this.comparator)}return DocumentSet.emptySet=function(oldSet){return new DocumentSet(oldSet.comparator)},DocumentSet.prototype.has=function(key){return null!=this.keyedMap.get(key)},DocumentSet.prototype.get=function(key){return this.keyedMap.get(key)},DocumentSet.prototype.first=function(){return this.sortedSet.minKey()},DocumentSet.prototype.last=function(){return this.sortedSet.maxKey()},DocumentSet.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},DocumentSet.prototype.indexOf=function(key){var doc=this.keyedMap.get(key);return doc?this.sortedSet.indexOf(doc):-1},Object.defineProperty(DocumentSet.prototype,'size',{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),DocumentSet.prototype.forEach=function(cb){this.sortedSet.inorderTraversal(function(k){return cb(k),!1})},DocumentSet.prototype.add=function(doc){var set=this.delete(doc.key);return set.copy(set.keyedMap.insert(doc.key,doc),set.sortedSet.insert(doc,null))},DocumentSet.prototype.delete=function(key){var doc=this.get(key);return doc?this.copy(this.keyedMap.remove(key),this.sortedSet.remove(doc)):this},DocumentSet.prototype.isEqual=function(other){if(!(other instanceof DocumentSet))return!1;if(this.size!==other.size)return!1;for(var thisIt=this.sortedSet.getIterator(),otherIt=other.sortedSet.getIterator();thisIt.hasNext();){var thisDoc=thisIt.getNext().key,otherDoc=otherIt.getNext().key;if(!thisDoc.isEqual(otherDoc))return!1}return!0},DocumentSet.prototype.toString=function(){var docStrings=[];return this.forEach(function(doc){docStrings.push(doc.toString())}),0===docStrings.length?'DocumentSet ()':'DocumentSet (\n  '+docStrings.join('  \n')+'\n)'},DocumentSet.prototype.copy=function(keyedMap,sortedSet){var newSet=new DocumentSet;return newSet.comparator=this.comparator,newSet.keyedMap=keyedMap,newSet.sortedSet=sortedSet,newSet},DocumentSet}(),ChangeType;(function(ChangeType){ChangeType[ChangeType.Added=0]='Added',ChangeType[ChangeType.Removed=1]='Removed',ChangeType[ChangeType.Modified=2]='Modified',ChangeType[ChangeType.Metadata=3]='Metadata'})(ChangeType||(ChangeType={}));var SyncState;(function(SyncState){SyncState[SyncState.Local=0]='Local',SyncState[SyncState.Synced=1]='Synced'})(SyncState||(SyncState={}));var DocumentChangeSet=function(){function DocumentChangeSet(){this.changeMap=new SortedMap(DocumentKey.comparator)}return DocumentChangeSet.prototype.track=function(change){var key=change.doc.key,oldChange=this.changeMap.get(key);return oldChange?void(change.type!==ChangeType.Added&&oldChange.type===ChangeType.Metadata?this.changeMap=this.changeMap.insert(key,change):change.type===ChangeType.Metadata&&oldChange.type!==ChangeType.Removed?this.changeMap=this.changeMap.insert(key,{type:oldChange.type,doc:change.doc}):change.type===ChangeType.Modified&&oldChange.type===ChangeType.Modified?this.changeMap=this.changeMap.insert(key,{type:ChangeType.Modified,doc:change.doc}):change.type===ChangeType.Modified&&oldChange.type===ChangeType.Added?this.changeMap=this.changeMap.insert(key,{type:ChangeType.Added,doc:change.doc}):change.type===ChangeType.Removed&&oldChange.type===ChangeType.Added?this.changeMap=this.changeMap.remove(key):change.type===ChangeType.Removed&&oldChange.type===ChangeType.Modified?this.changeMap=this.changeMap.insert(key,{type:ChangeType.Removed,doc:oldChange.doc}):change.type===ChangeType.Added&&oldChange.type===ChangeType.Removed?this.changeMap=this.changeMap.insert(key,{type:ChangeType.Modified,doc:change.doc}):fail('unsupported combination of changes: '+JSON.stringify(change)+' after '+JSON.stringify(oldChange))):void(this.changeMap=this.changeMap.insert(key,change))},DocumentChangeSet.prototype.getChanges=function(){var changes=[];return this.changeMap.inorderTraversal(function(key,change){changes.push(change)}),changes},DocumentChangeSet}(),ViewSnapshot=function(){function ViewSnapshot(query,docs,oldDocs,docChanges,mutatedKeys,fromCache,syncStateChanged,excludesMetadataChanges){this.query=query,this.docs=docs,this.oldDocs=oldDocs,this.docChanges=docChanges,this.mutatedKeys=mutatedKeys,this.fromCache=fromCache,this.syncStateChanged=syncStateChanged,this.excludesMetadataChanges=excludesMetadataChanges}return ViewSnapshot.fromInitialDocuments=function(query,documents,mutatedKeys,fromCache){var changes=[];return documents.forEach(function(doc){changes.push({type:ChangeType.Added,doc:doc})}),new ViewSnapshot(query,documents,DocumentSet.emptySet(documents),changes,mutatedKeys,fromCache,!0,!1)},Object.defineProperty(ViewSnapshot.prototype,'hasPendingWrites',{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),ViewSnapshot.prototype.isEqual=function(other){if(this.fromCache!==other.fromCache||this.syncStateChanged!==other.syncStateChanged||!this.mutatedKeys.isEqual(other.mutatedKeys)||!this.query.isEqual(other.query)||!this.docs.isEqual(other.docs)||!this.oldDocs.isEqual(other.oldDocs))return!1;var changes=this.docChanges,otherChanges=other.docChanges;if(changes.length!==otherChanges.length)return!1;for(var i=0;i<changes.length;i++)if(changes[i].type!==otherChanges[i].type||!changes[i].doc.isEqual(otherChanges[i].doc))return!1;return!0},ViewSnapshot}(),RemoteEvent=function(){function RemoteEvent(snapshotVersion,targetChanges,targetMismatches,documentUpdates,resolvedLimboDocuments){this.snapshotVersion=snapshotVersion,this.targetChanges=targetChanges,this.targetMismatches=targetMismatches,this.documentUpdates=documentUpdates,this.resolvedLimboDocuments=resolvedLimboDocuments}return RemoteEvent.createSynthesizedRemoteEventForCurrentChange=function(targetId,current){var targetChanges=(_a={},_a[targetId]=TargetChange.createSynthesizedTargetChangeForCurrentChange(targetId,current),_a);return new RemoteEvent(SnapshotVersion.MIN,targetChanges,targetIdSet(),maybeDocumentMap(),documentKeySet());var _a},RemoteEvent}(),TargetChange=function(){function TargetChange(resumeToken,current,addedDocuments,modifiedDocuments,removedDocuments){this.resumeToken=resumeToken,this.current=current,this.addedDocuments=addedDocuments,this.modifiedDocuments=modifiedDocuments,this.removedDocuments=removedDocuments}return TargetChange.createSynthesizedTargetChangeForCurrentChange=function(targetId,current){return new TargetChange(emptyByteString(),current,documentKeySet(),documentKeySet(),documentKeySet())},TargetChange}(),DocumentWatchChange=function(){return function DocumentWatchChange(updatedTargetIds,removedTargetIds,key,newDoc){this.updatedTargetIds=updatedTargetIds,this.removedTargetIds=removedTargetIds,this.key=key,this.newDoc=newDoc}}(),ExistenceFilterChange=function(){return function ExistenceFilterChange(targetId,existenceFilter){this.targetId=targetId,this.existenceFilter=existenceFilter}}(),WatchTargetChangeState;(function(WatchTargetChangeState){WatchTargetChangeState[WatchTargetChangeState.NoChange=0]='NoChange',WatchTargetChangeState[WatchTargetChangeState.Added=1]='Added',WatchTargetChangeState[WatchTargetChangeState.Removed=2]='Removed',WatchTargetChangeState[WatchTargetChangeState.Current=3]='Current',WatchTargetChangeState[WatchTargetChangeState.Reset=4]='Reset'})(WatchTargetChangeState||(WatchTargetChangeState={}));var WatchTargetChange=function(){return function WatchTargetChange(state,targetIds,resumeToken,cause){void 0===resumeToken&&(resumeToken=emptyByteString()),void 0===cause&&(cause=null),this.state=state,this.targetIds=targetIds,this.resumeToken=resumeToken,this.cause=cause}}(),TargetState=function(){function TargetState(){this.pendingResponses=0,this.documentChanges=snapshotChangesMap(),this._resumeToken=emptyByteString(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(TargetState.prototype,'current',{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(TargetState.prototype,'resumeToken',{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(TargetState.prototype,'isPending',{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(TargetState.prototype,'hasPendingChanges',{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),TargetState.prototype.updateResumeToken=function(resumeToken){0<resumeToken.length&&(this._hasPendingChanges=!0,this._resumeToken=resumeToken)},TargetState.prototype.toTargetChange=function(){var addedDocuments=documentKeySet(),modifiedDocuments=documentKeySet(),removedDocuments=documentKeySet();return this.documentChanges.forEach(function(key,changeType){changeType===ChangeType.Added?addedDocuments=addedDocuments.add(key):changeType===ChangeType.Modified?modifiedDocuments=modifiedDocuments.add(key):changeType===ChangeType.Removed?removedDocuments=removedDocuments.add(key):fail('Encountered invalid change type: '+changeType)}),new TargetChange(this._resumeToken,this._current,addedDocuments,modifiedDocuments,removedDocuments)},TargetState.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=snapshotChangesMap()},TargetState.prototype.addDocumentChange=function(key,changeType){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(key,changeType)},TargetState.prototype.removeDocumentChange=function(key){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(key)},TargetState.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},TargetState.prototype.recordTargetResponse=function(){this.pendingResponses-=1},TargetState.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},TargetState}(),WatchChangeAggregator=function(){function WatchChangeAggregator(metadataProvider){this.metadataProvider=metadataProvider,this.targetStates={},this.pendingDocumentUpdates=maybeDocumentMap(),this.pendingDocumentTargetMapping=documentTargetMap(),this.pendingTargetResets=new SortedSet(primitiveComparator)}return WatchChangeAggregator.prototype.handleDocumentChange=function(docChange){for(var _i=0,_a=docChange.updatedTargetIds,targetId;_i<_a.length;_i++)targetId=_a[_i],docChange.newDoc instanceof Document?this.addDocumentToTarget(targetId,docChange.newDoc):docChange.newDoc instanceof NoDocument&&this.removeDocumentFromTarget(targetId,docChange.key,docChange.newDoc);for(var _b=0,_c=docChange.removedTargetIds,targetId;_b<_c.length;_b++)targetId=_c[_b],this.removeDocumentFromTarget(targetId,docChange.key,docChange.newDoc)},WatchChangeAggregator.prototype.handleTargetChange=function(targetChange){var _this=this;this.forEachTarget(targetChange,function(targetId){var targetState=_this.ensureTargetState(targetId);switch(targetChange.state){case WatchTargetChangeState.NoChange:_this.isActiveTarget(targetId)&&targetState.updateResumeToken(targetChange.resumeToken);break;case WatchTargetChangeState.Added:targetState.recordTargetResponse(),targetState.isPending||targetState.clearPendingChanges(),targetState.updateResumeToken(targetChange.resumeToken);break;case WatchTargetChangeState.Removed:targetState.recordTargetResponse(),targetState.isPending||_this.removeTarget(targetId),assert(!targetChange.cause,'WatchChangeAggregator does not handle errored targets');break;case WatchTargetChangeState.Current:_this.isActiveTarget(targetId)&&(targetState.markCurrent(),targetState.updateResumeToken(targetChange.resumeToken));break;case WatchTargetChangeState.Reset:_this.isActiveTarget(targetId)&&(_this.resetTarget(targetId),targetState.updateResumeToken(targetChange.resumeToken));break;default:fail('Unknown target watch change state: '+targetChange.state);}})},WatchChangeAggregator.prototype.forEachTarget=function(targetChange,fn){0<targetChange.targetIds.length?targetChange.targetIds.forEach(fn):forEachNumber(this.targetStates,fn)},WatchChangeAggregator.prototype.handleExistenceFilter=function(watchChange){var targetId=watchChange.targetId,expectedCount=watchChange.existenceFilter.count,queryData=this.queryDataForActiveTarget(targetId);if(queryData){var query=queryData.query;if(!query.isDocumentQuery()){var currentSize=this.getCurrentDocumentCountForTarget(targetId);currentSize!==expectedCount&&(this.resetTarget(targetId),this.pendingTargetResets=this.pendingTargetResets.add(targetId))}else if(0===expectedCount){var key=new DocumentKey(query.path);this.removeDocumentFromTarget(targetId,key,new NoDocument(key,SnapshotVersion.forDeletedDoc()))}else assert(1===expectedCount,'Single document existence filter with count: '+expectedCount)}},WatchChangeAggregator.prototype.createRemoteEvent=function(snapshotVersion){var _this=this,targetChanges={};forEachNumber(this.targetStates,function(targetId,targetState){var queryData=_this.queryDataForActiveTarget(targetId);if(queryData){if(targetState.current&&queryData.query.isDocumentQuery()){var key=new DocumentKey(queryData.query.path);null!==_this.pendingDocumentUpdates.get(key)||_this.targetContainsDocument(targetId,key)||_this.removeDocumentFromTarget(targetId,key,new NoDocument(key,snapshotVersion))}targetState.hasPendingChanges&&(targetChanges[targetId]=targetState.toTargetChange(),targetState.clearPendingChanges())}});var resolvedLimboDocuments=documentKeySet();this.pendingDocumentTargetMapping.forEach(function(key,targets){var isOnlyLimboTarget=!0;targets.forEachWhile(function(targetId){var queryData=_this.queryDataForActiveTarget(targetId);return queryData&&queryData.purpose!==QueryPurpose.LimboResolution?(isOnlyLimboTarget=!1,!1):!0}),isOnlyLimboTarget&&(resolvedLimboDocuments=resolvedLimboDocuments.add(key))});var remoteEvent=new RemoteEvent(snapshotVersion,targetChanges,this.pendingTargetResets,this.pendingDocumentUpdates,resolvedLimboDocuments);return this.pendingDocumentUpdates=maybeDocumentMap(),this.pendingDocumentTargetMapping=documentTargetMap(),this.pendingTargetResets=new SortedSet(primitiveComparator),remoteEvent},WatchChangeAggregator.prototype.addDocumentToTarget=function(targetId,document){if(this.isActiveTarget(targetId)){var changeType=this.targetContainsDocument(targetId,document.key)?ChangeType.Modified:ChangeType.Added,targetState=this.ensureTargetState(targetId);targetState.addDocumentChange(document.key,changeType),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(document.key,document),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(document.key,this.ensureDocumentTargetMapping(document.key).add(targetId))}},WatchChangeAggregator.prototype.removeDocumentFromTarget=function(targetId,key,updatedDocument){if(this.isActiveTarget(targetId)){var targetState=this.ensureTargetState(targetId);this.targetContainsDocument(targetId,key)?targetState.addDocumentChange(key,ChangeType.Removed):targetState.removeDocumentChange(key),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(key,this.ensureDocumentTargetMapping(key).delete(targetId)),updatedDocument&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(key,updatedDocument))}},WatchChangeAggregator.prototype.removeTarget=function(targetId){delete this.targetStates[targetId]},WatchChangeAggregator.prototype.getCurrentDocumentCountForTarget=function(targetId){var targetState=this.ensureTargetState(targetId),targetChange=targetState.toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(targetId).size+targetChange.addedDocuments.size-targetChange.removedDocuments.size},WatchChangeAggregator.prototype.recordPendingTargetRequest=function(targetId){var targetState=this.ensureTargetState(targetId);targetState.recordPendingTargetRequest()},WatchChangeAggregator.prototype.ensureTargetState=function(targetId){return this.targetStates[targetId]||(this.targetStates[targetId]=new TargetState),this.targetStates[targetId]},WatchChangeAggregator.prototype.ensureDocumentTargetMapping=function(key){var targetMapping=this.pendingDocumentTargetMapping.get(key);return targetMapping||(targetMapping=new SortedSet(primitiveComparator),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(key,targetMapping)),targetMapping},WatchChangeAggregator.prototype.isActiveTarget=function(targetId){return null!==this.queryDataForActiveTarget(targetId)},WatchChangeAggregator.prototype.queryDataForActiveTarget=function(targetId){var targetState=this.targetStates[targetId];return targetState&&targetState.isPending?null:this.metadataProvider.getQueryDataForTarget(targetId)},WatchChangeAggregator.prototype.resetTarget=function(targetId){var _this=this;assert(!this.targetStates[targetId].isPending,'Should only reset active targets'),this.targetStates[targetId]=new TargetState;var existingKeys=this.metadataProvider.getRemoteKeysForTarget(targetId);existingKeys.forEach(function(key){_this.removeDocumentFromTarget(targetId,key,null)})},WatchChangeAggregator.prototype.targetContainsDocument=function(targetId,key){var existingKeys=this.metadataProvider.getRemoteKeysForTarget(targetId);return existingKeys.has(key)},WatchChangeAggregator}(),DIRECTIONS=function(){var dirs={};return dirs[Direction.ASCENDING.name]='ASCENDING',dirs[Direction.DESCENDING.name]='DESCENDING',dirs}(),OPERATORS=function(){var ops={};return ops[RelationOp.LESS_THAN.name]='LESS_THAN',ops[RelationOp.LESS_THAN_OR_EQUAL.name]='LESS_THAN_OR_EQUAL',ops[RelationOp.GREATER_THAN.name]='GREATER_THAN',ops[RelationOp.GREATER_THAN_OR_EQUAL.name]='GREATER_THAN_OR_EQUAL',ops[RelationOp.EQUAL.name]='EQUAL',ops[RelationOp.ARRAY_CONTAINS.name]='ARRAY_CONTAINS',ops}(),ISO_REG_EXP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/),JsonProtoSerializer=function(){function JsonProtoSerializer(databaseId,options){this.databaseId=databaseId,this.options=options}return JsonProtoSerializer.prototype.emptyByteString=function(){return this.options.useProto3Json?'':new Uint8Array(0)},JsonProtoSerializer.prototype.unsafeCastProtoByteString=function(byteString){return byteString},JsonProtoSerializer.prototype.fromRpcStatus=function(status){var code=void 0===status.code?Code.UNKNOWN:mapCodeFromRpcCode(status.code);return new FirestoreError(code,status.message||'')},JsonProtoSerializer.prototype.toInt32Value=function(val){return isNullOrUndefined(val)?void 0:{value:val}},JsonProtoSerializer.prototype.fromInt32Value=function(val){var result;return result='object'==typeof val?val.value:val,isNullOrUndefined(result)?null:result},JsonProtoSerializer.prototype.toTimestamp=function(timestamp){return{seconds:timestamp.seconds,nanos:timestamp.nanoseconds}},JsonProtoSerializer.prototype.fromTimestamp=function(date){if('string'==typeof date)return this.fromIso8601String(date);assert(!!date,'Cannot deserialize null or undefined timestamp.');var seconds=parseInt64(date.seconds||'0'),nanos=date.nanos||0;return new Timestamp(seconds,nanos)},JsonProtoSerializer.prototype.fromIso8601String=function(utc){var nanos=0,fraction=ISO_REG_EXP.exec(utc);if(assert(!!fraction,'invalid timestamp: '+utc),fraction[1]){var nanoStr=fraction[1];nanoStr=(nanoStr+'000000000').substr(0,9),nanos=+nanoStr}var date=new Date(utc),seconds=_Mathfloor(date.getTime()/1e3);return new Timestamp(seconds,nanos)},JsonProtoSerializer.prototype.toBytes=function(bytes){return this.options.useProto3Json?bytes.toBase64():this.unsafeCastProtoByteString(bytes.toUint8Array())},JsonProtoSerializer.prototype.fromBlob=function(blob){return'string'==typeof blob?(assert(this.options.useProto3Json,'Expected bytes to be passed in as Uint8Array, but got a string instead.'),Blob.fromBase64String(blob)):(assert(!this.options.useProto3Json,'Expected bytes to be passed in as string, but got something else instead.'),Blob.fromUint8Array(blob))},JsonProtoSerializer.prototype.toVersion=function(version){return this.toTimestamp(version.toTimestamp())},JsonProtoSerializer.prototype.fromVersion=function(version){return assert(!!version,'Trying to deserialize version that isn\'t set'),SnapshotVersion.fromTimestamp(this.fromTimestamp(version))},JsonProtoSerializer.prototype.toResourceName=function(databaseId,path){return this.fullyQualifiedPrefixPath(databaseId).child('documents').child(path).canonicalString()},JsonProtoSerializer.prototype.fromResourceName=function(name){var resource=ResourcePath.fromString(name);return assert(this.isValidResourceName(resource),'Tried to deserialize invalid key '+resource.toString()),resource},JsonProtoSerializer.prototype.toName=function(key){return this.toResourceName(this.databaseId,key.path)},JsonProtoSerializer.prototype.fromName=function(name){var resource=this.fromResourceName(name);return assert(resource.get(1)===this.databaseId.projectId,'Tried to deserialize key from different project: '+resource.get(1)+' vs '+this.databaseId.projectId),assert(!resource.get(3)&&!this.databaseId.database||resource.get(3)===this.databaseId.database,'Tried to deserialize key from different database: '+resource.get(3)+' vs '+this.databaseId.database),new DocumentKey(this.extractLocalPathFromResourceName(resource))},JsonProtoSerializer.prototype.toQueryPath=function(path){return 0===path.length?this.encodedDatabaseId:this.toResourceName(this.databaseId,path)},JsonProtoSerializer.prototype.fromQueryPath=function(name){var resourceName=this.fromResourceName(name);return 4===resourceName.length?ResourcePath.EMPTY_PATH:this.extractLocalPathFromResourceName(resourceName)},Object.defineProperty(JsonProtoSerializer.prototype,'encodedDatabaseId',{get:function(){var path=new ResourcePath(['projects',this.databaseId.projectId,'databases',this.databaseId.database]);return path.canonicalString()},enumerable:!0,configurable:!0}),JsonProtoSerializer.prototype.fullyQualifiedPrefixPath=function(databaseId){return new ResourcePath(['projects',databaseId.projectId,'databases',databaseId.database])},JsonProtoSerializer.prototype.extractLocalPathFromResourceName=function(resourceName){return assert(4<resourceName.length&&'documents'===resourceName.get(4),'tried to deserialize invalid key '+resourceName.toString()),resourceName.popFirst(5)},JsonProtoSerializer.prototype.isValidResourceName=function(path){return 4<=path.length&&'projects'===path.get(0)&&'databases'===path.get(2)},JsonProtoSerializer.prototype.toValue=function(val){if(val instanceof NullValue)return{nullValue:'NULL_VALUE'};if(val instanceof BooleanValue)return{booleanValue:val.value()};if(val instanceof IntegerValue)return{integerValue:''+val.value()};if(val instanceof DoubleValue){var doubleValue=val.value();if(this.options.useProto3Json){if(isNaN(doubleValue))return{doubleValue:'NaN'};if(doubleValue===Infinity)return{doubleValue:'Infinity'};if(doubleValue===-Infinity)return{doubleValue:'-Infinity'}}return{doubleValue:val.value()}}return val instanceof StringValue?{stringValue:val.value()}:val instanceof ObjectValue?{mapValue:this.toMapValue(val)}:val instanceof ArrayValue?{arrayValue:this.toArrayValue(val)}:val instanceof TimestampValue?{timestampValue:this.toTimestamp(val.internalValue)}:val instanceof GeoPointValue?{geoPointValue:{latitude:val.value().latitude,longitude:val.value().longitude}}:val instanceof BlobValue?{bytesValue:this.toBytes(val.value())}:val instanceof RefValue?{referenceValue:this.toResourceName(val.databaseId,val.key.path)}:fail('Unknown FieldValue '+JSON.stringify(val))},JsonProtoSerializer.prototype.fromValue=function(obj){var _this=this,type=obj.value_type;if(hasTag(obj,type,'nullValue'))return NullValue.INSTANCE;if(hasTag(obj,type,'booleanValue'))return BooleanValue.of(obj.booleanValue);if(hasTag(obj,type,'integerValue'))return new IntegerValue(parseInt64(obj.integerValue));if(hasTag(obj,type,'doubleValue')){if(this.options.useProto3Json){if('NaN'===obj.doubleValue)return DoubleValue.NAN;if('Infinity'===obj.doubleValue)return DoubleValue.POSITIVE_INFINITY;if('-Infinity'===obj.doubleValue)return DoubleValue.NEGATIVE_INFINITY}return new DoubleValue(obj.doubleValue)}if(hasTag(obj,type,'stringValue'))return new StringValue(obj.stringValue);if(hasTag(obj,type,'mapValue'))return this.fromFields(obj.mapValue.fields||{});if(hasTag(obj,type,'arrayValue')){assertPresent(obj.arrayValue,'arrayValue');var values$$1=obj.arrayValue.values||[];return new ArrayValue(values$$1.map(function(v){return _this.fromValue(v)}))}if(hasTag(obj,type,'timestampValue'))return assertPresent(obj.timestampValue,'timestampValue'),new TimestampValue(this.fromTimestamp(obj.timestampValue));if(hasTag(obj,type,'geoPointValue')){assertPresent(obj.geoPointValue,'geoPointValue');var latitude=obj.geoPointValue.latitude||0,longitude=obj.geoPointValue.longitude||0;return new GeoPointValue(new GeoPoint(latitude,longitude))}if(hasTag(obj,type,'bytesValue')){assertPresent(obj.bytesValue,'bytesValue');var blob=this.fromBlob(obj.bytesValue);return new BlobValue(blob)}if(hasTag(obj,type,'referenceValue')){assertPresent(obj.referenceValue,'referenceValue');var resourceName=this.fromResourceName(obj.referenceValue),dbId=new DatabaseId(resourceName.get(1),resourceName.get(3)),key=new DocumentKey(this.extractLocalPathFromResourceName(resourceName));return new RefValue(dbId,key)}return fail('Unknown Value proto '+JSON.stringify(obj))},JsonProtoSerializer.prototype.toMutationDocument=function(key,fields){return{name:this.toName(key),fields:this.toFields(fields)}},JsonProtoSerializer.prototype.toDocument=function(document){return assert(!document.hasLocalMutations,'Can\'t serialize documents with mutations.'),{name:this.toName(document.key),fields:this.toFields(document.data),updateTime:this.toTimestamp(document.version.toTimestamp())}},JsonProtoSerializer.prototype.fromDocument=function(document,hasCommittedMutations){return new Document(this.fromName(document.name),this.fromVersion(document.updateTime),this.fromFields(document.fields||{}),{hasCommittedMutations:!!hasCommittedMutations})},JsonProtoSerializer.prototype.toFields=function(fields){var _this=this,result={};return fields.forEach(function(key,value){result[key]=_this.toValue(value)}),result},JsonProtoSerializer.prototype.fromFields=function(object){var _this=this,result=ObjectValue.EMPTY;return forEach(object,function(key,value){result=result.set(new FieldPath([key]),_this.fromValue(value))}),result},JsonProtoSerializer.prototype.toMapValue=function(map){return{fields:this.toFields(map)}},JsonProtoSerializer.prototype.toArrayValue=function(array){var _this=this,result=[];return array.forEach(function(value){result.push(_this.toValue(value))}),{values:result}},JsonProtoSerializer.prototype.fromFound=function(doc){assert(!!doc.found,'Tried to deserialize a found document from a missing document.'),assertPresent(doc.found.name,'doc.found.name'),assertPresent(doc.found.updateTime,'doc.found.updateTime');var key=this.fromName(doc.found.name),version=this.fromVersion(doc.found.updateTime),fields=this.fromFields(doc.found.fields||{});return new Document(key,version,fields,{})},JsonProtoSerializer.prototype.fromMissing=function(result){assert(!!result.missing,'Tried to deserialize a missing document from a found document.'),assert(!!result.readTime,'Tried to deserialize a missing document without a read time.');var key=this.fromName(result.missing),version=this.fromVersion(result.readTime);return new NoDocument(key,version)},JsonProtoSerializer.prototype.fromMaybeDocument=function(result){var type=result.result;return hasTag(result,type,'found')?this.fromFound(result):hasTag(result,type,'missing')?this.fromMissing(result):fail('invalid batch get response: '+JSON.stringify(result))},JsonProtoSerializer.prototype.toWatchTargetChangeState=function(state){return state===WatchTargetChangeState.Added?'ADD':state===WatchTargetChangeState.Current?'CURRENT':state===WatchTargetChangeState.NoChange?'NO_CHANGE':state===WatchTargetChangeState.Removed?'REMOVE':state===WatchTargetChangeState.Reset?'RESET':fail('Unknown WatchTargetChangeState: '+state)},JsonProtoSerializer.prototype.toTestWatchChange=function(watchChange){if(watchChange instanceof ExistenceFilterChange)return{filter:{count:watchChange.existenceFilter.count,targetId:watchChange.targetId}};if(watchChange instanceof DocumentWatchChange){if(watchChange.newDoc instanceof Document){var doc=watchChange.newDoc;return{documentChange:{document:{name:this.toName(doc.key),fields:this.toFields(doc.data),updateTime:this.toVersion(doc.version)},targetIds:watchChange.updatedTargetIds,removedTargetIds:watchChange.removedTargetIds}}}if(watchChange.newDoc instanceof NoDocument){var doc=watchChange.newDoc;return{documentDelete:{document:this.toName(doc.key),readTime:this.toVersion(doc.version),removedTargetIds:watchChange.removedTargetIds}}}if(null===watchChange.newDoc)return{documentRemove:{document:this.toName(watchChange.key),removedTargetIds:watchChange.removedTargetIds}}}if(watchChange instanceof WatchTargetChange){var cause;return watchChange.cause&&(cause={code:mapRpcCodeFromCode(watchChange.cause.code),message:watchChange.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(watchChange.state),targetIds:watchChange.targetIds,resumeToken:this.unsafeCastProtoByteString(watchChange.resumeToken),cause:cause}}}return fail('Unrecognized watch change: '+JSON.stringify(watchChange))},JsonProtoSerializer.prototype.fromWatchChange=function(change){var type=change.response_type,watchChange;if(hasTag(change,type,'targetChange')){assertPresent(change.targetChange,'targetChange');var state=this.fromWatchTargetChangeState(change.targetChange.targetChangeType||'NO_CHANGE'),targetIds=change.targetChange.targetIds||[],resumeToken=change.targetChange.resumeToken||this.emptyByteString(),causeProto=change.targetChange.cause,cause=causeProto&&this.fromRpcStatus(causeProto);watchChange=new WatchTargetChange(state,targetIds,resumeToken,cause||null)}else if(hasTag(change,type,'documentChange')){assertPresent(change.documentChange,'documentChange'),assertPresent(change.documentChange.document,'documentChange.name'),assertPresent(change.documentChange.document.name,'documentChange.document.name'),assertPresent(change.documentChange.document.updateTime,'documentChange.document.updateTime');var entityChange=change.documentChange,key=this.fromName(entityChange.document.name),version=this.fromVersion(entityChange.document.updateTime),fields=this.fromFields(entityChange.document.fields||{}),doc=new Document(key,version,fields,{}),updatedTargetIds=entityChange.targetIds||[],removedTargetIds=entityChange.removedTargetIds||[];watchChange=new DocumentWatchChange(updatedTargetIds,removedTargetIds,doc.key,doc)}else if(hasTag(change,type,'documentDelete')){assertPresent(change.documentDelete,'documentDelete'),assertPresent(change.documentDelete.document,'documentDelete.document');var docDelete=change.documentDelete,key=this.fromName(docDelete.document),version=docDelete.readTime?this.fromVersion(docDelete.readTime):SnapshotVersion.forDeletedDoc(),doc=new NoDocument(key,version),removedTargetIds=docDelete.removedTargetIds||[];watchChange=new DocumentWatchChange([],removedTargetIds,doc.key,doc)}else if(hasTag(change,type,'documentRemove')){assertPresent(change.documentRemove,'documentRemove'),assertPresent(change.documentRemove.document,'documentRemove');var docRemove=change.documentRemove,key=this.fromName(docRemove.document),removedTargetIds=docRemove.removedTargetIds||[];watchChange=new DocumentWatchChange([],removedTargetIds,key,null)}else if(hasTag(change,type,'filter')){assertPresent(change.filter,'filter'),assertPresent(change.filter.targetId,'filter.targetId');var filter=change.filter,count=filter.count||0,existenceFilter=new ExistenceFilter(count),targetId=filter.targetId;watchChange=new ExistenceFilterChange(targetId,existenceFilter)}else return fail('Unknown change type '+JSON.stringify(change));return watchChange},JsonProtoSerializer.prototype.fromWatchTargetChangeState=function(state){return'NO_CHANGE'===state?WatchTargetChangeState.NoChange:'ADD'===state?WatchTargetChangeState.Added:'REMOVE'===state?WatchTargetChangeState.Removed:'CURRENT'===state?WatchTargetChangeState.Current:'RESET'===state?WatchTargetChangeState.Reset:fail('Got unexpected TargetChange.state: '+state)},JsonProtoSerializer.prototype.versionFromListenResponse=function(change){var type=change.response_type;if(!hasTag(change,type,'targetChange'))return SnapshotVersion.MIN;var targetChange=change.targetChange;return targetChange.targetIds&&targetChange.targetIds.length?SnapshotVersion.MIN:targetChange.readTime?this.fromVersion(targetChange.readTime):SnapshotVersion.MIN},JsonProtoSerializer.prototype.toMutation=function(mutation){var _this=this,result;if(mutation instanceof SetMutation)result={update:this.toMutationDocument(mutation.key,mutation.value)};else if(mutation instanceof DeleteMutation)result={delete:this.toName(mutation.key)};else if(mutation instanceof PatchMutation)result={update:this.toMutationDocument(mutation.key,mutation.data),updateMask:this.toDocumentMask(mutation.fieldMask)};else if(mutation instanceof TransformMutation)result={transform:{document:this.toName(mutation.key),fieldTransforms:mutation.fieldTransforms.map(function(transform){return _this.toFieldTransform(transform)})}};else return fail('Unknown mutation type '+mutation.type);return mutation.precondition.isNone||(result.currentDocument=this.toPrecondition(mutation.precondition)),result},JsonProtoSerializer.prototype.fromMutation=function(proto){var _this=this,precondition=proto.currentDocument?this.fromPrecondition(proto.currentDocument):Precondition.NONE;if(proto.update){assertPresent(proto.update.name,'name');var key=this.fromName(proto.update.name),value=this.fromFields(proto.update.fields||{});if(proto.updateMask){var fieldMask=this.fromDocumentMask(proto.updateMask);return new PatchMutation(key,value,fieldMask,precondition)}return new SetMutation(key,value,precondition)}if(proto.delete){var key=this.fromName(proto.delete);return new DeleteMutation(key,precondition)}if(proto.transform){var key=this.fromName(proto.transform.document),fieldTransforms=proto.transform.fieldTransforms.map(function(transform){return _this.fromFieldTransform(transform)});return assert(!0===precondition.exists,'Transforms only support precondition "exists == true"'),new TransformMutation(key,fieldTransforms)}return fail('unknown mutation proto: '+JSON.stringify(proto))},JsonProtoSerializer.prototype.toPrecondition=function(precondition){return assert(!precondition.isNone,'Can\'t serialize an empty precondition'),void 0===precondition.updateTime?void 0===precondition.exists?fail('Unknown precondition'):{exists:precondition.exists}:{updateTime:this.toVersion(precondition.updateTime)}},JsonProtoSerializer.prototype.fromPrecondition=function(precondition){return void 0===precondition.updateTime?void 0===precondition.exists?Precondition.NONE:Precondition.exists(precondition.exists):Precondition.updateTime(this.fromVersion(precondition.updateTime))},JsonProtoSerializer.prototype.fromWriteResult=function(proto,commitTime){var _this=this,version=proto.updateTime?this.fromVersion(proto.updateTime):this.fromVersion(commitTime),transformResults=null;return proto.transformResults&&0<proto.transformResults.length&&(transformResults=proto.transformResults.map(function(result){return _this.fromValue(result)})),new MutationResult(version,transformResults)},JsonProtoSerializer.prototype.fromWriteResults=function(protos,commitTime){var _this=this;return protos&&0<protos.length?(assert(void 0!==commitTime,'Received a write result without a commit time'),protos.map(function(proto){return _this.fromWriteResult(proto,commitTime)})):[]},JsonProtoSerializer.prototype.toFieldTransform=function(fieldTransform){var _this=this,transform=fieldTransform.transform;if(transform instanceof ServerTimestampTransform)return{fieldPath:fieldTransform.field.canonicalString(),setToServerValue:'REQUEST_TIME'};if(transform instanceof ArrayUnionTransformOperation)return{fieldPath:fieldTransform.field.canonicalString(),appendMissingElements:{values:transform.elements.map(function(v){return _this.toValue(v)})}};if(transform instanceof ArrayRemoveTransformOperation)return{fieldPath:fieldTransform.field.canonicalString(),removeAllFromArray:{values:transform.elements.map(function(v){return _this.toValue(v)})}};throw fail('Unknown transform: '+fieldTransform.transform)},JsonProtoSerializer.prototype.fromFieldTransform=function(proto){var _this=this,type=proto.transform_type,transform=null;if(hasTag(proto,type,'setToServerValue'))assert('REQUEST_TIME'===proto.setToServerValue,'Unknown server value transform proto: '+JSON.stringify(proto)),transform=ServerTimestampTransform.instance;else if(hasTag(proto,type,'appendMissingElements')){var values$$1=proto.appendMissingElements.values||[];transform=new ArrayUnionTransformOperation(values$$1.map(function(v){return _this.fromValue(v)}))}else if(hasTag(proto,type,'removeAllFromArray')){var values$$1=proto.removeAllFromArray.values||[];transform=new ArrayRemoveTransformOperation(values$$1.map(function(v){return _this.fromValue(v)}))}else fail('Unknown transform proto: '+JSON.stringify(proto));var fieldPath=FieldPath.fromServerFormat(proto.fieldPath);return new FieldTransform(fieldPath,transform)},JsonProtoSerializer.prototype.toDocumentsTarget=function(query){return{documents:[this.toQueryPath(query.path)]}},JsonProtoSerializer.prototype.fromDocumentsTarget=function(documentsTarget){var count=documentsTarget.documents.length;assert(1===count,'DocumentsTarget contained other than 1 document: '+count);var name=documentsTarget.documents[0];return Query.atPath(this.fromQueryPath(name))},JsonProtoSerializer.prototype.toQueryTarget=function(query){var result={structuredQuery:{}};if(query.path.isEmpty())result.parent=this.toQueryPath(ResourcePath.EMPTY_PATH);else{var path=query.path;assert(0!=path.length%2,'Document queries with filters are not supported.'),result.parent=this.toQueryPath(path.popLast()),result.structuredQuery.from=[{collectionId:path.lastSegment()}]}var where=this.toFilter(query.filters);where&&(result.structuredQuery.where=where);var orderBy=this.toOrder(query.orderBy);orderBy&&(result.structuredQuery.orderBy=orderBy);var limit=this.toInt32Value(query.limit);return void 0!==limit&&(result.structuredQuery.limit=limit),query.startAt&&(result.structuredQuery.startAt=this.toCursor(query.startAt)),query.endAt&&(result.structuredQuery.endAt=this.toCursor(query.endAt)),result},JsonProtoSerializer.prototype.fromQueryTarget=function(target){var path=this.fromQueryPath(target.parent),query=target.structuredQuery,fromCount=query.from?query.from.length:0;if(0<fromCount){assert(1===fromCount,'StructuredQuery.from with more than one collection is not supported.');var from=query.from[0];path=path.child(from.collectionId)}var filterBy=[];query.where&&(filterBy=this.fromFilter(query.where));var orderBy=[];query.orderBy&&(orderBy=this.fromOrder(query.orderBy));var limit=null;query.limit&&(limit=this.fromInt32Value(query.limit));var startAt=null;query.startAt&&(startAt=this.fromCursor(query.startAt));var endAt=null;return query.endAt&&(endAt=this.fromCursor(query.endAt)),new Query(path,orderBy,filterBy,limit,startAt,endAt)},JsonProtoSerializer.prototype.toListenRequestLabels=function(queryData){var value=this.toLabel(queryData.purpose);return null==value?null:{"goog-listen-tags":value}},JsonProtoSerializer.prototype.toLabel=function(purpose){return purpose===QueryPurpose.Listen?null:purpose===QueryPurpose.ExistenceFilterMismatch?'existence-filter-mismatch':purpose===QueryPurpose.LimboResolution?'limbo-document':fail('Unrecognized query purpose: '+purpose)},JsonProtoSerializer.prototype.toTarget=function(queryData){var query=queryData.query,result;return result=query.isDocumentQuery()?{documents:this.toDocumentsTarget(query)}:{query:this.toQueryTarget(query)},result.targetId=queryData.targetId,0<queryData.resumeToken.length&&(result.resumeToken=this.unsafeCastProtoByteString(queryData.resumeToken)),result},JsonProtoSerializer.prototype.toFilter=function(filters){var _this=this;if(0!==filters.length){var protos=filters.map(function(filter){return filter instanceof RelationFilter?_this.toRelationFilter(filter):_this.toUnaryFilter(filter)});return 1===protos.length?protos[0]:{compositeFilter:{op:'AND',filters:protos}}}},JsonProtoSerializer.prototype.fromFilter=function(filter){var _this=this;return filter?void 0===filter.unaryFilter?void 0===filter.fieldFilter?void 0===filter.compositeFilter?fail('Unknown filter: '+JSON.stringify(filter)):filter.compositeFilter.filters.map(function(f){return _this.fromFilter(f)}).reduce(function(accum,current){return accum.concat(current)}):[this.fromRelationFilter(filter)]:[this.fromUnaryFilter(filter)]:[]},JsonProtoSerializer.prototype.toOrder=function(orderBys){var _this=this;return 0===orderBys.length?void 0:orderBys.map(function(order){return _this.toPropertyOrder(order)})},JsonProtoSerializer.prototype.fromOrder=function(orderBys){var _this=this;return orderBys.map(function(order){return _this.fromPropertyOrder(order)})},JsonProtoSerializer.prototype.toCursor=function(cursor){var _this=this;return{before:cursor.before,values:cursor.position.map(function(component){return _this.toValue(component)})}},JsonProtoSerializer.prototype.fromCursor=function(cursor){var _this=this,before=!!cursor.before,position=cursor.values.map(function(component){return _this.fromValue(component)});return new Bound(position,before)},JsonProtoSerializer.prototype.toDirection=function(dir){return DIRECTIONS[dir.name]},JsonProtoSerializer.prototype.fromDirection=function(dir){return'ASCENDING'===dir?Direction.ASCENDING:'DESCENDING'===dir?Direction.DESCENDING:void 0},JsonProtoSerializer.prototype.toOperatorName=function(op){return OPERATORS[op.name]},JsonProtoSerializer.prototype.fromOperatorName=function(op){return'EQUAL'===op?RelationOp.EQUAL:'GREATER_THAN'===op?RelationOp.GREATER_THAN:'GREATER_THAN_OR_EQUAL'===op?RelationOp.GREATER_THAN_OR_EQUAL:'LESS_THAN'===op?RelationOp.LESS_THAN:'LESS_THAN_OR_EQUAL'===op?RelationOp.LESS_THAN_OR_EQUAL:'ARRAY_CONTAINS'===op?RelationOp.ARRAY_CONTAINS:'OPERATOR_UNSPECIFIED'===op?fail('Unspecified relation'):fail('Unknown relation')},JsonProtoSerializer.prototype.toFieldPathReference=function(path){return{fieldPath:path.canonicalString()}},JsonProtoSerializer.prototype.fromFieldPathReference=function(fieldReference){return FieldPath.fromServerFormat(fieldReference.fieldPath)},JsonProtoSerializer.prototype.toPropertyOrder=function(orderBy){return{field:this.toFieldPathReference(orderBy.field),direction:this.toDirection(orderBy.dir)}},JsonProtoSerializer.prototype.fromPropertyOrder=function(orderBy){return new OrderBy(this.fromFieldPathReference(orderBy.field),this.fromDirection(orderBy.direction))},JsonProtoSerializer.prototype.toRelationFilter=function(filter){return filter instanceof RelationFilter?{fieldFilter:{field:this.toFieldPathReference(filter.field),op:this.toOperatorName(filter.op),value:this.toValue(filter.value)}}:fail('Unrecognized filter: '+JSON.stringify(filter))},JsonProtoSerializer.prototype.fromRelationFilter=function(filter){return new RelationFilter(this.fromFieldPathReference(filter.fieldFilter.field),this.fromOperatorName(filter.fieldFilter.op),this.fromValue(filter.fieldFilter.value))},JsonProtoSerializer.prototype.toUnaryFilter=function(filter){return filter instanceof NanFilter?{unaryFilter:{field:this.toFieldPathReference(filter.field),op:'IS_NAN'}}:filter instanceof NullFilter?{unaryFilter:{field:this.toFieldPathReference(filter.field),op:'IS_NULL'}}:fail('Unrecognized filter: '+JSON.stringify(filter))},JsonProtoSerializer.prototype.fromUnaryFilter=function(filter){switch(filter.unaryFilter.op){case'IS_NAN':var nanField=this.fromFieldPathReference(filter.unaryFilter.field);return new NanFilter(nanField);case'IS_NULL':var nullField=this.fromFieldPathReference(filter.unaryFilter.field);return new NullFilter(nullField);case'OPERATOR_UNSPECIFIED':return fail('Unspecified filter');default:return fail('Unknown filter');}},JsonProtoSerializer.prototype.toDocumentMask=function(fieldMask){return{fieldPaths:fieldMask.fields.map(function(field){return field.canonicalString()})}},JsonProtoSerializer.prototype.fromDocumentMask=function(proto){var paths=proto.fieldPaths||[],fields=paths.map(function(path){return FieldPath.fromServerFormat(path)});return new FieldMask(fields)},JsonProtoSerializer}(),isReactNative=function(){return'object'==typeof navigator&&'ReactNative'===navigator.product},ERROR_NAME='FirebaseError',captureStackTrace=Error.captureStackTrace,FirebaseError=function(){return function FirebaseError(code,message){if(this.code=code,this.message=message,captureStackTrace)captureStackTrace(this,ErrorFactory.prototype.create);else try{throw Error.apply(this,arguments)}catch(err){this.name=ERROR_NAME,Object.defineProperty(this,'stack',{get:function(){return err.stack}})}}}();FirebaseError.prototype=Object.create(Error.prototype),FirebaseError.prototype.constructor=FirebaseError,FirebaseError.prototype.name=ERROR_NAME;var ErrorFactory=function(){function ErrorFactory(service,serviceName,errors){this.service=service,this.serviceName=serviceName,this.errors=errors,this.pattern=/\{\$([^}]+)}/g}return ErrorFactory.prototype.create=function(code,data){void 0===data&&(data={});var template=this.errors[code],fullCode=this.service+'/'+code,message;message=void 0===template?'Error':template.replace(this.pattern,function(match,key){var value=data[key];return void 0===value?'<'+key+'?>':value.toString()}),message=this.serviceName+': '+message+' ('+fullCode+').';var err=new FirebaseError(fullCode,message);for(var prop in data)data.hasOwnProperty(prop)&&'_'!==prop.slice(-1)&&(err[prop]=data[prop]);return err},ErrorFactory}(),Hash=function(){return function Hash(){this.blockSize=-1}}(),Sha1=function(_super){function Sha1(){var _this=_super.call(this)||this;_this.chain_=[],_this.buf_=[],_this.W_=[],_this.pad_=[],_this.inbuf_=0,_this.total_=0,_this.blockSize=512/8,_this.pad_[0]=128;for(var i=1;i<_this.blockSize;++i)_this.pad_[i]=0;return _this.reset(),_this}return tslib_1.__extends(Sha1,_super),Sha1.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},Sha1.prototype.compress_=function(buf,opt_offset){opt_offset||(opt_offset=0);var W=this.W_;if('string'==typeof buf)for(var i=0;16>i;i++)W[i]=buf.charCodeAt(opt_offset)<<24|buf.charCodeAt(opt_offset+1)<<16|buf.charCodeAt(opt_offset+2)<<8|buf.charCodeAt(opt_offset+3),opt_offset+=4;else for(var i=0;16>i;i++)W[i]=buf[opt_offset]<<24|buf[opt_offset+1]<<16|buf[opt_offset+2]<<8|buf[opt_offset+3],opt_offset+=4;for(var i=16,t;80>i;i++)t=W[i-3]^W[i-8]^W[i-14]^W[i-16],W[i]=4294967295&(t<<1|t>>>31);for(var a=this.chain_[0],b=this.chain_[1],c=this.chain_[2],d=this.chain_[3],e=this.chain_[4],i=0,f,k;80>i;i++){40>i?20>i?(f=d^b&(c^d),k=1518500249):(f=b^c^d,k=1859775393):60>i?(f=b&c|d&(b|c),k=2400959708):(f=b^c^d,k=3395469782);var t=4294967295&(a<<5|a>>>27)+f+e+k+W[i];e=d,d=c,c=4294967295&(b<<30|b>>>2),b=a,a=t}this.chain_[0]=4294967295&this.chain_[0]+a,this.chain_[1]=4294967295&this.chain_[1]+b,this.chain_[2]=4294967295&this.chain_[2]+c,this.chain_[3]=4294967295&this.chain_[3]+d,this.chain_[4]=4294967295&this.chain_[4]+e},Sha1.prototype.update=function(bytes,opt_length){if(null!=bytes){void 0===opt_length&&(opt_length=bytes.length);for(var lengthMinusBlock=opt_length-this.blockSize,n=0,buf=this.buf_,inbuf=this.inbuf_;n<opt_length;){if(0==inbuf)for(;n<=lengthMinusBlock;)this.compress_(bytes,n),n+=this.blockSize;if('string'==typeof bytes){for(;n<opt_length;)if(buf[inbuf]=bytes.charCodeAt(n),++inbuf,++n,inbuf==this.blockSize){this.compress_(buf),inbuf=0;break}}else for(;n<opt_length;)if(buf[inbuf]=bytes[n],++inbuf,++n,inbuf==this.blockSize){this.compress_(buf),inbuf=0;break}}this.inbuf_=inbuf,this.total_+=opt_length}},Sha1.prototype.digest=function(){var digest=[],totalBits=8*this.total_;56>this.inbuf_?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var i=this.blockSize-1;56<=i;i--)this.buf_[i]=255&totalBits,totalBits/=256;this.compress_(this.buf_);for(var n=0,i=0;5>i;i++)for(var j=24;0<=j;j-=8)digest[n]=255&this.chain_[i]>>j,++n;return digest},Sha1}(Hash),StreamBridge=function(){function StreamBridge(args){this.sendFn=args.sendFn,this.closeFn=args.closeFn}return StreamBridge.prototype.onOpen=function(callback){assert(!this.wrappedOnOpen,'Called onOpen on stream twice!'),this.wrappedOnOpen=callback},StreamBridge.prototype.onClose=function(callback){assert(!this.wrappedOnClose,'Called onClose on stream twice!'),this.wrappedOnClose=callback},StreamBridge.prototype.onMessage=function(callback){assert(!this.wrappedOnMessage,'Called onMessage on stream twice!'),this.wrappedOnMessage=callback},StreamBridge.prototype.close=function(){this.closeFn()},StreamBridge.prototype.send=function(msg){this.sendFn(msg)},StreamBridge.prototype.callOnOpen=function(){assert(void 0!==this.wrappedOnOpen,'Cannot call onOpen because no callback was set'),this.wrappedOnOpen()},StreamBridge.prototype.callOnClose=function(err){assert(void 0!==this.wrappedOnClose,'Cannot call onClose because no callback was set'),this.wrappedOnClose(err)},StreamBridge.prototype.callOnMessage=function(msg){assert(void 0!==this.wrappedOnMessage,'Cannot call onMessage because no callback was set'),this.wrappedOnMessage(msg)},StreamBridge}(),LOG_TAG='Connection',RPC_NAME_REST_MAPPING={BatchGetDocuments:'batchGet',Commit:'commit'},WebChannelConnection=function(){function WebChannelConnection(info){this.databaseId=info.databaseId,this.pool=new webchannelWrapper.XhrIoPool;var proto=info.ssl?'https':'http';this.baseUrl=proto+'://'+info.host}return WebChannelConnection.prototype.modifyHeadersForRequest=function(headers,token){if(token)for(var header in token.authHeaders)token.authHeaders.hasOwnProperty(header)&&(headers[header]=token.authHeaders[header]);headers['X-Goog-Api-Client']='gl-js/ fire/'+SDK_VERSION},WebChannelConnection.prototype.invokeRPC=function(rpcName,request,token){var _this=this,url=this.makeUrl(rpcName);return new Promise(function(resolve,reject){_this.pool.getObject(function(xhr){xhr.listenOnce(webchannelWrapper.EventType.COMPLETE,function(){try{switch(xhr.getLastErrorCode()){case webchannelWrapper.ErrorCode.NO_ERROR:var json=xhr.getResponseJson();debug(LOG_TAG,'XHR received:',JSON.stringify(json)),resolve(json);break;case webchannelWrapper.ErrorCode.TIMEOUT:debug(LOG_TAG,'RPC "'+rpcName+'" timed out'),reject(new FirestoreError(Code.DEADLINE_EXCEEDED,'Request time out'));break;case webchannelWrapper.ErrorCode.HTTP_ERROR:var status_1=xhr.getStatus();debug(LOG_TAG,'RPC "'+rpcName+'" failed with status:',status_1,'response text:',xhr.getResponseText()),0<status_1?reject(new FirestoreError(mapCodeFromHttpStatus(status_1),'Server responded with status '+xhr.getStatusText())):(debug(LOG_TAG,'RPC "'+rpcName+'" failed'),reject(new FirestoreError(Code.UNAVAILABLE,'Connection failed.')));break;default:fail('RPC "'+rpcName+'" failed with unanticipated '+'webchannel error '+xhr.getLastErrorCode()+': '+xhr.getLastError()+', giving up.');}}finally{debug(LOG_TAG,'RPC "'+rpcName+'" completed.'),_this.pool.releaseObject(xhr)}});var requestString=JSON.stringify(request);debug(LOG_TAG,'XHR sending: ',url+' '+requestString);var headers={"Content-Type":'text/plain'};_this.modifyHeadersForRequest(headers,token),xhr.send(url,'POST',requestString,headers,15)})})},WebChannelConnection.prototype.invokeStreamingRPC=function(rpcName,request,token){return this.invokeRPC(rpcName,request,token)},WebChannelConnection.prototype.openStream=function(rpcName,token){var urlParts=[this.baseUrl,'/','google.firestore.v1beta1.Firestore','/',rpcName,'/channel'],webchannelTransport=webchannelWrapper.createWebChannelTransport(),request={backgroundChannelTest:!0,httpSessionIdParam:'gsessionid',initMessageHeaders:{},messageUrlParams:{database:'projects/'+this.databaseId.projectId+'/databases/'+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0};this.modifyHeadersForRequest(request.initMessageHeaders,token),isReactNative()||(request.httpHeadersOverwriteParam='$httpHeaders');var url=urlParts.join('');debug(LOG_TAG,'Creating WebChannel: '+url+' '+request);var channel=webchannelTransport.createWebChannel(url,request),opened=!1,closed=!1,streamBridge=new StreamBridge({sendFn:function(msg){closed?debug(LOG_TAG,'Not sending because WebChannel is closed:',msg):(!opened&&(debug(LOG_TAG,'Opening WebChannel transport.'),channel.open(),opened=!0),debug(LOG_TAG,'WebChannel sending:',msg),channel.send(msg))},closeFn:function(){return channel.close()}}),unguardedEventListen=function(type,fn){channel.listen(type,function(param){try{fn(param)}catch(e){setTimeout(function(){throw e},0)}})};return unguardedEventListen(webchannelWrapper.WebChannel.EventType.OPEN,function(){closed||debug(LOG_TAG,'WebChannel transport opened.')}),unguardedEventListen(webchannelWrapper.WebChannel.EventType.CLOSE,function(){closed||(closed=!0,debug(LOG_TAG,'WebChannel transport closed'),streamBridge.callOnClose())}),unguardedEventListen(webchannelWrapper.WebChannel.EventType.ERROR,function(err){closed||(closed=!0,debug(LOG_TAG,'WebChannel transport errored:',err),streamBridge.callOnClose(new FirestoreError(Code.UNAVAILABLE,'The operation could not be completed')))}),unguardedEventListen(webchannelWrapper.WebChannel.EventType.MESSAGE,function(msg){if(!closed){var msgData=msg.data[0];assert(!!msgData,'Got a webchannel message without data.');var error$$1=msgData.error||msgData[0]&&msgData[0].error;if(error$$1){debug(LOG_TAG,'WebChannel received error:',error$$1);var status_2=error$$1.status,code=mapCodeFromRpcStatus(status_2),message=error$$1.message;void 0===code&&(code=Code.INTERNAL,message='Unknown error status: '+status_2+' with message '+error$$1.message),closed=!0,streamBridge.callOnClose(new FirestoreError(code,message)),channel.close()}else debug(LOG_TAG,'WebChannel received:',msgData),streamBridge.callOnMessage(msgData)}}),setTimeout(function(){streamBridge.callOnOpen()},0),streamBridge},WebChannelConnection.prototype.makeUrl=function(rpcName){var urlRpcName=RPC_NAME_REST_MAPPING[rpcName];assert(void 0!==urlRpcName,'Unknown REST mapping for: '+rpcName);var url=[this.baseUrl,'/','v1beta1','/projects/',this.databaseId.projectId,'/databases/',this.databaseId.database,'/documents',':',urlRpcName];return url.join('')},WebChannelConnection}(),BrowserPlatform=function(){function BrowserPlatform(){this.emptyByteString='',this.base64Available='undefined'!=typeof atob}return Object.defineProperty(BrowserPlatform.prototype,'document',{get:function(){return'undefined'==typeof document?null:document},enumerable:!0,configurable:!0}),Object.defineProperty(BrowserPlatform.prototype,'window',{get:function(){return'undefined'==typeof window?null:window},enumerable:!0,configurable:!0}),BrowserPlatform.prototype.loadConnection=function(databaseInfo){return Promise.resolve(new WebChannelConnection(databaseInfo))},BrowserPlatform.prototype.newSerializer=function(databaseId){return new JsonProtoSerializer(databaseId,{useProto3Json:!0})},BrowserPlatform.prototype.formatJSON=function(value){return JSON.stringify(value)},BrowserPlatform.prototype.atob=function(encoded){return atob(encoded)},BrowserPlatform.prototype.btoa=function(raw){return btoa(raw)},BrowserPlatform}();PlatformSupport.setPlatform(new BrowserPlatform);var ListenSequence=function(){function ListenSequence(previousValue,sequenceNumberSyncer){var _this=this;this.previousValue=previousValue,sequenceNumberSyncer&&(sequenceNumberSyncer.sequenceNumberHandler=function(sequenceNumber){return _this.setPreviousValue(sequenceNumber)},this.writeNewSequenceNumber=function(sequenceNumber){return sequenceNumberSyncer.writeSequenceNumber(sequenceNumber)})}return ListenSequence.prototype.setPreviousValue=function(externalPreviousValue){return this.previousValue=_Mathmax(externalPreviousValue,this.previousValue),this.previousValue},ListenSequence.prototype.next=function(){var nextValue=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(nextValue),nextValue},ListenSequence.INVALID=-1,ListenSequence}(),Deferred$1=function(){return function Deferred(){var _this=this;this.promise=new Promise(function(resolve,reject){_this.resolve=resolve,_this.reject=reject})}}(),TimerId;(function(TimerId){TimerId.All='all',TimerId.ListenStreamIdle='listen_stream_idle',TimerId.ListenStreamConnectionBackoff='listen_stream_connection_backoff',TimerId.WriteStreamIdle='write_stream_idle',TimerId.WriteStreamConnectionBackoff='write_stream_connection_backoff',TimerId.OnlineStateTimeout='online_state_timeout',TimerId.ClientMetadataRefresh='client_metadata_refresh'})(TimerId||(TimerId={}));var DelayedOperation=function(){function DelayedOperation(asyncQueue,timerId,targetTimeMs,op,removalCallback){this.asyncQueue=asyncQueue,this.timerId=timerId,this.targetTimeMs=targetTimeMs,this.op=op,this.removalCallback=removalCallback,this.deferred=new Deferred$1,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(){})}return DelayedOperation.createAndSchedule=function(asyncQueue,timerId,delayMs,op,removalCallback){var targetTime=Date.now()+delayMs,delayedOp=new DelayedOperation(asyncQueue,timerId,targetTime,op,removalCallback);return delayedOp.start(delayMs),delayedOp},DelayedOperation.prototype.start=function(delayMs){var _this=this;this.timerHandle=setTimeout(function(){return _this.handleDelayElapsed()},delayMs)},DelayedOperation.prototype.skipDelay=function(){return this.handleDelayElapsed()},DelayedOperation.prototype.cancel=function(reason){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new FirestoreError(Code.CANCELLED,'Operation cancelled'+(reason?': '+reason:''))))},DelayedOperation.prototype.handleDelayElapsed=function(){var _this=this;this.asyncQueue.enqueueAndForget(function(){return null===_this.timerHandle?Promise.resolve():(_this.clearTimeout(),_this.op().then(function(result){return _this.deferred.resolve(result)}))})},DelayedOperation.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},DelayedOperation}(),AsyncQueue=function(){function AsyncQueue(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return AsyncQueue.prototype.enqueueAndForget=function(op){this.enqueue(op)},AsyncQueue.prototype.enqueue=function(op){var _this=this;this.verifyNotFailed();var newTail=this.tail.then(function(){return _this.operationInProgress=!0,op().catch(function(error$$1){_this.failure=error$$1,_this.operationInProgress=!1;var message=error$$1.stack||error$$1.message||'';throw error('INTERNAL UNHANDLED ERROR: ',message),0>message.indexOf('Firestore Test Simulated Error')&&setTimeout(function(){throw error$$1},0),error$$1}).then(function(result){return _this.operationInProgress=!1,result})});return this.tail=newTail,newTail},AsyncQueue.prototype.enqueueAfterDelay=function(timerId,delayMs,op){var _this=this;this.verifyNotFailed(),assert(0<=delayMs,'Attempted to schedule an operation with a negative delay of '+delayMs),assert(!this.containsDelayedOperation(timerId),'Attempted to schedule multiple operations with timer id '+timerId+'.');var delayedOp=DelayedOperation.createAndSchedule(this,timerId,delayMs,op,function(op){return _this.removeDelayedOperation(op)});return this.delayedOperations.push(delayedOp),delayedOp},AsyncQueue.prototype.verifyNotFailed=function(){this.failure&&fail('AsyncQueue is already failed: '+(this.failure.stack||this.failure.message))},AsyncQueue.prototype.verifyOperationInProgress=function(){assert(this.operationInProgress,'verifyOpInProgress() called when no op in progress on this queue.')},AsyncQueue.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},AsyncQueue.prototype.containsDelayedOperation=function(timerId){for(var _i=0,_a=this.delayedOperations,op;_i<_a.length;_i++)if(op=_a[_i],op.timerId===timerId)return!0;return!1},AsyncQueue.prototype.runDelayedOperationsEarly=function(lastTimerId){var _this=this;return this.drain().then(function(){assert(lastTimerId===TimerId.All||_this.containsDelayedOperation(lastTimerId),'Attempted to drain to missing operation '+lastTimerId),_this.delayedOperations.sort(function(a,b){return a.targetTimeMs-b.targetTimeMs});for(var _i=0,_a=_this.delayedOperations,op;_i<_a.length&&(op=_a[_i],op.skipDelay(),lastTimerId===TimerId.All||op.timerId!==lastTimerId);_i++);return _this.drain()})},AsyncQueue.prototype.removeDelayedOperation=function(op){var index=this.delayedOperations.indexOf(op);assert(0<=index,'Delayed operation not found.'),this.delayedOperations.splice(index,1)},AsyncQueue}(),escapeChar='\x01',encodedSeparatorChar='\x01',encodedNul='\x10',encodedEscape='\x11',BATCHID_UNKNOWN=-1,MutationBatch=function(){function MutationBatch(batchId,localWriteTime,mutations){this.batchId=batchId,this.localWriteTime=localWriteTime,this.mutations=mutations,assert(0<mutations.length,'Cannot create an empty mutation batch')}return MutationBatch.prototype.applyToRemoteDocument=function(docKey,maybeDoc,batchResult){maybeDoc&&assert(maybeDoc.key.isEqual(docKey),'applyToRemoteDocument: key '+docKey+' should match maybeDoc key\n        '+maybeDoc.key);var mutationResults=batchResult.mutationResults;assert(mutationResults.length===this.mutations.length,'Mismatch between mutations length\n      ('+this.mutations.length+') and mutation results length\n      ('+mutationResults.length+').');for(var i=0,mutation;i<this.mutations.length;i++)if(mutation=this.mutations[i],mutation.key.isEqual(docKey)){var mutationResult=mutationResults[i];maybeDoc=mutation.applyToRemoteDocument(maybeDoc,mutationResult)}return maybeDoc},MutationBatch.prototype.applyToLocalView=function(docKey,maybeDoc){maybeDoc&&assert(maybeDoc.key.isEqual(docKey),'applyToLocalDocument: key '+docKey+' should match maybeDoc key\n        '+maybeDoc.key);for(var baseDoc=maybeDoc,i=0,mutation;i<this.mutations.length;i++)mutation=this.mutations[i],mutation.key.isEqual(docKey)&&(maybeDoc=mutation.applyToLocalView(maybeDoc,baseDoc,this.localWriteTime));return maybeDoc},MutationBatch.prototype.keys=function(){for(var keySet=documentKeySet(),_i=0,_a=this.mutations,mutation;_i<_a.length;_i++)mutation=_a[_i],keySet=keySet.add(mutation.key);return keySet},MutationBatch.prototype.isEqual=function(other){return this.batchId===other.batchId&&arrayEquals(this.mutations,other.mutations)},MutationBatch}(),MutationBatchResult=function(){function MutationBatchResult(batch,commitVersion,mutationResults,streamToken,docVersions){this.batch=batch,this.commitVersion=commitVersion,this.mutationResults=mutationResults,this.streamToken=streamToken,this.docVersions=docVersions}return MutationBatchResult.from=function(batch,commitVersion,results,streamToken){assert(batch.mutations.length===results.length,'Mutations sent '+batch.mutations.length+' must equal results received '+results.length);for(var versionMap=documentVersionMap(),mutations=batch.mutations,i=0;i<mutations.length;i++)versionMap=versionMap.insert(mutations[i].key,results[i].version);return new MutationBatchResult(batch,commitVersion,results,streamToken,versionMap)},MutationBatchResult}(),PersistencePromise=function(){function PersistencePromise(callback){var _this=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,callback(function(value){_this.isDone=!0,_this.result=value,_this.nextCallback&&_this.nextCallback(value)},function(error){_this.isDone=!0,_this.error=error,_this.catchCallback&&_this.catchCallback(error)})}return PersistencePromise.prototype.catch=function(fn){return this.next(void 0,fn)},PersistencePromise.prototype.next=function(nextFn,catchFn){var _this=this;return this.callbackAttached&&fail('Called next() or catch() twice for PersistencePromise'),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(catchFn,this.error):this.wrapSuccess(nextFn,this.result):new PersistencePromise(function(resolve,reject){_this.nextCallback=function(value){_this.wrapSuccess(nextFn,value).next(resolve,reject)},_this.catchCallback=function(error){_this.wrapFailure(catchFn,error).next(resolve,reject)}})},PersistencePromise.prototype.toPromise=function(){var _this=this;return new Promise(function(resolve,reject){_this.next(resolve,reject)})},PersistencePromise.prototype.wrapUserFunction=function(fn){try{var result=fn();return result instanceof PersistencePromise?result:PersistencePromise.resolve(result)}catch(e){return PersistencePromise.reject(e)}},PersistencePromise.prototype.wrapSuccess=function(nextFn,value){return nextFn?this.wrapUserFunction(function(){return nextFn(value)}):PersistencePromise.resolve(value)},PersistencePromise.prototype.wrapFailure=function(catchFn,error){return catchFn?this.wrapUserFunction(function(){return catchFn(error)}):PersistencePromise.reject(error)},PersistencePromise.resolve=function(result){return new PersistencePromise(function(resolve){resolve(result)})},PersistencePromise.reject=function(error){return new PersistencePromise(function(resolve,reject){reject(error)})},PersistencePromise.waitFor=function(all){return new PersistencePromise(function(resolve,reject){var expectedCount=0,resolvedCount=0,done=!1;all.forEach(function(element){++expectedCount,element.next(function(){++resolvedCount,done&&resolvedCount==expectedCount&&resolve()},function(err){return reject(err)})}),done=!0,resolvedCount==expectedCount&&resolve()})},PersistencePromise.or=function(predicates){for(var p=PersistencePromise.resolve(!1),_loop_1=function(predicate){p=p.next(function(isTrue){return isTrue?PersistencePromise.resolve(isTrue):predicate()})},_i=0,predicates_1=predicates,predicate;_i<predicates_1.length;_i++)predicate=predicates_1[_i],_loop_1(predicate);return p},PersistencePromise.forEach=function(collection,f){var _this=this,promises=[];return collection.forEach(function(r,s){promises.push(f.call(_this,r,s))}),this.waitFor(promises)},PersistencePromise}(),ObjectMap=function(){function ObjectMap(mapKeyFn){this.mapKeyFn=mapKeyFn,this.inner={}}return ObjectMap.prototype.get=function(key){var id=this.mapKeyFn(key),matches=this.inner[id];if(void 0!==matches)for(var _i=0,matches_1=matches;_i<matches_1.length;_i++){var _a=matches_1[_i],otherKey=_a[0],value=_a[1];if(otherKey.isEqual(key))return value}},ObjectMap.prototype.has=function(key){return void 0!==this.get(key)},ObjectMap.prototype.set=function(key,value){var id=this.mapKeyFn(key),matches=this.inner[id];if(void 0===matches)return void(this.inner[id]=[[key,value]]);for(var i=0;i<matches.length;i++)if(matches[i][0].isEqual(key))return void(matches[i]=[key,value]);matches.push([key,value])},ObjectMap.prototype.delete=function(key){var id=this.mapKeyFn(key),matches=this.inner[id];if(void 0===matches)return!1;for(var i=0;i<matches.length;i++)if(matches[i][0].isEqual(key))return 1===matches.length?delete this.inner[id]:matches.splice(i,1),!0;return!1},ObjectMap.prototype.forEach=function(fn){forEach(this.inner,function(_,entries){for(var _i=0,entries_1=entries;_i<entries_1.length;_i++){var _a=entries_1[_i],k=_a[0],v=_a[1];fn(k,v)}})},ObjectMap.prototype.isEmpty=function(){return isEmpty(this.inner)},ObjectMap}(),RemoteDocumentChangeBuffer=function(){function RemoteDocumentChangeBuffer(){this.changes=maybeDocumentMap(),this.documentSizes=new ObjectMap(function(key){return key.toString()})}return RemoteDocumentChangeBuffer.prototype.addEntry=function(maybeDocument){var changes=this.assertChanges();this.changes=changes.insert(maybeDocument.key,maybeDocument)},RemoteDocumentChangeBuffer.prototype.getEntry=function(transaction,documentKey){var _this=this,changes=this.assertChanges(),bufferedEntry=changes.get(documentKey);return bufferedEntry?PersistencePromise.resolve(bufferedEntry):this.getFromCache(transaction,documentKey).next(function(getResult){return null===getResult?(_this.documentSizes.set(documentKey,0),null):(_this.documentSizes.set(documentKey,getResult.size),getResult.maybeDocument)})},RemoteDocumentChangeBuffer.prototype.apply=function(transaction){var result=this.applyChanges(transaction);return this.changes=null,result},RemoteDocumentChangeBuffer.prototype.assertChanges=function(){return assert(null!==this.changes,'Changes have already been applied.'),this.changes},RemoteDocumentChangeBuffer}(),LOG_TAG$1='SimpleDb',SimpleDb=function(){function SimpleDb(db){this.db=db}return SimpleDb.openOrCreate=function(name,version,schemaConverter){return assert(SimpleDb.isAvailable(),'IndexedDB not supported in current environment.'),debug(LOG_TAG$1,'Opening database:',name),new PersistencePromise(function(resolve,reject){var request=window.indexedDB.open(name,version);request.onsuccess=function(event){var db=event.target.result;resolve(new SimpleDb(db))},request.onblocked=function(){reject(new FirestoreError(Code.FAILED_PRECONDITION,'Cannot upgrade IndexedDB schema while another tab is open. '+'Close all tabs that access Firestore and reload this page to proceed.'))},request.onerror=function(event){reject(event.target.error)},request.onupgradeneeded=function(event){debug(LOG_TAG$1,'Database "'+name+'" requires upgrade from version:',event.oldVersion);var db=event.target.result,txn=new SimpleDbTransaction(request.transaction);schemaConverter.createOrUpgrade(db,txn,event.oldVersion,SCHEMA_VERSION).next(function(){debug(LOG_TAG$1,'Database upgrade to version '+SCHEMA_VERSION+' complete')})}}).toPromise()},SimpleDb.delete=function(name){return debug(LOG_TAG$1,'Removing database:',name),wrapRequest(window.indexedDB.deleteDatabase(name)).toPromise()},SimpleDb.isAvailable=function(){if('undefined'==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return'YES'===process.env.USE_MOCK_PERSISTENCE;var ua=window.navigator.userAgent;return 0<ua.indexOf('MSIE ')||0<ua.indexOf('Trident/')||0<ua.indexOf('Edge/')?!1:!0},SimpleDb.getStore=function(txn,store){return txn.store(store)},SimpleDb.prototype.runTransaction=function(mode,objectStores,transactionFn){var transaction=SimpleDbTransaction.open(this.db,mode,objectStores),transactionFnResult=transactionFn(transaction).catch(function(error$$1){transaction.abort(error$$1)}).toPromise();return transaction.completionPromise.then(function(){return transactionFnResult})},SimpleDb.prototype.close=function(){this.db.close()},SimpleDb}(),IterationController=function(){function IterationController(dbCursor){this.dbCursor=dbCursor,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(IterationController.prototype,'isDone',{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(IterationController.prototype,'skipToKey',{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(IterationController.prototype,'cursor',{set:function(value){this.dbCursor=value},enumerable:!0,configurable:!0}),IterationController.prototype.done=function(){this.shouldStop=!0},IterationController.prototype.skip=function(key){this.nextKey=key},IterationController.prototype.delete=function(){return wrapRequest(this.dbCursor.delete())},IterationController}(),SimpleDbTransaction=function(){function SimpleDbTransaction(transaction){var _this=this;this.transaction=transaction,this.aborted=!1,this.completionDeferred=new Deferred$1,this.transaction.oncomplete=function(){_this.completionDeferred.resolve()},this.transaction.onabort=function(){transaction.error?_this.completionDeferred.reject(transaction.error):_this.completionDeferred.resolve()},this.transaction.onerror=function(event){_this.completionDeferred.reject(event.target.error)}}return SimpleDbTransaction.open=function(db,mode,objectStoreNames){return new SimpleDbTransaction(db.transaction(objectStoreNames,mode))},Object.defineProperty(SimpleDbTransaction.prototype,'completionPromise',{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),SimpleDbTransaction.prototype.abort=function(error$$1){error$$1&&this.completionDeferred.reject(error$$1),this.aborted||(debug(LOG_TAG$1,'Aborting transaction:',error$$1?error$$1.message:'Client-initiated abort'),this.aborted=!0,this.transaction.abort())},SimpleDbTransaction.prototype.store=function(storeName){var store=this.transaction.objectStore(storeName);return assert(!!store,'Object store not part of transaction: '+storeName),new SimpleDbStore(store)},SimpleDbTransaction}(),SimpleDbStore=function(){function SimpleDbStore(store){this.store=store}return SimpleDbStore.prototype.put=function(keyOrValue,value){var request;return void 0===value?(debug(LOG_TAG$1,'PUT',this.store.name,'<auto-key>',keyOrValue),request=this.store.put(keyOrValue)):(debug(LOG_TAG$1,'PUT',this.store.name,keyOrValue,value),request=this.store.put(value,keyOrValue)),wrapRequest(request)},SimpleDbStore.prototype.add=function(value){debug(LOG_TAG$1,'ADD',this.store.name,value,value);var request=this.store.add(value);return wrapRequest(request)},SimpleDbStore.prototype.get=function(key){var _this=this,request=this.store.get(key);return wrapRequest(request).next(function(result){return void 0===result&&(result=null),debug(LOG_TAG$1,'GET',_this.store.name,key,result),result})},SimpleDbStore.prototype.delete=function(key){debug(LOG_TAG$1,'DELETE',this.store.name,key);var request=this.store.delete(key);return wrapRequest(request)},SimpleDbStore.prototype.count=function(){debug(LOG_TAG$1,'COUNT',this.store.name);var request=this.store.count();return wrapRequest(request)},SimpleDbStore.prototype.loadAll=function(indexOrRange,range){var cursor=this.cursor(this.options(indexOrRange,range)),results=[];return this.iterateCursor(cursor,function(key,value){results.push(value)}).next(function(){return results})},SimpleDbStore.prototype.deleteAll=function(indexOrRange,range){debug(LOG_TAG$1,'DELETE ALL',this.store.name);var options=this.options(indexOrRange,range);options.keysOnly=!1;var cursor=this.cursor(options);return this.iterateCursor(cursor,function(key,value,control){return control.delete()})},SimpleDbStore.prototype.iterate=function(optionsOrCallback,callback){var options;callback?options=optionsOrCallback:(options={},callback=optionsOrCallback);var cursor=this.cursor(options);return this.iterateCursor(cursor,callback)},SimpleDbStore.prototype.iterateSerial=function(callback){var cursorRequest=this.cursor({});return new PersistencePromise(function(resolve,reject){cursorRequest.onerror=function(event){reject(event.target.error)},cursorRequest.onsuccess=function(event){var cursor=event.target.result;return cursor?void callback(cursor.primaryKey,cursor.value).next(function(shouldContinue){shouldContinue?cursor.continue():resolve()}):void resolve()}})},SimpleDbStore.prototype.iterateCursor=function(cursorRequest,fn){var results=[];return new PersistencePromise(function(resolve,reject){cursorRequest.onerror=function(event){reject(event.target.error)},cursorRequest.onsuccess=function(event){var cursor=event.target.result;if(!cursor)return void resolve();var controller=new IterationController(cursor),userResult=fn(cursor.primaryKey,cursor.value,controller);if(userResult instanceof PersistencePromise){var userPromise=userResult.catch(function(err){return controller.done(),PersistencePromise.reject(err)});results.push(userPromise)}controller.isDone?resolve():null===controller.skipToKey?cursor.continue():cursor.continue(controller.skipToKey)}}).next(function(){return PersistencePromise.waitFor(results)})},SimpleDbStore.prototype.options=function(indexOrRange,range){var indexName;return void 0!==indexOrRange&&('string'==typeof indexOrRange?indexName=indexOrRange:(assert(void 0===range,'3rd argument must not be defined if 2nd is a range.'),range=indexOrRange)),{index:indexName,range:range}},SimpleDbStore.prototype.cursor=function(options){var direction='next';if(options.reverse&&(direction='prev'),options.index){var index=this.store.index(options.index);return options.keysOnly?index.openKeyCursor(options.range,direction):index.openCursor(options.range,direction)}return this.store.openCursor(options.range,direction)},SimpleDbStore}(),REMOTE_DOCUMENT_CHANGE_MISSING_ERR_MSG='The remote document changelog no longer contains all changes for all '+'local query views. It may be necessary to rebuild these views.',IndexedDbRemoteDocumentCache=function(){function IndexedDbRemoteDocumentCache(serializer,keepDocumentChangeLog){this.serializer=serializer,this.keepDocumentChangeLog=keepDocumentChangeLog,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(IndexedDbRemoteDocumentCache.prototype,'lastProcessedDocumentChangeId',{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),IndexedDbRemoteDocumentCache.prototype.start=function(transaction){var store=SimpleDb.getStore(transaction,DbRemoteDocumentChanges.store);return this.synchronizeLastDocumentChangeId(store)},IndexedDbRemoteDocumentCache.prototype.addEntries=function(transaction,entries,sizeDelta){var promises=[];if(0<entries.length){for(var documentStore=remoteDocumentsStore(transaction),changedKeys=documentKeySet(),_i=0,entries_1=entries;_i<entries_1.length;_i++){var _a=entries_1[_i],key=_a.key,doc=_a.doc;promises.push(documentStore.put(dbKey(key),doc)),changedKeys=changedKeys.add(key)}this.keepDocumentChangeLog&&promises.push(documentChangesStore(transaction).put({changes:this.serializer.toDbResourcePaths(changedKeys)})),promises.push(this.updateSize(transaction,sizeDelta))}return PersistencePromise.waitFor(promises)},IndexedDbRemoteDocumentCache.prototype.removeEntry=function(transaction,documentKey){var store=remoteDocumentsStore(transaction),key=dbKey(documentKey);return store.get(key).next(function(document){return document?store.delete(key).next(function(){return dbDocumentSize(document)}):PersistencePromise.resolve(0)})},IndexedDbRemoteDocumentCache.prototype.getEntry=function(transaction,documentKey){var _this=this;return remoteDocumentsStore(transaction).get(dbKey(documentKey)).next(function(dbRemoteDoc){return dbRemoteDoc?_this.serializer.fromDbRemoteDocument(dbRemoteDoc):null})},IndexedDbRemoteDocumentCache.prototype.getSizedEntry=function(transaction,documentKey){var _this=this;return remoteDocumentsStore(transaction).get(dbKey(documentKey)).next(function(dbRemoteDoc){return dbRemoteDoc?{maybeDocument:_this.serializer.fromDbRemoteDocument(dbRemoteDoc),size:dbDocumentSize(dbRemoteDoc)}:null})},IndexedDbRemoteDocumentCache.prototype.getDocumentsMatchingQuery=function(transaction,query){var _this=this,results=documentMap(),startKey=query.path.toArray(),range=IDBKeyRange.lowerBound(startKey);return remoteDocumentsStore(transaction).iterate({range:range},function(key,dbRemoteDoc,control){var maybeDoc=_this.serializer.fromDbRemoteDocument(dbRemoteDoc);query.path.isPrefixOf(maybeDoc.key.path)?maybeDoc instanceof Document&&query.matches(maybeDoc)&&(results=results.insert(maybeDoc.key,maybeDoc)):control.done()}).next(function(){return results})},IndexedDbRemoteDocumentCache.prototype.getNewDocumentChanges=function(transaction){var _this=this;assert(this.keepDocumentChangeLog,'Can only call getNewDocumentChanges() when document change log is enabled');var changedKeys=documentKeySet(),changedDocs=maybeDocumentMap(),range=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),firstIteration=!0,changesStore=documentChangesStore(transaction);return changesStore.iterate({range:range},function(_,documentChange){return firstIteration&&(firstIteration=!1,_this._lastProcessedDocumentChangeId+1!==documentChange.id)?_this.synchronizeLastDocumentChangeId(changesStore).next(function(){return PersistencePromise.reject(new FirestoreError(Code.DATA_LOSS,REMOTE_DOCUMENT_CHANGE_MISSING_ERR_MSG))}):void(changedKeys=changedKeys.unionWith(_this.serializer.fromDbResourcePaths(documentChange.changes)),_this._lastProcessedDocumentChangeId=documentChange.id)}).next(function(){var documentPromises=[];return changedKeys.forEach(function(key){documentPromises.push(_this.getEntry(transaction,key).next(function(maybeDocument){var doc=maybeDocument||new NoDocument(key,SnapshotVersion.forDeletedDoc());changedDocs=changedDocs.insert(key,doc)}))}),PersistencePromise.waitFor(documentPromises)}).next(function(){return changedDocs})},IndexedDbRemoteDocumentCache.prototype.removeDocumentChangesThroughChangeId=function(transaction,changeId){var range=IDBKeyRange.upperBound(changeId);return documentChangesStore(transaction).delete(range)},IndexedDbRemoteDocumentCache.prototype.synchronizeLastDocumentChangeId=function(documentChangesStore){var _this=this;return this._lastProcessedDocumentChangeId=0,documentChangesStore.iterate({keysOnly:!0,reverse:!0},function(key,value,control){_this._lastProcessedDocumentChangeId=key,control.done()})},IndexedDbRemoteDocumentCache.prototype.newChangeBuffer=function(){return new IndexedDbRemoteDocumentChangeBuffer(this)},IndexedDbRemoteDocumentCache.prototype.getSize=function(txn){return this.getMetadata(txn).next(function(metadata){return metadata.byteSize})},IndexedDbRemoteDocumentCache.prototype.getMetadata=function(txn){return documentGlobalStore(txn).get(DbRemoteDocumentGlobal.key).next(function(metadata){return assert(!!metadata,'Missing document cache metadata'),metadata})},IndexedDbRemoteDocumentCache.prototype.setMetadata=function(txn,metadata){return documentGlobalStore(txn).put(DbRemoteDocumentGlobal.key,metadata)},IndexedDbRemoteDocumentCache.prototype.updateSize=function(txn,sizeDelta){var _this=this;return this.getMetadata(txn).next(function(metadata){return metadata.byteSize+=sizeDelta,_this.setMetadata(txn,metadata)})},IndexedDbRemoteDocumentCache}(),IndexedDbRemoteDocumentChangeBuffer=function(_super){function IndexedDbRemoteDocumentChangeBuffer(documentCache){var _this=_super.call(this)||this;return _this.documentCache=documentCache,_this}return tslib_1.__extends(IndexedDbRemoteDocumentChangeBuffer,_super),IndexedDbRemoteDocumentChangeBuffer.prototype.applyChanges=function(transaction){var _this=this,changes=this.assertChanges(),delta=0,toApply=[];return changes.forEach(function(key,maybeDocument){var doc=_this.documentCache.serializer.toDbRemoteDocument(maybeDocument),previousSize=_this.documentSizes.get(key);assert(void 0!==previousSize,'Attempting to change document '+key.toString()+' without having read it first');var size=dbDocumentSize(doc);delta+=size-previousSize,toApply.push({key:key,doc:doc})}),this.documentCache.addEntries(transaction,toApply,delta)},IndexedDbRemoteDocumentChangeBuffer.prototype.getFromCache=function(transaction,documentKey){return this.documentCache.getSizedEntry(transaction,documentKey)},IndexedDbRemoteDocumentChangeBuffer}(RemoteDocumentChangeBuffer),SCHEMA_VERSION=6,SchemaConverter=function(){function SchemaConverter(serializer){this.serializer=serializer}return SchemaConverter.prototype.createOrUpgrade=function(db,txn,fromVersion,toVersion){var _this=this;assert(fromVersion<toVersion&&0<=fromVersion&&toVersion<=SCHEMA_VERSION,'Unexpected schema upgrade from v'+fromVersion+' to v{toVersion}.'),1>fromVersion&&1<=toVersion&&(createPrimaryClientStore(db),createMutationQueue(db),createQueryCache(db),createRemoteDocumentCache(db));var p=PersistencePromise.resolve();return 3>fromVersion&&3<=toVersion&&(0!==fromVersion&&(dropQueryCache(db),createQueryCache(db)),p=p.next(function(){return writeEmptyTargetGlobalEntry(txn)})),4>fromVersion&&4<=toVersion&&(0!==fromVersion&&(p=p.next(function(){return upgradeMutationBatchSchemaAndMigrateData(db,txn)})),p=p.next(function(){createClientMetadataStore(db),createRemoteDocumentChangesStore(db)})),5>fromVersion&&5<=toVersion&&(p=p.next(function(){return _this.removeAcknowledgedMutations(txn)})),6>fromVersion&&6<=toVersion&&(p=p.next(function(){return createDocumentGlobalStore(db),_this.addDocumentGlobal(txn)})),p},SchemaConverter.prototype.addDocumentGlobal=function(txn){var byteCount=0;return txn.store(DbRemoteDocument.store).iterate(function(_,doc){byteCount+=dbDocumentSize(doc)}).next(function(){var metadata=new DbRemoteDocumentGlobal(byteCount);return txn.store(DbRemoteDocumentGlobal.store).put(DbRemoteDocumentGlobal.key,metadata)})},SchemaConverter.prototype.removeAcknowledgedMutations=function(txn){var _this=this,queuesStore=txn.store(DbMutationQueue.store),mutationsStore=txn.store(DbMutationBatch.store);return queuesStore.loadAll().next(function(queues){return PersistencePromise.forEach(queues,function(queue){var range=IDBKeyRange.bound([queue.userId,BATCHID_UNKNOWN],[queue.userId,queue.lastAcknowledgedBatchId]);return mutationsStore.loadAll(DbMutationBatch.userMutationsIndex,range).next(function(dbBatches){return PersistencePromise.forEach(dbBatches,function(dbBatch){assert(dbBatch.userId===queue.userId,'Cannot process batch '+dbBatch.batchId+' from unexpected user');var batch=_this.serializer.fromDbMutationBatch(dbBatch);return removeMutationBatch(txn,queue.userId,batch).next(function(){})})})})})},SchemaConverter}(),DbTimestamp=function(){return function DbTimestamp(seconds,nanoseconds){this.seconds=seconds,this.nanoseconds=nanoseconds}}(),DbPrimaryClient=function(){function DbPrimaryClient(ownerId,allowTabSynchronization,leaseTimestampMs){this.ownerId=ownerId,this.allowTabSynchronization=allowTabSynchronization,this.leaseTimestampMs=leaseTimestampMs}return DbPrimaryClient.store='owner',DbPrimaryClient.key='owner',DbPrimaryClient}(),DbMutationQueue=function(){function DbMutationQueue(userId,lastAcknowledgedBatchId,lastStreamToken){this.userId=userId,this.lastAcknowledgedBatchId=lastAcknowledgedBatchId,this.lastStreamToken=lastStreamToken}return DbMutationQueue.store='mutationQueues',DbMutationQueue.keyPath='userId',DbMutationQueue}(),DbMutationBatch=function(){function DbMutationBatch(userId,batchId,localWriteTimeMs,mutations){this.userId=userId,this.batchId=batchId,this.localWriteTimeMs=localWriteTimeMs,this.mutations=mutations}return DbMutationBatch.store='mutations',DbMutationBatch.keyPath='batchId',DbMutationBatch.userMutationsIndex='userMutationsIndex',DbMutationBatch.userMutationsKeyPath=['userId','batchId'],DbMutationBatch}(),DbDocumentMutation=function(){function DbDocumentMutation(){}return DbDocumentMutation.prefixForUser=function(userId){return[userId]},DbDocumentMutation.prefixForPath=function(userId,path){return[userId,encode(path)]},DbDocumentMutation.key=function(userId,path,batchId){return[userId,encode(path),batchId]},DbDocumentMutation.store='documentMutations',DbDocumentMutation.PLACEHOLDER=new DbDocumentMutation,DbDocumentMutation}(),DbNoDocument=function(){return function DbNoDocument(path,readTime){this.path=path,this.readTime=readTime}}(),DbUnknownDocument=function(){return function DbUnknownDocument(path,version){this.path=path,this.version=version}}(),DbRemoteDocument=function(){function DbRemoteDocument(unknownDocument,noDocument,document,hasCommittedMutations){this.unknownDocument=unknownDocument,this.noDocument=noDocument,this.document=document,this.hasCommittedMutations=hasCommittedMutations}return DbRemoteDocument.store='remoteDocuments',DbRemoteDocument}(),DbRemoteDocumentGlobal=function(){function DbRemoteDocumentGlobal(byteSize){this.byteSize=byteSize}return DbRemoteDocumentGlobal.store='remoteDocumentGlobal',DbRemoteDocumentGlobal.key='remoteDocumentGlobalKey',DbRemoteDocumentGlobal}(),DbTarget=function(){function DbTarget(targetId,canonicalId,readTime,resumeToken,lastListenSequenceNumber,query){this.targetId=targetId,this.canonicalId=canonicalId,this.readTime=readTime,this.resumeToken=resumeToken,this.lastListenSequenceNumber=lastListenSequenceNumber,this.query=query}return DbTarget.store='targets',DbTarget.keyPath='targetId',DbTarget.queryTargetsIndexName='queryTargetsIndex',DbTarget.queryTargetsKeyPath=['canonicalId','targetId'],DbTarget}(),DbTargetDocument=function(){function DbTargetDocument(targetId,path,sequenceNumber){this.targetId=targetId,this.path=path,this.sequenceNumber=sequenceNumber,assert(0===targetId==(void 0!==sequenceNumber),'A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number')}return DbTargetDocument.store='targetDocuments',DbTargetDocument.keyPath=['targetId','path'],DbTargetDocument.documentTargetsIndex='documentTargetsIndex',DbTargetDocument.documentTargetsKeyPath=['path','targetId'],DbTargetDocument}(),DbTargetGlobal=function(){function DbTargetGlobal(highestTargetId,highestListenSequenceNumber,lastRemoteSnapshotVersion,targetCount){this.highestTargetId=highestTargetId,this.highestListenSequenceNumber=highestListenSequenceNumber,this.lastRemoteSnapshotVersion=lastRemoteSnapshotVersion,this.targetCount=targetCount}return DbTargetGlobal.key='targetGlobalKey',DbTargetGlobal.store='targetGlobal',DbTargetGlobal}(),DbRemoteDocumentChanges=function(){function DbRemoteDocumentChanges(changes){this.changes=changes}return DbRemoteDocumentChanges.store='remoteDocumentChanges',DbRemoteDocumentChanges.keyPath='id',DbRemoteDocumentChanges}(),DbClientMetadata=function(){function DbClientMetadata(clientId,updateTimeMs,networkEnabled,inForeground,lastProcessedDocumentChangeId){this.clientId=clientId,this.updateTimeMs=updateTimeMs,this.networkEnabled=networkEnabled,this.inForeground=inForeground,this.lastProcessedDocumentChangeId=lastProcessedDocumentChangeId}return DbClientMetadata.store='clientMetadata',DbClientMetadata.keyPath='clientId',DbClientMetadata}(),V1_STORES=[DbMutationQueue.store,DbMutationBatch.store,DbDocumentMutation.store,DbRemoteDocument.store,DbTarget.store,DbPrimaryClient.store,DbTargetGlobal.store,DbTargetDocument.store],V4_STORES=V1_STORES.concat([DbClientMetadata.store,DbRemoteDocumentChanges.store]),V6_STORES=V4_STORES.concat([DbRemoteDocumentGlobal.store]),ALL_STORES=V6_STORES,IndexedDbMutationQueue=function(){function IndexedDbMutationQueue(userId,serializer,referenceDelegate){this.userId=userId,this.serializer=serializer,this.referenceDelegate=referenceDelegate,this.documentKeysByBatchId={}}return IndexedDbMutationQueue.forUser=function(user,serializer,referenceDelegate){assert(''!==user.uid,'UserID must not be an empty string.');var userId=user.isAuthenticated()?user.uid:'';return new IndexedDbMutationQueue(userId,serializer,referenceDelegate)},IndexedDbMutationQueue.prototype.checkEmpty=function(transaction){var empty=!0,range=IDBKeyRange.bound([this.userId,_NumberNEGATIVE_INFINITY],[this.userId,_NumberPOSITIVE_INFINITY]);return mutationsStore(transaction).iterate({index:DbMutationBatch.userMutationsIndex,range:range},function(key,value,control){empty=!1,control.done()}).next(function(){return empty})},IndexedDbMutationQueue.prototype.acknowledgeBatch=function(transaction,batch,streamToken){return this.getMutationQueueMetadata(transaction).next(function(metadata){var batchId=batch.batchId;return assert(batchId>metadata.lastAcknowledgedBatchId,'Mutation batchIDs must be acknowledged in order'),metadata.lastAcknowledgedBatchId=batchId,metadata.lastStreamToken=convertStreamToken(streamToken),mutationQueuesStore(transaction).put(metadata)})},IndexedDbMutationQueue.prototype.getLastStreamToken=function(transaction){return this.getMutationQueueMetadata(transaction).next(function(metadata){return metadata.lastStreamToken})},IndexedDbMutationQueue.prototype.setLastStreamToken=function(transaction,streamToken){return this.getMutationQueueMetadata(transaction).next(function(metadata){return metadata.lastStreamToken=convertStreamToken(streamToken),mutationQueuesStore(transaction).put(metadata)})},IndexedDbMutationQueue.prototype.addMutationBatch=function(transaction,localWriteTime,mutations){var _this=this,documentStore=documentMutationsStore(transaction),mutationStore=mutationsStore(transaction);return mutationStore.add({}).next(function(batchId){assert('number'==typeof batchId,'Auto-generated key is not a number');var batch=new MutationBatch(batchId,localWriteTime,mutations),dbBatch=_this.serializer.toDbMutationBatch(_this.userId,batch);_this.documentKeysByBatchId[batchId]=batch.keys();for(var promises=[],_i=0,mutations_1=mutations;_i<mutations_1.length;_i++){var mutation=mutations_1[_i],indexKey=DbDocumentMutation.key(_this.userId,mutation.key.path,batchId);promises.push(mutationStore.put(dbBatch)),promises.push(documentStore.put(indexKey,DbDocumentMutation.PLACEHOLDER))}return PersistencePromise.waitFor(promises).next(function(){return batch})})},IndexedDbMutationQueue.prototype.lookupMutationBatch=function(transaction,batchId){var _this=this;return mutationsStore(transaction).get(batchId).next(function(dbBatch){return dbBatch?(assert(dbBatch.userId===_this.userId,'Unexpected user \''+dbBatch.userId+'\' for mutation batch '+batchId),_this.serializer.fromDbMutationBatch(dbBatch)):null})},IndexedDbMutationQueue.prototype.lookupMutationKeys=function(transaction,batchId){var _this=this;return this.documentKeysByBatchId[batchId]?PersistencePromise.resolve(this.documentKeysByBatchId[batchId]):this.lookupMutationBatch(transaction,batchId).next(function(batch){if(batch){var keys=batch.keys();return _this.documentKeysByBatchId[batchId]=keys,keys}return null})},IndexedDbMutationQueue.prototype.getNextMutationBatchAfterBatchId=function(transaction,batchId){var _this=this;return this.getMutationQueueMetadata(transaction).next(function(metadata){var nextBatchId=_Mathmax(batchId,metadata.lastAcknowledgedBatchId)+1,range=IDBKeyRange.lowerBound([_this.userId,nextBatchId]),foundBatch=null;return mutationsStore(transaction).iterate({index:DbMutationBatch.userMutationsIndex,range:range},function(key,dbBatch,control){dbBatch.userId===_this.userId&&(assert(dbBatch.batchId>=nextBatchId,'Should have found mutation after '+nextBatchId),foundBatch=_this.serializer.fromDbMutationBatch(dbBatch)),control.done()}).next(function(){return foundBatch})})},IndexedDbMutationQueue.prototype.getAllMutationBatches=function(transaction){var _this=this,range=IDBKeyRange.bound([this.userId,BATCHID_UNKNOWN],[this.userId,_NumberPOSITIVE_INFINITY]);return mutationsStore(transaction).loadAll(DbMutationBatch.userMutationsIndex,range).next(function(dbBatches){return dbBatches.map(function(dbBatch){return _this.serializer.fromDbMutationBatch(dbBatch)})})},IndexedDbMutationQueue.prototype.getAllMutationBatchesAffectingDocumentKey=function(transaction,documentKey){var _this=this,indexPrefix=DbDocumentMutation.prefixForPath(this.userId,documentKey.path),indexStart=IDBKeyRange.lowerBound(indexPrefix),results=[];return documentMutationsStore(transaction).iterate({range:indexStart},function(indexKey,_,control){var userID=indexKey[0],encodedPath=indexKey[1],batchId=indexKey[2],path=decode$1(encodedPath);return userID===_this.userId&&documentKey.path.isEqual(path)?mutationsStore(transaction).get(batchId).next(function(mutation){if(!mutation)throw fail('Dangling document-mutation reference found: '+indexKey+' which points to '+batchId);assert(mutation.userId===_this.userId,'Unexpected user \''+mutation.userId+'\' for mutation batch '+batchId),results.push(_this.serializer.fromDbMutationBatch(mutation))}):void control.done()}).next(function(){return results})},IndexedDbMutationQueue.prototype.getAllMutationBatchesAffectingDocumentKeys=function(transaction,documentKeys){var _this=this,uniqueBatchIDs=new SortedSet(primitiveComparator),promises=[];return documentKeys.forEach(function(documentKey){var indexStart=DbDocumentMutation.prefixForPath(_this.userId,documentKey.path),range=IDBKeyRange.lowerBound(indexStart),promise=documentMutationsStore(transaction).iterate({range:range},function(indexKey,_,control){var userID=indexKey[0],encodedPath=indexKey[1],batchID=indexKey[2],path=decode$1(encodedPath);return userID===_this.userId&&documentKey.path.isEqual(path)?void(uniqueBatchIDs=uniqueBatchIDs.add(batchID)):void control.done()});promises.push(promise)}),PersistencePromise.waitFor(promises).next(function(){return _this.lookupMutationBatches(transaction,uniqueBatchIDs)})},IndexedDbMutationQueue.prototype.getAllMutationBatchesAffectingQuery=function(transaction,query){var _this=this;assert(!query.isDocumentQuery(),'Document queries shouldn\'t go down this path');var queryPath=query.path,immediateChildrenLength=queryPath.length+1,indexPrefix=DbDocumentMutation.prefixForPath(this.userId,queryPath),indexStart=IDBKeyRange.lowerBound(indexPrefix),uniqueBatchIDs=new SortedSet(primitiveComparator);return documentMutationsStore(transaction).iterate({range:indexStart},function(indexKey,_,control){var userID=indexKey[0],encodedPath=indexKey[1],batchID=indexKey[2],path=decode$1(encodedPath);return userID===_this.userId&&queryPath.isPrefixOf(path)?void(path.length!==immediateChildrenLength||(uniqueBatchIDs=uniqueBatchIDs.add(batchID))):void control.done()}).next(function(){return _this.lookupMutationBatches(transaction,uniqueBatchIDs)})},IndexedDbMutationQueue.prototype.lookupMutationBatches=function(transaction,batchIDs){var _this=this,results=[],promises=[];return batchIDs.forEach(function(batchId){promises.push(mutationsStore(transaction).get(batchId).next(function(mutation){if(null===mutation)throw fail('Dangling document-mutation reference found, '+'which points to '+batchId);assert(mutation.userId===_this.userId,'Unexpected user \''+mutation.userId+'\' for mutation batch '+batchId),results.push(_this.serializer.fromDbMutationBatch(mutation))}))}),PersistencePromise.waitFor(promises).next(function(){return results})},IndexedDbMutationQueue.prototype.removeMutationBatch=function(transaction,batch){var _this=this;return removeMutationBatch(transaction.simpleDbTransaction,this.userId,batch).next(function(removedDocuments){return _this.removeCachedMutationKeys(batch.batchId),PersistencePromise.forEach(removedDocuments,function(key){return _this.referenceDelegate.removeMutationReference(transaction,key)})})},IndexedDbMutationQueue.prototype.removeCachedMutationKeys=function(batchId){delete this.documentKeysByBatchId[batchId]},IndexedDbMutationQueue.prototype.performConsistencyCheck=function(txn){var _this=this;return this.checkEmpty(txn).next(function(empty){if(!empty)return PersistencePromise.resolve();var startRange=IDBKeyRange.lowerBound(DbDocumentMutation.prefixForUser(_this.userId)),danglingMutationReferences=[];return documentMutationsStore(txn).iterate({range:startRange},function(key,_,control){var userID=key[0];if(userID!==_this.userId)return void control.done();var path=decode$1(key[1]);danglingMutationReferences.push(path)}).next(function(){assert(0===danglingMutationReferences.length,'Document leak -- detected dangling mutation references when queue is empty. '+'Dangling keys: '+danglingMutationReferences.map(function(p){return p.canonicalString()}))})})},IndexedDbMutationQueue.prototype.containsKey=function(txn,key){return mutationQueueContainsKey(txn,this.userId,key)},IndexedDbMutationQueue.prototype.getMutationQueueMetadata=function(transaction){var _this=this;return mutationQueuesStore(transaction).get(this.userId).next(function(metadata){return metadata||new DbMutationQueue(_this.userId,BATCHID_UNKNOWN,'')})},IndexedDbMutationQueue}(),RESERVED_BITS=1,GeneratorIds;(function(GeneratorIds){GeneratorIds[GeneratorIds.QueryCache=0]='QueryCache',GeneratorIds[GeneratorIds.SyncEngine=1]='SyncEngine'})(GeneratorIds||(GeneratorIds={}));var TargetIdGenerator=function(){function TargetIdGenerator(generatorId,seed){this.generatorId=generatorId,assert((generatorId&RESERVED_BITS)===generatorId,'Generator ID '+generatorId+' contains more than '+RESERVED_BITS+' reserved bits'),this.seek(void 0===seed?this.generatorId:seed)}return TargetIdGenerator.prototype.next=function(){var nextId=this.nextId;return this.nextId+=1<<RESERVED_BITS,nextId},TargetIdGenerator.prototype.after=function(targetId){return this.seek(targetId+(1<<RESERVED_BITS)),this.next()},TargetIdGenerator.prototype.seek=function(targetId){assert((targetId&RESERVED_BITS)===this.generatorId,'Cannot supply target ID from different generator ID'),this.nextId=targetId},TargetIdGenerator.forQueryCache=function(){var targetIdGenerator=new TargetIdGenerator(GeneratorIds.QueryCache,2);return targetIdGenerator},TargetIdGenerator.forSyncEngine=function(){return new TargetIdGenerator(GeneratorIds.SyncEngine)},TargetIdGenerator}(),IndexedDbQueryCache=function(){function IndexedDbQueryCache(referenceDelegate,serializer){this.referenceDelegate=referenceDelegate,this.serializer=serializer,this.targetIdGenerator=TargetIdGenerator.forQueryCache()}return IndexedDbQueryCache.prototype.allocateTargetId=function(transaction){var _this=this;return this.retrieveMetadata(transaction).next(function(metadata){return metadata.highestTargetId=_this.targetIdGenerator.after(metadata.highestTargetId),_this.saveMetadata(transaction,metadata).next(function(){return metadata.highestTargetId})})},IndexedDbQueryCache.prototype.getLastRemoteSnapshotVersion=function(transaction){return this.retrieveMetadata(transaction).next(function(metadata){return SnapshotVersion.fromTimestamp(new Timestamp(metadata.lastRemoteSnapshotVersion.seconds,metadata.lastRemoteSnapshotVersion.nanoseconds))})},IndexedDbQueryCache.prototype.getHighestSequenceNumber=function(transaction){return getHighestListenSequenceNumber(transaction.simpleDbTransaction)},IndexedDbQueryCache.prototype.setTargetsMetadata=function(transaction,highestListenSequenceNumber,lastRemoteSnapshotVersion){var _this=this;return this.retrieveMetadata(transaction).next(function(metadata){return metadata.highestListenSequenceNumber=highestListenSequenceNumber,lastRemoteSnapshotVersion&&(metadata.lastRemoteSnapshotVersion=lastRemoteSnapshotVersion.toTimestamp()),highestListenSequenceNumber>metadata.highestListenSequenceNumber&&(metadata.highestListenSequenceNumber=highestListenSequenceNumber),_this.saveMetadata(transaction,metadata)})},IndexedDbQueryCache.prototype.addQueryData=function(transaction,queryData){var _this=this;return this.saveQueryData(transaction,queryData).next(function(){return _this.retrieveMetadata(transaction).next(function(metadata){return metadata.targetCount+=1,_this.updateMetadataFromQueryData(queryData,metadata),_this.saveMetadata(transaction,metadata)})})},IndexedDbQueryCache.prototype.updateQueryData=function(transaction,queryData){return this.saveQueryData(transaction,queryData)},IndexedDbQueryCache.prototype.removeQueryData=function(transaction,queryData){var _this=this;return this.removeMatchingKeysForTargetId(transaction,queryData.targetId).next(function(){return targetsStore(transaction).delete(queryData.targetId)}).next(function(){return _this.retrieveMetadata(transaction)}).next(function(metadata){return assert(0<metadata.targetCount,'Removing from an empty query cache'),metadata.targetCount-=1,_this.saveMetadata(transaction,metadata)})},IndexedDbQueryCache.prototype.removeTargets=function(txn,upperBound,activeTargetIds){var _this=this,count=0,promises=[];return targetsStore(txn).iterate(function(key,value){var queryData=_this.serializer.fromDbTarget(value);queryData.sequenceNumber<=upperBound&&void 0===activeTargetIds[queryData.targetId]&&(count++,promises.push(_this.removeQueryData(txn,queryData)))}).next(function(){return PersistencePromise.waitFor(promises)}).next(function(){return count})},IndexedDbQueryCache.prototype.forEachTarget=function(txn,f){var _this=this;return targetsStore(txn).iterate(function(key,value){var queryData=_this.serializer.fromDbTarget(value);f(queryData)})},IndexedDbQueryCache.prototype.retrieveMetadata=function(transaction){return retrieveMetadata(transaction.simpleDbTransaction)},IndexedDbQueryCache.prototype.saveMetadata=function(transaction,metadata){return globalTargetStore(transaction).put(DbTargetGlobal.key,metadata)},IndexedDbQueryCache.prototype.saveQueryData=function(transaction,queryData){return targetsStore(transaction).put(this.serializer.toDbTarget(queryData))},IndexedDbQueryCache.prototype.updateMetadataFromQueryData=function(queryData,metadata){var updated=!1;return queryData.targetId>metadata.highestTargetId&&(metadata.highestTargetId=queryData.targetId,updated=!0),queryData.sequenceNumber>metadata.highestListenSequenceNumber&&(metadata.highestListenSequenceNumber=queryData.sequenceNumber,updated=!0),updated},IndexedDbQueryCache.prototype.getQueryCount=function(transaction){return this.retrieveMetadata(transaction).next(function(metadata){return metadata.targetCount})},IndexedDbQueryCache.prototype.getQueryData=function(transaction,query){var _this=this,canonicalId=query.canonicalId(),range=IDBKeyRange.bound([canonicalId,_NumberNEGATIVE_INFINITY],[canonicalId,_NumberPOSITIVE_INFINITY]),result=null;return targetsStore(transaction).iterate({range:range,index:DbTarget.queryTargetsIndexName},function(key,value,control){var found=_this.serializer.fromDbTarget(value);query.isEqual(found.query)&&(result=found,control.done())}).next(function(){return result})},IndexedDbQueryCache.prototype.addMatchingKeys=function(txn,keys,targetId){var _this=this,promises=[],store=documentTargetStore(txn);return keys.forEach(function(key){var path=encode(key.path);promises.push(store.put(new DbTargetDocument(targetId,path))),promises.push(_this.referenceDelegate.addReference(txn,key))}),PersistencePromise.waitFor(promises)},IndexedDbQueryCache.prototype.removeMatchingKeys=function(txn,keys,targetId){var _this=this,store=documentTargetStore(txn);return PersistencePromise.forEach(keys,function(key){var path=encode(key.path);return PersistencePromise.waitFor([store.delete([targetId,path]),_this.referenceDelegate.removeReference(txn,key)])})},IndexedDbQueryCache.prototype.removeMatchingKeysForTargetId=function(txn,targetId){var store=documentTargetStore(txn),range=IDBKeyRange.bound([targetId],[targetId+1],!1,!0);return store.delete(range)},IndexedDbQueryCache.prototype.getMatchingKeysForTargetId=function(txn,targetId){var range=IDBKeyRange.bound([targetId],[targetId+1],!1,!0),store=documentTargetStore(txn),result=documentKeySet();return store.iterate({range:range,keysOnly:!0},function(key){var path=decode$1(key[1]),docKey=new DocumentKey(path);result=result.add(docKey)}).next(function(){return result})},IndexedDbQueryCache.prototype.containsKey=function(txn,key){var path=encode(key.path),range=IDBKeyRange.bound([path],[immediateSuccessor(path)],!1,!0),count=0;return documentTargetStore(txn).iterate({index:DbTargetDocument.documentTargetsIndex,keysOnly:!0,range:range},function(_a,_,control){var targetId=_a[0],path=_a[1];0!==targetId&&(count++,control.done())}).next(function(){return 0<count})},IndexedDbQueryCache.prototype.getQueryDataForTarget=function(transaction,targetId){var _this=this;return targetsStore(transaction).get(targetId).next(function(found){return found?_this.serializer.fromDbTarget(found):null})},IndexedDbQueryCache}(),LocalSerializer=function(){function LocalSerializer(remoteSerializer){this.remoteSerializer=remoteSerializer}return LocalSerializer.prototype.fromDbRemoteDocument=function(remoteDoc){if(remoteDoc.document)return this.remoteSerializer.fromDocument(remoteDoc.document,!!remoteDoc.hasCommittedMutations);if(remoteDoc.noDocument){var key=DocumentKey.fromSegments(remoteDoc.noDocument.path),version=this.fromDbTimestamp(remoteDoc.noDocument.readTime);return new NoDocument(key,version,{hasCommittedMutations:!!remoteDoc.hasCommittedMutations})}if(remoteDoc.unknownDocument){var key=DocumentKey.fromSegments(remoteDoc.unknownDocument.path),version=this.fromDbTimestamp(remoteDoc.unknownDocument.version);return new UnknownDocument(key,version)}return fail('Unexpected DbRemoteDocument')},LocalSerializer.prototype.toDbRemoteDocument=function(maybeDoc){if(maybeDoc instanceof Document){var doc=this.remoteSerializer.toDocument(maybeDoc),hasCommittedMutations=maybeDoc.hasCommittedMutations;return new DbRemoteDocument(null,null,doc,hasCommittedMutations)}if(maybeDoc instanceof NoDocument){var path=maybeDoc.key.path.toArray(),readTime=this.toDbTimestamp(maybeDoc.version),hasCommittedMutations=maybeDoc.hasCommittedMutations;return new DbRemoteDocument(null,new DbNoDocument(path,readTime),null,hasCommittedMutations)}if(maybeDoc instanceof UnknownDocument){var path=maybeDoc.key.path.toArray(),readTime=this.toDbTimestamp(maybeDoc.version);return new DbRemoteDocument(new DbUnknownDocument(path,readTime),null,null,!0)}return fail('Unexpected MaybeDocumment')},LocalSerializer.prototype.toDbTimestamp=function(snapshotVersion){var timestamp=snapshotVersion.toTimestamp();return new DbTimestamp(timestamp.seconds,timestamp.nanoseconds)},LocalSerializer.prototype.fromDbTimestamp=function(dbTimestamp){var timestamp=new Timestamp(dbTimestamp.seconds,dbTimestamp.nanoseconds);return SnapshotVersion.fromTimestamp(timestamp)},LocalSerializer.prototype.toDbMutationBatch=function(userId,batch){var _this=this,serializedMutations=batch.mutations.map(function(m){return _this.remoteSerializer.toMutation(m)});return new DbMutationBatch(userId,batch.batchId,batch.localWriteTime.toMillis(),serializedMutations)},LocalSerializer.prototype.fromDbMutationBatch=function(dbBatch){var _this=this,mutations=dbBatch.mutations.map(function(m){return _this.remoteSerializer.fromMutation(m)}),timestamp=Timestamp.fromMillis(dbBatch.localWriteTimeMs);return new MutationBatch(dbBatch.batchId,timestamp,mutations)},LocalSerializer.prototype.toDbResourcePaths=function(keys){var encodedKeys=[];return keys.forEach(function(key){encodedKeys.push(encode(key.path))}),encodedKeys},LocalSerializer.prototype.fromDbResourcePaths=function(encodedPaths){for(var keys=documentKeySet(),_i=0,encodedPaths_1=encodedPaths,documentKey;_i<encodedPaths_1.length;_i++)documentKey=encodedPaths_1[_i],keys=keys.add(new DocumentKey(decode$1(documentKey)));return keys},LocalSerializer.prototype.fromDbTarget=function(dbTarget){var version=this.fromDbTimestamp(dbTarget.readTime),query;return query=isDocumentQuery(dbTarget.query)?this.remoteSerializer.fromDocumentsTarget(dbTarget.query):this.remoteSerializer.fromQueryTarget(dbTarget.query),new QueryData(query,dbTarget.targetId,QueryPurpose.Listen,dbTarget.lastListenSequenceNumber,version,dbTarget.resumeToken)},LocalSerializer.prototype.toDbTarget=function(queryData){assert(QueryPurpose.Listen===queryData.purpose,'Only queries with purpose '+QueryPurpose.Listen+' may be stored, got '+queryData.purpose);var dbTimestamp=this.toDbTimestamp(queryData.snapshotVersion),queryProto;queryProto=queryData.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(queryData.query):this.remoteSerializer.toQueryTarget(queryData.query);var resumeToken;return queryData.resumeToken instanceof Uint8Array?(assert('YES'===process.env.USE_MOCK_PERSISTENCE,'Persisting non-string stream tokens is only supported with mock persistence .'),resumeToken=queryData.resumeToken.toString()):resumeToken=queryData.resumeToken,new DbTarget(queryData.targetId,queryData.query.canonicalId(),dbTimestamp,resumeToken,queryData.sequenceNumber,queryProto)},LocalSerializer}(),RollingSequenceNumberBuffer=function(){function RollingSequenceNumberBuffer(maxElements){this.maxElements=maxElements,this.buffer=new SortedSet(bufferEntryComparator),this.previousIndex=0}return RollingSequenceNumberBuffer.prototype.nextIndex=function(){return++this.previousIndex},RollingSequenceNumberBuffer.prototype.addElement=function(sequenceNumber){var entry=[sequenceNumber,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(entry);else{var highestValue=this.buffer.last();0>bufferEntryComparator(entry,highestValue)&&(this.buffer=this.buffer.delete(highestValue).add(entry))}},Object.defineProperty(RollingSequenceNumberBuffer.prototype,'maxValue',{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),RollingSequenceNumberBuffer}(),LruGarbageCollector=function(){function LruGarbageCollector(delegate){this.delegate=delegate}return LruGarbageCollector.prototype.calculateTargetCount=function(txn,percentile){return this.delegate.getTargetCount(txn).next(function(targetCount){return _Mathfloor(percentile/100*targetCount)})},LruGarbageCollector.prototype.nthSequenceNumber=function(txn,n){var _this=this;if(0===n)return PersistencePromise.resolve(ListenSequence.INVALID);var buffer=new RollingSequenceNumberBuffer(n);return this.delegate.forEachTarget(txn,function(target){return buffer.addElement(target.sequenceNumber)}).next(function(){return _this.delegate.forEachOrphanedDocumentSequenceNumber(txn,function(sequenceNumber){return buffer.addElement(sequenceNumber)})}).next(function(){return buffer.maxValue})},LruGarbageCollector.prototype.removeTargets=function(txn,upperBound,activeTargetIds){return this.delegate.removeTargets(txn,upperBound,activeTargetIds)},LruGarbageCollector.prototype.removeOrphanedDocuments=function(txn,upperBound){return this.delegate.removeOrphanedDocuments(txn,upperBound)},LruGarbageCollector}(),PersistenceTransaction=function(){return function PersistenceTransaction(){}}(),LOG_TAG$2='IndexedDbPersistence',MAX_CLIENT_AGE_MS=1e3*(60*30),MAX_PRIMARY_ELIGIBLE_AGE_MS=5e3,PRIMARY_LEASE_LOST_ERROR_MSG='The current tab is not in the required state to perform this operation. '+'It might be necessary to refresh the browser tab.',PRIMARY_LEASE_EXCLUSIVE_ERROR_MSG='Another tab has exclusive access to the persistence layer. '+'To allow shared access, make sure to invoke '+'`enablePersistence()` with `experimentalTabSynchronization:true` in all tabs.',IndexedDbTransaction=function(_super){function IndexedDbTransaction(simpleDbTransaction,currentSequenceNumber){var _this=_super.call(this)||this;return _this.simpleDbTransaction=simpleDbTransaction,_this.currentSequenceNumber=currentSequenceNumber,_this}return tslib_1.__extends(IndexedDbTransaction,_super),IndexedDbTransaction}(PersistenceTransaction),IndexedDbPersistence=function(){function IndexedDbPersistence(persistenceKey,clientId,platform,queue,serializer,multiClientParams){if(this.persistenceKey=persistenceKey,this.clientId=clientId,this.queue=queue,this.multiClientParams=multiClientParams,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=_NumberNEGATIVE_INFINITY,this.primaryStateListener=function(){return Promise.resolve()},!IndexedDbPersistence.isAvailable())throw new FirestoreError(Code.UNIMPLEMENTED,'This platform is either missing'+' IndexedDB or is known to have an incomplete implementation. Offline'+' persistence has been disabled.');if(this.referenceDelegate=new IndexedDbLruDelegate(this),this.dbName=persistenceKey+IndexedDbPersistence.MAIN_DATABASE,this.serializer=new LocalSerializer(serializer),this.document=platform.document,this.allowTabSynchronization=void 0!==multiClientParams,this.queryCache=new IndexedDbQueryCache(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new IndexedDbRemoteDocumentCache(this.serializer,this.allowTabSynchronization),platform.window&&platform.window.localStorage)this.window=platform.window,this.webStorage=this.window.localStorage;else throw new FirestoreError(Code.UNIMPLEMENTED,'IndexedDB persistence is only available on platforms that support LocalStorage.')}return IndexedDbPersistence.getStore=function(txn,store){if(txn instanceof IndexedDbTransaction)return SimpleDb.getStore(txn.simpleDbTransaction,store);throw fail('IndexedDbPersistence must use instances of IndexedDbTransaction')},IndexedDbPersistence.createIndexedDbPersistence=function(persistenceKey,clientId,platform,queue,serializer){return tslib_1.__awaiter(this,void 0,void 0,function(){var persistence;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return persistence=new IndexedDbPersistence(persistenceKey,clientId,platform,queue,serializer),[4,persistence.start()];case 1:return _a.sent(),[2,persistence];}})})},IndexedDbPersistence.createMultiClientIndexedDbPersistence=function(persistenceKey,clientId,platform,queue,serializer,multiClientParams){return tslib_1.__awaiter(this,void 0,void 0,function(){var persistence;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return persistence=new IndexedDbPersistence(persistenceKey,clientId,platform,queue,serializer,multiClientParams),[4,persistence.start()];case 1:return _a.sent(),[2,persistence];}})})},IndexedDbPersistence.prototype.start=function(){var _this=this;return assert(!this.started,'IndexedDbPersistence double-started!'),assert(null!==this.window,'Expected \'window\' to be defined'),SimpleDb.openOrCreate(this.dbName,SCHEMA_VERSION,new SchemaConverter(this.serializer)).then(function(db){_this.simpleDb=db}).then(function(){return _this.startRemoteDocumentCache()}).then(function(){return _this.attachVisibilityHandler(),_this.attachWindowUnloadHook(),_this.updateClientMetadataAndTryBecomePrimary().then(function(){return _this.scheduleClientMetadataAndPrimaryLeaseRefreshes()})}).then(function(){return _this.simpleDb.runTransaction('readonly',[DbTargetGlobal.store],function(txn){return getHighestListenSequenceNumber(txn).next(function(highestListenSequenceNumber){var sequenceNumberSyncer=_this.multiClientParams?_this.multiClientParams.sequenceNumberSyncer:void 0;_this.listenSequence=new ListenSequence(highestListenSequenceNumber,sequenceNumberSyncer)})})}).then(function(){_this._started=!0}).catch(function(reason){return _this.simpleDb&&_this.simpleDb.close(),Promise.reject(reason)})},IndexedDbPersistence.prototype.startRemoteDocumentCache=function(){var _this=this;return this.simpleDb.runTransaction('readonly',ALL_STORES,function(txn){return _this.remoteDocumentCache.start(txn)})},IndexedDbPersistence.prototype.setPrimaryStateListener=function(primaryStateListener){var _this=this;return this.primaryStateListener=function(primaryState){return tslib_1.__awaiter(_this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return this.started?[2,primaryStateListener(primaryState)]:[2]})})},primaryStateListener(this.isPrimary)},IndexedDbPersistence.prototype.setNetworkEnabled=function(networkEnabled){var _this=this;this.networkEnabled!==networkEnabled&&(this.networkEnabled=networkEnabled,this.queue.enqueueAndForget(function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:_a.sent(),_a.label=2;case 2:return[2];}})})}))},IndexedDbPersistence.prototype.updateClientMetadataAndTryBecomePrimary=function(){var _this=this;return this.simpleDb.runTransaction('readwrite',ALL_STORES,function(txn){var metadataStore=clientMetadataStore(txn);return metadataStore.put(new DbClientMetadata(_this.clientId,Date.now(),_this.networkEnabled,_this.inForeground,_this.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(_this.isPrimary)return _this.verifyPrimaryLease(txn).next(function(success){success||(_this.isPrimary=!1,_this.queue.enqueueAndForget(function(){return _this.primaryStateListener(!1)}))})}).next(function(){return _this.canActAsPrimary(txn)}).next(function(canActAsPrimary){var wasPrimary=_this.isPrimary;return(_this.isPrimary=canActAsPrimary,wasPrimary!==_this.isPrimary&&_this.queue.enqueueAndForget(function(){return _this.primaryStateListener(_this.isPrimary)}),wasPrimary&&!_this.isPrimary)?_this.releasePrimaryLeaseIfHeld(txn):_this.isPrimary?_this.acquireOrExtendPrimaryLease(txn):void 0})})},IndexedDbPersistence.prototype.verifyPrimaryLease=function(txn){var _this=this,store=primaryClientStore(txn);return store.get(DbPrimaryClient.key).next(function(primaryClient){return PersistencePromise.resolve(_this.isLocalClient(primaryClient))})},IndexedDbPersistence.prototype.removeClientMetadata=function(txn){var metadataStore=clientMetadataStore(txn);return metadataStore.delete(this.clientId)},IndexedDbPersistence.prototype.maybeGarbageCollectMultiClientState=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this,activeClients_1,inactiveClients_1;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,MAX_CLIENT_AGE_MS)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),inactiveClients_1=[],[4,this.runTransaction('maybeGarbageCollectMultiClientState','readwrite-primary',function(txn){var metadataStore=IndexedDbPersistence.getStore(txn,DbClientMetadata.store);return metadataStore.loadAll().next(function(existingClients){activeClients_1=_this.filterActiveClients(existingClients,MAX_CLIENT_AGE_MS),inactiveClients_1=existingClients.filter(function(client){return-1===activeClients_1.indexOf(client)})}).next(function(){return PersistencePromise.forEach(inactiveClients_1,function(inactiveClient){return metadataStore.delete(inactiveClient.clientId)})}).next(function(){if(activeClients_1=activeClients_1.filter(function(client){return client.clientId!==_this.clientId}),0<activeClients_1.length){var processedChangeIds=activeClients_1.map(function(client){return client.lastProcessedDocumentChangeId||0}),oldestChangeId=_Mathmin.apply(Math,processedChangeIds);return _this.remoteDocumentCache.removeDocumentChangesThroughChangeId(txn,oldestChangeId)}})})]);case 1:_a.sent(),inactiveClients_1.forEach(function(inactiveClient){_this.window.localStorage.removeItem(_this.zombiedClientLocalStorageKey(inactiveClient.clientId))}),_a.label=2;case 2:return[2];}})})},IndexedDbPersistence.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var _this=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(TimerId.ClientMetadataRefresh,4e3,function(){return _this.updateClientMetadataAndTryBecomePrimary().then(function(){return _this.maybeGarbageCollectMultiClientState()}).then(function(){return _this.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},IndexedDbPersistence.prototype.isLocalClient=function(client){return!!client&&client.ownerId===this.clientId},IndexedDbPersistence.prototype.canActAsPrimary=function(txn){var _this=this,store=primaryClientStore(txn);return store.get(DbPrimaryClient.key).next(function(currentPrimary){var currentLeaseIsValid=null!==currentPrimary&&_this.isWithinAge(currentPrimary.leaseTimestampMs,MAX_PRIMARY_ELIGIBLE_AGE_MS)&&!_this.isClientZombied(currentPrimary.ownerId);if(currentLeaseIsValid){if(_this.isLocalClient(currentPrimary)&&_this.networkEnabled)return!0;if(!_this.isLocalClient(currentPrimary)){if(!currentPrimary.allowTabSynchronization)throw new FirestoreError(Code.FAILED_PRECONDITION,PRIMARY_LEASE_EXCLUSIVE_ERROR_MSG);return!1}}return _this.networkEnabled&&_this.inForeground||clientMetadataStore(txn).loadAll().next(function(existingClients){var preferredCandidate=_this.filterActiveClients(existingClients,MAX_PRIMARY_ELIGIBLE_AGE_MS).find(function(otherClient){if(_this.clientId!==otherClient.clientId){var otherClientHasBetterNetworkState=!_this.networkEnabled&&otherClient.networkEnabled,otherClientHasBetterVisibility=!_this.inForeground&&otherClient.inForeground,otherClientHasSameNetworkState=_this.networkEnabled===otherClient.networkEnabled;if(otherClientHasBetterNetworkState||otherClientHasBetterVisibility&&otherClientHasSameNetworkState)return!0}return!1});return void 0===preferredCandidate})}).next(function(canActAsPrimary){return _this.isPrimary!==canActAsPrimary&&debug(LOG_TAG$2,'Client '+(canActAsPrimary?'is':'is not')+' eligible for a primary lease.'),canActAsPrimary})},IndexedDbPersistence.prototype.shutdown=function(deleteData){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction('readwrite',[DbPrimaryClient.store,DbClientMetadata.store],function(txn){return _this.releasePrimaryLeaseIfHeld(txn).next(function(){return _this.removeClientMetadata(txn)})})];case 1:return _a.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),deleteData?[4,SimpleDb.delete(this.dbName)]:[3,3];case 2:_a.sent(),_a.label=3;case 3:return[2];}})})},IndexedDbPersistence.prototype.filterActiveClients=function(clients,activityThresholdMs){var _this=this;return clients.filter(function(client){return _this.isWithinAge(client.updateTimeMs,activityThresholdMs)&&!_this.isClientZombied(client.clientId)})},IndexedDbPersistence.prototype.getActiveClients=function(){var _this=this;return this.simpleDb.runTransaction('readonly',[DbClientMetadata.store],function(txn){return clientMetadataStore(txn).loadAll().next(function(clients){return _this.filterActiveClients(clients,MAX_CLIENT_AGE_MS).map(function(clientMetadata){return clientMetadata.clientId})})})},Object.defineProperty(IndexedDbPersistence.prototype,'started',{get:function(){return this._started},enumerable:!0,configurable:!0}),IndexedDbPersistence.prototype.getMutationQueue=function(user){return assert(this.started,'Cannot initialize MutationQueue before persistence is started.'),IndexedDbMutationQueue.forUser(user,this.serializer,this.referenceDelegate)},IndexedDbPersistence.prototype.getQueryCache=function(){return assert(this.started,'Cannot initialize QueryCache before persistence is started.'),this.queryCache},IndexedDbPersistence.prototype.getRemoteDocumentCache=function(){return assert(this.started,'Cannot initialize RemoteDocumentCache before persistence is started.'),this.remoteDocumentCache},IndexedDbPersistence.prototype.runTransaction=function(action,mode,transactionOperation){var _this=this;return debug(LOG_TAG$2,'Starting transaction:',action),this.simpleDb.runTransaction('readonly'===mode?'readonly':'readwrite',ALL_STORES,function(simpleDbTxn){return'readwrite-primary'===mode?_this.verifyPrimaryLease(simpleDbTxn).next(function(success){if(!success)throw error('Failed to obtain primary lease for action \''+action+'\'.'),_this.isPrimary=!1,_this.queue.enqueueAndForget(function(){return _this.primaryStateListener(!1)}),new FirestoreError(Code.FAILED_PRECONDITION,PRIMARY_LEASE_LOST_ERROR_MSG);return transactionOperation(new IndexedDbTransaction(simpleDbTxn,_this.listenSequence.next()))}).next(function(result){return _this.acquireOrExtendPrimaryLease(simpleDbTxn).next(function(){return result})}):_this.verifyAllowTabSynchronization(simpleDbTxn).next(function(){return transactionOperation(new IndexedDbTransaction(simpleDbTxn,_this.listenSequence.next()))})})},IndexedDbPersistence.prototype.verifyAllowTabSynchronization=function(txn){var _this=this,store=primaryClientStore(txn);return store.get(DbPrimaryClient.key).next(function(currentPrimary){var currentLeaseIsValid=null!==currentPrimary&&_this.isWithinAge(currentPrimary.leaseTimestampMs,MAX_PRIMARY_ELIGIBLE_AGE_MS)&&!_this.isClientZombied(currentPrimary.ownerId);if(currentLeaseIsValid&&!_this.isLocalClient(currentPrimary)&&!currentPrimary.allowTabSynchronization)throw new FirestoreError(Code.FAILED_PRECONDITION,PRIMARY_LEASE_EXCLUSIVE_ERROR_MSG)})},IndexedDbPersistence.prototype.acquireOrExtendPrimaryLease=function(txn){var newPrimary=new DbPrimaryClient(this.clientId,this.allowTabSynchronization,Date.now());return primaryClientStore(txn).put(DbPrimaryClient.key,newPrimary)},IndexedDbPersistence.isAvailable=function(){return SimpleDb.isAvailable()},IndexedDbPersistence.buildStoragePrefix=function(databaseInfo){var database=databaseInfo.databaseId.projectId;return databaseInfo.databaseId.isDefaultDatabase||(database+='.'+databaseInfo.databaseId.database),'firestore/'+databaseInfo.persistenceKey+'/'+database+'/'},IndexedDbPersistence.prototype.releasePrimaryLeaseIfHeld=function(txn){var _this=this,store=primaryClientStore(txn);return store.get(DbPrimaryClient.key).next(function(primaryClient){return _this.isLocalClient(primaryClient)?(debug(LOG_TAG$2,'Releasing primary lease.'),store.delete(DbPrimaryClient.key)):PersistencePromise.resolve()})},IndexedDbPersistence.prototype.isWithinAge=function(updateTimeMs,maxAgeMs){var now=Date.now(),maxAcceptable=now;return!(updateTimeMs<now-maxAgeMs)&&(!(updateTimeMs>maxAcceptable)||(error('Detected an update time that is in the future: '+updateTimeMs+' > '+maxAcceptable),!1))},IndexedDbPersistence.prototype.attachVisibilityHandler=function(){var _this=this;null!==this.document&&'function'==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){_this.queue.enqueueAndForget(function(){return _this.inForeground='visible'===_this.document.visibilityState,_this.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener('visibilitychange',this.documentVisibilityHandler),this.inForeground='visible'===this.document.visibilityState)},IndexedDbPersistence.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(assert(null!==this.document&&'function'==typeof this.document.addEventListener,'Expected \'document.addEventListener\' to be a function'),this.document.removeEventListener('visibilitychange',this.documentVisibilityHandler),this.documentVisibilityHandler=null)},IndexedDbPersistence.prototype.attachWindowUnloadHook=function(){var _this=this;'function'==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){_this.markClientZombied(),_this.queue.enqueueAndForget(function(){return _this.shutdown()})},this.window.addEventListener('unload',this.windowUnloadHandler))},IndexedDbPersistence.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(assert('function'==typeof this.window.removeEventListener,'Expected \'window.removeEventListener\' to be a function'),this.window.removeEventListener('unload',this.windowUnloadHandler),this.windowUnloadHandler=null)},IndexedDbPersistence.prototype.isClientZombied=function(clientId){try{var isZombied=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(clientId));return debug(LOG_TAG$2,'Client \''+clientId+'\' '+(isZombied?'is':'is not')+' zombied in LocalStorage'),isZombied}catch(e){return error(LOG_TAG$2,'Failed to get zombied client id.',e),!1}},IndexedDbPersistence.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),Date.now()+'')}catch(e){error('Failed to set zombie client id.',e)}},IndexedDbPersistence.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}},IndexedDbPersistence.prototype.zombiedClientLocalStorageKey=function(clientId){return'firestore_zombie'+'_'+this.persistenceKey+'_'+clientId},IndexedDbPersistence.MAIN_DATABASE='main',IndexedDbPersistence}(),IndexedDbLruDelegate=function(){function IndexedDbLruDelegate(db){this.db=db,this.garbageCollector=new LruGarbageCollector(this)}return IndexedDbLruDelegate.prototype.getTargetCount=function(txn){return this.db.getQueryCache().getQueryCount(txn)},IndexedDbLruDelegate.prototype.forEachTarget=function(txn,f){return this.db.getQueryCache().forEachTarget(txn,f)},IndexedDbLruDelegate.prototype.forEachOrphanedDocumentSequenceNumber=function(txn,f){return this.forEachOrphanedDocument(txn,function(docKey,sequenceNumber){return f(sequenceNumber)})},IndexedDbLruDelegate.prototype.setInMemoryPins=function(inMemoryPins){this.inMemoryPins=inMemoryPins},IndexedDbLruDelegate.prototype.addReference=function(txn,key){return writeSentinelKey(txn,key)},IndexedDbLruDelegate.prototype.removeReference=function(txn,key){return writeSentinelKey(txn,key)},IndexedDbLruDelegate.prototype.removeTargets=function(txn,upperBound,activeTargetIds){return this.db.getQueryCache().removeTargets(txn,upperBound,activeTargetIds)},IndexedDbLruDelegate.prototype.removeMutationReference=function(txn,key){return writeSentinelKey(txn,key)},IndexedDbLruDelegate.prototype.isPinned=function(txn,docKey){return this.inMemoryPins.containsKey(docKey)?PersistencePromise.resolve(!0):mutationQueuesContainKey(txn,docKey)},IndexedDbLruDelegate.prototype.removeOrphanedDocuments=function(txn,upperBound){var _this=this,count=0,bytesRemoved=0,promises=[],iteration=this.forEachOrphanedDocument(txn,function(docKey,sequenceNumber){if(sequenceNumber<=upperBound){var p=_this.isPinned(txn,docKey).next(function(isPinned){if(!isPinned)return count++,_this.removeOrphanedDocument(txn,docKey).next(function(documentBytes){bytesRemoved+=documentBytes})});promises.push(p)}});return iteration.next(function(){return PersistencePromise.waitFor(promises)}).next(function(){return _this.db.getRemoteDocumentCache().updateSize(txn,-bytesRemoved)}).next(function(){return count})},IndexedDbLruDelegate.prototype.removeOrphanedDocument=function(txn,docKey){var totalBytesRemoved=0,documentCache=this.db.getRemoteDocumentCache();return PersistencePromise.waitFor([documentTargetStore(txn).delete(sentinelKey(docKey)),documentCache.removeEntry(txn,docKey).next(function(bytesRemoved){totalBytesRemoved+=bytesRemoved})]).next(function(){return totalBytesRemoved})},IndexedDbLruDelegate.prototype.removeTarget=function(txn,queryData){var updated=queryData.copy({sequenceNumber:txn.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(txn,updated)},IndexedDbLruDelegate.prototype.updateLimboDocument=function(txn,key){return writeSentinelKey(txn,key)},IndexedDbLruDelegate.prototype.forEachOrphanedDocument=function(txn,f){var store=documentTargetStore(txn),nextToReport=ListenSequence.INVALID,nextPath;return store.iterate({index:DbTargetDocument.documentTargetsIndex},function(_a,_b){var targetId=_a[0],docKey=_a[1],path=_b.path,sequenceNumber=_b.sequenceNumber;0===targetId?(nextToReport!==ListenSequence.INVALID&&f(new DocumentKey(decode$1(nextPath)),nextToReport),nextToReport=sequenceNumber,nextPath=path):nextToReport=ListenSequence.INVALID}).next(function(){nextToReport!==ListenSequence.INVALID&&f(new DocumentKey(decode$1(nextPath)),nextToReport)})},IndexedDbLruDelegate}(),LocalDocumentsView=function(){function LocalDocumentsView(remoteDocumentCache,mutationQueue){this.remoteDocumentCache=remoteDocumentCache,this.mutationQueue=mutationQueue}return LocalDocumentsView.prototype.getDocument=function(transaction,key){var _this=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(transaction,key).next(function(batches){return _this.getDocumentInternal(transaction,key,batches)})},LocalDocumentsView.prototype.getDocumentInternal=function(transaction,key,inBatches){return this.remoteDocumentCache.getEntry(transaction,key).next(function(doc){for(var _i=0,inBatches_1=inBatches,batch;_i<inBatches_1.length;_i++)batch=inBatches_1[_i],doc=batch.applyToLocalView(key,doc);return doc})},LocalDocumentsView.prototype.getDocuments=function(transaction,keys){var _this=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(transaction,keys).next(function(batches){var promises=[],results=maybeDocumentMap();return keys.forEach(function(key){promises.push(_this.getDocumentInternal(transaction,key,batches).next(function(maybeDoc){maybeDoc||(maybeDoc=new NoDocument(key,SnapshotVersion.forDeletedDoc())),results=results.insert(key,maybeDoc)}))}),PersistencePromise.waitFor(promises).next(function(){return results})})},LocalDocumentsView.prototype.getDocumentsMatchingQuery=function(transaction,query){return DocumentKey.isDocumentKey(query.path)?this.getDocumentsMatchingDocumentQuery(transaction,query.path):this.getDocumentsMatchingCollectionQuery(transaction,query)},LocalDocumentsView.prototype.getDocumentsMatchingDocumentQuery=function(transaction,docPath){return this.getDocument(transaction,new DocumentKey(docPath)).next(function(maybeDoc){var result=documentMap();return maybeDoc instanceof Document&&(result=result.insert(maybeDoc.key,maybeDoc)),result})},LocalDocumentsView.prototype.getDocumentsMatchingCollectionQuery=function(transaction,query){var _this=this,results;return this.remoteDocumentCache.getDocumentsMatchingQuery(transaction,query).next(function(queryResults){return results=queryResults,_this.mutationQueue.getAllMutationBatchesAffectingQuery(transaction,query)}).next(function(matchingMutationBatches){for(var _i=0,matchingMutationBatches_1=matchingMutationBatches,batch;_i<matchingMutationBatches_1.length;_i++){batch=matchingMutationBatches_1[_i];for(var _a=0,_b=batch.mutations;_a<_b.length;_a++){var mutation=_b[_a],key=mutation.key;if(query.path.isImmediateParentOf(key.path)){var baseDoc=results.get(key),mutatedDoc=mutation.applyToLocalView(baseDoc,baseDoc,batch.localWriteTime);results=mutatedDoc instanceof Document?results.insert(key,mutatedDoc):results.remove(key)}}}}).next(function(){return results.forEach(function(key,doc){query.matches(doc)||(results=results.remove(key))}),results})},LocalDocumentsView}(),ReferenceSet=function(){function ReferenceSet(){this.refsByKey=new SortedSet(DocReference.compareByKey),this.refsByTarget=new SortedSet(DocReference.compareByTargetId)}return ReferenceSet.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},ReferenceSet.prototype.addReference=function(key,id){var ref=new DocReference(key,id);this.refsByKey=this.refsByKey.add(ref),this.refsByTarget=this.refsByTarget.add(ref)},ReferenceSet.prototype.addReferences=function(keys,id){var _this=this;keys.forEach(function(key){return _this.addReference(key,id)})},ReferenceSet.prototype.removeReference=function(key,id){this.removeRef(new DocReference(key,id))},ReferenceSet.prototype.removeReferences=function(keys,id){var _this=this;keys.forEach(function(key){return _this.removeReference(key,id)})},ReferenceSet.prototype.removeReferencesForId=function(id){var _this=this,emptyKey=DocumentKey.EMPTY,startRef=new DocReference(emptyKey,id),endRef=new DocReference(emptyKey,id+1),keys=[];return this.refsByTarget.forEachInRange([startRef,endRef],function(ref){_this.removeRef(ref),keys.push(ref.key)}),keys},ReferenceSet.prototype.removeAllReferences=function(){var _this=this;this.refsByKey.forEach(function(ref){return _this.removeRef(ref)})},ReferenceSet.prototype.removeRef=function(ref){this.refsByKey=this.refsByKey.delete(ref),this.refsByTarget=this.refsByTarget.delete(ref)},ReferenceSet.prototype.referencesForId=function(id){var emptyKey=DocumentKey.EMPTY,startRef=new DocReference(emptyKey,id),endRef=new DocReference(emptyKey,id+1),keys=documentKeySet();return this.refsByTarget.forEachInRange([startRef,endRef],function(ref){keys=keys.add(ref.key)}),keys},ReferenceSet.prototype.containsKey=function(key){var ref=new DocReference(key,0),firstRef=this.refsByKey.firstAfterOrEqual(ref);return null!==firstRef&&key.isEqual(firstRef.key)},ReferenceSet}(),DocReference=function(){function DocReference(key,targetOrBatchId){this.key=key,this.targetOrBatchId=targetOrBatchId}return DocReference.compareByKey=function(left,right){return DocumentKey.comparator(left.key,right.key)||primitiveComparator(left.targetOrBatchId,right.targetOrBatchId)},DocReference.compareByTargetId=function(left,right){return primitiveComparator(left.targetOrBatchId,right.targetOrBatchId)||DocumentKey.comparator(left.key,right.key)},DocReference}(),LocalStore=function(){function LocalStore(persistence,initialUser){this.persistence=persistence,this.localViewReferences=new ReferenceSet,this.queryDataByTarget={},assert(persistence.started,'LocalStore was passed an unstarted persistence implementation'),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=persistence.getMutationQueue(initialUser),this.remoteDocuments=persistence.getRemoteDocumentCache(),this.queryCache=persistence.getQueryCache(),this.localDocuments=new LocalDocumentsView(this.remoteDocuments,this.mutationQueue)}return LocalStore.prototype.handleUserChange=function(user){var _this=this;return this.persistence.runTransaction('Handle user change','readonly',function(txn){var oldBatches;return _this.mutationQueue.getAllMutationBatches(txn).next(function(promisedOldBatches){return oldBatches=promisedOldBatches,_this.mutationQueue=_this.persistence.getMutationQueue(user),_this.localDocuments=new LocalDocumentsView(_this.remoteDocuments,_this.mutationQueue),_this.mutationQueue.getAllMutationBatches(txn)}).next(function(newBatches){for(var removedBatchIds=[],addedBatchIds=[],changedKeys=documentKeySet(),_i=0,oldBatches_1=oldBatches,batch;_i<oldBatches_1.length;_i++){batch=oldBatches_1[_i],removedBatchIds.push(batch.batchId);for(var _a=0,_b=batch.mutations,mutation;_a<_b.length;_a++)mutation=_b[_a],changedKeys=changedKeys.add(mutation.key)}for(var _c=0,newBatches_1=newBatches,batch;_c<newBatches_1.length;_c++){batch=newBatches_1[_c],addedBatchIds.push(batch.batchId);for(var _d=0,_e=batch.mutations,mutation;_d<_e.length;_d++)mutation=_e[_d],changedKeys=changedKeys.add(mutation.key)}return _this.localDocuments.getDocuments(txn,changedKeys).next(function(affectedDocuments){return{affectedDocuments:affectedDocuments,removedBatchIds:removedBatchIds,addedBatchIds:addedBatchIds}})})})},LocalStore.prototype.localWrite=function(mutations){var _this=this;return this.persistence.runTransaction('Locally write mutations','readwrite',function(txn){var localWriteTime=Timestamp.now(),batch;return _this.mutationQueue.addMutationBatch(txn,localWriteTime,mutations).next(function(promisedBatch){batch=promisedBatch;var keys=batch.keys();return _this.localDocuments.getDocuments(txn,keys)}).next(function(changedDocuments){return{batchId:batch.batchId,changes:changedDocuments}})})},LocalStore.prototype.lookupMutationDocuments=function(batchId){var _this=this;return this.persistence.runTransaction('Lookup mutation documents','readonly',function(txn){return _this.mutationQueue.lookupMutationKeys(txn,batchId).next(function(keys){return keys?_this.localDocuments.getDocuments(txn,keys):PersistencePromise.resolve(null)})})},LocalStore.prototype.acknowledgeBatch=function(batchResult){var _this=this;return this.persistence.runTransaction('Acknowledge batch','readwrite-primary',function(txn){var affected=batchResult.batch.keys(),documentBuffer=_this.remoteDocuments.newChangeBuffer();return _this.mutationQueue.acknowledgeBatch(txn,batchResult.batch,batchResult.streamToken).next(function(){return _this.applyWriteToRemoteDocuments(txn,batchResult,documentBuffer)}).next(function(){return documentBuffer.apply(txn)}).next(function(){return _this.mutationQueue.performConsistencyCheck(txn)}).next(function(){return _this.localDocuments.getDocuments(txn,affected)})})},LocalStore.prototype.rejectBatch=function(batchId){var _this=this;return this.persistence.runTransaction('Reject batch','readwrite-primary',function(txn){var affectedKeys;return _this.mutationQueue.lookupMutationBatch(txn,batchId).next(function(batch){return assert(null!==batch,'Attempt to reject nonexistent batch!'),affectedKeys=batch.keys(),_this.mutationQueue.removeMutationBatch(txn,batch)}).next(function(){return _this.mutationQueue.performConsistencyCheck(txn)}).next(function(){return _this.localDocuments.getDocuments(txn,affectedKeys)})})},LocalStore.prototype.getLastStreamToken=function(){var _this=this;return this.persistence.runTransaction('Get last stream token','readonly',function(txn){return _this.mutationQueue.getLastStreamToken(txn)})},LocalStore.prototype.setLastStreamToken=function(streamToken){var _this=this;return this.persistence.runTransaction('Set last stream token','readwrite-primary',function(txn){return _this.mutationQueue.setLastStreamToken(txn,streamToken)})},LocalStore.prototype.getLastRemoteSnapshotVersion=function(){var _this=this;return this.persistence.runTransaction('Get last remote snapshot version','readonly',function(txn){return _this.queryCache.getLastRemoteSnapshotVersion(txn)})},LocalStore.prototype.applyRemoteEvent=function(remoteEvent){var _this=this,documentBuffer=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction('Apply remote event','readwrite-primary',function(txn){var promises=[],authoritativeUpdates=documentKeySet();forEachNumber(remoteEvent.targetChanges,function(targetId,change){var queryData=_this.queryDataByTarget[targetId];if(queryData){change.addedDocuments.forEach(function(key){authoritativeUpdates=authoritativeUpdates.add(key)}),change.modifiedDocuments.forEach(function(key){authoritativeUpdates=authoritativeUpdates.add(key)}),promises.push(_this.queryCache.removeMatchingKeys(txn,change.removedDocuments,targetId).next(function(){return _this.queryCache.addMatchingKeys(txn,change.addedDocuments,targetId)}));var resumeToken=change.resumeToken;if(0<resumeToken.length){var oldQueryData=queryData;queryData=queryData.copy({resumeToken:resumeToken,snapshotVersion:remoteEvent.snapshotVersion}),_this.queryDataByTarget[targetId]=queryData,LocalStore.shouldPersistQueryData(oldQueryData,queryData,change)&&promises.push(_this.queryCache.updateQueryData(txn,queryData))}}});var changedDocKeys=documentKeySet();remoteEvent.documentUpdates.forEach(function(key,doc){changedDocKeys=changedDocKeys.add(key),promises.push(documentBuffer.getEntry(txn,key).next(function(existingDoc){null==existingDoc||doc.version.isEqual(SnapshotVersion.MIN)||authoritativeUpdates.has(doc.key)&&!existingDoc.hasPendingWrites||0<=doc.version.compareTo(existingDoc.version)?documentBuffer.addEntry(doc):debug('LocalStore','Ignoring outdated watch update for ',key,'. Current version:',existingDoc.version,' Watch version:',doc.version)})),remoteEvent.resolvedLimboDocuments.has(key)&&promises.push(_this.persistence.referenceDelegate.updateLimboDocument(txn,key))});var remoteVersion=remoteEvent.snapshotVersion;if(!remoteVersion.isEqual(SnapshotVersion.MIN)){var updateRemoteVersion=_this.queryCache.getLastRemoteSnapshotVersion(txn).next(function(lastRemoteVersion){return assert(0<=remoteVersion.compareTo(lastRemoteVersion),'Watch stream reverted to previous snapshot?? '+remoteVersion+' < '+lastRemoteVersion),_this.queryCache.setTargetsMetadata(txn,txn.currentSequenceNumber,remoteVersion)});promises.push(updateRemoteVersion)}return PersistencePromise.waitFor(promises).next(function(){return documentBuffer.apply(txn)}).next(function(){return _this.localDocuments.getDocuments(txn,changedDocKeys)})})},LocalStore.shouldPersistQueryData=function(oldQueryData,newQueryData,change){if(0===newQueryData.resumeToken.length)return!1;if(0===oldQueryData.resumeToken.length)return!0;var timeDelta=newQueryData.snapshotVersion.toMicroseconds()-oldQueryData.snapshotVersion.toMicroseconds();if(timeDelta>=this.RESUME_TOKEN_MAX_AGE_MICROS)return!0;var changes=change.addedDocuments.size+change.modifiedDocuments.size+change.removedDocuments.size;return 0<changes},LocalStore.prototype.notifyLocalViewChanges=function(viewChanges){var _this=this;return this.persistence.runTransaction('notifyLocalViewChanges','readwrite',function(txn){return PersistencePromise.forEach(viewChanges,function(viewChange){return _this.localViewReferences.addReferences(viewChange.addedKeys,viewChange.targetId),_this.localViewReferences.removeReferences(viewChange.removedKeys,viewChange.targetId),PersistencePromise.forEach(viewChange.removedKeys,function(key){return _this.persistence.referenceDelegate.removeReference(txn,key)})})})},LocalStore.prototype.nextMutationBatch=function(afterBatchId){var _this=this;return this.persistence.runTransaction('Get next mutation batch','readonly',function(txn){return void 0===afterBatchId&&(afterBatchId=BATCHID_UNKNOWN),_this.mutationQueue.getNextMutationBatchAfterBatchId(txn,afterBatchId)})},LocalStore.prototype.readDocument=function(key){var _this=this;return this.persistence.runTransaction('read document','readonly',function(txn){return _this.localDocuments.getDocument(txn,key)})},LocalStore.prototype.allocateQuery=function(query){var _this=this;return this.persistence.runTransaction('Allocate query','readwrite',function(txn){var queryData;return _this.queryCache.getQueryData(txn,query).next(function(cached){return cached?(queryData=cached,PersistencePromise.resolve()):_this.queryCache.allocateTargetId(txn).next(function(targetId){return queryData=new QueryData(query,targetId,QueryPurpose.Listen,txn.currentSequenceNumber),_this.queryCache.addQueryData(txn,queryData)})}).next(function(){return assert(!_this.queryDataByTarget[queryData.targetId],'Tried to allocate an already allocated query: '+query),_this.queryDataByTarget[queryData.targetId]=queryData,queryData})})},LocalStore.prototype.releaseQuery=function(query,keepPersistedQueryData){var _this=this,mode=keepPersistedQueryData?'readwrite':'readwrite-primary';return this.persistence.runTransaction('Release query',mode,function(txn){return _this.queryCache.getQueryData(txn,query).next(function(queryData){assert(null!=queryData,'Tried to release nonexistent query: '+query);var targetId=queryData.targetId,cachedQueryData=_this.queryDataByTarget[targetId],removed=_this.localViewReferences.removeReferencesForId(targetId);return delete _this.queryDataByTarget[targetId],keepPersistedQueryData?PersistencePromise.resolve():PersistencePromise.forEach(removed,function(key){return _this.persistence.referenceDelegate.removeReference(txn,key)}).next(function(){return _this.persistence.referenceDelegate.removeTarget(txn,cachedQueryData)})})})},LocalStore.prototype.executeQuery=function(query){var _this=this;return this.persistence.runTransaction('Execute query','readonly',function(txn){return _this.localDocuments.getDocumentsMatchingQuery(txn,query)})},LocalStore.prototype.remoteDocumentKeys=function(targetId){var _this=this;return this.persistence.runTransaction('Remote document keys','readonly',function(txn){return _this.queryCache.getMatchingKeysForTargetId(txn,targetId)})},LocalStore.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},LocalStore.prototype.removeCachedMutationBatchMetadata=function(batchId){this.mutationQueue.removeCachedMutationKeys(batchId)},LocalStore.prototype.setNetworkEnabled=function(networkEnabled){this.persistence.setNetworkEnabled(networkEnabled)},LocalStore.prototype.applyWriteToRemoteDocuments=function(txn,batchResult,documentBuffer){var _this=this,batch=batchResult.batch,docKeys=batch.keys(),promiseChain=PersistencePromise.resolve();return docKeys.forEach(function(docKey){promiseChain=promiseChain.next(function(){return documentBuffer.getEntry(txn,docKey)}).next(function(remoteDoc){var doc=remoteDoc,ackVersion=batchResult.docVersions.get(docKey);assert(null!==ackVersion,'ackVersions should contain every doc in the write.'),(!doc||0>doc.version.compareTo(ackVersion))&&(doc=batch.applyToRemoteDocument(docKey,doc,batchResult),doc?documentBuffer.addEntry(doc):assert(!remoteDoc,'Mutation batch '+batch+' applied to document '+remoteDoc+' resulted in null'))})}),promiseChain.next(function(){return _this.mutationQueue.removeMutationBatch(txn,batch)})},LocalStore.prototype.getQueryForTarget=function(targetId){var _this=this;return this.queryDataByTarget[targetId]?Promise.resolve(this.queryDataByTarget[targetId].query):this.persistence.runTransaction('Get query data','readonly',function(txn){return _this.queryCache.getQueryDataForTarget(txn,targetId).next(function(queryData){return queryData?queryData.query:null})})},LocalStore.prototype.getNewDocumentChanges=function(){var _this=this;return this.persistence.runTransaction('Get new document changes','readonly',function(txn){return _this.remoteDocuments.getNewDocumentChanges(txn)})},LocalStore.RESUME_TOKEN_MAX_AGE_MICROS=1e6*(60*5),LocalStore}(),MemoryMutationQueue=function(){function MemoryMutationQueue(referenceDelegate){this.referenceDelegate=referenceDelegate,this.mutationQueue=[],this.nextBatchId=1,this.highestAcknowledgedBatchId=BATCHID_UNKNOWN,this.lastStreamToken=emptyByteString(),this.batchesByDocumentKey=new SortedSet(DocReference.compareByKey)}return MemoryMutationQueue.prototype.checkEmpty=function(){return PersistencePromise.resolve(0===this.mutationQueue.length)},MemoryMutationQueue.prototype.acknowledgeBatch=function(transaction,batch,streamToken){var batchId=batch.batchId;assert(batchId>this.highestAcknowledgedBatchId,'Mutation batchIDs must be acknowledged in order');var batchIndex=this.indexOfExistingBatchId(batchId,'acknowledged');assert(0===batchIndex,'Can only acknowledge the first batch in the mutation queue');var check=this.mutationQueue[batchIndex];return assert(batchId===check.batchId,'Queue ordering failure: expected batch '+batchId+', got batch '+check.batchId),this.highestAcknowledgedBatchId=batchId,this.lastStreamToken=streamToken,PersistencePromise.resolve()},MemoryMutationQueue.prototype.getLastStreamToken=function(){return PersistencePromise.resolve(this.lastStreamToken)},MemoryMutationQueue.prototype.setLastStreamToken=function(transaction,streamToken){return this.lastStreamToken=streamToken,PersistencePromise.resolve()},MemoryMutationQueue.prototype.addMutationBatch=function(transaction,localWriteTime,mutations){assert(0!==mutations.length,'Mutation batches should not be empty');var batchId=this.nextBatchId;if(this.nextBatchId++,0<this.mutationQueue.length){var prior=this.mutationQueue[this.mutationQueue.length-1];assert(prior.batchId<batchId,'Mutation batchIDs must be monotonically increasing order')}var batch=new MutationBatch(batchId,localWriteTime,mutations);this.mutationQueue.push(batch);for(var _i=0,mutations_1=mutations,mutation;_i<mutations_1.length;_i++)mutation=mutations_1[_i],this.batchesByDocumentKey=this.batchesByDocumentKey.add(new DocReference(mutation.key,batchId));return PersistencePromise.resolve(batch)},MemoryMutationQueue.prototype.lookupMutationBatch=function(transaction,batchId){return PersistencePromise.resolve(this.findMutationBatch(batchId))},MemoryMutationQueue.prototype.lookupMutationKeys=function(transaction,batchId){var mutationBatch=this.findMutationBatch(batchId);return assert(null!=mutationBatch,'Failed to find local mutation batch.'),PersistencePromise.resolve(mutationBatch.keys())},MemoryMutationQueue.prototype.getNextMutationBatchAfterBatchId=function(transaction,batchId){var nextBatchId=_Mathmax(batchId,this.highestAcknowledgedBatchId)+1,rawIndex=this.indexOfBatchId(nextBatchId),index=0>rawIndex?0:rawIndex;return PersistencePromise.resolve(this.mutationQueue.length>index?this.mutationQueue[index]:null)},MemoryMutationQueue.prototype.getAllMutationBatches=function(){return PersistencePromise.resolve(this.mutationQueue.slice())},MemoryMutationQueue.prototype.getAllMutationBatchesAffectingDocumentKey=function(transaction,documentKey){var _this=this,start=new DocReference(documentKey,0),end=new DocReference(documentKey,_NumberPOSITIVE_INFINITY),result=[];return this.batchesByDocumentKey.forEachInRange([start,end],function(ref){assert(documentKey.isEqual(ref.key),'Should only iterate over a single key\'s batches');var batch=_this.findMutationBatch(ref.targetOrBatchId);assert(null!==batch,'Batches in the index must exist in the main table'),result.push(batch)}),PersistencePromise.resolve(result)},MemoryMutationQueue.prototype.getAllMutationBatchesAffectingDocumentKeys=function(transaction,documentKeys){var _this=this,uniqueBatchIDs=new SortedSet(primitiveComparator);return documentKeys.forEach(function(documentKey){var start=new DocReference(documentKey,0),end=new DocReference(documentKey,_NumberPOSITIVE_INFINITY);_this.batchesByDocumentKey.forEachInRange([start,end],function(ref){assert(documentKey.isEqual(ref.key),'For each key, should only iterate over a single key\'s batches'),uniqueBatchIDs=uniqueBatchIDs.add(ref.targetOrBatchId)})}),PersistencePromise.resolve(this.findMutationBatches(uniqueBatchIDs))},MemoryMutationQueue.prototype.getAllMutationBatchesAffectingQuery=function(transaction,query){var prefix=query.path,immediateChildrenPathLength=prefix.length+1,startPath=prefix;DocumentKey.isDocumentKey(startPath)||(startPath=startPath.child(''));var start=new DocReference(new DocumentKey(startPath),0),uniqueBatchIDs=new SortedSet(primitiveComparator);return this.batchesByDocumentKey.forEachWhile(function(ref){var rowKeyPath=ref.key.path;return!!prefix.isPrefixOf(rowKeyPath)&&(rowKeyPath.length===immediateChildrenPathLength&&(uniqueBatchIDs=uniqueBatchIDs.add(ref.targetOrBatchId)),!0)},start),PersistencePromise.resolve(this.findMutationBatches(uniqueBatchIDs))},MemoryMutationQueue.prototype.findMutationBatches=function(batchIDs){var _this=this,result=[];return batchIDs.forEach(function(batchId){var batch=_this.findMutationBatch(batchId);null!==batch&&result.push(batch)}),result},MemoryMutationQueue.prototype.removeMutationBatch=function(transaction,batch){var _this=this,batchIndex=this.indexOfExistingBatchId(batch.batchId,'removed');assert(0===batchIndex,'Can only remove the first entry of the mutation queue'),this.mutationQueue.shift();var references=this.batchesByDocumentKey;return PersistencePromise.forEach(batch.mutations,function(mutation){var ref=new DocReference(mutation.key,batch.batchId);return references=references.delete(ref),_this.referenceDelegate.removeMutationReference(transaction,mutation.key)}).next(function(){_this.batchesByDocumentKey=references})},MemoryMutationQueue.prototype.removeCachedMutationKeys=function(){},MemoryMutationQueue.prototype.containsKey=function(txn,key){var ref=new DocReference(key,0),firstRef=this.batchesByDocumentKey.firstAfterOrEqual(ref);return PersistencePromise.resolve(key.isEqual(firstRef&&firstRef.key))},MemoryMutationQueue.prototype.performConsistencyCheck=function(){return 0===this.mutationQueue.length&&assert(this.batchesByDocumentKey.isEmpty(),'Document leak -- detected dangling mutation references when queue is empty.'),PersistencePromise.resolve()},MemoryMutationQueue.prototype.indexOfExistingBatchId=function(batchId,action){var index=this.indexOfBatchId(batchId);return assert(0<=index&&index<this.mutationQueue.length,'Batches must exist to be '+action),index},MemoryMutationQueue.prototype.indexOfBatchId=function(batchId){if(0===this.mutationQueue.length)return 0;var firstBatchId=this.mutationQueue[0].batchId;return batchId-firstBatchId},MemoryMutationQueue.prototype.findMutationBatch=function(batchId){var index=this.indexOfBatchId(batchId);if(0>index||index>=this.mutationQueue.length)return null;var batch=this.mutationQueue[index];return assert(batch.batchId===batchId,'If found batch must match'),batch},MemoryMutationQueue}(),MemoryQueryCache=function(){function MemoryQueryCache(persistence){this.persistence=persistence,this.queries=new ObjectMap(function(q){return q.canonicalId()}),this.lastRemoteSnapshotVersion=SnapshotVersion.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new ReferenceSet,this.targetCount=0,this.targetIdGenerator=TargetIdGenerator.forQueryCache()}return MemoryQueryCache.prototype.getTargetCount=function(){return PersistencePromise.resolve(this.targetCount)},MemoryQueryCache.prototype.forEachTarget=function(txn,f){return this.queries.forEach(function(_,queryData){return f(queryData)}),PersistencePromise.resolve()},MemoryQueryCache.prototype.getLastRemoteSnapshotVersion=function(){return PersistencePromise.resolve(this.lastRemoteSnapshotVersion)},MemoryQueryCache.prototype.getHighestSequenceNumber=function(){return PersistencePromise.resolve(this.highestSequenceNumber)},MemoryQueryCache.prototype.allocateTargetId=function(){var nextTargetId=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=nextTargetId,PersistencePromise.resolve(nextTargetId)},MemoryQueryCache.prototype.setTargetsMetadata=function(transaction,highestListenSequenceNumber,lastRemoteSnapshotVersion){return lastRemoteSnapshotVersion&&(this.lastRemoteSnapshotVersion=lastRemoteSnapshotVersion),highestListenSequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=highestListenSequenceNumber),PersistencePromise.resolve()},MemoryQueryCache.prototype.saveQueryData=function(queryData){this.queries.set(queryData.query,queryData);var targetId=queryData.targetId;targetId>this.highestTargetId&&(this.highestTargetId=targetId),queryData.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=queryData.sequenceNumber)},MemoryQueryCache.prototype.addQueryData=function(transaction,queryData){return assert(!this.queries.has(queryData.query),'Adding a query that already exists'),this.saveQueryData(queryData),this.targetCount+=1,PersistencePromise.resolve()},MemoryQueryCache.prototype.updateQueryData=function(transaction,queryData){return assert(this.queries.has(queryData.query),'Updating a non-existent query'),this.saveQueryData(queryData),PersistencePromise.resolve()},MemoryQueryCache.prototype.removeQueryData=function(transaction,queryData){return assert(0<this.targetCount,'Removing a target from an empty cache'),assert(this.queries.has(queryData.query),'Removing a non-existent target from the cache'),this.queries.delete(queryData.query),this.references.removeReferencesForId(queryData.targetId),this.targetCount-=1,PersistencePromise.resolve()},MemoryQueryCache.prototype.removeTargets=function(transaction,upperBound,activeTargetIds){var _this=this,count=0,removals=[];return this.queries.forEach(function(key,queryData){queryData.sequenceNumber<=upperBound&&!activeTargetIds[queryData.targetId]&&(_this.queries.delete(key),removals.push(_this.removeMatchingKeysForTargetId(transaction,queryData.targetId)),count++)}),PersistencePromise.waitFor(removals).next(function(){return count})},MemoryQueryCache.prototype.getQueryCount=function(){return PersistencePromise.resolve(this.targetCount)},MemoryQueryCache.prototype.getQueryData=function(transaction,query){var queryData=this.queries.get(query)||null;return PersistencePromise.resolve(queryData)},MemoryQueryCache.prototype.getQueryDataForTarget=function(){return fail('Not yet implemented.')},MemoryQueryCache.prototype.addMatchingKeys=function(txn,keys,targetId){this.references.addReferences(keys,targetId);var referenceDelegate=this.persistence.referenceDelegate,promises=[];return referenceDelegate&&keys.forEach(function(key){promises.push(referenceDelegate.addReference(txn,key))}),PersistencePromise.waitFor(promises)},MemoryQueryCache.prototype.removeMatchingKeys=function(txn,keys,targetId){this.references.removeReferences(keys,targetId);var referenceDelegate=this.persistence.referenceDelegate,promises=[];return referenceDelegate&&keys.forEach(function(key){promises.push(referenceDelegate.removeReference(txn,key))}),PersistencePromise.waitFor(promises)},MemoryQueryCache.prototype.removeMatchingKeysForTargetId=function(txn,targetId){return this.references.removeReferencesForId(targetId),PersistencePromise.resolve()},MemoryQueryCache.prototype.getMatchingKeysForTargetId=function(txn,targetId){var matchingKeys=this.references.referencesForId(targetId);return PersistencePromise.resolve(matchingKeys)},MemoryQueryCache.prototype.containsKey=function(txn,key){return PersistencePromise.resolve(this.references.containsKey(key))},MemoryQueryCache}(),MemoryRemoteDocumentCache=function(){function MemoryRemoteDocumentCache(sizer){this.sizer=sizer,this.docs=documentSizeMap(),this.newDocumentChanges=documentKeySet(),this.size=0}return MemoryRemoteDocumentCache.prototype.addEntries=function(transaction,entries,sizeDelta){for(var _i=0,entries_1=entries;_i<entries_1.length;_i++){var entry=entries_1[_i],key=entry.maybeDocument.key;this.docs=this.docs.insert(key,entry),this.newDocumentChanges=this.newDocumentChanges.add(key)}return this.size+=sizeDelta,PersistencePromise.resolve()},MemoryRemoteDocumentCache.prototype.removeEntry=function(transaction,documentKey){var entry=this.docs.get(documentKey);return entry?(this.docs=this.docs.remove(documentKey),this.size-=entry.size,PersistencePromise.resolve(entry.size)):PersistencePromise.resolve(0)},MemoryRemoteDocumentCache.prototype.getEntry=function(transaction,documentKey){var entry=this.docs.get(documentKey);return PersistencePromise.resolve(entry?entry.maybeDocument:null)},MemoryRemoteDocumentCache.prototype.getSizedEntry=function(transaction,documentKey){return PersistencePromise.resolve(this.docs.get(documentKey))},MemoryRemoteDocumentCache.prototype.getDocumentsMatchingQuery=function(transaction,query){for(var results=documentMap(),prefix=new DocumentKey(query.path.child('')),iterator=this.docs.getIteratorFrom(prefix);iterator.hasNext();){var _a=iterator.getNext(),key=_a.key,maybeDocument=_a.value.maybeDocument;if(!query.path.isPrefixOf(key.path))break;maybeDocument instanceof Document&&query.matches(maybeDocument)&&(results=results.insert(maybeDocument.key,maybeDocument))}return PersistencePromise.resolve(results)},MemoryRemoteDocumentCache.prototype.forEachDocumentKey=function(transaction,f){return PersistencePromise.forEach(this.docs,function(key){return f(key)})},MemoryRemoteDocumentCache.prototype.getNewDocumentChanges=function(){var _this=this,changedDocs=maybeDocumentMap();return this.newDocumentChanges.forEach(function(key){var entry=_this.docs.get(key),changedDoc=entry?entry.maybeDocument:new NoDocument(key,SnapshotVersion.forDeletedDoc());changedDocs=changedDocs.insert(key,changedDoc)}),this.newDocumentChanges=documentKeySet(),PersistencePromise.resolve(changedDocs)},MemoryRemoteDocumentCache.prototype.newChangeBuffer=function(){return new MemoryRemoteDocumentChangeBuffer(this.sizer,this)},MemoryRemoteDocumentCache.prototype.getSize=function(){return PersistencePromise.resolve(this.size)},MemoryRemoteDocumentCache}(),MemoryRemoteDocumentChangeBuffer=function(_super){function MemoryRemoteDocumentChangeBuffer(sizer,documentCache){var _this=_super.call(this)||this;return _this.sizer=sizer,_this.documentCache=documentCache,_this}return tslib_1.__extends(MemoryRemoteDocumentChangeBuffer,_super),MemoryRemoteDocumentChangeBuffer.prototype.applyChanges=function(transaction){var _this=this,changes=this.assertChanges(),delta=0,docs=[];return changes.forEach(function(key,maybeDocument){var previousSize=_this.documentSizes.get(key);assert(void 0!==previousSize,'Attempting to change document '+key.toString()+' without having read it first');var size=_this.sizer(maybeDocument);delta+=size-previousSize,docs.push({maybeDocument:maybeDocument,size:size})}),this.documentCache.addEntries(transaction,docs,delta)},MemoryRemoteDocumentChangeBuffer.prototype.getFromCache=function(transaction,documentKey){return this.documentCache.getSizedEntry(transaction,documentKey)},MemoryRemoteDocumentChangeBuffer}(RemoteDocumentChangeBuffer),MemoryPersistence=function(){function MemoryPersistence(clientId,isEager,serializer){var _this=this;this.clientId=clientId,this.mutationQueues={},this.listenSequence=new ListenSequence(0),this._started=!1,this._started=!0,this.referenceDelegate=isEager?new MemoryEagerDelegate(this):new MemoryLruDelegate(this,new LocalSerializer(serializer)),this.queryCache=new MemoryQueryCache(this);this.remoteDocumentCache=new MemoryRemoteDocumentCache(function(doc){return _this.referenceDelegate.documentSize(doc)})}return MemoryPersistence.createLruPersistence=function(clientId,serializer){return new MemoryPersistence(clientId,!1,serializer)},MemoryPersistence.createEagerPersistence=function(clientId,serializer){return new MemoryPersistence(clientId,!0,serializer)},MemoryPersistence.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(MemoryPersistence.prototype,'started',{get:function(){return this._started},enumerable:!0,configurable:!0}),MemoryPersistence.prototype.getActiveClients=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return[2,[this.clientId]]})})},MemoryPersistence.prototype.setPrimaryStateListener=function(primaryStateListener){return primaryStateListener(!0)},MemoryPersistence.prototype.setNetworkEnabled=function(){},MemoryPersistence.prototype.getMutationQueue=function(user){var queue=this.mutationQueues[user.toKey()];return queue||(queue=new MemoryMutationQueue(this.referenceDelegate),this.mutationQueues[user.toKey()]=queue),queue},MemoryPersistence.prototype.getQueryCache=function(){return this.queryCache},MemoryPersistence.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},MemoryPersistence.prototype.runTransaction=function(action,mode,transactionOperation){var _this=this;debug('MemoryPersistence','Starting transaction:',action);var txn=new MemoryTransaction(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),transactionOperation(txn).next(function(result){return _this.referenceDelegate.onTransactionCommitted(txn).next(function(){return result})}).toPromise()},MemoryPersistence.prototype.mutationQueuesContainKey=function(transaction,key){return PersistencePromise.or(values(this.mutationQueues).map(function(queue){return function(){return queue.containsKey(transaction,key)}}))},MemoryPersistence}(),MemoryTransaction=function(){return function MemoryTransaction(currentSequenceNumber){this.currentSequenceNumber=currentSequenceNumber}}(),MemoryEagerDelegate=function(){function MemoryEagerDelegate(persistence){this.persistence=persistence}return MemoryEagerDelegate.prototype.setInMemoryPins=function(inMemoryPins){this.inMemoryPins=inMemoryPins},MemoryEagerDelegate.prototype.addReference=function(txn,key){return this.orphanedDocuments.delete(key),PersistencePromise.resolve()},MemoryEagerDelegate.prototype.removeReference=function(txn,key){return this.orphanedDocuments.add(key),PersistencePromise.resolve()},MemoryEagerDelegate.prototype.removeMutationReference=function(txn,key){return this.orphanedDocuments.add(key),PersistencePromise.resolve()},MemoryEagerDelegate.prototype.removeTarget=function(txn,queryData){var _this=this,cache=this.persistence.getQueryCache();return cache.getMatchingKeysForTargetId(txn,queryData.targetId).next(function(keys){keys.forEach(function(key){return _this.orphanedDocuments.add(key)})}).next(function(){return cache.removeQueryData(txn,queryData)})},MemoryEagerDelegate.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},MemoryEagerDelegate.prototype.onTransactionCommitted=function(txn){var _this=this,cache=this.persistence.getRemoteDocumentCache();return PersistencePromise.forEach(this.orphanedDocuments,function(key){return _this.isReferenced(txn,key).next(function(isReferenced){return isReferenced?PersistencePromise.resolve():cache.removeEntry(txn,key).next(function(){})})})},MemoryEagerDelegate.prototype.updateLimboDocument=function(txn,key){var _this=this;return this.isReferenced(txn,key).next(function(isReferenced){isReferenced?_this.orphanedDocuments.delete(key):_this.orphanedDocuments.add(key)})},MemoryEagerDelegate.prototype.documentSize=function(){return 0},MemoryEagerDelegate.prototype.isReferenced=function(txn,key){var _this=this;return PersistencePromise.or([function(){return _this.persistence.getQueryCache().containsKey(txn,key)},function(){return _this.persistence.mutationQueuesContainKey(txn,key)},function(){return PersistencePromise.resolve(_this.inMemoryPins.containsKey(key))}])},MemoryEagerDelegate}(),MemoryLruDelegate=function(){function MemoryLruDelegate(persistence,serializer){this.persistence=persistence,this.serializer=serializer,this.orphanedSequenceNumbers=new ObjectMap(function(k){return encode(k.path)}),this.garbageCollector=new LruGarbageCollector(this)}return MemoryLruDelegate.prototype.onTransactionStarted=function(){},MemoryLruDelegate.prototype.onTransactionCommitted=function(){return PersistencePromise.resolve()},MemoryLruDelegate.prototype.forEachTarget=function(txn,f){return this.persistence.getQueryCache().forEachTarget(txn,f)},MemoryLruDelegate.prototype.getTargetCount=function(txn){return this.persistence.getQueryCache().getTargetCount(txn)},MemoryLruDelegate.prototype.forEachOrphanedDocumentSequenceNumber=function(txn,f){var _this=this;return PersistencePromise.forEach(this.orphanedSequenceNumbers,function(key,sequenceNumber){return _this.isPinned(txn,key,sequenceNumber).next(function(isPinned){return isPinned?PersistencePromise.resolve():f(sequenceNumber)})})},MemoryLruDelegate.prototype.setInMemoryPins=function(inMemoryPins){this.inMemoryPins=inMemoryPins},MemoryLruDelegate.prototype.removeTargets=function(txn,upperBound,activeTargetIds){return this.persistence.getQueryCache().removeTargets(txn,upperBound,activeTargetIds)},MemoryLruDelegate.prototype.removeOrphanedDocuments=function(txn,upperBound){var _this=this,count=0,cache=this.persistence.getRemoteDocumentCache(),p=cache.forEachDocumentKey(txn,function(key){return _this.isPinned(txn,key,upperBound).next(function(isPinned){return isPinned?PersistencePromise.resolve():(count++,cache.removeEntry(txn,key).next())})});return p.next(function(){return count})},MemoryLruDelegate.prototype.removeMutationReference=function(txn,key){return this.orphanedSequenceNumbers.set(key,txn.currentSequenceNumber),PersistencePromise.resolve()},MemoryLruDelegate.prototype.removeTarget=function(txn,queryData){var updated=queryData.copy({sequenceNumber:txn.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(txn,updated)},MemoryLruDelegate.prototype.addReference=function(txn,key){return this.orphanedSequenceNumbers.set(key,txn.currentSequenceNumber),PersistencePromise.resolve()},MemoryLruDelegate.prototype.removeReference=function(txn,key){return this.orphanedSequenceNumbers.set(key,txn.currentSequenceNumber),PersistencePromise.resolve()},MemoryLruDelegate.prototype.updateLimboDocument=function(txn,key){return this.orphanedSequenceNumbers.set(key,txn.currentSequenceNumber),PersistencePromise.resolve()},MemoryLruDelegate.prototype.documentSize=function(maybeDoc){var remoteDocument=this.serializer.toDbRemoteDocument(maybeDoc),value;if(remoteDocument.document)value=remoteDocument.document;else if(remoteDocument.unknownDocument)value=remoteDocument.unknownDocument;else if(remoteDocument.noDocument)value=remoteDocument.noDocument;else throw fail('Unknown remote document type');return JSON.stringify(value).length},MemoryLruDelegate.prototype.isPinned=function(txn,key,upperBound){var _this=this;return PersistencePromise.or([function(){return _this.persistence.mutationQueuesContainKey(txn,key)},function(){return PersistencePromise.resolve(_this.inMemoryPins.containsKey(key))},function(){return _this.persistence.getQueryCache().containsKey(txn,key)},function(){var orphanedAt=_this.orphanedSequenceNumbers.get(key);return PersistencePromise.resolve(void 0!==orphanedAt&&orphanedAt>upperBound)}])},MemoryLruDelegate}(),ExponentialBackoff=function(){function ExponentialBackoff(queue,timerId,initialDelayMs,backoffFactor,maxDelayMs){this.queue=queue,this.timerId=timerId,this.initialDelayMs=initialDelayMs,this.backoffFactor=backoffFactor,this.maxDelayMs=maxDelayMs,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return ExponentialBackoff.prototype.reset=function(){this.currentBaseMs=0},ExponentialBackoff.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},ExponentialBackoff.prototype.backoffAndRun=function(op){var _this=this;this.cancel();var desiredDelayWithJitterMs=_Mathfloor(this.currentBaseMs+this.jitterDelayMs()),delaySoFarMs=_Mathmax(0,Date.now()-this.lastAttemptTime),remainingDelayMs=_Mathmax(0,desiredDelayWithJitterMs-delaySoFarMs);0<this.currentBaseMs&&debug('ExponentialBackoff','Backing off for '+remainingDelayMs+' ms '+('(base delay: '+this.currentBaseMs+' ms, ')+('delay with jitter: '+desiredDelayWithJitterMs+' ms, ')+('last attempt: '+delaySoFarMs+' ms ago)')),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,remainingDelayMs,function(){return _this.lastAttemptTime=Date.now(),op()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},ExponentialBackoff.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},ExponentialBackoff.prototype.jitterDelayMs=function(){return(Math.random()-0.5)*this.currentBaseMs},ExponentialBackoff}(),LOG_TAG$6='PersistentStream',PersistentStreamState;(function(PersistentStreamState){PersistentStreamState[PersistentStreamState.Initial=0]='Initial',PersistentStreamState[PersistentStreamState.Starting=1]='Starting',PersistentStreamState[PersistentStreamState.Open=2]='Open',PersistentStreamState[PersistentStreamState.Error=3]='Error',PersistentStreamState[PersistentStreamState.Backoff=4]='Backoff'})(PersistentStreamState||(PersistentStreamState={}));var PersistentStream=function(){function PersistentStream(queue,connectionTimerId,idleTimerId,connection,credentialsProvider,listener){this.queue=queue,this.idleTimerId=idleTimerId,this.connection=connection,this.credentialsProvider=credentialsProvider,this.listener=listener,this.state=PersistentStreamState.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new ExponentialBackoff(queue,connectionTimerId,1e3,1.5,1e3*60)}return PersistentStream.prototype.isStarted=function(){return this.state===PersistentStreamState.Starting||this.state===PersistentStreamState.Open||this.state===PersistentStreamState.Backoff},PersistentStream.prototype.isOpen=function(){return this.state===PersistentStreamState.Open},PersistentStream.prototype.start=function(){return this.state===PersistentStreamState.Error?void this.performBackoff():void(assert(this.state===PersistentStreamState.Initial,'Already started'),this.auth())},PersistentStream.prototype.stop=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return this.isStarted()?[4,this.close(PersistentStreamState.Initial)]:[3,2];case 1:_a.sent(),_a.label=2;case 2:return[2];}})})},PersistentStream.prototype.inhibitBackoff=function(){assert(!this.isStarted(),'Can only inhibit backoff in a stopped state'),this.state=PersistentStreamState.Initial,this.backoff.reset()},PersistentStream.prototype.markIdle=function(){var _this=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,1e3*60,function(){return _this.handleIdleCloseTimer()}))},PersistentStream.prototype.sendRequest=function(msg){this.cancelIdleCheck(),this.stream.send(msg)},PersistentStream.prototype.handleIdleCloseTimer=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return this.isOpen()?[2,this.close(PersistentStreamState.Initial)]:[2]})})},PersistentStream.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},PersistentStream.prototype.close=function(finalState,error$$1){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return assert(this.isStarted(),'Only started streams should be closed.'),assert(finalState===PersistentStreamState.Error||isNullOrUndefined(error$$1),'Can\'t provide an error when not in an error state.'),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,finalState===PersistentStreamState.Error?error$$1&&error$$1.code===Code.RESOURCE_EXHAUSTED?(error(error$$1.toString()),error('Using maximum backoff delay to prevent overloading the backend.'),this.backoff.resetToMax()):error$$1&&error$$1.code===Code.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken():this.backoff.reset(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=finalState,[4,this.listener.onClose(error$$1)];case 1:return _a.sent(),[2];}})})},PersistentStream.prototype.tearDown=function(){},PersistentStream.prototype.auth=function(){var _this=this;assert(this.state===PersistentStreamState.Initial,'Must be in initial state to auth'),this.state=PersistentStreamState.Starting;var dispatchIfNotClosed=this.getCloseGuardedDispatcher(this.closeCount),closeCount=this.closeCount;this.credentialsProvider.getToken().then(function(token){_this.closeCount===closeCount&&_this.startStream(token)},function(error$$1){dispatchIfNotClosed(function(){var rpcError=new FirestoreError(Code.UNKNOWN,'Fetching auth token failed: '+error$$1.message);return _this.handleStreamClose(rpcError)})})},PersistentStream.prototype.startStream=function(token){var _this=this;assert(this.state===PersistentStreamState.Starting,'Trying to start stream in a non-starting state');var dispatchIfNotClosed=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(token),this.stream.onOpen(function(){dispatchIfNotClosed(function(){return assert(_this.state===PersistentStreamState.Starting,'Expected stream to be in state Starting, but was '+_this.state),_this.state=PersistentStreamState.Open,_this.listener.onOpen()})}),this.stream.onClose(function(error$$1){dispatchIfNotClosed(function(){return _this.handleStreamClose(error$$1)})}),this.stream.onMessage(function(msg){dispatchIfNotClosed(function(){return _this.onMessage(msg)})})},PersistentStream.prototype.performBackoff=function(){var _this=this;assert(this.state===PersistentStreamState.Error,'Should only perform backoff when in Error state'),this.state=PersistentStreamState.Backoff,this.backoff.backoffAndRun(function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return assert(this.state===PersistentStreamState.Backoff,'Backoff elapsed but state is now: '+this.state),this.state=PersistentStreamState.Initial,this.start(),assert(this.isStarted(),'PersistentStream should have started'),[2]})})})},PersistentStream.prototype.handleStreamClose=function(error$$1){return assert(this.isStarted(),'Can\'t handle server close on non-started stream'),debug(LOG_TAG$6,'close with error: '+error$$1),this.stream=null,this.close(PersistentStreamState.Error,error$$1)},PersistentStream.prototype.getCloseGuardedDispatcher=function(startCloseCount){var _this=this;return function(fn){_this.queue.enqueueAndForget(function(){return _this.closeCount===startCloseCount?fn():(debug(LOG_TAG$6,'stream callback skipped by getCloseGuardedDispatcher.'),Promise.resolve())})}},PersistentStream}(),PersistentListenStream=function(_super){function PersistentListenStream(queue,connection,credentials,serializer,listener){var _this=_super.call(this,queue,TimerId.ListenStreamConnectionBackoff,TimerId.ListenStreamIdle,connection,credentials,listener)||this;return _this.serializer=serializer,_this}return tslib_1.__extends(PersistentListenStream,_super),PersistentListenStream.prototype.startRpc=function(token){return this.connection.openStream('Listen',token)},PersistentListenStream.prototype.onMessage=function(watchChangeProto){this.backoff.reset();var watchChange=this.serializer.fromWatchChange(watchChangeProto),snapshot=this.serializer.versionFromListenResponse(watchChangeProto);return this.listener.onWatchChange(watchChange,snapshot)},PersistentListenStream.prototype.watch=function(queryData){var request={database:this.serializer.encodedDatabaseId,addTarget:this.serializer.toTarget(queryData)},labels=this.serializer.toListenRequestLabels(queryData);labels&&(request.labels=labels),this.sendRequest(request)},PersistentListenStream.prototype.unwatch=function(targetId){var request={};request.database=this.serializer.encodedDatabaseId,request.removeTarget=targetId,this.sendRequest(request)},PersistentListenStream}(PersistentStream),PersistentWriteStream=function(_super){function PersistentWriteStream(queue,connection,credentials,serializer,listener){var _this=_super.call(this,queue,TimerId.WriteStreamConnectionBackoff,TimerId.WriteStreamIdle,connection,credentials,listener)||this;return _this.serializer=serializer,_this.handshakeComplete_=!1,_this}return tslib_1.__extends(PersistentWriteStream,_super),Object.defineProperty(PersistentWriteStream.prototype,'handshakeComplete',{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),PersistentWriteStream.prototype.start=function(){this.handshakeComplete_=!1,_super.prototype.start.call(this)},PersistentWriteStream.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},PersistentWriteStream.prototype.startRpc=function(token){return this.connection.openStream('Write',token)},PersistentWriteStream.prototype.onMessage=function(responseProto){if(assert(!!responseProto.streamToken,'Got a write response without a stream token'),this.lastStreamToken=responseProto.streamToken,!this.handshakeComplete_)return assert(!responseProto.writeResults||0===responseProto.writeResults.length,'Got mutation results for handshake'),this.handshakeComplete_=!0,this.listener.onHandshakeComplete();this.backoff.reset();var results=this.serializer.fromWriteResults(responseProto.writeResults,responseProto.commitTime),commitVersion=this.serializer.fromVersion(responseProto.commitTime);return this.listener.onMutationResult(commitVersion,results)},PersistentWriteStream.prototype.writeHandshake=function(){assert(this.isOpen(),'Writing handshake requires an opened stream'),assert(!this.handshakeComplete_,'Handshake already completed');var request={};request.database=this.serializer.encodedDatabaseId,this.sendRequest(request)},PersistentWriteStream.prototype.writeMutations=function(mutations){var _this=this;assert(this.isOpen(),'Writing mutations requires an opened stream'),assert(this.handshakeComplete_,'Handshake must be complete before writing mutations'),assert(0<this.lastStreamToken.length,'Trying to write mutation without a token');var request={streamToken:this.lastStreamToken,writes:mutations.map(function(mutation){return _this.serializer.toMutation(mutation)})};this.sendRequest(request)},PersistentWriteStream}(PersistentStream),Datastore=function(){function Datastore(queue,connection,credentials,serializer){this.queue=queue,this.connection=connection,this.credentials=credentials,this.serializer=serializer}return Datastore.prototype.newPersistentWriteStream=function(listener){return new PersistentWriteStream(this.queue,this.connection,this.credentials,this.serializer,listener)},Datastore.prototype.newPersistentWatchStream=function(listener){return new PersistentListenStream(this.queue,this.connection,this.credentials,this.serializer,listener)},Datastore.prototype.commit=function(mutations){var _this=this,params={database:this.serializer.encodedDatabaseId,writes:mutations.map(function(m){return _this.serializer.toMutation(m)})};return this.invokeRPC('Commit',params).then(function(response){return _this.serializer.fromWriteResults(response.writeResults,response.commitTime)})},Datastore.prototype.lookup=function(keys){var _this=this,params={database:this.serializer.encodedDatabaseId,documents:keys.map(function(k){return _this.serializer.toName(k)})};return this.invokeStreamingRPC('BatchGetDocuments',params).then(function(response){var docs=maybeDocumentMap();response.forEach(function(proto){var doc=_this.serializer.fromMaybeDocument(proto);docs=docs.insert(doc.key,doc)});var result=[];return keys.forEach(function(key){var doc=docs.get(key);assert(!!doc,'Missing entity in write response for '+key),result.push(doc)}),result})},Datastore.prototype.invokeRPC=function(rpcName,request){var _this=this;return this.credentials.getToken().then(function(token){return _this.connection.invokeRPC(rpcName,request,token)}).catch(function(error){throw error.code===Code.UNAUTHENTICATED&&_this.credentials.invalidateToken(),error})},Datastore.prototype.invokeStreamingRPC=function(rpcName,request){var _this=this;return this.credentials.getToken().then(function(token){return _this.connection.invokeStreamingRPC(rpcName,request,token)}).catch(function(error){throw error.code===Code.UNAUTHENTICATED&&_this.credentials.invalidateToken(),error})},Datastore}(),Transaction=function(){function Transaction(datastore){this.datastore=datastore,this.readVersions=documentVersionMap(),this.mutations=[],this.committed=!1}return Transaction.prototype.recordVersion=function(doc){var docVersion;if(doc instanceof Document)docVersion=doc.version;else if(doc instanceof NoDocument)docVersion=SnapshotVersion.forDeletedDoc();else throw fail('Document in a transaction was a '+doc.constructor.name);var existingVersion=this.readVersions.get(doc.key);if(null===existingVersion)this.readVersions=this.readVersions.insert(doc.key,docVersion);else if(!docVersion.isEqual(existingVersion))throw new FirestoreError(Code.ABORTED,'Document version changed between two reads.')},Transaction.prototype.lookup=function(keys){var _this=this;return this.committed?Promise.reject('Transaction has already completed.'):0<this.mutations.length?Promise.reject('Transactions lookups are invalid after writes.'):this.datastore.lookup(keys).then(function(docs){return docs.forEach(function(doc){doc instanceof NoDocument||doc instanceof Document?_this.recordVersion(doc):fail('Document in a transaction was a '+doc.constructor.name)}),docs})},Transaction.prototype.write=function(mutations){if(this.committed)throw new FirestoreError(Code.FAILED_PRECONDITION,'Transaction has already completed.');this.mutations=this.mutations.concat(mutations)},Transaction.prototype.precondition=function(key){var version=this.readVersions.get(key);return version?Precondition.updateTime(version):Precondition.NONE},Transaction.prototype.preconditionForUpdate=function(key){var version=this.readVersions.get(key);if(version&&version.isEqual(SnapshotVersion.forDeletedDoc()))throw new FirestoreError(Code.FAILED_PRECONDITION,'Can\'t update a document that doesn\'t exist.');else return version?Precondition.updateTime(version):Precondition.exists(!0)},Transaction.prototype.set=function(key,data){this.write(data.toMutations(key,this.precondition(key)))},Transaction.prototype.update=function(key,data){this.write(data.toMutations(key,this.preconditionForUpdate(key)))},Transaction.prototype.delete=function(key){this.write([new DeleteMutation(key,this.precondition(key))]),this.readVersions=this.readVersions.insert(key,SnapshotVersion.forDeletedDoc())},Transaction.prototype.commit=function(){var _this=this,unwritten=this.readVersions;return this.mutations.forEach(function(mutation){unwritten=unwritten.remove(mutation.key)}),unwritten.isEmpty()?this.datastore.commit(this.mutations).then(function(){_this.committed=!0}):Promise.reject(Error('Every document read in a transaction must also be written.'))},Transaction}(),OnlineState;(function(OnlineState){OnlineState[OnlineState.Unknown=0]='Unknown',OnlineState[OnlineState.Online=1]='Online',OnlineState[OnlineState.Offline=2]='Offline'})(OnlineState||(OnlineState={}));var OnlineStateSource;(function(OnlineStateSource){OnlineStateSource[OnlineStateSource.RemoteStore=0]='RemoteStore',OnlineStateSource[OnlineStateSource.SharedClientState=1]='SharedClientState'})(OnlineStateSource||(OnlineStateSource={}));var MAX_WATCH_STREAM_FAILURES=1,ONLINE_STATE_TIMEOUT_MS=1e3*10,OnlineStateTracker=function(){function OnlineStateTracker(asyncQueue,onlineStateHandler){this.asyncQueue=asyncQueue,this.onlineStateHandler=onlineStateHandler,this.state=OnlineState.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return OnlineStateTracker.prototype.handleWatchStreamStart=function(){var _this=this;0===this.watchStreamFailures&&(this.setAndBroadcast(OnlineState.Unknown),assert(null===this.onlineStateTimer,'onlineStateTimer shouldn\'t be started yet'),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(TimerId.OnlineStateTimeout,ONLINE_STATE_TIMEOUT_MS,function(){return _this.onlineStateTimer=null,assert(_this.state===OnlineState.Unknown,'Timer should be canceled if we transitioned to a different state.'),_this.logClientOfflineWarningIfNecessary('Backend didn\'t respond within '+ONLINE_STATE_TIMEOUT_MS/1e3+' '+'seconds.'),_this.setAndBroadcast(OnlineState.Offline),Promise.resolve()}))},OnlineStateTracker.prototype.handleWatchStreamFailure=function(error$$1){this.state===OnlineState.Online?(this.setAndBroadcast(OnlineState.Unknown),assert(0===this.watchStreamFailures,'watchStreamFailures must be 0'),assert(null===this.onlineStateTimer,'onlineStateTimer must be null')):(this.watchStreamFailures++,this.watchStreamFailures>=MAX_WATCH_STREAM_FAILURES&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary('Connection failed '+MAX_WATCH_STREAM_FAILURES+' '+('times. Most recent error: '+error$$1.toString())),this.setAndBroadcast(OnlineState.Offline)))},OnlineStateTracker.prototype.set=function(newState){this.clearOnlineStateTimer(),this.watchStreamFailures=0,newState===OnlineState.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(newState)},OnlineStateTracker.prototype.setAndBroadcast=function(newState){newState!==this.state&&(this.state=newState,this.onlineStateHandler(newState))},OnlineStateTracker.prototype.logClientOfflineWarningIfNecessary=function(details){var message='Could not reach Cloud Firestore backend. '+details+'\n'+'This typically indicates that your device does not have a healthy '+'Internet connection at the moment. The client will operate in offline '+'mode until it is able to successfully connect to the backend.';this.shouldWarnClientIsOffline?(error(message),this.shouldWarnClientIsOffline=!1):debug('OnlineStateTracker',message)},OnlineStateTracker.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},OnlineStateTracker}(),LOG_TAG$8='RemoteStore',RemoteStore=function(){function RemoteStore(localStore,datastore,asyncQueue,onlineStateHandler){this.localStore=localStore,this.datastore=datastore,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.onlineStateTracker=new OnlineStateTracker(asyncQueue,onlineStateHandler),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return RemoteStore.prototype.start=function(){return this.enableNetwork()},RemoteStore.prototype.enableNetwork=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){var _a;return tslib_1.__generator(this,function(_b){switch(_b.label){case 0:return(this.networkEnabled=!0,!this.canUseNetwork())?[3,3]:(_a=this.writeStream,[4,this.localStore.getLastStreamToken()]);case 1:return _a.lastStreamToken=_b.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(OnlineState.Unknown),[4,this.fillWritePipeline()];case 2:_b.sent(),_b.label=3;case 3:return[2];}})})},RemoteStore.prototype.disableNetwork=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return _a.sent(),this.onlineStateTracker.set(OnlineState.Offline),[2];}})})},RemoteStore.prototype.disableNetworkInternal=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return[4,this.writeStream.stop()];case 1:return _a.sent(),[4,this.watchStream.stop()];case 2:return _a.sent(),0<this.writePipeline.length&&(debug(LOG_TAG$8,'Stopping write stream with '+this.writePipeline.length+' pending writes'),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2];}})})},RemoteStore.prototype.shutdown=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return debug(LOG_TAG$8,'RemoteStore shutting down.'),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return _a.sent(),this.onlineStateTracker.set(OnlineState.Unknown),[2];}})})},RemoteStore.prototype.listen=function(queryData){assert(!contains(this.listenTargets,queryData.targetId),'listen called with duplicate targetId!'),this.listenTargets[queryData.targetId]=queryData,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(queryData)},RemoteStore.prototype.unlisten=function(targetId){assert(contains(this.listenTargets,targetId),'unlisten called without assigned target ID!'),delete this.listenTargets[targetId],this.watchStream.isOpen()&&this.sendUnwatchRequest(targetId),isEmpty(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(OnlineState.Unknown))},RemoteStore.prototype.getQueryDataForTarget=function(targetId){return this.listenTargets[targetId]||null},RemoteStore.prototype.getRemoteKeysForTarget=function(targetId){return this.syncEngine.getRemoteKeysForTarget(targetId)},RemoteStore.prototype.sendWatchRequest=function(queryData){this.watchChangeAggregator.recordPendingTargetRequest(queryData.targetId),this.watchStream.watch(queryData)},RemoteStore.prototype.sendUnwatchRequest=function(targetId){this.watchChangeAggregator.recordPendingTargetRequest(targetId),this.watchStream.unwatch(targetId)},RemoteStore.prototype.startWatchStream=function(){assert(this.shouldStartWatchStream(),'startWatchStream() called when shouldStartWatchStream() is false.'),this.watchChangeAggregator=new WatchChangeAggregator(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},RemoteStore.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!isEmpty(this.listenTargets)},RemoteStore.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},RemoteStore.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},RemoteStore.prototype.onWatchStreamOpen=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this;return tslib_1.__generator(this,function(){return forEachNumber(this.listenTargets,function(targetId,queryData){_this.sendWatchRequest(queryData)}),[2]})})},RemoteStore.prototype.onWatchStreamClose=function(error$$1){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return void 0===error$$1&&assert(!this.shouldStartWatchStream(),'Watch stream was stopped gracefully while still needed.'),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(error$$1),this.startWatchStream()):this.onlineStateTracker.set(OnlineState.Unknown),[2]})})},RemoteStore.prototype.onWatchStreamChange=function(watchChange,snapshotVersion){return tslib_1.__awaiter(this,void 0,void 0,function(){var lastRemoteSnapshotVersion;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return(this.onlineStateTracker.set(OnlineState.Online),watchChange instanceof WatchTargetChange&&watchChange.state===WatchTargetChangeState.Removed&&watchChange.cause)?[2,this.handleTargetError(watchChange)]:(watchChange instanceof DocumentWatchChange?this.watchChangeAggregator.handleDocumentChange(watchChange):watchChange instanceof ExistenceFilterChange?this.watchChangeAggregator.handleExistenceFilter(watchChange):(assert(watchChange instanceof WatchTargetChange,'Expected watchChange to be an instance of WatchTargetChange'),this.watchChangeAggregator.handleTargetChange(watchChange)),snapshotVersion.isEqual(SnapshotVersion.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return lastRemoteSnapshotVersion=_a.sent(),0<=snapshotVersion.compareTo(lastRemoteSnapshotVersion)?[4,this.raiseWatchSnapshot(snapshotVersion)]:[3,3];case 2:_a.sent(),_a.label=3;case 3:return[2];}})})},RemoteStore.prototype.raiseWatchSnapshot=function(snapshotVersion){var _this=this;assert(!snapshotVersion.isEqual(SnapshotVersion.MIN),'Can\'t raise event for unknown SnapshotVersion');var remoteEvent=this.watchChangeAggregator.createRemoteEvent(snapshotVersion);return forEachNumber(remoteEvent.targetChanges,function(targetId,change){if(0<change.resumeToken.length){var queryData=_this.listenTargets[targetId];queryData&&(_this.listenTargets[targetId]=queryData.copy({resumeToken:change.resumeToken,snapshotVersion:snapshotVersion}))}}),remoteEvent.targetMismatches.forEach(function(targetId){var queryData=_this.listenTargets[targetId];if(queryData){_this.listenTargets[targetId]=queryData.copy({resumeToken:emptyByteString()}),_this.sendUnwatchRequest(targetId);var requestQueryData=new QueryData(queryData.query,targetId,QueryPurpose.ExistenceFilterMismatch,queryData.sequenceNumber);_this.sendWatchRequest(requestQueryData)}}),this.syncEngine.applyRemoteEvent(remoteEvent)},RemoteStore.prototype.handleTargetError=function(watchChange){var _this=this;assert(!!watchChange.cause,'Handling target error without a cause');var error$$1=watchChange.cause,promiseChain=Promise.resolve();return watchChange.targetIds.forEach(function(targetId){promiseChain=promiseChain.then(function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return contains(this.listenTargets,targetId)?(delete this.listenTargets[targetId],this.watchChangeAggregator.removeTarget(targetId),[2,this.syncEngine.rejectListen(targetId,error$$1)]):[2]})})})}),promiseChain},RemoteStore.prototype.fillWritePipeline=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){var lastBatchIdRetrieved,batch;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return this.canAddToWritePipeline()?(lastBatchIdRetrieved=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:BATCHID_UNKNOWN,[4,this.localStore.nextMutationBatch(lastBatchIdRetrieved)]):[3,4];case 1:return(batch=_a.sent(),null!==batch)?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(batch),[4,this.fillWritePipeline()];case 3:_a.sent(),_a.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2];}})})},RemoteStore.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},RemoteStore.prototype.outstandingWrites=function(){return this.writePipeline.length},RemoteStore.prototype.addToWritePipeline=function(batch){assert(this.canAddToWritePipeline(),'addToWritePipeline called when pipeline is full'),this.writePipeline.push(batch),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(batch.mutations)},RemoteStore.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},RemoteStore.prototype.startWriteStream=function(){assert(this.shouldStartWriteStream(),'startWriteStream() called when shouldStartWriteStream() is false.'),this.writeStream.start()},RemoteStore.prototype.onWriteStreamOpen=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return this.writeStream.writeHandshake(),[2]})})},RemoteStore.prototype.onWriteHandshakeComplete=function(){var _this=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var _i=0,_a=_this.writePipeline,batch;_i<_a.length;_i++)batch=_a[_i],_this.writeStream.writeMutations(batch.mutations)}).catch(function(err){return _this.ignoreIfPrimaryLeaseLoss(err)})},RemoteStore.prototype.ignoreIfPrimaryLeaseLoss=function(err){if(isPrimaryLeaseLostError(err))debug(LOG_TAG$8,'Unexpectedly lost primary lease');else throw err},RemoteStore.prototype.onMutationResult=function(commitVersion,results){var _this=this;assert(0<this.writePipeline.length,'Got result for empty write pipeline');var batch=this.writePipeline.shift(),success=MutationBatchResult.from(batch,commitVersion,results,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(success).then(function(){return _this.fillWritePipeline()})},RemoteStore.prototype.onWriteStreamClose=function(error$$1){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this,errorHandling;return tslib_1.__generator(this,function(){return void 0===error$$1&&assert(!this.shouldStartWriteStream(),'Write stream was stopped gracefully while still needed.'),error$$1&&0<this.writePipeline.length?(errorHandling=void 0,errorHandling=this.writeStream.handshakeComplete?this.handleWriteError(error$$1):this.handleHandshakeError(error$$1),[2,errorHandling.then(function(){_this.shouldStartWriteStream()&&_this.startWriteStream()})]):[2]})})},RemoteStore.prototype.handleHandshakeError=function(error$$1){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this;return tslib_1.__generator(this,function(){return isPermanentError(error$$1.code)||error$$1.code===Code.ABORTED?(debug(LOG_TAG$8,'RemoteStore error before completed handshake; resetting stream token: ',this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=emptyByteString(),[2,this.localStore.setLastStreamToken(emptyByteString()).catch(function(err){return _this.ignoreIfPrimaryLeaseLoss(err)})]):[2]})})},RemoteStore.prototype.handleWriteError=function(error$$1){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this,batch;return tslib_1.__generator(this,function(){return isPermanentError(error$$1.code)?(batch=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(batch.batchId,error$$1).then(function(){return _this.fillWritePipeline()})]):[2]})})},RemoteStore.prototype.createTransaction=function(){return new Transaction(this.datastore)},RemoteStore.prototype.handleCredentialChange=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return this.canUseNetwork()?(debug(LOG_TAG$8,'RemoteStore restarting streams for new credential'),this.networkEnabled=!1,[4,this.disableNetworkInternal()]):[3,3];case 1:return _a.sent(),this.onlineStateTracker.set(OnlineState.Unknown),[4,this.enableNetwork()];case 2:_a.sent(),_a.label=3;case 3:return[2];}})})},RemoteStore.prototype.applyPrimaryState=function(isPrimary){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return this.isPrimary=isPrimary,isPrimary&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return _a.sent(),[3,4];case 2:return isPrimary?[3,4]:[4,this.disableNetworkInternal()];case 3:_a.sent(),this.onlineStateTracker.set(OnlineState.Unknown),_a.label=4;case 4:return[2];}})})},RemoteStore}(),QueryListenersInfo=function(){return function QueryListenersInfo(){this.listeners=[]}}(),EventManager=function(){function EventManager(syncEngine){this.syncEngine=syncEngine,this.queries=new ObjectMap(function(q){return q.canonicalId()}),this.onlineState=OnlineState.Unknown,this.syncEngine.subscribe(this)}return EventManager.prototype.listen=function(listener){var query=listener.query,firstListen=!1,queryInfo=this.queries.get(query);return queryInfo||(firstListen=!0,queryInfo=new QueryListenersInfo,this.queries.set(query,queryInfo)),queryInfo.listeners.push(listener),listener.applyOnlineStateChange(this.onlineState),queryInfo.viewSnap&&listener.onViewSnapshot(queryInfo.viewSnap),firstListen?this.syncEngine.listen(query).then(function(targetId){return queryInfo.targetId=targetId,targetId}):Promise.resolve(queryInfo.targetId)},EventManager.prototype.unlisten=function(listener){return tslib_1.__awaiter(this,void 0,void 0,function(){var query,lastListen,queryInfo,i;return tslib_1.__generator(this,function(){return query=listener.query,lastListen=!1,queryInfo=this.queries.get(query),queryInfo&&(i=queryInfo.listeners.indexOf(listener),0<=i&&(queryInfo.listeners.splice(i,1),lastListen=0===queryInfo.listeners.length)),lastListen?(this.queries.delete(query),[2,this.syncEngine.unlisten(query)]):[2]})})},EventManager.prototype.onWatchChange=function(viewSnaps){for(var _i=0,viewSnaps_1=viewSnaps;_i<viewSnaps_1.length;_i++){var viewSnap=viewSnaps_1[_i],query=viewSnap.query,queryInfo=this.queries.get(query);if(queryInfo){for(var _a=0,_b=queryInfo.listeners,listener;_a<_b.length;_a++)listener=_b[_a],listener.onViewSnapshot(viewSnap);queryInfo.viewSnap=viewSnap}}},EventManager.prototype.onWatchError=function(query,error){var queryInfo=this.queries.get(query);if(queryInfo)for(var _i=0,_a=queryInfo.listeners,listener;_i<_a.length;_i++)listener=_a[_i],listener.onError(error);this.queries.delete(query)},EventManager.prototype.onOnlineStateChange=function(onlineState){this.onlineState=onlineState,this.queries.forEach(function(_,queryInfo){for(var _i=0,_a=queryInfo.listeners,listener;_i<_a.length;_i++)listener=_a[_i],listener.applyOnlineStateChange(onlineState)})},EventManager}(),QueryListener=function(){function QueryListener(query,queryObserver,options){this.query=query,this.queryObserver=queryObserver,this.raisedInitialEvent=!1,this.onlineState=OnlineState.Unknown,this.options=options||{}}return QueryListener.prototype.onViewSnapshot=function(snap){if(assert(0<snap.docChanges.length||snap.syncStateChanged,'We got a new snapshot with no changes?'),!this.options.includeMetadataChanges){for(var docChanges=[],_i=0,_a=snap.docChanges,docChange;_i<_a.length;_i++)docChange=_a[_i],docChange.type!==ChangeType.Metadata&&docChanges.push(docChange);snap=new ViewSnapshot(snap.query,snap.docs,snap.oldDocs,docChanges,snap.mutatedKeys,snap.fromCache,snap.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(snap)&&this.queryObserver.next(snap):this.shouldRaiseInitialEvent(snap,this.onlineState)&&this.raiseInitialEvent(snap),this.snap=snap},QueryListener.prototype.onError=function(error){this.queryObserver.error(error)},QueryListener.prototype.applyOnlineStateChange=function(onlineState){this.onlineState=onlineState,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,onlineState)&&this.raiseInitialEvent(this.snap)},QueryListener.prototype.shouldRaiseInitialEvent=function(snap,onlineState){if(assert(!this.raisedInitialEvent,'Determining whether to raise first event but already had first event'),!snap.fromCache)return!0;var maybeOnline=onlineState!==OnlineState.Offline;return this.options.waitForSyncWhenOnline&&maybeOnline?(assert(snap.fromCache,'Waiting for sync, but snapshot is not from cache'),!1):!snap.docs.isEmpty()||onlineState===OnlineState.Offline},QueryListener.prototype.shouldRaiseEvent=function(snap){if(0<snap.docChanges.length)return!0;var hasPendingWritesChanged=this.snap&&this.snap.hasPendingWrites!==snap.hasPendingWrites;return(snap.syncStateChanged||hasPendingWritesChanged)&&!0===this.options.includeMetadataChanges},QueryListener.prototype.raiseInitialEvent=function(snap){assert(!this.raisedInitialEvent,'Trying to raise initial events for second time'),snap=ViewSnapshot.fromInitialDocuments(snap.query,snap.docs,snap.mutatedKeys,snap.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(snap)},QueryListener}(),LocalViewChanges=function(){function LocalViewChanges(targetId,addedKeys,removedKeys){this.targetId=targetId,this.addedKeys=addedKeys,this.removedKeys=removedKeys}return LocalViewChanges.fromSnapshot=function(targetId,viewSnapshot){for(var addedKeys=documentKeySet(),removedKeys=documentKeySet(),_i=0,_a=viewSnapshot.docChanges,docChange;_i<_a.length;_i++)switch(docChange=_a[_i],docChange.type){case ChangeType.Added:addedKeys=addedKeys.add(docChange.doc.key);break;case ChangeType.Removed:removedKeys=removedKeys.add(docChange.doc.key);break;default:}return new LocalViewChanges(targetId,addedKeys,removedKeys)},LocalViewChanges}(),AddedLimboDocument=function(){return function AddedLimboDocument(key){this.key=key}}(),RemovedLimboDocument=function(){return function RemovedLimboDocument(key){this.key=key}}(),View=function(){function View(query,_syncedDocuments){this.query=query,this._syncedDocuments=_syncedDocuments,this.syncState=null,this.current=!1,this.limboDocuments=documentKeySet(),this.mutatedKeys=documentKeySet(),this.documentSet=new DocumentSet(query.docComparator.bind(query))}return Object.defineProperty(View.prototype,'syncedDocuments',{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),View.prototype.computeDocChanges=function(docChanges,previousChanges){var _this=this,changeSet=previousChanges?previousChanges.changeSet:new DocumentChangeSet,oldDocumentSet=previousChanges?previousChanges.documentSet:this.documentSet,newMutatedKeys=previousChanges?previousChanges.mutatedKeys:this.mutatedKeys,newDocumentSet=oldDocumentSet,needsRefill=!1,lastDocInLimit=this.query.hasLimit()&&oldDocumentSet.size===this.query.limit?oldDocumentSet.last():null;if(docChanges.inorderTraversal(function(key,newMaybeDoc){var oldDoc=oldDocumentSet.get(key),newDoc=newMaybeDoc instanceof Document?newMaybeDoc:null;newDoc&&(assert(key.isEqual(newDoc.key),'Mismatching keys found in document changes: '+key+' != '+newDoc.key),newDoc=_this.query.matches(newDoc)?newDoc:null);var oldDocHadPendingMutations=!!oldDoc&&_this.mutatedKeys.has(oldDoc.key),newDocHasPendingMutations=!!newDoc&&(newDoc.hasLocalMutations||_this.mutatedKeys.has(newDoc.key)&&newDoc.hasCommittedMutations),changeApplied=!1;if(oldDoc&&newDoc){var docsEqual=oldDoc.data.isEqual(newDoc.data);docsEqual?oldDocHadPendingMutations!==newDocHasPendingMutations&&(changeSet.track({type:ChangeType.Metadata,doc:newDoc}),changeApplied=!0):!_this.shouldWaitForSyncedDocument(oldDoc,newDoc)&&(changeSet.track({type:ChangeType.Modified,doc:newDoc}),changeApplied=!0,lastDocInLimit&&0<_this.query.docComparator(newDoc,lastDocInLimit)&&(needsRefill=!0))}else!oldDoc&&newDoc?(changeSet.track({type:ChangeType.Added,doc:newDoc}),changeApplied=!0):oldDoc&&!newDoc&&(changeSet.track({type:ChangeType.Removed,doc:oldDoc}),changeApplied=!0,lastDocInLimit&&(needsRefill=!0));changeApplied&&(newDoc?(newDocumentSet=newDocumentSet.add(newDoc),newMutatedKeys=newDocHasPendingMutations?newMutatedKeys.add(key):newMutatedKeys.delete(key)):(newDocumentSet=newDocumentSet.delete(key),newMutatedKeys=newMutatedKeys.delete(key)))}),this.query.hasLimit())for(;newDocumentSet.size>this.query.limit;){var oldDoc=newDocumentSet.last();newDocumentSet=newDocumentSet.delete(oldDoc.key),newMutatedKeys=newMutatedKeys.delete(oldDoc.key),changeSet.track({type:ChangeType.Removed,doc:oldDoc})}return assert(!needsRefill||!previousChanges,'View was refilled using docs that themselves needed refilling.'),{documentSet:newDocumentSet,changeSet:changeSet,needsRefill:needsRefill,mutatedKeys:newMutatedKeys}},View.prototype.shouldWaitForSyncedDocument=function(oldDoc,newDoc){return oldDoc.hasLocalMutations&&newDoc.hasCommittedMutations&&!newDoc.hasLocalMutations},View.prototype.applyChanges=function(docChanges,updateLimboDocuments,targetChange){var _this=this;assert(!docChanges.needsRefill,'Cannot apply changes that need a refill');var oldDocs=this.documentSet;this.documentSet=docChanges.documentSet,this.mutatedKeys=docChanges.mutatedKeys;var changes=docChanges.changeSet.getChanges();changes.sort(function(c1,c2){return compareChangeType(c1.type,c2.type)||_this.query.docComparator(c1.doc,c2.doc)}),this.applyTargetChange(targetChange);var limboChanges=updateLimboDocuments?this.updateLimboDocuments():[],synced=0===this.limboDocuments.size&&this.current,newSyncState=synced?SyncState.Synced:SyncState.Local,syncStateChanged=newSyncState!==this.syncState;if(this.syncState=newSyncState,0===changes.length&&!syncStateChanged)return{limboChanges:limboChanges};var snap=new ViewSnapshot(this.query,docChanges.documentSet,oldDocs,changes,docChanges.mutatedKeys,newSyncState===SyncState.Local,syncStateChanged,!1);return{snapshot:snap,limboChanges:limboChanges}},View.prototype.applyOnlineStateChange=function(onlineState){return this.current&&onlineState===OnlineState.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new DocumentChangeSet,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},View.prototype.shouldBeInLimbo=function(key){return!this._syncedDocuments.has(key)&&!!this.documentSet.has(key)&&!this.documentSet.get(key).hasLocalMutations},View.prototype.applyTargetChange=function(targetChange){var _this=this;targetChange&&(targetChange.addedDocuments.forEach(function(key){return _this._syncedDocuments=_this._syncedDocuments.add(key)}),targetChange.modifiedDocuments.forEach(function(key){return assert(_this._syncedDocuments.has(key),'Modified document '+key+' not found in view.')}),targetChange.removedDocuments.forEach(function(key){return _this._syncedDocuments=_this._syncedDocuments.delete(key)}),this.current=targetChange.current)},View.prototype.updateLimboDocuments=function(){var _this=this;if(!this.current)return[];var oldLimboDocuments=this.limboDocuments;this.limboDocuments=documentKeySet(),this.documentSet.forEach(function(doc){_this.shouldBeInLimbo(doc.key)&&(_this.limboDocuments=_this.limboDocuments.add(doc.key))});var changes=[];return oldLimboDocuments.forEach(function(key){_this.limboDocuments.has(key)||changes.push(new RemovedLimboDocument(key))}),this.limboDocuments.forEach(function(key){oldLimboDocuments.has(key)||changes.push(new AddedLimboDocument(key))}),changes},View.prototype.synchronizeWithPersistedState=function(localDocs,remoteKeys){this._syncedDocuments=remoteKeys,this.limboDocuments=documentKeySet();var docChanges=this.computeDocChanges(localDocs);return this.applyChanges(docChanges,!0)},View.prototype.computeInitialSnapshot=function(){return ViewSnapshot.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===SyncState.Local)},View}(),LOG_TAG$9='SyncEngine',QueryView=function(){return function QueryView(query,targetId,view){this.query=query,this.targetId=targetId,this.view=view}}(),LimboResolution=function(){return function LimboResolution(key){this.key=key}}(),SyncEngine=function(){function SyncEngine(localStore,remoteStore,sharedClientState,currentUser){this.localStore=localStore,this.remoteStore=remoteStore,this.sharedClientState=sharedClientState,this.currentUser=currentUser,this.syncEngineListener=null,this.queryViewsByQuery=new ObjectMap(function(q){return q.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new SortedMap(DocumentKey.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new ReferenceSet,this.mutationUserCallbacks={},this.limboTargetIdGenerator=TargetIdGenerator.forSyncEngine(),this.isPrimary=void 0,this.onlineState=OnlineState.Unknown}return Object.defineProperty(SyncEngine.prototype,'isPrimaryClient',{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),SyncEngine.prototype.subscribe=function(syncEngineListener){assert(null!==syncEngineListener,'SyncEngine listener cannot be null'),assert(null===this.syncEngineListener,'SyncEngine already has a subscriber.'),this.syncEngineListener=syncEngineListener},SyncEngine.prototype.listen=function(query){return tslib_1.__awaiter(this,void 0,void 0,function(){var targetId,viewSnapshot,queryView,queryData,status_1;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return(this.assertSubscribed('listen()'),queryView=this.queryViewsByQuery.get(query),!queryView)?[3,1]:(targetId=queryView.targetId,this.sharedClientState.addLocalQueryTarget(targetId),viewSnapshot=queryView.view.computeInitialSnapshot(),[3,4]);case 1:return[4,this.localStore.allocateQuery(query)];case 2:return queryData=_a.sent(),status_1=this.sharedClientState.addLocalQueryTarget(queryData.targetId),targetId=queryData.targetId,[4,this.initializeViewAndComputeSnapshot(queryData,'current'===status_1)];case 3:viewSnapshot=_a.sent(),this.isPrimary&&this.remoteStore.listen(queryData),_a.label=4;case 4:return this.syncEngineListener.onWatchChange([viewSnapshot]),[2,targetId];}})})},SyncEngine.prototype.initializeViewAndComputeSnapshot=function(queryData,current){var _this=this,query=queryData.query;return this.localStore.executeQuery(query).then(function(docs){return _this.localStore.remoteDocumentKeys(queryData.targetId).then(function(remoteKeys){var view=new View(query,remoteKeys),viewDocChanges=view.computeDocChanges(docs),synthesizedTargetChange=TargetChange.createSynthesizedTargetChangeForCurrentChange(queryData.targetId,current&&_this.onlineState!==OnlineState.Offline),viewChange=view.applyChanges(viewDocChanges,!0===_this.isPrimary,synthesizedTargetChange);assert(0===viewChange.limboChanges.length,'View returned limbo docs before target ack from the server.'),assert(!!viewChange.snapshot,'applyChanges for new view should always return a snapshot');var data=new QueryView(query,queryData.targetId,view);return _this.queryViewsByQuery.set(query,data),_this.queryViewsByTarget[queryData.targetId]=data,viewChange.snapshot})})},SyncEngine.prototype.synchronizeViewAndComputeSnapshot=function(queryView){var _this=this;return this.localStore.executeQuery(queryView.query).then(function(docs){return _this.localStore.remoteDocumentKeys(queryView.targetId).then(function(remoteKeys){return tslib_1.__awaiter(_this,void 0,void 0,function(){var viewSnapshot;return tslib_1.__generator(this,function(){return viewSnapshot=queryView.view.synchronizeWithPersistedState(docs,remoteKeys),this.isPrimary&&this.updateTrackedLimbos(queryView.targetId,viewSnapshot.limboChanges),[2,viewSnapshot]})})})})},SyncEngine.prototype.unlisten=function(query){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this,queryView,targetRemainsActive;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return(this.assertSubscribed('unlisten()'),queryView=this.queryViewsByQuery.get(query),assert(!!queryView,'Trying to unlisten on query not found:'+query),!this.isPrimary)?[3,3]:(this.sharedClientState.removeLocalQueryTarget(queryView.targetId),targetRemainsActive=this.sharedClientState.isActiveQueryTarget(queryView.targetId),targetRemainsActive?[3,2]:[4,this.localStore.releaseQuery(query,!1).then(function(){_this.sharedClientState.clearQueryState(queryView.targetId),_this.remoteStore.unlisten(queryView.targetId),_this.removeAndCleanupQuery(queryView)}).catch(function(err){return _this.ignoreIfPrimaryLeaseLoss(err)})]);case 1:_a.sent(),_a.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(queryView),[4,this.localStore.releaseQuery(query,!0)];case 4:_a.sent(),_a.label=5;case 5:return[2];}})})},SyncEngine.prototype.write=function(batch,userCallback){var _this=this;return this.assertSubscribed('write()'),this.localStore.localWrite(batch).then(function(result){return _this.sharedClientState.addPendingMutation(result.batchId),_this.addMutationCallback(result.batchId,userCallback),_this.emitNewSnapsAndNotifyLocalStore(result.changes)}).then(function(){return _this.remoteStore.fillWritePipeline()})},SyncEngine.prototype.wrapUpdateFunctionError=function(error$$1){return error$$1},SyncEngine.prototype.runTransaction=function(updateFunction,retries){var _this=this;void 0===retries&&(retries=5),assert(0<=retries,'Got negative number of retries for transaction.');var transaction=this.remoteStore.createTransaction();return function(){try{var userPromise=updateFunction(transaction);return!isNullOrUndefined(userPromise)&&userPromise.catch&&userPromise.then?userPromise.catch(function(e){return Promise.reject(_this.wrapUpdateFunctionError(e))}):Promise.reject(Error('Transaction callback must return a Promise'))}catch(e){return Promise.reject(_this.wrapUpdateFunctionError(e))}}().then(function(result){return transaction.commit().then(function(){return result}).catch(function(error$$1){return 0===retries?Promise.reject(error$$1):_this.runTransaction(updateFunction,retries-1)})})},SyncEngine.prototype.applyRemoteEvent=function(remoteEvent){var _this=this;return this.assertSubscribed('applyRemoteEvent()'),this.localStore.applyRemoteEvent(remoteEvent).then(function(changes){return forEach(remoteEvent.targetChanges,function(targetId,targetChange){var limboResolution=_this.limboResolutionsByTarget[targetId];limboResolution&&(assert(1>=targetChange.addedDocuments.size+targetChange.modifiedDocuments.size+targetChange.removedDocuments.size,'Limbo resolution for single document contains multiple changes.'),0<targetChange.addedDocuments.size?limboResolution.receivedDocument=!0:0<targetChange.modifiedDocuments.size?assert(limboResolution.receivedDocument,'Received change for limbo target document without add.'):0<targetChange.removedDocuments.size&&(assert(limboResolution.receivedDocument,'Received remove for limbo target document without add.'),limboResolution.receivedDocument=!1))}),_this.emitNewSnapsAndNotifyLocalStore(changes,remoteEvent)}).catch(function(err){return _this.ignoreIfPrimaryLeaseLoss(err)})},SyncEngine.prototype.applyOnlineStateChange=function(onlineState,source){if(this.isPrimary&&source===OnlineStateSource.RemoteStore||!this.isPrimary&&source===OnlineStateSource.SharedClientState){var newViewSnapshots_1=[];this.queryViewsByQuery.forEach(function(query,queryView){var viewChange=queryView.view.applyOnlineStateChange(onlineState);assert(0===viewChange.limboChanges.length,'OnlineState should not affect limbo documents.'),viewChange.snapshot&&newViewSnapshots_1.push(viewChange.snapshot)}),this.syncEngineListener.onOnlineStateChange(onlineState),this.syncEngineListener.onWatchChange(newViewSnapshots_1),this.onlineState=onlineState,this.isPrimary&&this.sharedClientState.setOnlineState(onlineState)}},SyncEngine.prototype.rejectListen=function(targetId,err){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this,limboResolution,limboKey,documentUpdates,resolvedLimboDocuments,event_1,queryView_1;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return(this.assertSubscribed('rejectListens()'),this.sharedClientState.updateQueryState(targetId,'rejected',err),limboResolution=this.limboResolutionsByTarget[targetId],limboKey=limboResolution&&limboResolution.key,!limboKey)?[3,1]:(this.limboTargetsByKey=this.limboTargetsByKey.remove(limboKey),delete this.limboResolutionsByTarget[targetId],documentUpdates=new SortedMap(DocumentKey.comparator),documentUpdates=documentUpdates.insert(limboKey,new NoDocument(limboKey,SnapshotVersion.forDeletedDoc())),resolvedLimboDocuments=documentKeySet().add(limboKey),event_1=new RemoteEvent(SnapshotVersion.MIN,{},new SortedSet(primitiveComparator),documentUpdates,resolvedLimboDocuments),[2,this.applyRemoteEvent(event_1)]);case 1:return queryView_1=this.queryViewsByTarget[targetId],assert(!!queryView_1,'Unknown targetId: '+targetId),[4,this.localStore.releaseQuery(queryView_1.query,!1).then(function(){return _this.removeAndCleanupQuery(queryView_1)}).catch(function(err){return _this.ignoreIfPrimaryLeaseLoss(err)})];case 2:_a.sent(),this.syncEngineListener.onWatchError(queryView_1.query,err),_a.label=3;case 3:return[2];}})})},SyncEngine.prototype.applyBatchState=function(batchId,batchState,error$$1){return tslib_1.__awaiter(this,void 0,void 0,function(){var documents;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return this.assertSubscribed('applyBatchState()'),[4,this.localStore.lookupMutationDocuments(batchId)];case 1:return documents=_a.sent(),null===documents?(debug(LOG_TAG$9,'Cannot apply mutation batch with id: '+batchId),[2]):'pending'===batchState?[4,this.remoteStore.fillWritePipeline()]:[3,3];case 2:return _a.sent(),[3,4];case 3:'acknowledged'===batchState||'rejected'===batchState?(this.processUserCallback(batchId,error$$1?error$$1:null),this.localStore.removeCachedMutationBatchMetadata(batchId)):fail('Unknown batchState: '+batchState),_a.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(documents)];case 5:return _a.sent(),[2];}})})},SyncEngine.prototype.applySuccessfulWrite=function(mutationBatchResult){var _this=this;this.assertSubscribed('applySuccessfulWrite()');var batchId=mutationBatchResult.batch.batchId;return this.processUserCallback(batchId,null),this.localStore.acknowledgeBatch(mutationBatchResult).then(function(changes){return _this.sharedClientState.updateMutationState(batchId,'acknowledged'),_this.emitNewSnapsAndNotifyLocalStore(changes)}).catch(function(err){return _this.ignoreIfPrimaryLeaseLoss(err)})},SyncEngine.prototype.rejectFailedWrite=function(batchId,error$$1){var _this=this;return this.assertSubscribed('rejectFailedWrite()'),this.processUserCallback(batchId,error$$1),this.localStore.rejectBatch(batchId).then(function(changes){return _this.sharedClientState.updateMutationState(batchId,'rejected',error$$1),_this.emitNewSnapsAndNotifyLocalStore(changes)}).catch(function(err){return _this.ignoreIfPrimaryLeaseLoss(err)})},SyncEngine.prototype.addMutationCallback=function(batchId,callback){var newCallbacks=this.mutationUserCallbacks[this.currentUser.toKey()];newCallbacks||(newCallbacks=new SortedMap(primitiveComparator)),newCallbacks=newCallbacks.insert(batchId,callback),this.mutationUserCallbacks[this.currentUser.toKey()]=newCallbacks},SyncEngine.prototype.processUserCallback=function(batchId,error$$1){var newCallbacks=this.mutationUserCallbacks[this.currentUser.toKey()];if(newCallbacks){var callback=newCallbacks.get(batchId);callback&&(assert(batchId===newCallbacks.minKey(),'Mutation callbacks processed out-of-order?'),error$$1?callback.reject(error$$1):callback.resolve(),newCallbacks=newCallbacks.remove(batchId)),this.mutationUserCallbacks[this.currentUser.toKey()]=newCallbacks}},SyncEngine.prototype.removeAndCleanupQuery=function(queryView){var _this=this;if(this.sharedClientState.removeLocalQueryTarget(queryView.targetId),this.queryViewsByQuery.delete(queryView.query),delete this.queryViewsByTarget[queryView.targetId],this.isPrimary){var limboKeys=this.limboDocumentRefs.referencesForId(queryView.targetId);this.limboDocumentRefs.removeReferencesForId(queryView.targetId),limboKeys.forEach(function(limboKey){var isReferenced=_this.limboDocumentRefs.containsKey(limboKey);isReferenced||_this.removeLimboTarget(limboKey)})}},SyncEngine.prototype.removeLimboTarget=function(key){var limboTargetId=this.limboTargetsByKey.get(key);null===limboTargetId||(this.remoteStore.unlisten(limboTargetId),this.limboTargetsByKey=this.limboTargetsByKey.remove(key),delete this.limboResolutionsByTarget[limboTargetId])},SyncEngine.prototype.updateTrackedLimbos=function(targetId,limboChanges){for(var _i=0,limboChanges_1=limboChanges,limboChange;_i<limboChanges_1.length;_i++)if(limboChange=limboChanges_1[_i],limboChange instanceof AddedLimboDocument)this.limboDocumentRefs.addReference(limboChange.key,targetId),this.trackLimboChange(limboChange);else if(limboChange instanceof RemovedLimboDocument){debug(LOG_TAG$9,'Document no longer in limbo: '+limboChange.key),this.limboDocumentRefs.removeReference(limboChange.key,targetId);var isReferenced=this.limboDocumentRefs.containsKey(limboChange.key);isReferenced||this.removeLimboTarget(limboChange.key)}else fail('Unknown limbo change: '+JSON.stringify(limboChange))},SyncEngine.prototype.trackLimboChange=function(limboChange){var key=limboChange.key;if(!this.limboTargetsByKey.get(key)){debug(LOG_TAG$9,'New document in limbo: '+key);var limboTargetId=this.limboTargetIdGenerator.next(),query=Query.atPath(key.path);this.limboResolutionsByTarget[limboTargetId]=new LimboResolution(key),this.remoteStore.listen(new QueryData(query,limboTargetId,QueryPurpose.LimboResolution,ListenSequence.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(key,limboTargetId)}},SyncEngine.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},SyncEngine.prototype.emitNewSnapsAndNotifyLocalStore=function(changes,remoteEvent){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this,newSnaps,docChangesInAllViews,queriesProcessed;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return newSnaps=[],docChangesInAllViews=[],queriesProcessed=[],this.queryViewsByQuery.forEach(function(_,queryView){queriesProcessed.push(Promise.resolve().then(function(){var viewDocChanges=queryView.view.computeDocChanges(changes);return viewDocChanges.needsRefill?_this.localStore.executeQuery(queryView.query).then(function(docs){return queryView.view.computeDocChanges(docs,viewDocChanges)}):viewDocChanges}).then(function(viewDocChanges){var targetChange=remoteEvent&&remoteEvent.targetChanges[queryView.targetId],viewChange=queryView.view.applyChanges(viewDocChanges,!0===_this.isPrimary,targetChange);if(_this.updateTrackedLimbos(queryView.targetId,viewChange.limboChanges),viewChange.snapshot){_this.isPrimary&&_this.sharedClientState.updateQueryState(queryView.targetId,viewChange.snapshot.fromCache?'not-current':'current'),newSnaps.push(viewChange.snapshot);var docChanges=LocalViewChanges.fromSnapshot(queryView.targetId,viewChange.snapshot);docChangesInAllViews.push(docChanges)}}))}),[4,Promise.all(queriesProcessed)];case 1:return _a.sent(),this.syncEngineListener.onWatchChange(newSnaps),[4,this.localStore.notifyLocalViewChanges(docChangesInAllViews)];case 2:return _a.sent(),[2];}})})},SyncEngine.prototype.ignoreIfPrimaryLeaseLoss=function(err){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(){if(isPrimaryLeaseLostError(err))debug(LOG_TAG$9,'Unexpectedly lost primary lease');else throw err;return[2]})})},SyncEngine.prototype.assertSubscribed=function(fnName){assert(null!==this.syncEngineListener,'Trying to call '+fnName+' before calling subscribe().')},SyncEngine.prototype.handleCredentialChange=function(user){return tslib_1.__awaiter(this,void 0,void 0,function(){var userChanged,result;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return userChanged=!this.currentUser.isEqual(user),this.currentUser=user,userChanged?[4,this.localStore.handleUserChange(user)]:[3,3];case 1:return result=_a.sent(),this.sharedClientState.handleUserChange(user,result.removedBatchIds,result.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(result.affectedDocuments)];case 2:_a.sent(),_a.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return _a.sent(),[2];}})})},SyncEngine.prototype.applyPrimaryState=function(isPrimary){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this,activeTargets,activeQueries,_i,activeQueries_1,queryData,activeTargets_1,p_1;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return!0!==isPrimary||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return _a.sent(),activeTargets=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(activeTargets.toArray())];case 2:for(activeQueries=_a.sent(),_i=0,activeQueries_1=activeQueries;_i<activeQueries_1.length;_i++)queryData=activeQueries_1[_i],this.remoteStore.listen(queryData);return[3,7];case 3:return!1!==isPrimary||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,activeTargets_1=[],p_1=Promise.resolve(),forEachNumber(this.queryViewsByTarget,function(targetId,queryView){_this.sharedClientState.isLocalQueryTarget(targetId)?activeTargets_1.push(targetId):p_1=p_1.then(function(){return _this.unlisten(queryView.query)}),_this.remoteStore.unlisten(queryView.targetId)}),[4,p_1]);case 4:return _a.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(activeTargets_1)];case 5:return _a.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:_a.sent(),_a.label=7;case 7:return[2];}})})},SyncEngine.prototype.resetLimboDocuments=function(){var _this=this;forEachNumber(this.limboResolutionsByTarget,function(targetId){_this.remoteStore.unlisten(targetId)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new SortedMap(DocumentKey.comparator)},SyncEngine.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(targets){for(var _this=this,p=Promise.resolve(),activeQueries=[],newViewSnapshots=[],_loop_1=function(targetId){p=p.then(function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){var queryData,queryView,viewChange,query;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return queryView=this.queryViewsByTarget[targetId],queryView?[4,this.localStore.releaseQuery(queryView.query,!0)]:[3,4];case 1:return _a.sent(),[4,this.localStore.allocateQuery(queryView.query)];case 2:return queryData=_a.sent(),[4,this.synchronizeViewAndComputeSnapshot(queryView)];case 3:return viewChange=_a.sent(),viewChange.snapshot&&newViewSnapshots.push(viewChange.snapshot),[3,8];case 4:return assert(!0===this.isPrimary,'A secondary tab should never have an active query without an active view.'),[4,this.localStore.getQueryForTarget(targetId)];case 5:return query=_a.sent(),assert(!!query,'Query data for target '+targetId+' not found'),[4,this.localStore.allocateQuery(query)];case 6:return queryData=_a.sent(),[4,this.initializeViewAndComputeSnapshot(queryData,!1)];case 7:_a.sent(),_a.label=8;case 8:return activeQueries.push(queryData),[2];}})})})},_i=0,targets_1=targets,targetId;_i<targets_1.length;_i++)targetId=targets_1[_i],_loop_1(targetId);return p.then(function(){return _this.syncEngineListener.onWatchChange(newViewSnapshots),activeQueries})},SyncEngine.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},SyncEngine.prototype.applyTargetState=function(targetId,state,error$$1){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this,_a,queryView;return tslib_1.__generator(this,function(_b){switch(_b.label){case 0:return this.isPrimary?(debug(LOG_TAG$9,'Ignoring unexpected query state notification.'),[2]):this.queryViewsByTarget[targetId]?(_a=state,'current'===_a?[3,1]:'not-current'===_a?[3,1]:'rejected'===_a?[3,2]:[3,4]):[3,5];case 1:return[2,this.localStore.getNewDocumentChanges().then(function(changes){return tslib_1.__awaiter(_this,void 0,void 0,function(){var synthesizedRemoteEvent;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return synthesizedRemoteEvent=RemoteEvent.createSynthesizedRemoteEventForCurrentChange(targetId,'current'===state),[4,this.emitNewSnapsAndNotifyLocalStore(changes,synthesizedRemoteEvent)];case 1:return _a.sent(),[2];}})})},function(err){return tslib_1.__awaiter(_this,void 0,void 0,function(){var activeTargets_2;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return isDocumentChangeMissingError(err)?(activeTargets_2=[],forEachNumber(this.queryViewsByTarget,function(target){return activeTargets_2.push(target)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(activeTargets_2)]):[3,2];case 1:return _a.sent(),[3,3];case 2:throw err;case 3:return[2];}})})})];_b.label=2;case 2:return queryView=this.queryViewsByTarget[targetId],this.removeAndCleanupQuery(queryView),[4,this.localStore.releaseQuery(queryView.query,!0)];case 3:return _b.sent(),this.syncEngineListener.onWatchError(queryView.query,error$$1),[3,5];case 4:fail('Unexpected target state: '+state),_b.label=5;case 5:return[2];}})})},SyncEngine.prototype.applyActiveTargetsChange=function(added,removed){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this,_i,added_1,targetId,query,queryData,_loop_2,this_1,_a,removed_1,targetId;return tslib_1.__generator(this,function(_b){switch(_b.label){case 0:if(!this.isPrimary)return[2];_i=0,added_1=added,_b.label=1;case 1:return _i<added_1.length?(targetId=added_1[_i],assert(!this.queryViewsByTarget[targetId],'Trying to add an already active target'),[4,this.localStore.getQueryForTarget(targetId)]):[3,6];case 2:return query=_b.sent(),assert(!!query,'Query data for active target '+targetId+' not found'),[4,this.localStore.allocateQuery(query)];case 3:return queryData=_b.sent(),[4,this.initializeViewAndComputeSnapshot(queryData,!1)];case 4:_b.sent(),this.remoteStore.listen(queryData),_b.label=5;case 5:return _i++,[3,1];case 6:_loop_2=function(targetId){var queryView;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return queryView=this_1.queryViewsByTarget[targetId],queryView?[4,this_1.localStore.releaseQuery(queryView.query,!1).then(function(){_this.remoteStore.unlisten(targetId),_this.removeAndCleanupQuery(queryView)}).catch(function(err){return _this.ignoreIfPrimaryLeaseLoss(err)})]:[3,2];case 1:_a.sent(),_a.label=2;case 2:return[2];}})},this_1=this,_a=0,removed_1=removed,_b.label=7;case 7:return _a<removed_1.length?(targetId=removed_1[_a],[5,_loop_2(targetId)]):[3,10];case 8:_b.sent(),_b.label=9;case 9:return _a++,[3,7];case 10:return[2];}})})},SyncEngine.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},SyncEngine.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},SyncEngine.prototype.getRemoteKeysForTarget=function(targetId){var limboResolution=this.limboResolutionsByTarget[targetId];return limboResolution&&limboResolution.receivedDocument?documentKeySet().add(limboResolution.key):this.queryViewsByTarget[targetId]?this.queryViewsByTarget[targetId].view.syncedDocuments:documentKeySet()},SyncEngine}(),User=function(){function User(uid){this.uid=uid}return User.prototype.isAuthenticated=function(){return null!=this.uid},User.prototype.toKey=function(){return this.isAuthenticated()?'uid:'+this.uid:'anonymous-user'},User.prototype.isEqual=function(otherUser){return otherUser.uid===this.uid},User.UNAUTHENTICATED=new User(null),User.GOOGLE_CREDENTIALS=new User('google-credentials-uid'),User.FIRST_PARTY=new User('first-party-uid'),User}(),LOG_TAG$10='SharedClientState',CLIENT_STATE_KEY_PREFIX='firestore_clients',MUTATION_BATCH_KEY_PREFIX='firestore_mutations',QUERY_TARGET_KEY_PREFIX='firestore_targets',MutationMetadata=function(){function MutationMetadata(user,batchId,state,error$$1){this.user=user,this.batchId=batchId,this.state=state,this.error=error$$1,assert(void 0!==error$$1==('rejected'===state),'MutationMetadata must contain an error iff state is \'rejected\'')}return MutationMetadata.fromWebStorageEntry=function(user,batchId,value){var mutationBatch=JSON.parse(value),validData='object'==typeof mutationBatch&&-1!==['pending','acknowledged','rejected'].indexOf(mutationBatch.state)&&(void 0===mutationBatch.error||'object'==typeof mutationBatch.error),firestoreError=void 0;return validData&&mutationBatch.error&&(validData='string'==typeof mutationBatch.error.message&&'string'==typeof mutationBatch.error.code,validData&&(firestoreError=new FirestoreError(mutationBatch.error.code,mutationBatch.error.message))),validData?new MutationMetadata(user,batchId,mutationBatch.state,firestoreError):(error(LOG_TAG$10,'Failed to parse mutation state for ID \''+batchId+'\': '+value),null)},MutationMetadata.prototype.toWebStorageJSON=function(){var batchMetadata={state:this.state,updateTimeMs:Date.now()};return this.error&&(batchMetadata.error={code:this.error.code,message:this.error.message}),JSON.stringify(batchMetadata)},MutationMetadata}(),QueryTargetMetadata=function(){function QueryTargetMetadata(targetId,state,error$$1){this.targetId=targetId,this.state=state,this.error=error$$1,assert(void 0!==error$$1==('rejected'===state),'QueryTargetMetadata must contain an error iff state is \'rejected\'')}return QueryTargetMetadata.fromWebStorageEntry=function(targetId,value){var targetState=JSON.parse(value),validData='object'==typeof targetState&&-1!==['not-current','current','rejected'].indexOf(targetState.state)&&(void 0===targetState.error||'object'==typeof targetState.error),firestoreError=void 0;return validData&&targetState.error&&(validData='string'==typeof targetState.error.message&&'string'==typeof targetState.error.code,validData&&(firestoreError=new FirestoreError(targetState.error.code,targetState.error.message))),validData?new QueryTargetMetadata(targetId,targetState.state,firestoreError):(error(LOG_TAG$10,'Failed to parse target state for ID \''+targetId+'\': '+value),null)},QueryTargetMetadata.prototype.toWebStorageJSON=function(){var targetState={state:this.state,updateTimeMs:Date.now()};return this.error&&(targetState.error={code:this.error.code,message:this.error.message}),JSON.stringify(targetState)},QueryTargetMetadata}(),RemoteClientState=function(){function RemoteClientState(clientId,activeTargetIds){this.clientId=clientId,this.activeTargetIds=activeTargetIds}return RemoteClientState.fromWebStorageEntry=function(clientId,value){for(var clientState=JSON.parse(value),validData='object'==typeof clientState&&clientState.activeTargetIds instanceof Array,activeTargetIdsSet=targetIdSet(),i=0;validData&&i<clientState.activeTargetIds.length;++i)validData=isSafeInteger(clientState.activeTargetIds[i]),activeTargetIdsSet=activeTargetIdsSet.add(clientState.activeTargetIds[i]);return validData?new RemoteClientState(clientId,activeTargetIdsSet):(error(LOG_TAG$10,'Failed to parse client data for instance \''+clientId+'\': '+value),null)},RemoteClientState}(),SharedOnlineState=function(){function SharedOnlineState(clientId,onlineState){this.clientId=clientId,this.onlineState=onlineState}return SharedOnlineState.fromWebStorageEntry=function(value){var onlineState=JSON.parse(value),validData='object'==typeof onlineState&&void 0!==OnlineState[onlineState.onlineState]&&'string'==typeof onlineState.clientId;return validData?new SharedOnlineState(onlineState.clientId,OnlineState[onlineState.onlineState]):(error(LOG_TAG$10,'Failed to parse online state: '+value),null)},SharedOnlineState}(),LocalClientState=function(){function LocalClientState(){this.activeTargetIds=targetIdSet()}return LocalClientState.prototype.addQueryTarget=function(targetId){assert(!this.activeTargetIds.has(targetId),'Target with ID \''+targetId+'\' already active.'),this.activeTargetIds=this.activeTargetIds.add(targetId)},LocalClientState.prototype.removeQueryTarget=function(targetId){this.activeTargetIds=this.activeTargetIds.delete(targetId)},LocalClientState.prototype.toWebStorageJSON=function(){var data={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(data)},LocalClientState}(),WebStorageSharedClientState=function(){function WebStorageSharedClientState(queue,platform,persistenceKey,localClientId,initialUser){if(this.queue=queue,this.platform=platform,this.persistenceKey=persistenceKey,this.localClientId=localClientId,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!WebStorageSharedClientState.isAvailable(this.platform))throw new FirestoreError(Code.UNIMPLEMENTED,'LocalStorage is not available on this platform.');var escapedPersistenceKey=persistenceKey.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');this.storage=this.platform.window.localStorage,this.currentUser=initialUser,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey='firestore_sequence_number'+'_'+persistenceKey,this.activeClients[this.localClientId]=new LocalClientState,this.clientStateKeyRe=new RegExp('^'+CLIENT_STATE_KEY_PREFIX+'_'+escapedPersistenceKey+'_([^_]*)$'),this.mutationBatchKeyRe=new RegExp('^'+MUTATION_BATCH_KEY_PREFIX+'_'+escapedPersistenceKey+'_(\\d+)(?:_(.*))?$'),this.queryTargetKeyRe=new RegExp('^'+QUERY_TARGET_KEY_PREFIX+'_'+escapedPersistenceKey+'_(\\d+)$'),this.onlineStateKey='firestore_online_state'+'_'+persistenceKey,this.platform.window.addEventListener('storage',this.storageListener)}return WebStorageSharedClientState.isAvailable=function(platform){return!!(platform.window&&null!=platform.window.localStorage)},WebStorageSharedClientState.prototype.start=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){var _this=this,existingClients,_i,existingClients_1,clientId,storageItem,clientState,onlineStateJSON,onlineState,_a,_b,event_1;return tslib_1.__generator(this,function(_c){switch(_c.label){case 0:return assert(!this.started,'WebStorageSharedClientState already started'),assert(null!==this.syncEngine,'syncEngine property must be set before calling start()'),assert(null!==this.onlineStateHandler,'onlineStateHandler property must be set before calling start()'),[4,this.syncEngine.getActiveClients()];case 1:for(existingClients=_c.sent(),_i=0,existingClients_1=existingClients;_i<existingClients_1.length;_i++)(clientId=existingClients_1[_i],clientId!==this.localClientId)&&(storageItem=this.getItem(this.toWebStorageClientStateKey(clientId)),storageItem&&(clientState=RemoteClientState.fromWebStorageEntry(clientId,storageItem),clientState&&(this.activeClients[clientState.clientId]=clientState)));for(this.persistClientState(),onlineStateJSON=this.storage.getItem(this.onlineStateKey),onlineStateJSON&&(onlineState=this.fromWebStorageOnlineState(onlineStateJSON),onlineState&&this.handleOnlineStateEvent(onlineState)),(_a=0,_b=this.earlyEvents);_a<_b.length;_a++)event_1=_b[_a],this.handleWebStorageEvent(event_1);return this.earlyEvents=[],this.platform.window.addEventListener('unload',function(){return _this.shutdown()}),this.started=!0,[2];}})})},WebStorageSharedClientState.prototype.writeSequenceNumber=function(sequenceNumber){this.setItem(this.sequenceNumberKey,JSON.stringify(sequenceNumber))},WebStorageSharedClientState.prototype.getAllActiveQueryTargets=function(){var activeTargets=targetIdSet();return forEach(this.activeClients,function(key,value){activeTargets=activeTargets.unionWith(value.activeTargetIds)}),activeTargets},WebStorageSharedClientState.prototype.isActiveQueryTarget=function(targetId){for(var clientId in this.activeClients)if(this.activeClients.hasOwnProperty(clientId)&&this.activeClients[clientId].activeTargetIds.has(targetId))return!0;return!1},WebStorageSharedClientState.prototype.addPendingMutation=function(batchId){this.persistMutationState(batchId,'pending')},WebStorageSharedClientState.prototype.updateMutationState=function(batchId,state,error$$1){this.persistMutationState(batchId,state,error$$1),this.removeMutationState(batchId)},WebStorageSharedClientState.prototype.addLocalQueryTarget=function(targetId){var queryState='not-current';if(this.isActiveQueryTarget(targetId)){var storageItem=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(targetId));if(storageItem){var metadata=QueryTargetMetadata.fromWebStorageEntry(targetId,storageItem);metadata&&(queryState=metadata.state)}}return this.localClientState.addQueryTarget(targetId),this.persistClientState(),queryState},WebStorageSharedClientState.prototype.removeLocalQueryTarget=function(targetId){this.localClientState.removeQueryTarget(targetId),this.persistClientState()},WebStorageSharedClientState.prototype.isLocalQueryTarget=function(targetId){return this.localClientState.activeTargetIds.has(targetId)},WebStorageSharedClientState.prototype.clearQueryState=function(targetId){this.removeItem(this.toWebStorageQueryTargetMetadataKey(targetId))},WebStorageSharedClientState.prototype.updateQueryState=function(targetId,state,error$$1){this.persistQueryTargetState(targetId,state,error$$1)},WebStorageSharedClientState.prototype.handleUserChange=function(user,removedBatchIds,addedBatchIds){var _this=this;removedBatchIds.forEach(function(batchId){_this.removeMutationState(batchId)}),this.currentUser=user,addedBatchIds.forEach(function(batchId){_this.addPendingMutation(batchId)})},WebStorageSharedClientState.prototype.setOnlineState=function(onlineState){this.persistOnlineState(onlineState)},WebStorageSharedClientState.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener('storage',this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},WebStorageSharedClientState.prototype.getItem=function(key){var value=this.storage.getItem(key);return debug(LOG_TAG$10,'READ',key,value),value},WebStorageSharedClientState.prototype.setItem=function(key,value){debug(LOG_TAG$10,'SET',key,value),this.storage.setItem(key,value)},WebStorageSharedClientState.prototype.removeItem=function(key){debug(LOG_TAG$10,'REMOVE',key),this.storage.removeItem(key)},WebStorageSharedClientState.prototype.handleWebStorageEvent=function(event){var _this=this;if(event.storageArea===this.storage){if(debug(LOG_TAG$10,'EVENT',event.key,event.newValue),event.key===this.localClientStorageKey)return void error('Received WebStorage notification for local change. Another client might have '+'garbage-collected our state');this.queue.enqueueAndForget(function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){var clientState,clientId,mutationMetadata,queryTargetMetadata,onlineState,sequenceNumber;return tslib_1.__generator(this,function(){if(!this.started)return this.earlyEvents.push(event),[2];if(null===event.key)return[2];if(this.clientStateKeyRe.test(event.key)){if(null==event.newValue)return clientId=this.fromWebStorageClientStateKey(event.key),[2,this.handleClientStateEvent(clientId,null)];if(clientState=this.fromWebStorageClientState(event.key,event.newValue),clientState)return[2,this.handleClientStateEvent(clientState.clientId,clientState)]}else if(this.mutationBatchKeyRe.test(event.key)){if(null!==event.newValue&&(mutationMetadata=this.fromWebStorageMutationMetadata(event.key,event.newValue),mutationMetadata))return[2,this.handleMutationBatchEvent(mutationMetadata)];}else if(this.queryTargetKeyRe.test(event.key)){if(null!==event.newValue&&(queryTargetMetadata=this.fromWebStorageQueryTargetMetadata(event.key,event.newValue),queryTargetMetadata))return[2,this.handleQueryTargetEvent(queryTargetMetadata)];}else if(event.key!==this.onlineStateKey)event.key===this.sequenceNumberKey&&(assert(!!this.sequenceNumberHandler,'Missing sequenceNumberHandler'),sequenceNumber=fromWebStorageSequenceNumber(event.newValue),sequenceNumber!==ListenSequence.INVALID&&this.sequenceNumberHandler(sequenceNumber));else if(null!==event.newValue&&(onlineState=this.fromWebStorageOnlineState(event.newValue),onlineState))return[2,this.handleOnlineStateEvent(onlineState)];return[2]})})})}},Object.defineProperty(WebStorageSharedClientState.prototype,'localClientState',{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),WebStorageSharedClientState.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},WebStorageSharedClientState.prototype.persistMutationState=function(batchId,state,error$$1){var mutationState=new MutationMetadata(this.currentUser,batchId,state,error$$1),mutationKey=this.toWebStorageMutationBatchKey(batchId);this.setItem(mutationKey,mutationState.toWebStorageJSON())},WebStorageSharedClientState.prototype.removeMutationState=function(batchId){var mutationKey=this.toWebStorageMutationBatchKey(batchId);this.removeItem(mutationKey)},WebStorageSharedClientState.prototype.persistOnlineState=function(onlineState){var entry={clientId:this.localClientId,onlineState:OnlineState[onlineState]};this.storage.setItem(this.onlineStateKey,JSON.stringify(entry))},WebStorageSharedClientState.prototype.persistQueryTargetState=function(targetId,state,error$$1){var targetKey=this.toWebStorageQueryTargetMetadataKey(targetId),targetMetadata=new QueryTargetMetadata(targetId,state,error$$1);this.setItem(targetKey,targetMetadata.toWebStorageJSON())},WebStorageSharedClientState.prototype.toWebStorageClientStateKey=function(clientId){return assert(-1===clientId.indexOf('_'),'Client key cannot contain \'_\', but was \''+clientId+'\''),CLIENT_STATE_KEY_PREFIX+'_'+this.persistenceKey+'_'+clientId},WebStorageSharedClientState.prototype.toWebStorageQueryTargetMetadataKey=function(targetId){return QUERY_TARGET_KEY_PREFIX+'_'+this.persistenceKey+'_'+targetId},WebStorageSharedClientState.prototype.toWebStorageMutationBatchKey=function(batchId){var mutationKey=MUTATION_BATCH_KEY_PREFIX+'_'+this.persistenceKey+'_'+batchId;return this.currentUser.isAuthenticated()&&(mutationKey+='_'+this.currentUser.uid),mutationKey},WebStorageSharedClientState.prototype.fromWebStorageClientStateKey=function(key){var match=this.clientStateKeyRe.exec(key);return match?match[1]:null},WebStorageSharedClientState.prototype.fromWebStorageClientState=function(key,value){var clientId=this.fromWebStorageClientStateKey(key);return assert(null!==clientId,'Cannot parse client state key \''+key+'\''),RemoteClientState.fromWebStorageEntry(clientId,value)},WebStorageSharedClientState.prototype.fromWebStorageMutationMetadata=function(key,value){var match=this.mutationBatchKeyRe.exec(key);assert(null!==match,'Cannot parse mutation batch key \''+key+'\'');var batchId=+match[1],userId=void 0===match[2]?null:match[2];return MutationMetadata.fromWebStorageEntry(new User(userId),batchId,value)},WebStorageSharedClientState.prototype.fromWebStorageQueryTargetMetadata=function(key,value){var match=this.queryTargetKeyRe.exec(key);assert(null!==match,'Cannot parse query target key \''+key+'\'');var targetId=+match[1];return QueryTargetMetadata.fromWebStorageEntry(targetId,value)},WebStorageSharedClientState.prototype.fromWebStorageOnlineState=function(value){return SharedOnlineState.fromWebStorageEntry(value)},WebStorageSharedClientState.prototype.handleMutationBatchEvent=function(mutationBatch){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return mutationBatch.user.uid===this.currentUser.uid?[2,this.syncEngine.applyBatchState(mutationBatch.batchId,mutationBatch.state,mutationBatch.error)]:(debug(LOG_TAG$10,'Ignoring mutation for non-active user '+mutationBatch.user.uid),[2])})})},WebStorageSharedClientState.prototype.handleQueryTargetEvent=function(targetMetadata){return this.syncEngine.applyTargetState(targetMetadata.targetId,targetMetadata.state,targetMetadata.error)},WebStorageSharedClientState.prototype.handleClientStateEvent=function(clientId,clientState){var _this=this,existingTargets=this.getAllActiveQueryTargets();clientState?this.activeClients[clientId]=clientState:delete this.activeClients[clientId];var newTargets=this.getAllActiveQueryTargets(),addedTargets=[],removedTargets=[];return newTargets.forEach(function(targetId){return tslib_1.__awaiter(_this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return existingTargets.has(targetId)||addedTargets.push(targetId),[2]})})}),existingTargets.forEach(function(targetId){return tslib_1.__awaiter(_this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return newTargets.has(targetId)||removedTargets.push(targetId),[2]})})}),this.syncEngine.applyActiveTargetsChange(addedTargets,removedTargets)},WebStorageSharedClientState.prototype.handleOnlineStateEvent=function(onlineState){this.activeClients[onlineState.clientId]&&this.onlineStateHandler(onlineState.onlineState)},WebStorageSharedClientState}(),MemorySharedClientState=function(){function MemorySharedClientState(){this.localState=new LocalClientState,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return MemorySharedClientState.prototype.addPendingMutation=function(){},MemorySharedClientState.prototype.updateMutationState=function(){},MemorySharedClientState.prototype.addLocalQueryTarget=function(targetId){return this.localState.addQueryTarget(targetId),this.queryState[targetId]||'not-current'},MemorySharedClientState.prototype.updateQueryState=function(targetId,state){this.queryState[targetId]=state},MemorySharedClientState.prototype.removeLocalQueryTarget=function(targetId){this.localState.removeQueryTarget(targetId)},MemorySharedClientState.prototype.isLocalQueryTarget=function(targetId){return this.localState.activeTargetIds.has(targetId)},MemorySharedClientState.prototype.clearQueryState=function(targetId){delete this.queryState[targetId]},MemorySharedClientState.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},MemorySharedClientState.prototype.isActiveQueryTarget=function(targetId){return this.localState.activeTargetIds.has(targetId)},MemorySharedClientState.prototype.start=function(){return this.localState=new LocalClientState,Promise.resolve()},MemorySharedClientState.prototype.handleUserChange=function(){},MemorySharedClientState.prototype.setOnlineState=function(){},MemorySharedClientState.prototype.shutdown=function(){},MemorySharedClientState.prototype.writeSequenceNumber=function(){},MemorySharedClientState}(),LOG_TAG$11='FirestoreClient',FirestoreClient=function(){function FirestoreClient(platform,databaseInfo,credentials,asyncQueue){this.platform=platform,this.databaseInfo=databaseInfo,this.credentials=credentials,this.asyncQueue=asyncQueue,this.clientId=AutoId.newId()}return FirestoreClient.prototype.start=function(persistenceSettings){var _this=this,initializationDone=new Deferred$1,persistenceResult=new Deferred$1,initialized=!1;return this.credentials.setChangeListener(function(user){initialized?_this.asyncQueue.enqueueAndForget(function(){return _this.handleCredentialChange(user)}):(initialized=!0,_this.initializePersistence(persistenceSettings,persistenceResult,user).then(function(){return _this.initializeRest(user)}).then(initializationDone.resolve,initializationDone.reject))}),this.asyncQueue.enqueueAndForget(function(){return initializationDone.promise}),persistenceResult.promise},FirestoreClient.prototype.enableNetwork=function(){var _this=this;return this.asyncQueue.enqueue(function(){return _this.syncEngine.enableNetwork()})},FirestoreClient.prototype.initializePersistence=function(persistenceSettings,persistenceResult,user){var _this=this;return persistenceSettings.enabled?this.startIndexedDbPersistence(user,persistenceSettings).then(persistenceResult.resolve).catch(function(error$$1){return(persistenceResult.reject(error$$1),!_this.canFallback(error$$1))?Promise.reject(error$$1):(console.warn('Error enabling offline storage. Falling back to'+' storage disabled: '+error$$1),_this.startMemoryPersistence())}):(persistenceResult.resolve(),this.startMemoryPersistence())},FirestoreClient.prototype.canFallback=function(error$$1){return error$$1 instanceof FirestoreError?error$$1.code===Code.FAILED_PRECONDITION||error$$1.code===Code.UNIMPLEMENTED:'undefined'!=typeof DOMException&&error$$1 instanceof DOMException?error$$1.code===22||error$$1.code===20:!0},FirestoreClient.prototype.startIndexedDbPersistence=function(user,settings){var _this=this;assert(settings.enabled,'Should only start IndexedDb persitence with offline persistence enabled.');var storagePrefix=IndexedDbPersistence.buildStoragePrefix(this.databaseInfo),serializer=new JsonProtoSerializer(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){var _a,_b;return tslib_1.__generator(this,function(_c){switch(_c.label){case 0:if(settings.experimentalTabSynchronization&&!WebStorageSharedClientState.isAvailable(this.platform))throw new FirestoreError(Code.UNIMPLEMENTED,'IndexedDB persistence is only available on platforms that support LocalStorage.');return settings.experimentalTabSynchronization?(this.sharedClientState=new WebStorageSharedClientState(this.asyncQueue,this.platform,storagePrefix,this.clientId,user),_a=this,[4,IndexedDbPersistence.createMultiClientIndexedDbPersistence(storagePrefix,this.clientId,this.platform,this.asyncQueue,serializer,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return _a.persistence=_c.sent(),[3,4];case 2:return this.sharedClientState=new MemorySharedClientState,_b=this,[4,IndexedDbPersistence.createIndexedDbPersistence(storagePrefix,this.clientId,this.platform,this.asyncQueue,serializer)];case 3:_b.persistence=_c.sent(),_c.label=4;case 4:return[2];}})})})},FirestoreClient.prototype.startMemoryPersistence=function(){var serializer=new JsonProtoSerializer(this.databaseInfo.databaseId,{useProto3Json:!0});return this.persistence=MemoryPersistence.createEagerPersistence(this.clientId,serializer),this.sharedClientState=new MemorySharedClientState,Promise.resolve()},FirestoreClient.prototype.initializeRest=function(user){var _this=this;return debug(LOG_TAG$11,'Initializing. user=',user.uid),this.platform.loadConnection(this.databaseInfo).then(function(connection){return tslib_1.__awaiter(_this,void 0,void 0,function(){var _this=this,serializer,datastore,remoteStoreOnlineStateChangedHandler,sharedClientStateOnlineStateChangedHandler;return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return this.localStore=new LocalStore(this.persistence,user),serializer=this.platform.newSerializer(this.databaseInfo.databaseId),datastore=new Datastore(this.asyncQueue,connection,this.credentials,serializer),remoteStoreOnlineStateChangedHandler=function(onlineState){return _this.syncEngine.applyOnlineStateChange(onlineState,OnlineStateSource.RemoteStore)},sharedClientStateOnlineStateChangedHandler=function(onlineState){return _this.syncEngine.applyOnlineStateChange(onlineState,OnlineStateSource.SharedClientState)},this.remoteStore=new RemoteStore(this.localStore,datastore,this.asyncQueue,remoteStoreOnlineStateChangedHandler),this.syncEngine=new SyncEngine(this.localStore,this.remoteStore,this.sharedClientState,user),this.sharedClientState.onlineStateHandler=sharedClientStateOnlineStateChangedHandler,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new EventManager(this.syncEngine),[4,this.sharedClientState.start()];case 1:return _a.sent(),[4,this.remoteStore.start()];case 2:return _a.sent(),[4,this.persistence.setPrimaryStateListener(function(isPrimary){return _this.syncEngine.applyPrimaryState(isPrimary)})];case 3:return _a.sent(),[2];}})})})},FirestoreClient.prototype.handleCredentialChange=function(user){return this.asyncQueue.verifyOperationInProgress(),debug(LOG_TAG$11,'Credential Changed. Current user: '+user.uid),this.syncEngine.handleCredentialChange(user)},FirestoreClient.prototype.disableNetwork=function(){var _this=this;return this.asyncQueue.enqueue(function(){return _this.syncEngine.disableNetwork()})},FirestoreClient.prototype.shutdown=function(options){var _this=this;return this.asyncQueue.enqueue(function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){return tslib_1.__generator(this,function(_a){switch(_a.label){case 0:return[4,this.remoteStore.shutdown()];case 1:return _a.sent(),[4,this.sharedClientState.shutdown()];case 2:return _a.sent(),[4,this.persistence.shutdown(options&&options.purgePersistenceWithDataLoss)];case 3:return _a.sent(),this.credentials.removeChangeListener(),[2];}})})})},FirestoreClient.prototype.listen=function(query,observer,options){var _this=this,listener=new QueryListener(query,observer,options);return this.asyncQueue.enqueueAndForget(function(){return _this.eventMgr.listen(listener)}),listener},FirestoreClient.prototype.unlisten=function(listener){var _this=this;this.asyncQueue.enqueueAndForget(function(){return _this.eventMgr.unlisten(listener)})},FirestoreClient.prototype.getDocumentFromLocalCache=function(docKey){var _this=this;return this.asyncQueue.enqueue(function(){return _this.localStore.readDocument(docKey)}).then(function(maybeDoc){if(maybeDoc instanceof Document)return maybeDoc;if(maybeDoc instanceof NoDocument)return null;throw new FirestoreError(Code.UNAVAILABLE,'Failed to get document from cache. (However, this document may '+'exist on the server. Run again without setting \'source\' in '+'the GetOptions to attempt to retrieve the document from the '+'server.)')})},FirestoreClient.prototype.getDocumentsFromLocalCache=function(query){var _this=this;return this.asyncQueue.enqueue(function(){return _this.localStore.executeQuery(query)}).then(function(docs){var remoteKeys=documentKeySet(),view=new View(query,remoteKeys),viewDocChanges=view.computeDocChanges(docs);return view.applyChanges(viewDocChanges,!1).snapshot})},FirestoreClient.prototype.write=function(mutations){var _this=this,deferred=new Deferred$1;return this.asyncQueue.enqueueAndForget(function(){return _this.syncEngine.write(mutations,deferred)}),deferred.promise},FirestoreClient.prototype.databaseId=function(){return this.databaseInfo.databaseId},FirestoreClient.prototype.transaction=function(updateFunction){var _this=this;return this.asyncQueue.enqueue(function(){return tslib_1.__awaiter(_this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return[2]})})}).then(function(){return _this.syncEngine.runTransaction(updateFunction)})},FirestoreClient}(),AsyncObserver=function(){function AsyncObserver(observer){this.observer=observer,this.muted=!1}return AsyncObserver.prototype.next=function(value){this.scheduleEvent(this.observer.next,value)},AsyncObserver.prototype.error=function(error){this.scheduleEvent(this.observer.error,error)},AsyncObserver.prototype.mute=function(){this.muted=!0},AsyncObserver.prototype.scheduleEvent=function(eventHandler,event){var _this=this;this.muted||setTimeout(function(){_this.muted||eventHandler(event)},0)},AsyncObserver}(),FieldPath$1=function(){function FieldPath$$1(){for(var fieldNames=[],_i=0;_i<arguments.length;_i++)fieldNames[_i]=arguments[_i];validateNamedArrayAtLeastNumberOfElements('FieldPath',fieldNames,'fieldNames',1);for(var i=0;i<fieldNames.length;++i)if(validateArgType('FieldPath','string',i,fieldNames[i]),0===fieldNames[i].length)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid field name at argument $(i + 1). '+'Field names must not be empty.');this._internalPath=new FieldPath(fieldNames)}return FieldPath$$1.documentId=function(){return FieldPath$$1._DOCUMENT_ID},FieldPath$$1.prototype.isEqual=function(other){if(!(other instanceof FieldPath$$1))throw invalidClassError('isEqual','FieldPath',1,other);return this._internalPath.isEqual(other._internalPath)},FieldPath$$1._DOCUMENT_ID=new FieldPath$$1(FieldPath.keyField().canonicalString()),FieldPath$$1}(),RESERVED=/[~\*\/\[\]]/,OAuthToken=function(){return function OAuthToken(value,user){this.user=user,this.type='OAuth',this.authHeaders={Authorization:'Bearer '+value}}}(),EmptyCredentialsProvider=function(){function EmptyCredentialsProvider(){this.changeListener=null}return EmptyCredentialsProvider.prototype.getToken=function(){return Promise.resolve(null)},EmptyCredentialsProvider.prototype.invalidateToken=function(){},EmptyCredentialsProvider.prototype.setChangeListener=function(changeListener){assert(!this.changeListener,'Can only call setChangeListener() once.'),this.changeListener=changeListener,changeListener(User.UNAUTHENTICATED)},EmptyCredentialsProvider.prototype.removeChangeListener=function(){assert(null!==this.changeListener,'removeChangeListener() when no listener registered'),this.changeListener=null},EmptyCredentialsProvider}(),FirebaseCredentialsProvider=function(){function FirebaseCredentialsProvider(app){var _this=this;this.app=app,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){_this.tokenCounter++,_this.currentUser=_this.getUser(),_this.changeListener&&_this.changeListener(_this.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return FirebaseCredentialsProvider.prototype.getToken=function(){var _this=this;assert(null!=this.tokenListener,'getToken cannot be called after listener removed.');var initialTokenCounter=this.tokenCounter,forceRefresh=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(forceRefresh).then(function(tokenData){if(_this.tokenCounter!==initialTokenCounter)throw new FirestoreError(Code.ABORTED,'getToken aborted due to token change.');else return tokenData?(assert('string'==typeof tokenData.accessToken,'Invalid tokenData returned from getToken():'+tokenData),new OAuthToken(tokenData.accessToken,_this.currentUser)):null})},FirebaseCredentialsProvider.prototype.invalidateToken=function(){this.forceRefresh=!0},FirebaseCredentialsProvider.prototype.setChangeListener=function(changeListener){assert(!this.changeListener,'Can only call setChangeListener() once.'),this.changeListener=changeListener,this.currentUser&&changeListener(this.currentUser)},FirebaseCredentialsProvider.prototype.removeChangeListener=function(){assert(null!=this.tokenListener,'removeChangeListener() called twice'),assert(null!==this.changeListener,'removeChangeListener() called when no listener registered'),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},FirebaseCredentialsProvider.prototype.getUser=function(){var currentUid=this.app.INTERNAL.getUid();return assert(null===currentUid||'string'==typeof currentUid,'Received invalid UID: '+currentUid),new User(currentUid)},FirebaseCredentialsProvider}(),FirstPartyToken=function(){function FirstPartyToken(gapi,sessionIndex){this.gapi=gapi,this.sessionIndex=sessionIndex,this.type='FirstParty',this.user=User.FIRST_PARTY,assert(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,'unexpected gapi interface')}return Object.defineProperty(FirstPartyToken.prototype,'authHeaders',{get:function(){return{Authorization:this.gapi.auth.getAuthHeaderValueForFirstParty([]),"X-Goog-AuthUser":this.sessionIndex}},enumerable:!0,configurable:!0}),FirstPartyToken}(),FirstPartyCredentialsProvider=function(){function FirstPartyCredentialsProvider(gapi,sessionIndex){this.gapi=gapi,this.sessionIndex=sessionIndex,assert(this.gapi&&this.gapi.auth&&this.gapi.auth.getAuthHeaderValueForFirstParty,'unexpected gapi interface')}return FirstPartyCredentialsProvider.prototype.getToken=function(){return Promise.resolve(new FirstPartyToken(this.gapi,this.sessionIndex))},FirstPartyCredentialsProvider.prototype.setChangeListener=function(changeListener){changeListener(User.FIRST_PARTY)},FirstPartyCredentialsProvider.prototype.removeChangeListener=function(){},FirstPartyCredentialsProvider.prototype.invalidateToken=function(){},FirstPartyCredentialsProvider}(),FieldValueImpl=function(){function FieldValueImpl(_methodName){this._methodName=_methodName}return FieldValueImpl.delete=function(){return DeleteFieldValueImpl.instance},FieldValueImpl.serverTimestamp=function(){return ServerTimestampFieldValueImpl.instance},FieldValueImpl.arrayUnion=function(){for(var elements=[],_i=0;_i<arguments.length;_i++)elements[_i]=arguments[_i];return validateAtLeastNumberOfArgs('FieldValue.arrayUnion',arguments,1),new ArrayUnionFieldValueImpl(elements)},FieldValueImpl.arrayRemove=function(){for(var elements=[],_i=0;_i<arguments.length;_i++)elements[_i]=arguments[_i];return validateAtLeastNumberOfArgs('FieldValue.arrayRemove',arguments,1),new ArrayRemoveFieldValueImpl(elements)},FieldValueImpl.prototype.isEqual=function(other){return this===other},FieldValueImpl}(),DeleteFieldValueImpl=function(_super){function DeleteFieldValueImpl(){return _super.call(this,'FieldValue.delete')||this}return tslib_1.__extends(DeleteFieldValueImpl,_super),DeleteFieldValueImpl.instance=new DeleteFieldValueImpl,DeleteFieldValueImpl}(FieldValueImpl),ServerTimestampFieldValueImpl=function(_super){function ServerTimestampFieldValueImpl(){return _super.call(this,'FieldValue.serverTimestamp')||this}return tslib_1.__extends(ServerTimestampFieldValueImpl,_super),ServerTimestampFieldValueImpl.instance=new ServerTimestampFieldValueImpl,ServerTimestampFieldValueImpl}(FieldValueImpl),ArrayUnionFieldValueImpl=function(_super){function ArrayUnionFieldValueImpl(_elements){var _this=_super.call(this,'FieldValue.arrayUnion')||this;return _this._elements=_elements,_this}return tslib_1.__extends(ArrayUnionFieldValueImpl,_super),ArrayUnionFieldValueImpl}(FieldValueImpl),ArrayRemoveFieldValueImpl=function(_super){function ArrayRemoveFieldValueImpl(_elements){var _this=_super.call(this,'FieldValue.arrayRemove')||this;return _this._elements=_elements,_this}return tslib_1.__extends(ArrayRemoveFieldValueImpl,_super),ArrayRemoveFieldValueImpl}(FieldValueImpl),PublicFieldValue=makeConstructorPrivate(FieldValueImpl,'Use FieldValue.<field>() instead.'),RESERVED_FIELD_REGEX=/^__.*__$/,ParsedSetData=function(){function ParsedSetData(data,fieldMask,fieldTransforms){this.data=data,this.fieldMask=fieldMask,this.fieldTransforms=fieldTransforms}return ParsedSetData.prototype.toMutations=function(key,precondition){var mutations=[];return null===this.fieldMask?mutations.push(new SetMutation(key,this.data,precondition)):mutations.push(new PatchMutation(key,this.data,this.fieldMask,precondition)),0<this.fieldTransforms.length&&mutations.push(new TransformMutation(key,this.fieldTransforms)),mutations},ParsedSetData}(),ParsedUpdateData=function(){function ParsedUpdateData(data,fieldMask,fieldTransforms){this.data=data,this.fieldMask=fieldMask,this.fieldTransforms=fieldTransforms}return ParsedUpdateData.prototype.toMutations=function(key,precondition){var mutations=[new PatchMutation(key,this.data,this.fieldMask,precondition)];return 0<this.fieldTransforms.length&&mutations.push(new TransformMutation(key,this.fieldTransforms)),mutations},ParsedUpdateData}(),UserDataSource;(function(UserDataSource){UserDataSource[UserDataSource.Set=0]='Set',UserDataSource[UserDataSource.Update=1]='Update',UserDataSource[UserDataSource.MergeSet=2]='MergeSet',UserDataSource[UserDataSource.Argument=3]='Argument'})(UserDataSource||(UserDataSource={}));var ParseContext=function(){function ParseContext(dataSource,methodName,path,arrayElement,fieldTransforms,fieldMask){this.dataSource=dataSource,this.methodName=methodName,this.path=path,this.arrayElement=arrayElement,void 0===fieldTransforms&&this.validatePath(),this.arrayElement=void 0!==arrayElement&&arrayElement,this.fieldTransforms=fieldTransforms||[],this.fieldMask=fieldMask||[]}return ParseContext.prototype.childContextForField=function(field){var childPath=null==this.path?null:this.path.child(field),context=new ParseContext(this.dataSource,this.methodName,childPath,!1,this.fieldTransforms,this.fieldMask);return context.validatePathSegment(field),context},ParseContext.prototype.childContextForFieldPath=function(field){var childPath=null==this.path?null:this.path.child(field),context=new ParseContext(this.dataSource,this.methodName,childPath,!1,this.fieldTransforms,this.fieldMask);return context.validatePath(),context},ParseContext.prototype.childContextForArray=function(){return new ParseContext(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},ParseContext.prototype.createError=function(reason){var fieldDescription=null===this.path||this.path.isEmpty()?'':' (found in field '+this.path.toString()+')';return new FirestoreError(Code.INVALID_ARGUMENT,'Function '+this.methodName+'() called with invalid data. '+reason+fieldDescription)},ParseContext.prototype.contains=function(fieldPath){return void 0!==this.fieldMask.find(function(field){return fieldPath.isPrefixOf(field)})||void 0!==this.fieldTransforms.find(function(transform){return fieldPath.isPrefixOf(transform.field)})},ParseContext.prototype.validatePath=function(){if(null!==this.path)for(var i=0;i<this.path.length;i++)this.validatePathSegment(this.path.get(i))},ParseContext.prototype.validatePathSegment=function(segment){if(isWrite(this.dataSource)&&RESERVED_FIELD_REGEX.test(segment))throw this.createError('Document fields cannot begin and end with __')},ParseContext}(),DocumentKeyReference=function(){return function DocumentKeyReference(databaseId,key){this.databaseId=databaseId,this.key=key}}(),UserDataConverter=function(){function UserDataConverter(preConverter){this.preConverter=preConverter}return UserDataConverter.prototype.parseSetData=function(methodName,input){var context=new ParseContext(UserDataSource.Set,methodName,FieldPath.EMPTY_PATH);validatePlainObject('Data must be an object, but it was:',context,input);var updateData=this.parseData(input,context);return new ParsedSetData(updateData,null,context.fieldTransforms)},UserDataConverter.prototype.parseMergeData=function(methodName,input,fieldPaths){var context=new ParseContext(UserDataSource.MergeSet,methodName,FieldPath.EMPTY_PATH);validatePlainObject('Data must be an object, but it was:',context,input);var updateData=this.parseData(input,context),fieldMask,fieldTransforms;if(!fieldPaths)fieldMask=new FieldMask(context.fieldMask),fieldTransforms=context.fieldTransforms;else{for(var validatedFieldPaths=[],_i=0,fieldPaths_1=fieldPaths;_i<fieldPaths_1.length;_i++){var stringOrFieldPath=fieldPaths_1[_i],fieldPath=void 0;if(stringOrFieldPath instanceof FieldPath$1)fieldPath=stringOrFieldPath._internalPath;else if('string'==typeof stringOrFieldPath)fieldPath=fieldPathFromDotSeparatedString(methodName,stringOrFieldPath);else throw fail('Expected stringOrFieldPath to be a string or a FieldPath');if(!context.contains(fieldPath))throw new FirestoreError(Code.INVALID_ARGUMENT,'Field \''+fieldPath+'\' is specified in your field mask but missing from your input data.');validatedFieldPaths.push(fieldPath)}fieldMask=new FieldMask(validatedFieldPaths),fieldTransforms=context.fieldTransforms.filter(function(transform){return fieldMask.covers(transform.field)})}return new ParsedSetData(updateData,fieldMask,fieldTransforms)},UserDataConverter.prototype.parseUpdateData=function(methodName,input){var _this=this,context=new ParseContext(UserDataSource.Update,methodName,FieldPath.EMPTY_PATH);validatePlainObject('Data must be an object, but it was:',context,input);var fieldMaskPaths=[],updateData=ObjectValue.EMPTY;forEach(input,function(key,value){var path=fieldPathFromDotSeparatedString(methodName,key),childContext=context.childContextForFieldPath(path);if(value=_this.runPreConverter(value,childContext),value instanceof DeleteFieldValueImpl)fieldMaskPaths.push(path);else{var parsedValue=_this.parseData(value,childContext);null!=parsedValue&&(fieldMaskPaths.push(path),updateData=updateData.set(path,parsedValue))}});var mask=new FieldMask(fieldMaskPaths);return new ParsedUpdateData(updateData,mask,context.fieldTransforms)},UserDataConverter.prototype.parseUpdateVarargs=function(methodName,field,value,moreFieldsAndValues){var context=new ParseContext(UserDataSource.Update,methodName,FieldPath.EMPTY_PATH),keys=[fieldPathFromArgument(methodName,field)],values$$1=[value];if(0!=moreFieldsAndValues.length%2)throw new FirestoreError(Code.INVALID_ARGUMENT,'Function '+methodName+'() needs to be called with an even number '+'of arguments that alternate between field names and values.');for(var i=0;i<moreFieldsAndValues.length;i+=2)keys.push(fieldPathFromArgument(methodName,moreFieldsAndValues[i])),values$$1.push(moreFieldsAndValues[i+1]);for(var fieldMaskPaths=[],updateData=ObjectValue.EMPTY,i=0;i<keys.length;++i){var path=keys[i],childContext=context.childContextForFieldPath(path),value_1=this.runPreConverter(values$$1[i],childContext);if(value_1 instanceof DeleteFieldValueImpl)fieldMaskPaths.push(path);else{var parsedValue=this.parseData(value_1,childContext);null!=parsedValue&&(fieldMaskPaths.push(path),updateData=updateData.set(path,parsedValue))}}var mask=new FieldMask(fieldMaskPaths);return new ParsedUpdateData(updateData,mask,context.fieldTransforms)},UserDataConverter.prototype.parseQueryValue=function(methodName,input){var context=new ParseContext(UserDataSource.Argument,methodName,FieldPath.EMPTY_PATH),parsed=this.parseData(input,context);return assert(null!=parsed,'Parsed data should not be null.'),assert(0===context.fieldTransforms.length,'Field transforms should have been disallowed.'),parsed},UserDataConverter.prototype.runPreConverter=function(input,context){try{return this.preConverter(input)}catch(e){var message=errorMessage(e);throw context.createError(message)}},UserDataConverter.prototype.parseData=function(input,context){if(input=this.runPreConverter(input,context),looksLikeJsonObject(input))return validatePlainObject('Unsupported field value:',context,input),this.parseObject(input,context);if(input instanceof FieldValueImpl)return this.parseSentinelFieldValue(input,context),null;if(context.path&&context.fieldMask.push(context.path),input instanceof Array){if(context.arrayElement)throw context.createError('Nested arrays are not supported');return this.parseArray(input,context)}return this.parseScalarValue(input,context)},UserDataConverter.prototype.parseObject=function(obj,context){var _this=this,result=new SortedMap(primitiveComparator);return isEmpty(obj)?context.path&&0<context.path.length&&context.fieldMask.push(context.path):forEach(obj,function(key,val){var parsedValue=_this.parseData(val,context.childContextForField(key));null!=parsedValue&&(result=result.insert(key,parsedValue))}),new ObjectValue(result)},UserDataConverter.prototype.parseArray=function(array,context){for(var result=[],entryIndex=0,_i=0,array_1=array;_i<array_1.length;_i++){var entry=array_1[_i],parsedEntry=this.parseData(entry,context.childContextForArray(entryIndex));null==parsedEntry&&(parsedEntry=NullValue.INSTANCE),result.push(parsedEntry),entryIndex++}return new ArrayValue(result)},UserDataConverter.prototype.parseSentinelFieldValue=function(value,context){if(!isWrite(context.dataSource))throw context.createError(value._methodName+'() can only be used with update() and set()');if(null===context.path)throw context.createError(value._methodName+'() is not currently supported inside arrays');if(value instanceof DeleteFieldValueImpl){if(context.dataSource===UserDataSource.MergeSet)context.fieldMask.push(context.path);else if(context.dataSource===UserDataSource.Update)throw assert(0<context.path.length,'FieldValue.delete() at the top level should have already'+' been handled.'),context.createError('FieldValue.delete() can only appear at the top level '+'of your update data');else throw context.createError('FieldValue.delete() cannot be used with set() unless you pass '+'{merge:true}');}else if(value instanceof ServerTimestampFieldValueImpl)context.fieldTransforms.push(new FieldTransform(context.path,ServerTimestampTransform.instance));else if(value instanceof ArrayUnionFieldValueImpl){var parsedElements=this.parseArrayTransformElements(value._methodName,value._elements),arrayUnion=new ArrayUnionTransformOperation(parsedElements);context.fieldTransforms.push(new FieldTransform(context.path,arrayUnion))}else if(value instanceof ArrayRemoveFieldValueImpl){var parsedElements=this.parseArrayTransformElements(value._methodName,value._elements),arrayRemove=new ArrayRemoveTransformOperation(parsedElements);context.fieldTransforms.push(new FieldTransform(context.path,arrayRemove))}else fail('Unknown FieldValue type: '+value)},UserDataConverter.prototype.parseScalarValue=function(value,context){if(null===value)return NullValue.INSTANCE;if('number'==typeof value)return isSafeInteger(value)?new IntegerValue(value):new DoubleValue(value);if('boolean'==typeof value)return BooleanValue.of(value);if('string'==typeof value)return new StringValue(value);if(value instanceof Date)return new TimestampValue(Timestamp.fromDate(value));if(value instanceof Timestamp)return new TimestampValue(new Timestamp(value.seconds,1e3*_Mathfloor(value.nanoseconds/1e3)));if(value instanceof GeoPoint)return new GeoPointValue(value);if(value instanceof Blob)return new BlobValue(value);if(value instanceof DocumentKeyReference)return new RefValue(value.databaseId,value.key);throw context.createError('Unsupported field value: '+valueDescription(value))},UserDataConverter.prototype.parseArrayTransformElements=function(methodName,elements){var _this=this;return elements.map(function(element,i){var context=new ParseContext(UserDataSource.Argument,methodName,FieldPath.EMPTY_PATH);return _this.parseData(element,context.childContextForArray(i))})},UserDataConverter}(),DEFAULT_SSL=!0,FirestoreSettings=function(){function FirestoreSettings(settings){if(void 0===settings.host){if(void 0!==settings.ssl)throw new FirestoreError(Code.INVALID_ARGUMENT,'Can\'t provide ssl option if host option is not set');this.host='firestore.googleapis.com',this.ssl=DEFAULT_SSL}else validateNamedType('settings','non-empty string','host',settings.host),this.host=settings.host,validateNamedOptionalType('settings','boolean','ssl',settings.ssl),this.ssl=defaulted(settings.ssl,DEFAULT_SSL);validateOptionNames('settings',settings,['host','ssl','credentials','timestampsInSnapshots']),validateNamedOptionalType('settings','object','credentials',settings.credentials),this.credentials=settings.credentials,validateNamedOptionalType('settings','boolean','timestampsInSnapshots',settings.timestampsInSnapshots),this.timestampsInSnapshots=defaulted(settings.timestampsInSnapshots,!1)}return FirestoreSettings.prototype.isEqual=function(other){return this.host===other.host&&this.ssl===other.ssl&&this.timestampsInSnapshots===other.timestampsInSnapshots&&this.credentials===other.credentials},FirestoreSettings}(),FirestoreConfig=function(){return function FirestoreConfig(){}}(),PersistenceSettings=function(){function PersistenceSettings(enabled,settings){this.enabled=enabled,assert(enabled||!settings,'Can only provide PersistenceSettings with persistence enabled'),settings=settings||{},this.experimentalTabSynchronization=defaulted(settings.experimentalTabSynchronization,!1)}return PersistenceSettings.prototype.isEqual=function(other){return this.enabled===other.enabled&&this.experimentalTabSynchronization===other.experimentalTabSynchronization},PersistenceSettings}(),Firestore=function(){function Firestore(databaseIdOrApp){var _this=this;this._queue=new AsyncQueue,this.INTERNAL={delete:function(options){return tslib_1.__awaiter(_this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return this._firestoreClient?[2,this._firestoreClient.shutdown(options)]:[2]})})}};var config=new FirestoreConfig;if('object'==typeof databaseIdOrApp.options){var app=databaseIdOrApp;config.firebaseApp=app,config.databaseId=Firestore.databaseIdFromApp(app),config.persistenceKey=config.firebaseApp.name,config.credentials=new FirebaseCredentialsProvider(app)}else{var external_1=databaseIdOrApp;if(!external_1.projectId)throw new FirestoreError(Code.INVALID_ARGUMENT,'Must provide projectId');config.databaseId=new DatabaseId(external_1.projectId,external_1.database),config.persistenceKey='[DEFAULT]',config.credentials=new EmptyCredentialsProvider}config.settings=new FirestoreSettings({}),this._config=config,this._databaseId=config.databaseId}return Firestore.prototype.settings=function(settingsLiteral){if(validateExactNumberOfArgs('Firestore.settings',arguments,1),validateArgType('Firestore.settings','object',1,settingsLiteral),contains(settingsLiteral,'persistence'))throw new FirestoreError(Code.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to '+'firestore.enablePersistence().');var newSettings=new FirestoreSettings(settingsLiteral);if(this._firestoreClient&&!this._config.settings.isEqual(newSettings))throw new FirestoreError(Code.FAILED_PRECONDITION,'Firestore has already been started and its settings can no longer '+'be changed. You can only call settings() before calling any other '+'methods on a Firestore object.');this._config.settings=newSettings,void 0!==newSettings.credentials&&(this._config.credentials=makeCredentialsProvider(newSettings.credentials))},Firestore.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},Firestore.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},Firestore.prototype.enablePersistence=function(settings){if(this._firestoreClient)throw new FirestoreError(Code.FAILED_PRECONDITION,'Firestore has already been started and persistence can no longer '+'be enabled. You can only call enablePersistence() before calling '+'any other methods on a Firestore object.');return this.configureClient(new PersistenceSettings(!0,settings))},Firestore.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new PersistenceSettings(!1)),this._firestoreClient},Firestore.prototype.configureClient=function(persistenceSettings){var _this=this;assert(!!this._config.settings.host,'FirestoreSettings.host cannot be falsey'),this._config.settings.timestampsInSnapshots||error('\nThe behavior for Date objects stored in Firestore is going to change\nAND YOUR APP MAY BREAK.\nTo hide this warning and ensure your app does not break, you need to add the\nfollowing code to your app before calling any other Cloud Firestore methods:\n\n  const firestore = firebase.firestore();\n  const settings = {/* your settings... */ timestampsInSnapshots: true};\n  firestore.settings(settings);\n\nWith this change, timestamps stored in Cloud Firestore will be read back as\nFirebase Timestamp objects instead of as system Date objects. So you will also\nneed to update code expecting a Date to instead expect a Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get(\'created_at\');\n  // New:\n  const timestamp = snapshot.get(\'created_at\');\n  const date = timestamp.toDate();\n\nPlease audit all existing usages of Date when you enable the new behavior. In a\nfuture release, the behavior will change to the new behavior, so if you do not\nfollow these steps, YOUR APP MAY BREAK.'),assert(!this._firestoreClient,'configureClient() called multiple times');var databaseInfo=new DatabaseInfo(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl);return this._dataConverter=new UserDataConverter(function(value){if(value instanceof DocumentReference){var thisDb=_this._config.databaseId,otherDb=value.firestore._config.databaseId;if(!otherDb.isEqual(thisDb))throw new FirestoreError(Code.INVALID_ARGUMENT,'Document reference is for database '+(otherDb.projectId+'/'+otherDb.database+' but should be ')+('for database '+thisDb.projectId+'/'+thisDb.database));return new DocumentKeyReference(_this._config.databaseId,value._key)}return value}),this._firestoreClient=new FirestoreClient(PlatformSupport.getPlatform(),databaseInfo,this._config.credentials,this._queue),this._firestoreClient.start(persistenceSettings)},Firestore.databaseIdFromApp=function(app){var options=app.options;if(!contains(options,'projectId'))throw new FirestoreError(Code.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var projectId=options.projectId;if(!projectId||'string'!=typeof projectId)throw new FirestoreError(Code.INVALID_ARGUMENT,'projectId must be a string in FirebaseApp.options');return new DatabaseId(projectId)},Object.defineProperty(Firestore.prototype,'app',{get:function(){if(!this._config.firebaseApp)throw new FirestoreError(Code.FAILED_PRECONDITION,'Firestore was not initialized using the Firebase SDK. \'app\' is '+'not available');return this._config.firebaseApp},enumerable:!0,configurable:!0}),Firestore.prototype.collection=function(pathString){if(validateExactNumberOfArgs('Firestore.collection',arguments,1),validateArgType('Firestore.collection','non-empty string',1,pathString),!pathString)throw new FirestoreError(Code.INVALID_ARGUMENT,'Must provide a non-empty collection path to collection()');return this.ensureClientConfigured(),new CollectionReference(ResourcePath.fromString(pathString),this)},Firestore.prototype.doc=function(pathString){if(validateExactNumberOfArgs('Firestore.doc',arguments,1),validateArgType('Firestore.doc','non-empty string',1,pathString),!pathString)throw new FirestoreError(Code.INVALID_ARGUMENT,'Must provide a non-empty document path to doc()');return this.ensureClientConfigured(),DocumentReference.forPath(ResourcePath.fromString(pathString),this)},Firestore.prototype.runTransaction=function(updateFunction){var _this=this;return validateExactNumberOfArgs('Firestore.runTransaction',arguments,1),validateArgType('Firestore.runTransaction','function',1,updateFunction),this.ensureClientConfigured().transaction(function(transaction){return updateFunction(new Transaction$1(_this,transaction))})},Firestore.prototype.batch=function(){return this.ensureClientConfigured(),new WriteBatch(this)},Object.defineProperty(Firestore,'logLevel',{get:function(){switch(getLogLevel()){case LogLevel.DEBUG:return'debug';case LogLevel.ERROR:return'error';case LogLevel.SILENT:return'silent';default:return fail('Unknown log level: '+getLogLevel());}},enumerable:!0,configurable:!0}),Firestore.setLogLevel=function(level){switch(validateExactNumberOfArgs('Firestore.setLogLevel',arguments,1),validateArgType('Firestore.setLogLevel','non-empty string',1,level),level){case'debug':setLogLevel(LogLevel.DEBUG);break;case'error':setLogLevel(LogLevel.ERROR);break;case'silent':setLogLevel(LogLevel.SILENT);break;default:throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid log level: '+level);}},Firestore.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},Firestore}(),Transaction$1=function(){function Transaction(_firestore,_transaction){this._firestore=_firestore,this._transaction=_transaction}return Transaction.prototype.get=function(documentRef){var _this=this;validateExactNumberOfArgs('Transaction.get',arguments,1);var ref=validateReference('Transaction.get',documentRef,this._firestore);return this._transaction.lookup([ref._key]).then(function(docs){if(!docs||1!==docs.length)return fail('Mismatch in docs returned from document lookup.');var doc=docs[0];if(doc instanceof NoDocument)return new DocumentSnapshot(_this._firestore,ref._key,null,!1,!1);if(doc instanceof Document)return new DocumentSnapshot(_this._firestore,ref._key,doc,!1,!1);throw fail('BatchGetDocumentsRequest returned unexpected document type: '+doc.constructor.name)})},Transaction.prototype.set=function(documentRef,value,options){validateBetweenNumberOfArgs('Transaction.set',arguments,2,3);var ref=validateReference('Transaction.set',documentRef,this._firestore);options=validateSetOptions('Transaction.set',options);var parsed=options.merge||options.mergeFields?this._firestore._dataConverter.parseMergeData('Transaction.set',value,options.mergeFields):this._firestore._dataConverter.parseSetData('Transaction.set',value);return this._transaction.set(ref._key,parsed),this},Transaction.prototype.update=function(documentRef,fieldOrUpdateData,value){for(var moreFieldsAndValues=[],_i=3;_i<arguments.length;_i++)moreFieldsAndValues[_i-3]=arguments[_i];var ref,parsed;return'string'==typeof fieldOrUpdateData||fieldOrUpdateData instanceof FieldPath$1?(validateAtLeastNumberOfArgs('Transaction.update',arguments,3),ref=validateReference('Transaction.update',documentRef,this._firestore),parsed=this._firestore._dataConverter.parseUpdateVarargs('Transaction.update',fieldOrUpdateData,value,moreFieldsAndValues)):(validateExactNumberOfArgs('Transaction.update',arguments,2),ref=validateReference('Transaction.update',documentRef,this._firestore),parsed=this._firestore._dataConverter.parseUpdateData('Transaction.update',fieldOrUpdateData)),this._transaction.update(ref._key,parsed),this},Transaction.prototype.delete=function(documentRef){validateExactNumberOfArgs('Transaction.delete',arguments,1);var ref=validateReference('Transaction.delete',documentRef,this._firestore);return this._transaction.delete(ref._key),this},Transaction}(),WriteBatch=function(){function WriteBatch(_firestore){this._firestore=_firestore,this._mutations=[],this._committed=!1}return WriteBatch.prototype.set=function(documentRef,value,options){validateBetweenNumberOfArgs('WriteBatch.set',arguments,2,3),this.verifyNotCommitted();var ref=validateReference('WriteBatch.set',documentRef,this._firestore);options=validateSetOptions('WriteBatch.set',options);var parsed=options.merge||options.mergeFields?this._firestore._dataConverter.parseMergeData('WriteBatch.set',value,options.mergeFields):this._firestore._dataConverter.parseSetData('WriteBatch.set',value);return this._mutations=this._mutations.concat(parsed.toMutations(ref._key,Precondition.NONE)),this},WriteBatch.prototype.update=function(documentRef,fieldOrUpdateData,value){for(var moreFieldsAndValues=[],_i=3;_i<arguments.length;_i++)moreFieldsAndValues[_i-3]=arguments[_i];this.verifyNotCommitted();var ref,parsed;return'string'==typeof fieldOrUpdateData||fieldOrUpdateData instanceof FieldPath$1?(validateAtLeastNumberOfArgs('WriteBatch.update',arguments,3),ref=validateReference('WriteBatch.update',documentRef,this._firestore),parsed=this._firestore._dataConverter.parseUpdateVarargs('WriteBatch.update',fieldOrUpdateData,value,moreFieldsAndValues)):(validateExactNumberOfArgs('WriteBatch.update',arguments,2),ref=validateReference('WriteBatch.update',documentRef,this._firestore),parsed=this._firestore._dataConverter.parseUpdateData('WriteBatch.update',fieldOrUpdateData)),this._mutations=this._mutations.concat(parsed.toMutations(ref._key,Precondition.exists(!0))),this},WriteBatch.prototype.delete=function(documentRef){validateExactNumberOfArgs('WriteBatch.delete',arguments,1),this.verifyNotCommitted();var ref=validateReference('WriteBatch.delete',documentRef,this._firestore);return this._mutations=this._mutations.concat(new DeleteMutation(ref._key,Precondition.NONE)),this},WriteBatch.prototype.commit=function(){return tslib_1.__awaiter(this,void 0,void 0,function(){return tslib_1.__generator(this,function(){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},WriteBatch.prototype.verifyNotCommitted=function(){if(this._committed)throw new FirestoreError(Code.FAILED_PRECONDITION,'A write batch can no longer be used after commit() '+'has been called.')},WriteBatch}(),DocumentReference=function(){function DocumentReference(_key,firestore){this._key=_key,this.firestore=firestore,this._firestoreClient=this.firestore.ensureClientConfigured()}return DocumentReference.forPath=function(path,firestore){if(0!=path.length%2)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid document reference. Document '+'references must have an even number of segments, but '+(path.canonicalString()+' has '+path.length));return new DocumentReference(new DocumentKey(path),firestore)},Object.defineProperty(DocumentReference.prototype,'id',{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(DocumentReference.prototype,'parent',{get:function(){return new CollectionReference(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(DocumentReference.prototype,'path',{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),DocumentReference.prototype.collection=function(pathString){if(validateExactNumberOfArgs('DocumentReference.collection',arguments,1),validateArgType('DocumentReference.collection','non-empty string',1,pathString),!pathString)throw new FirestoreError(Code.INVALID_ARGUMENT,'Must provide a non-empty collection name to collection()');var path=ResourcePath.fromString(pathString);return new CollectionReference(this._key.path.child(path),this.firestore)},DocumentReference.prototype.isEqual=function(other){if(!(other instanceof DocumentReference))throw invalidClassError('isEqual','DocumentReference',1,other);return this.firestore===other.firestore&&this._key.isEqual(other._key)},DocumentReference.prototype.set=function(value,options){validateBetweenNumberOfArgs('DocumentReference.set',arguments,1,2),options=validateSetOptions('DocumentReference.set',options);var parsed=options.merge||options.mergeFields?this.firestore._dataConverter.parseMergeData('DocumentReference.set',value,options.mergeFields):this.firestore._dataConverter.parseSetData('DocumentReference.set',value);return this._firestoreClient.write(parsed.toMutations(this._key,Precondition.NONE))},DocumentReference.prototype.update=function(fieldOrUpdateData,value){for(var moreFieldsAndValues=[],_i=2;_i<arguments.length;_i++)moreFieldsAndValues[_i-2]=arguments[_i];var parsed;return'string'==typeof fieldOrUpdateData||fieldOrUpdateData instanceof FieldPath$1?(validateAtLeastNumberOfArgs('DocumentReference.update',arguments,2),parsed=this.firestore._dataConverter.parseUpdateVarargs('DocumentReference.update',fieldOrUpdateData,value,moreFieldsAndValues)):(validateExactNumberOfArgs('DocumentReference.update',arguments,1),parsed=this.firestore._dataConverter.parseUpdateData('DocumentReference.update',fieldOrUpdateData)),this._firestoreClient.write(parsed.toMutations(this._key,Precondition.exists(!0)))},DocumentReference.prototype.delete=function(){return validateExactNumberOfArgs('DocumentReference.delete',arguments,0),this._firestoreClient.write([new DeleteMutation(this._key,Precondition.NONE)])},DocumentReference.prototype.onSnapshot=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];validateBetweenNumberOfArgs('DocumentReference.onSnapshot',arguments,1,4);var options={includeMetadataChanges:!1},currArg=0,observer;'object'!=typeof args[currArg]||isPartialObserver(args[currArg])||(options=args[currArg],validateOptionNames('DocumentReference.onSnapshot',options,['includeMetadataChanges']),validateNamedOptionalType('DocumentReference.onSnapshot','boolean','includeMetadataChanges',options.includeMetadataChanges),currArg++);var internalOptions={includeMetadataChanges:options.includeMetadataChanges};return isPartialObserver(args[currArg])?observer=args[currArg]:(validateArgType('DocumentReference.onSnapshot','function',currArg,args[currArg]),validateOptionalArgType('DocumentReference.onSnapshot','function',currArg+1,args[currArg+1]),validateOptionalArgType('DocumentReference.onSnapshot','function',currArg+2,args[currArg+2]),observer={next:args[currArg],error:args[currArg+1],complete:args[currArg+2]}),this.onSnapshotInternal(internalOptions,observer)},DocumentReference.prototype.onSnapshotInternal=function(options,observer){var _this=this,errHandler=function(err){console.error('Uncaught Error in onSnapshot:',err)};observer.error&&(errHandler=observer.error.bind(observer));var asyncObserver=new AsyncObserver({next:function(snapshot){if(observer.next){assert(1>=snapshot.docs.size,'Too many documents returned on a document query');var doc=snapshot.docs.get(_this._key);observer.next(new DocumentSnapshot(_this.firestore,_this._key,doc,snapshot.fromCache,snapshot.hasPendingWrites))}},error:errHandler}),internalListener=this._firestoreClient.listen(Query.atPath(this._key.path),asyncObserver,options);return function(){asyncObserver.mute(),_this._firestoreClient.unlisten(internalListener)}},DocumentReference.prototype.get=function(options){var _this=this;return validateBetweenNumberOfArgs('DocumentReference.get',arguments,0,1),validateGetOptions('DocumentReference.get',options),new Promise(function(resolve,reject){options&&'cache'===options.source?_this.firestore.ensureClientConfigured().getDocumentFromLocalCache(_this._key).then(function(doc){resolve(new DocumentSnapshot(_this.firestore,_this._key,doc,!0,!!(doc instanceof Document)&&doc.hasLocalMutations))},reject):_this.getViaSnapshotListener(resolve,reject,options)})},DocumentReference.prototype.getViaSnapshotListener=function(resolve,reject,options){var unlisten=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(snap){unlisten(),!snap.exists&&snap.metadata.fromCache?reject(new FirestoreError(Code.UNAVAILABLE,'Failed to get document because the client is '+'offline.')):snap.exists&&snap.metadata.fromCache&&options&&'server'===options.source?reject(new FirestoreError(Code.UNAVAILABLE,'Failed to get document from server. (However, this '+'document does exist in the local cache. Run again '+'without setting source to "server" to '+'retrieve the cached document.)')):resolve(snap)},error:reject})},DocumentReference}(),SnapshotMetadata=function(){function SnapshotMetadata(hasPendingWrites,fromCache){this.hasPendingWrites=hasPendingWrites,this.fromCache=fromCache}return SnapshotMetadata.prototype.isEqual=function(other){return this.hasPendingWrites===other.hasPendingWrites&&this.fromCache===other.fromCache},SnapshotMetadata}(),DocumentSnapshot=function(){function DocumentSnapshot(_firestore,_key,_document,_fromCache,_hasPendingWrites){this._firestore=_firestore,this._key=_key,this._document=_document,this._fromCache=_fromCache,this._hasPendingWrites=_hasPendingWrites}return DocumentSnapshot.prototype.data=function(options){return validateBetweenNumberOfArgs('DocumentSnapshot.data',arguments,0,1),options=validateSnapshotOptions('DocumentSnapshot.data',options),this._document?this.convertObject(this._document.data,FieldValueOptions.fromSnapshotOptions(options,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},DocumentSnapshot.prototype.get=function(fieldPath,options){if(validateBetweenNumberOfArgs('DocumentSnapshot.get',arguments,1,2),options=validateSnapshotOptions('DocumentSnapshot.get',options),this._document){var value=this._document.data.field(fieldPathFromArgument('DocumentSnapshot.get',fieldPath));if(void 0!==value)return this.convertValue(value,FieldValueOptions.fromSnapshotOptions(options,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(DocumentSnapshot.prototype,'id',{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(DocumentSnapshot.prototype,'ref',{get:function(){return new DocumentReference(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(DocumentSnapshot.prototype,'exists',{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(DocumentSnapshot.prototype,'metadata',{get:function(){return new SnapshotMetadata(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),DocumentSnapshot.prototype.isEqual=function(other){if(!(other instanceof DocumentSnapshot))throw invalidClassError('isEqual','DocumentSnapshot',1,other);return this._firestore===other._firestore&&this._fromCache===other._fromCache&&this._key.isEqual(other._key)&&(null===this._document?null===other._document:this._document.isEqual(other._document))},DocumentSnapshot.prototype.convertObject=function(data,options){var _this=this,result={};return data.forEach(function(key,value){result[key]=_this.convertValue(value,options)}),result},DocumentSnapshot.prototype.convertValue=function(value,options){if(value instanceof ObjectValue)return this.convertObject(value,options);if(value instanceof ArrayValue)return this.convertArray(value,options);if(value instanceof RefValue){var key=value.value(options),database=this._firestore.ensureClientConfigured().databaseId();return value.databaseId.isEqual(database)||error('Document '+this._key.path+' contains a document '+'reference within a different database ('+(value.databaseId.projectId+'/'+value.databaseId.database+') which is not ')+'supported. It will be treated as a reference in the current '+('database ('+database.projectId+'/'+database.database+') ')+'instead.'),new DocumentReference(key,this._firestore)}return value.value(options)},DocumentSnapshot.prototype.convertArray=function(data,options){var _this=this;return data.internalValue.map(function(value){return _this.convertValue(value,options)})},DocumentSnapshot}(),QueryDocumentSnapshot=function(_super){function QueryDocumentSnapshot(firestore,key,document,fromCache,hasPendingWrites){return _super.call(this,firestore,key,document,fromCache,hasPendingWrites)||this}return tslib_1.__extends(QueryDocumentSnapshot,_super),QueryDocumentSnapshot.prototype.data=function(options){var data=_super.prototype.data.call(this,options);return assert('object'==typeof data,'Document in a QueryDocumentSnapshot should exist'),data},QueryDocumentSnapshot}(DocumentSnapshot),Query$1=function(){function Query$$1(_query,firestore){this._query=_query,this.firestore=firestore}return Query$$1.prototype.where=function(field,opStr,value){validateExactNumberOfArgs('Query.where',arguments,3),validateArgType('Query.where','non-empty string',2,opStr),validateDefined('Query.where',3,value);var fieldPath=fieldPathFromArgument('Query.where',field),relationOp=RelationOp.fromString(opStr),fieldValue;if(fieldPath.isKeyField()){if(relationOp===RelationOp.ARRAY_CONTAINS)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid Query. You can\'t perform array-contains queries on '+'FieldPath.documentId() since document IDs are not arrays.');if('string'==typeof value){if(-1!==value.indexOf('/'))throw new FirestoreError(Code.INVALID_ARGUMENT,'Function Query.where() requires its third parameter to be a '+'valid document ID if the first parameter is '+'FieldPath.documentId(), but it contains a slash.');if(''===value)throw new FirestoreError(Code.INVALID_ARGUMENT,'Function Query.where() requires its third parameter to be a '+'valid document ID if the first parameter is '+'FieldPath.documentId(), but it was an empty string.');var path=this._query.path.child(new ResourcePath([value]));assert(0==path.length%2,'Path should be a document key'),fieldValue=new RefValue(this.firestore._databaseId,new DocumentKey(path))}else if(value instanceof DocumentReference){fieldValue=new RefValue(this.firestore._databaseId,value._key)}else throw new FirestoreError(Code.INVALID_ARGUMENT,'Function Query.where() requires its third parameter to be a '+'string or a DocumentReference if the first parameter is '+'FieldPath.documentId(), but it was: '+(valueDescription(value)+'.'))}else fieldValue=this.firestore._dataConverter.parseQueryValue('Query.where',value);var filter=Filter.create(fieldPath,relationOp,fieldValue);return this.validateNewFilter(filter),new Query$$1(this._query.addFilter(filter),this.firestore)},Query$$1.prototype.orderBy=function(field,directionStr){validateBetweenNumberOfArgs('Query.orderBy',arguments,1,2),validateOptionalArgType('Query.orderBy','non-empty string',2,directionStr);var direction;if(void 0===directionStr||'asc'===directionStr)direction=Direction.ASCENDING;else if('desc'===directionStr)direction=Direction.DESCENDING;else throw new FirestoreError(Code.INVALID_ARGUMENT,'Function Query.orderBy() has unknown direction \''+directionStr+'\', '+'expected \'asc\' or \'desc\'.');if(null!==this._query.startAt)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid query. You must not call Query.startAt() or '+'Query.startAfter() before calling Query.orderBy().');if(null!==this._query.endAt)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid query. You must not call Query.endAt() or '+'Query.endBefore() before calling Query.orderBy().');var fieldPath=fieldPathFromArgument('Query.orderBy',field),orderBy=new OrderBy(fieldPath,direction);return this.validateNewOrderBy(orderBy),new Query$$1(this._query.addOrderBy(orderBy),this.firestore)},Query$$1.prototype.limit=function(n){if(validateExactNumberOfArgs('Query.limit',arguments,1),validateArgType('Query.limit','number',1,n),0>=n)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid Query. Query limit ('+n+') is invalid. Limit must be '+'positive.');return new Query$$1(this._query.withLimit(n),this.firestore)},Query$$1.prototype.startAt=function(docOrField){for(var fields=[],_i=1;_i<arguments.length;_i++)fields[_i-1]=arguments[_i];validateAtLeastNumberOfArgs('Query.startAt',arguments,1);var bound=this.boundFromDocOrFields('Query.startAt',docOrField,fields,!0);return new Query$$1(this._query.withStartAt(bound),this.firestore)},Query$$1.prototype.startAfter=function(docOrField){for(var fields=[],_i=1;_i<arguments.length;_i++)fields[_i-1]=arguments[_i];validateAtLeastNumberOfArgs('Query.startAfter',arguments,1);var bound=this.boundFromDocOrFields('Query.startAfter',docOrField,fields,!1);return new Query$$1(this._query.withStartAt(bound),this.firestore)},Query$$1.prototype.endBefore=function(docOrField){for(var fields=[],_i=1;_i<arguments.length;_i++)fields[_i-1]=arguments[_i];validateAtLeastNumberOfArgs('Query.endBefore',arguments,1);var bound=this.boundFromDocOrFields('Query.endBefore',docOrField,fields,!0);return new Query$$1(this._query.withEndAt(bound),this.firestore)},Query$$1.prototype.endAt=function(docOrField){for(var fields=[],_i=1;_i<arguments.length;_i++)fields[_i-1]=arguments[_i];validateAtLeastNumberOfArgs('Query.endAt',arguments,1);var bound=this.boundFromDocOrFields('Query.endAt',docOrField,fields,!1);return new Query$$1(this._query.withEndAt(bound),this.firestore)},Query$$1.prototype.isEqual=function(other){if(!(other instanceof Query$$1))throw invalidClassError('isEqual','Query',1,other);return this.firestore===other.firestore&&this._query.isEqual(other._query)},Query$$1.prototype.boundFromDocOrFields=function(methodName,docOrField,fields,before){if(validateDefined(methodName,1,docOrField),docOrField instanceof DocumentSnapshot){if(0<fields.length)throw new FirestoreError(Code.INVALID_ARGUMENT,'Too many arguments provided to '+methodName+'().');var snap=docOrField;if(!snap.exists)throw new FirestoreError(Code.NOT_FOUND,'Can\'t use a DocumentSnapshot that doesn\'t exist for '+(methodName+'().'));return this.boundFromDocument(methodName,snap._document,before)}var allFields=[docOrField].concat(fields);return this.boundFromFields(methodName,allFields,before)},Query$$1.prototype.boundFromDocument=function(methodName,doc,before){for(var components=[],_i=0,_a=this._query.orderBy,orderBy;_i<_a.length;_i++)if(orderBy=_a[_i],orderBy.field.isKeyField())components.push(new RefValue(this.firestore._databaseId,doc.key));else{var value=doc.field(orderBy.field);if(void 0!==value)components.push(value);else{var field=orderBy.field.canonicalString();throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a '+('document for which the field \''+field+'\' (used as the ')+'orderBy) does not exist.')}}return new Bound(components,before)},Query$$1.prototype.boundFromFields=function(methodName,values$$1,before){var orderBy=this._query.explicitOrderBy;if(values$$1.length>orderBy.length)throw new FirestoreError(Code.INVALID_ARGUMENT,'Too many arguments provided to '+methodName+'(). '+'The number of arguments must be less than or equal to the '+'number of Query.orderBy() clauses');for(var components=[],i=0;i<values$$1.length;i++){var rawValue=values$$1[i],orderByComponent=orderBy[i];if(orderByComponent.field.isKeyField()){if('string'!=typeof rawValue)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid query. Expected a string for document ID in '+(methodName+'(), but got a '+typeof rawValue));if(-1!==rawValue.indexOf('/'))throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid query. Document ID \''+rawValue+'\' contains a slash in '+(methodName+'()'));var key=new DocumentKey(this._query.path.child(rawValue));components.push(new RefValue(this.firestore._databaseId,key))}else{var wrapped=this.firestore._dataConverter.parseQueryValue(methodName,rawValue);components.push(wrapped)}}return new Bound(components,before)},Query$$1.prototype.onSnapshot=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];validateBetweenNumberOfArgs('Query.onSnapshot',arguments,1,4);var options={},currArg=0,observer;return'object'!=typeof args[currArg]||isPartialObserver(args[currArg])||(options=args[currArg],validateOptionNames('Query.onSnapshot',options,['includeMetadataChanges']),validateNamedOptionalType('Query.onSnapshot','boolean','includeMetadataChanges',options.includeMetadataChanges),currArg++),isPartialObserver(args[currArg])?observer=args[currArg]:(validateArgType('Query.onSnapshot','function',currArg,args[currArg]),validateOptionalArgType('Query.onSnapshot','function',currArg+1,args[currArg+1]),validateOptionalArgType('Query.onSnapshot','function',currArg+2,args[currArg+2]),observer={next:args[currArg],error:args[currArg+1],complete:args[currArg+2]}),this.onSnapshotInternal(options,observer)},Query$$1.prototype.onSnapshotInternal=function(options,observer){var _this=this,errHandler=function(err){console.error('Uncaught Error in onSnapshot:',err)};observer.error&&(errHandler=observer.error.bind(observer));var asyncObserver=new AsyncObserver({next:function(result){observer.next&&observer.next(new QuerySnapshot(_this.firestore,_this._query,result))},error:errHandler}),firestoreClient=this.firestore.ensureClientConfigured(),internalListener=firestoreClient.listen(this._query,asyncObserver,options);return function(){asyncObserver.mute(),firestoreClient.unlisten(internalListener)}},Query$$1.prototype.get=function(options){var _this=this;return validateBetweenNumberOfArgs('Query.get',arguments,0,1),validateGetOptions('Query.get',options),new Promise(function(resolve,reject){options&&'cache'===options.source?_this.firestore.ensureClientConfigured().getDocumentsFromLocalCache(_this._query).then(function(viewSnap){resolve(new QuerySnapshot(_this.firestore,_this._query,viewSnap))},reject):_this.getViaSnapshotListener(resolve,reject,options)})},Query$$1.prototype.getViaSnapshotListener=function(resolve,reject,options){var unlisten=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(result){unlisten(),result.metadata.fromCache&&options&&'server'===options.source?reject(new FirestoreError(Code.UNAVAILABLE,'Failed to get documents from server. (However, these '+'documents may exist in the local cache. Run again '+'without setting source to "server" to '+'retrieve the cached documents.)')):resolve(result)},error:reject})},Query$$1.prototype.validateNewFilter=function(filter){if(filter instanceof RelationFilter)if(filter.isInequality()){var existingField=this._query.getInequalityFilterField();if(null!==existingField&&!existingField.isEqual(filter.field))throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid query. All where filters with an inequality'+' (<, <=, >, or >=) must be on the same field. But you have'+(' inequality filters on \''+existingField.toString()+'\'')+(' and \''+filter.field.toString()+'\''));var firstOrderByField=this._query.getFirstOrderByField();null!==firstOrderByField&&this.validateOrderByAndInequalityMatch(filter.field,firstOrderByField)}else if(filter.op===RelationOp.ARRAY_CONTAINS&&this._query.hasArrayContainsFilter())throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid query. Queries only support a single array-contains '+'filter.')},Query$$1.prototype.validateNewOrderBy=function(orderBy){if(null===this._query.getFirstOrderByField()){var inequalityField=this._query.getInequalityFilterField();null!==inequalityField&&this.validateOrderByAndInequalityMatch(inequalityField,orderBy.field)}},Query$$1.prototype.validateOrderByAndInequalityMatch=function(inequality,orderBy){if(!orderBy.isEqual(inequality))throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid query. You have a where filter with an inequality '+('(<, <=, >, or >=) on field \''+inequality.toString()+'\' ')+('and so you must also use \''+inequality.toString()+'\' ')+'as your first Query.orderBy(), but your first Query.orderBy() '+('is on field \''+orderBy.toString()+'\' instead.'))},Query$$1}(),QuerySnapshot=function(){function QuerySnapshot(_firestore,_originalQuery,_snapshot){this._firestore=_firestore,this._originalQuery=_originalQuery,this._snapshot=_snapshot,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new SnapshotMetadata(_snapshot.hasPendingWrites,_snapshot.fromCache)}return Object.defineProperty(QuerySnapshot.prototype,'docs',{get:function(){var result=[];return this.forEach(function(doc){return result.push(doc)}),result},enumerable:!0,configurable:!0}),Object.defineProperty(QuerySnapshot.prototype,'empty',{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(QuerySnapshot.prototype,'size',{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),QuerySnapshot.prototype.forEach=function(callback,thisArg){var _this=this;validateBetweenNumberOfArgs('QuerySnapshot.forEach',arguments,1,2),validateArgType('QuerySnapshot.forEach','function',1,callback),this._snapshot.docs.forEach(function(doc){callback.call(thisArg,_this.convertToDocumentImpl(doc))})},Object.defineProperty(QuerySnapshot.prototype,'query',{get:function(){return new Query$1(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),QuerySnapshot.prototype.docChanges=function(options){options&&(validateOptionNames('QuerySnapshot.docChanges',options,['includeMetadataChanges']),validateNamedOptionalType('QuerySnapshot.docChanges','boolean','includeMetadataChanges',options.includeMetadataChanges));var includeMetadataChanges=!!(options&&options.includeMetadataChanges);if(includeMetadataChanges&&this._snapshot.excludesMetadataChanges)throw new FirestoreError(Code.INVALID_ARGUMENT,'To include metadata changes with your document changes, you must '+'also pass { includeMetadataChanges:true } to onSnapshot().');return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===includeMetadataChanges||(this._cachedChanges=changesFromSnapshot(this._firestore,includeMetadataChanges,this._snapshot),this._cachedChangesIncludeMetadataChanges=includeMetadataChanges),this._cachedChanges},QuerySnapshot.prototype.isEqual=function(other){if(!(other instanceof QuerySnapshot))throw invalidClassError('isEqual','QuerySnapshot',1,other);return this._firestore===other._firestore&&this._originalQuery.isEqual(other._originalQuery)&&this._snapshot.isEqual(other._snapshot)},QuerySnapshot.prototype.convertToDocumentImpl=function(doc){return new QueryDocumentSnapshot(this._firestore,doc.key,doc,this.metadata.fromCache,this._snapshot.mutatedKeys.has(doc.key))},QuerySnapshot}(),docChangesPropertiesToOverride=['length','forEach','map'].concat('undefined'==typeof Symbol?[]:[Symbol.iterator]);docChangesPropertiesToOverride.forEach(function(property){try{Object.defineProperty(QuerySnapshot.prototype.docChanges,property,{get:function(){return throwDocChangesMethodError()}})}catch(err){}});var CollectionReference=function(_super){function CollectionReference(path,firestore){var _this=_super.call(this,Query.atPath(path),firestore)||this;if(1!=path.length%2)throw new FirestoreError(Code.INVALID_ARGUMENT,'Invalid collection reference. Collection '+'references must have an odd number of segments, but '+(path.canonicalString()+' has '+path.length));return _this}return tslib_1.__extends(CollectionReference,_super),Object.defineProperty(CollectionReference.prototype,'id',{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(CollectionReference.prototype,'parent',{get:function(){var parentPath=this._query.path.popLast();return parentPath.isEmpty()?null:new DocumentReference(new DocumentKey(parentPath),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(CollectionReference.prototype,'path',{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),CollectionReference.prototype.doc=function(pathString){if(validateBetweenNumberOfArgs('CollectionReference.doc',arguments,0,1),0===arguments.length&&(pathString=AutoId.newId()),validateArgType('CollectionReference.doc','non-empty string',1,pathString),''===pathString)throw new FirestoreError(Code.INVALID_ARGUMENT,'Document path must be a non-empty string');var path=ResourcePath.fromString(pathString);return DocumentReference.forPath(this._query.path.child(path),this.firestore)},CollectionReference.prototype.add=function(value){validateExactNumberOfArgs('CollectionReference.add',arguments,1),validateArgType('CollectionReference.add','object',1,value);var docRef=this.doc();return docRef.set(value).then(function(){return docRef})},CollectionReference}(Query$1),PublicFirestore=makeConstructorPrivate(Firestore,'Use firebase.firestore() instead.'),PublicTransaction=makeConstructorPrivate(Transaction$1,'Use firebase.firestore().runTransaction() instead.'),PublicWriteBatch=makeConstructorPrivate(WriteBatch,'Use firebase.firestore().batch() instead.'),PublicDocumentReference=makeConstructorPrivate(DocumentReference,'Use firebase.firestore().doc() instead.'),PublicDocumentSnapshot=makeConstructorPrivate(DocumentSnapshot),PublicQueryDocumentSnapshot=makeConstructorPrivate(QueryDocumentSnapshot),PublicQuery=makeConstructorPrivate(Query$1),PublicQuerySnapshot=makeConstructorPrivate(QuerySnapshot),PublicCollectionReference=makeConstructorPrivate(CollectionReference,'Use firebase.firestore().collection() instead.'),firestoreNamespace={Firestore:PublicFirestore,GeoPoint:GeoPoint,Timestamp:Timestamp,Blob:PublicBlob,Transaction:PublicTransaction,WriteBatch:PublicWriteBatch,DocumentReference:PublicDocumentReference,DocumentSnapshot:PublicDocumentSnapshot,Query:PublicQuery,QueryDocumentSnapshot:PublicQueryDocumentSnapshot,QuerySnapshot:PublicQuerySnapshot,CollectionReference:PublicCollectionReference,FieldPath:FieldPath$1,FieldValue:PublicFieldValue,setLogLevel:Firestore.setLogLevel};registerFirestore(firebase),exports.registerFirestore=registerFirestore}).call(exports,__webpack_require__(4))},function(module,__webpack_exports__,__webpack_require__){'use strict';function setLogLevel(level){instances.forEach(function(inst){inst.logLevel=level})}Object.defineProperty(__webpack_exports__,'__esModule',{value:!0}),__webpack_require__.d(__webpack_exports__,'setLogLevel',function(){return setLogLevel}),__webpack_require__.d(__webpack_exports__,'Logger',function(){return Logger}),__webpack_require__.d(__webpack_exports__,'LogLevel',function(){return LogLevel});var instances=[],LogLevel;(function(LogLevel){LogLevel[LogLevel.DEBUG=0]='DEBUG',LogLevel[LogLevel.VERBOSE=1]='VERBOSE',LogLevel[LogLevel.INFO=2]='INFO',LogLevel[LogLevel.WARN=3]='WARN',LogLevel[LogLevel.ERROR=4]='ERROR',LogLevel[LogLevel.SILENT=5]='SILENT'})(LogLevel||(LogLevel={}));var defaultLogLevel=LogLevel.INFO,defaultLogHandler=function(instance,logType){for(var args=[],_i=2;_i<arguments.length;_i++)args[_i-2]=arguments[_i];if(!(logType<instance.logLevel)){var now=new Date().toISOString();switch(logType){case LogLevel.DEBUG:console.log.apply(console,['['+now+']  '+instance.name+':'].concat(args));break;case LogLevel.VERBOSE:console.log.apply(console,['['+now+']  '+instance.name+':'].concat(args));break;case LogLevel.INFO:console.info.apply(console,['['+now+']  '+instance.name+':'].concat(args));break;case LogLevel.WARN:console.warn.apply(console,['['+now+']  '+instance.name+':'].concat(args));break;case LogLevel.ERROR:console.error.apply(console,['['+now+']  '+instance.name+':'].concat(args));break;default:throw new Error('Attempted to log a message with an invalid logType (value: '+logType+')');}}},Logger=function(){function Logger(name){this.name=name,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,instances.push(this)}return Object.defineProperty(Logger.prototype,'logLevel',{get:function(){return this._logLevel},set:function(val){if(!(val in LogLevel))throw new TypeError('Invalid value assigned to `logLevel`');this._logLevel=val},enumerable:!0,configurable:!0}),Object.defineProperty(Logger.prototype,'logHandler',{get:function(){return this._logHandler},set:function(val){if('function'!=typeof val)throw new TypeError('Value assigned to `logHandler` must be a function');this._logHandler=val},enumerable:!0,configurable:!0}),Logger.prototype.debug=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this._logHandler.apply(this,[this,LogLevel.DEBUG].concat(args))},Logger.prototype.log=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this._logHandler.apply(this,[this,LogLevel.VERBOSE].concat(args))},Logger.prototype.info=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this._logHandler.apply(this,[this,LogLevel.INFO].concat(args))},Logger.prototype.warn=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this._logHandler.apply(this,[this,LogLevel.WARN].concat(args))},Logger.prototype.error=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this._logHandler.apply(this,[this,LogLevel.ERROR].concat(args))},Logger}()},function(module,__webpack_exports__,__webpack_require__){'use strict';var _Mathmin2=Math.min;(function(setImmediate,global){function noop(){}function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}function Promise(fn){if(!(this instanceof Promise))throw new TypeError('Promises must be constructed via new');if('function'!=typeof fn)throw new TypeError('not a function');this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],doResolve(fn,this)}function handle(self,deferred){for(;3===self._state;)self=self._value;return 0===self._state?void self._deferreds.push(deferred):void(self._handled=!0,Promise._immediateFn(function(){var cb=1===self._state?deferred.onFulfilled:deferred.onRejected;if(null===cb)return void(1===self._state?resolve:reject)(deferred.promise,self._value);var ret;try{ret=cb(self._value)}catch(e){return void reject(deferred.promise,e)}resolve(deferred.promise,ret)}))}function resolve(self,newValue){try{if(newValue===self)throw new TypeError('A promise cannot be resolved with itself.');if(newValue&&('object'==typeof newValue||'function'==typeof newValue)){var then=newValue.then;if(newValue instanceof Promise)return self._state=3,self._value=newValue,void finale(self);if('function'==typeof then)return void doResolve(bind(then,newValue),self)}self._state=1,self._value=newValue,finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2,self._value=newValue,finale(self)}function finale(self){2===self._state&&0===self._deferreds.length&&Promise._immediateFn(function(){self._handled||Promise._unhandledRejectionFn(self._value)});for(var i=0,len=self._deferreds.length;i<len;i++)handle(self,self._deferreds[i]);self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled='function'==typeof onFulfilled?onFulfilled:null,this.onRejected='function'==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,self){var done=!1;try{fn(function(value){done||(done=!0,resolve(self,value))},function(reason){done||(done=!0,reject(self,reason))})}catch(ex){if(done)return;done=!0,reject(self,ex)}}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0_whatwg_fetch__=__webpack_require__(154),setTimeoutFunc=setTimeout;Promise.prototype['catch']=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);return handle(this,new Handler(onFulfilled,onRejected,prom)),prom},Promise.prototype['finally']=function(callback){var constructor=this.constructor;return this.then(function(value){return constructor.resolve(callback()).then(function(){return value})},function(reason){return constructor.resolve(callback()).then(function(){return constructor.reject(reason)})})},Promise.all=function(arr){return new Promise(function(resolve,reject){function res(i,val){try{if(val&&('object'==typeof val||'function'==typeof val)){var then=val.then;if('function'==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0==--remaining&&resolve(args)}catch(ex){reject(ex)}}if(!arr||'undefined'==typeof arr.length)throw new TypeError('Promise.all accepts an array');var args=Array.prototype.slice.call(arr);if(0===args.length)return resolve([]);for(var remaining=args.length,i=0;i<args.length;i++)res(i,args[i])})},Promise.resolve=function(value){return value&&'object'==typeof value&&value.constructor===Promise?value:new Promise(function(resolve){resolve(value)})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)})},Promise._immediateFn='function'==typeof setImmediate&&function(fn){setImmediate(fn)}||function(fn){setTimeoutFunc(fn,0)},Promise._unhandledRejectionFn=function _unhandledRejectionFn(err){'undefined'!=typeof console&&console&&console.warn('Possible Unhandled Promise Rejection:',err)};var globalNS=function(){if('undefined'!=typeof self)return self;if('undefined'!=typeof window)return window;if('undefined'!=typeof global)return global;throw new Error('unable to locate global object')}();globalNS.Promise||(globalNS.Promise=Promise);var _global=createCommonjsModule(function(module){var global=module.exports='undefined'!=typeof window&&window.Math==Math?window:'undefined'!=typeof self&&self.Math==Math?self:Function('return this')();'number'==typeof __g&&(__g=global)}),_core=createCommonjsModule(function(module){var core=module.exports={version:'2.5.5'};'number'==typeof __e&&(__e=core)}),_core_1=_core.version,_isObject=function(it){return'object'==typeof it?null!==it:'function'==typeof it},_anObject=function(it){if(!_isObject(it))throw TypeError(it+' is not an object!');return it},_fails=function(exec){try{return!!exec()}catch(e){return!0}},_descriptors=!_fails(function(){return 7!=Object.defineProperty({},'a',{get:function(){return 7}}).a}),document=_global.document,is=_isObject(document)&&_isObject(document.createElement),_domCreate=function(it){return is?document.createElement(it):{}},_ie8DomDefine=!_descriptors&&!_fails(function(){return 7!=Object.defineProperty(_domCreate('div'),'a',{get:function(){return 7}}).a}),_toPrimitive=function(it,S){if(!_isObject(it))return it;var fn,val;if(S&&'function'==typeof(fn=it.toString)&&!_isObject(val=fn.call(it)))return val;if('function'==typeof(fn=it.valueOf)&&!_isObject(val=fn.call(it)))return val;if(!S&&'function'==typeof(fn=it.toString)&&!_isObject(val=fn.call(it)))return val;throw TypeError('Can\'t convert object to primitive value')},dP=Object.defineProperty,f=_descriptors?Object.defineProperty:function defineProperty(O,P,Attributes){if(_anObject(O),P=_toPrimitive(P,!0),_anObject(Attributes),_ie8DomDefine)try{return dP(O,P,Attributes)}catch(e){}if('get'in Attributes||'set'in Attributes)throw TypeError('Accessors not supported!');return'value'in Attributes&&(O[P]=Attributes.value),O},_objectDp={f:f},_propertyDesc=function(bitmap,value){return{enumerable:!(1&bitmap),configurable:!(2&bitmap),writable:!(4&bitmap),value:value}},_hide=_descriptors?function(object,key,value){return _objectDp.f(object,key,_propertyDesc(1,value))}:function(object,key,value){return object[key]=value,object},hasOwnProperty={}.hasOwnProperty,_has=function(it,key){return hasOwnProperty.call(it,key)},id=0,px=Math.random(),_uid=function(key){return'Symbol('.concat(key===void 0?'':key,')_',(++id+px).toString(36))},_redefine=createCommonjsModule(function(module){var SRC=_uid('src'),TO_STRING='toString',$toString=Function[TO_STRING],TPL=(''+$toString).split(TO_STRING);_core.inspectSource=function(it){return $toString.call(it)},(module.exports=function(O,key,val,safe){var isFunction='function'==typeof val;isFunction&&(_has(val,'name')||_hide(val,'name',key));O[key]===val||(isFunction&&(_has(val,SRC)||_hide(val,SRC,O[key]?''+O[key]:TPL.join(key+''))),O===_global?O[key]=val:safe?O[key]?O[key]=val:_hide(O,key,val):(delete O[key],_hide(O,key,val)))})(Function.prototype,TO_STRING,function toString(){return'function'==typeof this&&this[SRC]||$toString.call(this)})}),_aFunction=function(it){if('function'!=typeof it)throw TypeError(it+' is not a function!');return it},_ctx=function(fn,that,length){return(_aFunction(fn),void 0===that)?fn:1===length?function(a){return fn.call(that,a)}:2===length?function(a,b){return fn.call(that,a,b)}:3===length?function(a,b,c){return fn.call(that,a,b,c)}:function(){return fn.apply(that,arguments)}},PROTOTYPE='prototype',$export=function(type,name,source){var IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,target=IS_GLOBAL?_global:IS_STATIC?_global[name]||(_global[name]={}):(_global[name]||{})[PROTOTYPE],exports=IS_GLOBAL?_core:_core[name]||(_core[name]={}),expProto=exports[PROTOTYPE]||(exports[PROTOTYPE]={}),key,own,out,exp;for(key in IS_GLOBAL&&(source=name),source)own=!IS_FORCED&&target&&void 0!==target[key],out=(own?target:source)[key],exp=IS_BIND&&own?_ctx(out,_global):IS_PROTO&&'function'==typeof out?_ctx(Function.call,out):out,target&&_redefine(target,key,out,type&$export.U),exports[key]!=out&&_hide(exports,key,exp),IS_PROTO&&expProto[key]!=out&&(expProto[key]=out)};_global.core=_core,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128;var _export=$export,toString={}.toString,_cof=function(it){return toString.call(it).slice(8,-1)},_iobject=Object('z').propertyIsEnumerable(0)?Object:function(it){return'String'==_cof(it)?it.split(''):Object(it)},_defined=function(it){if(it==void 0)throw TypeError('Can\'t call method on  '+it);return it},_toObject=function(it){return Object(_defined(it))},ceil=Math.ceil,floor=Math.floor,_toInteger=function(it){return isNaN(it=+it)?0:(0<it?floor:ceil)(it)},_toLength=function(it){return 0<it?_Mathmin2(_toInteger(it),9007199254740991):0},_isArray=Array.isArray||function isArray(arg){return'Array'==_cof(arg)},SHARED='__core-js_shared__',store=_global[SHARED]||(_global[SHARED]={}),_shared=function(key){return store[key]||(store[key]={})},_wks=createCommonjsModule(function(module){var store=_shared('wks'),Symbol=_global.Symbol,USE_SYMBOL='function'==typeof Symbol,$exports=module.exports=function(name){return store[name]||(store[name]=USE_SYMBOL&&Symbol[name]||(USE_SYMBOL?Symbol:_uid)('Symbol.'+name))};$exports.store=store}),SPECIES=_wks('species'),_arraySpeciesConstructor=function(original){var C;return _isArray(original)&&(C=original.constructor,'function'==typeof C&&(C===Array||_isArray(C.prototype))&&(C=void 0),_isObject(C)&&(C=C[SPECIES],null===C&&(C=void 0))),void 0===C?Array:C},_arraySpeciesCreate=function(original,length){return new(_arraySpeciesConstructor(original))(length)},_arrayMethods=function(TYPE,$create){var IS_MAP=1==TYPE,IS_EVERY=4==TYPE,IS_FIND_INDEX=6==TYPE,create=$create||_arraySpeciesCreate;return function($this,callbackfn,that){for(var O=_toObject($this),self=_iobject(O),f=_ctx(callbackfn,that,3),length=_toLength(self.length),index=0,result=IS_MAP?create($this,length):2==TYPE?create($this,0):void 0,val,res;length>index;index++)if((5==TYPE||IS_FIND_INDEX||index in self)&&(val=self[index],res=f(val,index,O),TYPE))if(IS_MAP)result[index]=res;else if(res)switch(TYPE){case 3:return!0;case 5:return val;case 6:return index;case 2:result.push(val);}else if(IS_EVERY)return!1;return IS_FIND_INDEX?-1:3==TYPE||IS_EVERY?IS_EVERY:result}},UNSCOPABLES=_wks('unscopables'),ArrayProto=Array.prototype;ArrayProto[UNSCOPABLES]==void 0&&_hide(ArrayProto,UNSCOPABLES,{});var _addToUnscopables=function(key){ArrayProto[UNSCOPABLES][key]=!0},$find=_arrayMethods(5),KEY='find',forced=!0;KEY in[]&&[,][KEY](function(){forced=!1}),_export(_export.P+_export.F*forced,'Array',{find:function find(callbackfn){return $find(this,callbackfn,1<arguments.length?arguments[1]:void 0)}}),_addToUnscopables(KEY);var find=_core.Array.find,$find$1=_arrayMethods(6),KEY$1='findIndex',forced$1=!0;KEY$1 in[]&&[,][KEY$1](function(){forced$1=!1}),_export(_export.P+_export.F*forced$1,'Array',{findIndex:function findIndex(callbackfn){return $find$1(this,callbackfn,1<arguments.length?arguments[1]:void 0)}}),_addToUnscopables(KEY$1);var findIndex=_core.Array.findIndex,_toIobject=function(it){return _iobject(_defined(it))},max=Math.max,_toAbsoluteIndex=function(index,length){return index=_toInteger(index),0>index?max(index+length,0):_Mathmin2(index,length)},shared=_shared('keys'),_sharedKey=function(key){return shared[key]||(shared[key]=_uid(key))},arrayIndexOf=function(IS_INCLUDES){return function($this,el,fromIndex){var O=_toIobject($this),length=_toLength(O.length),index=_toAbsoluteIndex(fromIndex,length),value;if(IS_INCLUDES&&el!=el){for(;length>index;)if(value=O[index++],value!=value)return!0;}else for(;length>index;index++)if((IS_INCLUDES||index in O)&&O[index]===el)return IS_INCLUDES||index||0;return!IS_INCLUDES&&-1}}(!1),IE_PROTO=_sharedKey('IE_PROTO'),_objectKeysInternal=function(object,names){var O=_toIobject(object),i=0,result=[],key;for(key in O)key!=IE_PROTO&&_has(O,key)&&result.push(key);for(;names.length>i;)_has(O,key=names[i++])&&(~arrayIndexOf(result,key)||result.push(key));return result},_enumBugKeys='constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'.split(','),_objectKeys=Object.keys||function keys(O){return _objectKeysInternal(O,_enumBugKeys)},f$1=Object.getOwnPropertySymbols,_objectGops={f:f$1},f$2={}.propertyIsEnumerable,_objectPie={f:f$2},$assign=Object.assign,_objectAssign=!$assign||_fails(function(){var A={},B={},S=Symbol(),K='abcdefghijklmnopqrst';return A[S]=7,K.split('').forEach(function(k){B[k]=k}),7!=$assign({},A)[S]||Object.keys($assign({},B)).join('')!=K})?function assign(target){for(var T=_toObject(target),aLen=arguments.length,index=1,getSymbols=_objectGops.f,isEnum=_objectPie.f;aLen>index;)for(var S=_iobject(arguments[index++]),keys=getSymbols?_objectKeys(S).concat(getSymbols(S)):_objectKeys(S),length=keys.length,j=0,key;length>j;)isEnum.call(S,key=keys[j++])&&(T[key]=S[key]);return T}:$assign;_export(_export.S+_export.F,'Object',{assign:_objectAssign});var assign=_core.Object.assign,MATCH=_wks('match'),_isRegexp=function(it){var isRegExp;return _isObject(it)&&((isRegExp=it[MATCH])===void 0?'RegExp'==_cof(it):!!isRegExp)},_stringContext=function(that,searchString,NAME){if(_isRegexp(searchString))throw TypeError('String#'+NAME+' doesn\'t accept regex!');return _defined(that)+''},MATCH$1=_wks('match'),STARTS_WITH='startsWith',$startsWith=''[STARTS_WITH];_export(_export.P+_export.F*function(KEY){var re=/./;try{'/./'[KEY](re)}catch(e){try{return re[MATCH$1]=!1,!'/./'[KEY](re)}catch(f){}}return!0}(STARTS_WITH),'String',{startsWith:function startsWith(searchString){var that=_stringContext(this,searchString,STARTS_WITH),index=_toLength(_Mathmin2(1<arguments.length?arguments[1]:void 0,that.length)),search=searchString+'';return that.slice(index,index+search.length)===search}});var startsWith=_core.String.startsWith;_export(_export.P,'String',{repeat:function repeat(count){var str=_defined(this)+'',res='',n=_toInteger(count);if(0>n||n==Infinity)throw RangeError('Count can\'t be negative');for(;0<n;(n>>>=1)&&(str+=str))1&n&&(res+=str);return res}});var repeat=_core.String.repeat,_meta=createCommonjsModule(function(module){var META=_uid('meta'),setDesc=_objectDp.f,id=0,isExtensible=Object.isExtensible||function(){return!0},FREEZE=!_fails(function(){return isExtensible(Object.preventExtensions({}))}),setMeta=function(it){setDesc(it,META,{value:{i:'O'+ ++id,w:{}}})},meta=module.exports={KEY:META,NEED:!1,fastKey:function(it,create){if(!_isObject(it))return'symbol'==typeof it?it:('string'==typeof it?'S':'P')+it;if(!_has(it,META)){if(!isExtensible(it))return'F';if(!create)return'E';setMeta(it)}return it[META].i},getWeak:function(it,create){if(!_has(it,META)){if(!isExtensible(it))return!0;if(!create)return!1;setMeta(it)}return it[META].w},onFreeze:function(it){return FREEZE&&meta.NEED&&isExtensible(it)&&!_has(it,META)&&setMeta(it),it}}}),_meta_1=_meta.KEY,_meta_2=_meta.NEED,_meta_3=_meta.fastKey,_meta_4=_meta.getWeak,_meta_5=_meta.onFreeze,def=_objectDp.f,TAG=_wks('toStringTag'),_setToStringTag=function(it,tag,stat){it&&!_has(it=stat?it:it.prototype,TAG)&&def(it,TAG,{configurable:!0,value:tag})},_wksExt={f:_wks},_library=!1,defineProperty=_objectDp.f,_wksDefine=function(name){var $Symbol=_core.Symbol||(_core.Symbol=_global.Symbol||{});'_'==name.charAt(0)||name in $Symbol||defineProperty($Symbol,name,{value:_wksExt.f(name)})},_enumKeys=function(it){var result=_objectKeys(it),getSymbols=_objectGops.f;if(getSymbols)for(var symbols=getSymbols(it),isEnum=_objectPie.f,i=0,key;symbols.length>i;)isEnum.call(it,key=symbols[i++])&&result.push(key);return result},_objectDps=_descriptors?Object.defineProperties:function defineProperties(O,Properties){_anObject(O);for(var keys=_objectKeys(Properties),length=keys.length,i=0,P;length>i;)_objectDp.f(O,P=keys[i++],Properties[P]);return O},document$1=_global.document,_html=document$1&&document$1.documentElement,IE_PROTO$1=_sharedKey('IE_PROTO'),Empty=function(){},PROTOTYPE$1='prototype',createDict=function(){var iframe=_domCreate('iframe'),i=_enumBugKeys.length,lt='<',gt='>',iframeDocument;for(iframe.style.display='none',_html.appendChild(iframe),iframe.src='javascript:',iframeDocument=iframe.contentWindow.document,iframeDocument.open(),iframeDocument.write(lt+'script'+gt+'document.F=Object'+lt+'/script'+gt),iframeDocument.close(),createDict=iframeDocument.F;i--;)delete createDict[PROTOTYPE$1][_enumBugKeys[i]];return createDict()},_objectCreate=Object.create||function create(O,Properties){var result;return null===O?result=createDict():(Empty[PROTOTYPE$1]=_anObject(O),result=new Empty,Empty[PROTOTYPE$1]=null,result[IE_PROTO$1]=O),void 0===Properties?result:_objectDps(result,Properties)},hiddenKeys=_enumBugKeys.concat('length','prototype'),f$4=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return _objectKeysInternal(O,hiddenKeys)},_objectGopn={f:f$4},gOPN=_objectGopn.f,toString$1={}.toString,windowNames='object'==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],getWindowNames=function(it){try{return gOPN(it)}catch(e){return windowNames.slice()}},_objectGopnExt={f:function getOwnPropertyNames(it){return windowNames&&'[object Window]'==toString$1.call(it)?getWindowNames(it):gOPN(_toIobject(it))}},gOPD=Object.getOwnPropertyDescriptor,f$6=_descriptors?gOPD:function getOwnPropertyDescriptor(O,P){if(O=_toIobject(O),P=_toPrimitive(P,!0),_ie8DomDefine)try{return gOPD(O,P)}catch(e){}return _has(O,P)?_propertyDesc(!_objectPie.f.call(O,P),O[P]):void 0},_objectGopd={f:f$6},META=_meta.KEY,gOPD$1=_objectGopd.f,dP$1=_objectDp.f,gOPN$1=_objectGopnExt.f,$Symbol=_global.Symbol,$JSON=_global.JSON,_stringify=$JSON&&$JSON.stringify,PROTOTYPE$2='prototype',HIDDEN=_wks('_hidden'),TO_PRIMITIVE=_wks('toPrimitive'),isEnum={}.propertyIsEnumerable,SymbolRegistry=_shared('symbol-registry'),AllSymbols=_shared('symbols'),OPSymbols=_shared('op-symbols'),ObjectProto=Object[PROTOTYPE$2],USE_NATIVE='function'==typeof $Symbol,QObject=_global.QObject,setter=!QObject||!QObject[PROTOTYPE$2]||!QObject[PROTOTYPE$2].findChild,setSymbolDesc=_descriptors&&_fails(function(){return 7!=_objectCreate(dP$1({},'a',{get:function(){return dP$1(this,'a',{value:7}).a}})).a})?function(it,key,D){var protoDesc=gOPD$1(ObjectProto,key);protoDesc&&delete ObjectProto[key],dP$1(it,key,D),protoDesc&&it!==ObjectProto&&dP$1(ObjectProto,key,protoDesc)}:dP$1,wrap=function(tag){var sym=AllSymbols[tag]=_objectCreate($Symbol[PROTOTYPE$2]);return sym._k=tag,sym},isSymbol=USE_NATIVE&&'symbol'==typeof $Symbol.iterator?function(it){return'symbol'==typeof it}:function(it){return it instanceof $Symbol},$defineProperty=function defineProperty(it,key,D){return it===ObjectProto&&$defineProperty(OPSymbols,key,D),_anObject(it),key=_toPrimitive(key,!0),_anObject(D),_has(AllSymbols,key)?(D.enumerable?(_has(it,HIDDEN)&&it[HIDDEN][key]&&(it[HIDDEN][key]=!1),D=_objectCreate(D,{enumerable:_propertyDesc(0,!1)})):(!_has(it,HIDDEN)&&dP$1(it,HIDDEN,_propertyDesc(1,{})),it[HIDDEN][key]=!0),setSymbolDesc(it,key,D)):dP$1(it,key,D)},$defineProperties=function defineProperties(it,P){_anObject(it);for(var keys=_enumKeys(P=_toIobject(P)),i=0,l=keys.length,key;l>i;)$defineProperty(it,key=keys[i++],P[key]);return it},$propertyIsEnumerable=function propertyIsEnumerable(key){var E=isEnum.call(this,key=_toPrimitive(key,!0));return this===ObjectProto&&_has(AllSymbols,key)&&!_has(OPSymbols,key)?!1:E||!_has(this,key)||!_has(AllSymbols,key)||_has(this,HIDDEN)&&this[HIDDEN][key]?E:!0},$getOwnPropertyDescriptor=function getOwnPropertyDescriptor(it,key){if(it=_toIobject(it),key=_toPrimitive(key,!0),it!==ObjectProto||!_has(AllSymbols,key)||_has(OPSymbols,key)){var D=gOPD$1(it,key);return D&&_has(AllSymbols,key)&&!(_has(it,HIDDEN)&&it[HIDDEN][key])&&(D.enumerable=!0),D}},$getOwnPropertyNames=function getOwnPropertyNames(it){for(var names=gOPN$1(_toIobject(it)),result=[],i=0,key;names.length>i;)_has(AllSymbols,key=names[i++])||key==HIDDEN||key==META||result.push(key);return result},$getOwnPropertySymbols=function getOwnPropertySymbols(it){for(var IS_OP=it===ObjectProto,names=gOPN$1(IS_OP?OPSymbols:_toIobject(it)),result=[],i=0,key;names.length>i;)_has(AllSymbols,key=names[i++])&&(!IS_OP||_has(ObjectProto,key))&&result.push(AllSymbols[key]);return result};USE_NATIVE||($Symbol=function Symbol(){if(this instanceof $Symbol)throw TypeError('Symbol is not a constructor!');var tag=_uid(0<arguments.length?arguments[0]:void 0),$set=function(value){this===ObjectProto&&$set.call(OPSymbols,value),_has(this,HIDDEN)&&_has(this[HIDDEN],tag)&&(this[HIDDEN][tag]=!1),setSymbolDesc(this,tag,_propertyDesc(1,value))};return _descriptors&&setter&&setSymbolDesc(ObjectProto,tag,{configurable:!0,set:$set}),wrap(tag)},_redefine($Symbol[PROTOTYPE$2],'toString',function toString(){return this._k}),_objectGopd.f=$getOwnPropertyDescriptor,_objectDp.f=$defineProperty,_objectGopn.f=_objectGopnExt.f=$getOwnPropertyNames,_objectPie.f=$propertyIsEnumerable,_objectGops.f=$getOwnPropertySymbols,_descriptors&&!_library&&_redefine(ObjectProto,'propertyIsEnumerable',$propertyIsEnumerable,!0),_wksExt.f=function(name){return wrap(_wks(name))}),_export(_export.G+_export.W+_export.F*!USE_NATIVE,{Symbol:$Symbol});for(var es6Symbols='hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'.split(','),j=0;es6Symbols.length>j;)_wks(es6Symbols[j++]);for(var wellKnownSymbols=_objectKeys(_wks.store),k=0;wellKnownSymbols.length>k;)_wksDefine(wellKnownSymbols[k++]);_export(_export.S+_export.F*!USE_NATIVE,'Symbol',{for:function(key){return _has(SymbolRegistry,key+='')?SymbolRegistry[key]:SymbolRegistry[key]=$Symbol(key)},keyFor:function keyFor(sym){if(!isSymbol(sym))throw TypeError(sym+' is not a symbol!');for(var key in SymbolRegistry)if(SymbolRegistry[key]===sym)return key},useSetter:function(){setter=!0},useSimple:function(){setter=!1}}),_export(_export.S+_export.F*!USE_NATIVE,'Object',{create:function create(it,P){return P===void 0?_objectCreate(it):$defineProperties(_objectCreate(it),P)},defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor,getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols}),$JSON&&_export(_export.S+_export.F*(!USE_NATIVE||_fails(function(){var S=$Symbol();return'[null]'!=_stringify([S])||'{}'!=_stringify({a:S})||'{}'!=_stringify(Object(S))})),'JSON',{stringify:function stringify(it){for(var args=[it],i=1,replacer,$replacer;arguments.length>i;)args.push(arguments[i++]);if($replacer=replacer=args[1],(_isObject(replacer)||void 0!==it)&&!isSymbol(it))return _isArray(replacer)||(replacer=function(key,value){if('function'==typeof $replacer&&(value=$replacer.call(this,key,value)),!isSymbol(value))return value}),args[1]=replacer,_stringify.apply($JSON,args)}}),$Symbol[PROTOTYPE$2][TO_PRIMITIVE]||_hide($Symbol[PROTOTYPE$2],TO_PRIMITIVE,$Symbol[PROTOTYPE$2].valueOf),_setToStringTag($Symbol,'Symbol'),_setToStringTag(Math,'Math',!0),_setToStringTag(_global.JSON,'JSON',!0);var TAG$1=_wks('toStringTag'),ARG='Arguments'==_cof(function(){return arguments}()),tryGet=function(it,key){try{return it[key]}catch(e){}},_classof=function(it){var O,T,B;return it===void 0?'Undefined':null===it?'Null':'string'==typeof(T=tryGet(O=Object(it),TAG$1))?T:ARG?_cof(O):'Object'==(B=_cof(O))&&'function'==typeof O.callee?'Arguments':B};({})[_wks('toStringTag')]='z',_redefine(Object.prototype,'toString',function toString(){return'[object '+_classof(this)+']'},!0),_wksDefine('asyncIterator'),_wksDefine('observable');var symbol=_core.Symbol,_iterators={},IteratorPrototype={};_hide(IteratorPrototype,_wks('iterator'),function(){return this});var _iterCreate=function(Constructor,NAME,next){Constructor.prototype=_objectCreate(IteratorPrototype,{next:_propertyDesc(1,next)}),_setToStringTag(Constructor,NAME+' Iterator')},IE_PROTO$2=_sharedKey('IE_PROTO'),ObjectProto$1=Object.prototype,_objectGpo=Object.getPrototypeOf||function(O){return O=_toObject(O),_has(O,IE_PROTO$2)?O[IE_PROTO$2]:'function'==typeof O.constructor&&O instanceof O.constructor?O.constructor.prototype:O instanceof Object?ObjectProto$1:null},ITERATOR=_wks('iterator'),BUGGY=!([].keys&&'next'in[].keys()),KEYS='keys',VALUES='values',returnThis=function(){return this},_iterDefine=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCED){_iterCreate(Constructor,NAME,next);var getMethod=function(kind){return!BUGGY&&kind in proto?proto[kind]:kind===KEYS?function keys(){return new Constructor(this,kind)}:kind===VALUES?function values(){return new Constructor(this,kind)}:function entries(){return new Constructor(this,kind)}},TAG=NAME+' Iterator',DEF_VALUES=DEFAULT==VALUES,VALUES_BUG=!1,proto=Base.prototype,$native=proto[ITERATOR]||proto['@@iterator']||DEFAULT&&proto[DEFAULT],$default=$native||getMethod(DEFAULT),$entries=DEFAULT?DEF_VALUES?getMethod('entries'):$default:void 0,$anyNative='Array'==NAME?proto.entries||$native:$native,methods,key,IteratorPrototype;if($anyNative&&(IteratorPrototype=_objectGpo($anyNative.call(new Base)),IteratorPrototype!==Object.prototype&&IteratorPrototype.next&&(_setToStringTag(IteratorPrototype,TAG,!0),'function'!=typeof IteratorPrototype[ITERATOR]&&_hide(IteratorPrototype,ITERATOR,returnThis))),DEF_VALUES&&$native&&$native.name!==VALUES&&(VALUES_BUG=!0,$default=function values(){return $native.call(this)}),(BUGGY||VALUES_BUG||!proto[ITERATOR])&&_hide(proto,ITERATOR,$default),_iterators[NAME]=$default,_iterators[TAG]=returnThis,DEFAULT)if(methods={values:DEF_VALUES?$default:getMethod(VALUES),keys:IS_SET?$default:getMethod(KEYS),entries:$entries},FORCED)for(key in methods)key in proto||_redefine(proto,key,methods[key]);else _export(_export.P+_export.F*(BUGGY||VALUES_BUG),NAME,methods);return methods},$at=function(TO_STRING){return function(that,pos){var s=_defined(that)+'',i=_toInteger(pos),l=s.length,a,b;return 0>i||i>=l?TO_STRING?'':void 0:(a=s.charCodeAt(i),55296>a||56319<a||i+1===l||56320>(b=s.charCodeAt(i+1))||57343<b?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536)}}(!0);_iterDefine(String,'String',function(iterated){this._t=iterated+'',this._i=0},function(){var O=this._t,index=this._i,point;return index>=O.length?{value:void 0,done:!0}:(point=$at(O,index),this._i+=point.length,{value:point,done:!1})});var _iterStep=function(done,value){return{value:value,done:!!done}},es6_array_iterator=_iterDefine(Array,'Array',function(iterated,kind){this._t=_toIobject(iterated),this._i=0,this._k=kind},function(){var O=this._t,kind=this._k,index=this._i++;return!O||index>=O.length?(this._t=void 0,_iterStep(1)):'keys'==kind?_iterStep(0,index):'values'==kind?_iterStep(0,O[index]):_iterStep(0,[index,O[index]])},'values');_iterators.Arguments=_iterators.Array,_addToUnscopables('keys'),_addToUnscopables('values'),_addToUnscopables('entries');for(var ITERATOR$1=_wks('iterator'),TO_STRING_TAG=_wks('toStringTag'),ArrayValues=_iterators.Array,DOMIterables={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},collections=_objectKeys(DOMIterables),i=0;i<collections.length;i++){var NAME=collections[i],explicit=DOMIterables[NAME],Collection=_global[NAME],proto=Collection&&Collection.prototype,key;if(proto&&(proto[ITERATOR$1]||_hide(proto,ITERATOR$1,ArrayValues),proto[TO_STRING_TAG]||_hide(proto,TO_STRING_TAG,NAME),_iterators[NAME]=ArrayValues,explicit))for(key in es6_array_iterator)proto[key]||_redefine(proto,key,es6_array_iterator[key],!0)}_wksExt.f('iterator')}).call(__webpack_exports__,__webpack_require__(151).setImmediate,__webpack_require__(0))},function(module,exports,__webpack_require__){'use strict';function deepExtend(target,source){if(!(source instanceof Object))return source;switch(source.constructor){case Date:return new Date(source.getTime());case Object:target===void 0&&(target={});break;case Array:target=[];break;default:return source;}for(var prop in source)source.hasOwnProperty(prop)&&(target[prop]=deepExtend(target[prop],source[prop]));return target}function jsonEval(str){return JSON.parse(str)}function implementsAnyMethods(obj,methods){if('object'!=typeof obj||null===obj)return!1;for(var _i=0,methods_1=methods,method;_i<methods_1.length;_i++)if(method=methods_1[_i],method in obj&&'function'==typeof obj[method])return!0;return!1}function noop(){}function errorPrefix(fnName,argumentNumber,optional){var argName='';switch(argumentNumber){case 1:argName=optional?'first':'First';break;case 2:argName=optional?'second':'Second';break;case 3:argName=optional?'third':'Third';break;case 4:argName=optional?'fourth':'Fourth';break;default:throw new Error('errorPrefix called with argumentNumber > 4.  Need to update it?');}var error=fnName+' failed: ';return error+=argName+' argument ',error}var _StringfromCharCode=String.fromCharCode;Object.defineProperty(exports,'__esModule',{value:!0});var tslib_1=__webpack_require__(19),CONSTANTS={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:'${JSCORE_VERSION}'},assert=function(assertion,message){if(!assertion)throw assertionError(message)},assertionError=function(message){return new Error('Firebase Database ('+CONSTANTS.SDK_VERSION+') INTERNAL ASSERT FAILED: '+message)},stringToByteArray=function(str){for(var out=[],p=0,i=0,c;i<str.length;i++)c=str.charCodeAt(i),128>c?out[p++]=c:2048>c?(out[p++]=192|c>>6,out[p++]=128|63&c):55296==(64512&c)&&i+1<str.length&&56320==(64512&str.charCodeAt(i+1))?(c=65536+((1023&c)<<10)+(1023&str.charCodeAt(++i)),out[p++]=240|c>>18,out[p++]=128|63&c>>12,out[p++]=128|63&c>>6,out[p++]=128|63&c):(out[p++]=224|c>>12,out[p++]=128|63&c>>6,out[p++]=128|63&c);return out},byteArrayToString=function(bytes){for(var out=[],pos=0,c=0;pos<bytes.length;){var c1=bytes[pos++];if(128>c1)out[c++]=_StringfromCharCode(c1);else if(191<c1&&224>c1){var c2=bytes[pos++];out[c++]=_StringfromCharCode((31&c1)<<6|63&c2)}else if(239<c1&&365>c1){var c2=bytes[pos++],c3=bytes[pos++],c4=bytes[pos++],u=((7&c1)<<18|(63&c2)<<12|(63&c3)<<6|63&c4)-65536;out[c++]=_StringfromCharCode(55296+(u>>10)),out[c++]=_StringfromCharCode(56320+(1023&u))}else{var c2=bytes[pos++],c3=bytes[pos++];out[c++]=_StringfromCharCode((15&c1)<<12|(63&c2)<<6|63&c3)}}return out.join('')},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:'ABCDEFGHIJKLMNOPQRSTUVWXYZ'+'abcdefghijklmnopqrstuvwxyz'+'0123456789',get ENCODED_VALS(){return this.ENCODED_VALS_BASE+'+/='},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+'-_.'},HAS_NATIVE_SUPPORT:'function'==typeof atob,encodeByteArray:function(input,opt_webSafe){if(!Array.isArray(input))throw Error('encodeByteArray takes an array as a parameter');this.init_();for(var byteToCharMap=opt_webSafe?this.byteToCharMapWebSafe_:this.byteToCharMap_,output=[],i=0;i<input.length;i+=3){var byte1=input[i],haveByte2=i+1<input.length,byte2=haveByte2?input[i+1]:0,haveByte3=i+2<input.length,byte3=haveByte3?input[i+2]:0,outByte3=(15&byte2)<<2|byte3>>6,outByte4=63&byte3;haveByte3||(outByte4=64,!haveByte2&&(outByte3=64)),output.push(byteToCharMap[byte1>>2],byteToCharMap[(3&byte1)<<4|byte2>>4],byteToCharMap[outByte3],byteToCharMap[outByte4])}return output.join('')},encodeString:function(input,opt_webSafe){return this.HAS_NATIVE_SUPPORT&&!opt_webSafe?btoa(input):this.encodeByteArray(stringToByteArray(input),opt_webSafe)},decodeString:function(input,opt_webSafe){return this.HAS_NATIVE_SUPPORT&&!opt_webSafe?atob(input):byteArrayToString(this.decodeStringToByteArray(input,opt_webSafe))},decodeStringToByteArray:function(input,opt_webSafe){this.init_();for(var charToByteMap=opt_webSafe?this.charToByteMapWebSafe_:this.charToByteMap_,output=[],i=0;i<input.length;){var byte1=charToByteMap[input.charAt(i++)],haveByte2=i<input.length,byte2=haveByte2?charToByteMap[input.charAt(i)]:0;++i;var haveByte3=i<input.length,byte3=haveByte3?charToByteMap[input.charAt(i)]:64;++i;var haveByte4=i<input.length,byte4=haveByte4?charToByteMap[input.charAt(i)]:64;if(++i,null==byte1||null==byte2||null==byte3||null==byte4)throw Error();if(output.push(byte1<<2|byte2>>4),64!=byte3){if(output.push(240&byte2<<4|byte3>>2),64!=byte4){output.push(192&byte3<<6|byte4)}}}return output},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}},base64Decode=function(str){try{return base64.decodeString(str,!0)}catch(e){console.error('base64Decode failed: ',e)}return null},Deferred=function(){function Deferred(){var _this=this;this.promise=new Promise(function(resolve,reject){_this.resolve=resolve,_this.reject=reject})}return Deferred.prototype.wrapCallback=function(callback){var _this=this;return function(error,value){error?_this.reject(error):_this.resolve(value),'function'==typeof callback&&(_this.promise.catch(function(){}),1===callback.length?callback(error):callback(error,value))}},Deferred}(),getUA=function(){return'undefined'!=typeof navigator&&'string'==typeof navigator.userAgent?navigator.userAgent:''},ERROR_NAME='FirebaseError',captureStackTrace=Error.captureStackTrace,FirebaseError=function(){return function FirebaseError(code,message){if(this.code=code,this.message=message,captureStackTrace)captureStackTrace(this,ErrorFactory.prototype.create);else try{throw Error.apply(this,arguments)}catch(err){this.name=ERROR_NAME,Object.defineProperty(this,'stack',{get:function(){return err.stack}})}}}();FirebaseError.prototype=Object.create(Error.prototype),FirebaseError.prototype.constructor=FirebaseError,FirebaseError.prototype.name=ERROR_NAME;var ErrorFactory=function(){function ErrorFactory(service,serviceName,errors){this.service=service,this.serviceName=serviceName,this.errors=errors,this.pattern=/\{\$([^}]+)}/g}return ErrorFactory.prototype.create=function(code,data){void 0===data&&(data={});var template=this.errors[code],fullCode=this.service+'/'+code,message;message=void 0===template?'Error':template.replace(this.pattern,function(match,key){var value=data[key];return void 0===value?'<'+key+'?>':value.toString()}),message=this.serviceName+': '+message+' ('+fullCode+').';var err=new FirebaseError(fullCode,message);for(var prop in data)data.hasOwnProperty(prop)&&'_'!==prop.slice(-1)&&(err[prop]=data[prop]);return err},ErrorFactory}(),decode=function(token){var header={},claims={},data={},signature='';try{var parts=token.split('.');header=jsonEval(base64Decode(parts[0])||''),claims=jsonEval(base64Decode(parts[1])||''),signature=parts[2],data=claims.d||{},delete claims.d}catch(e){}return{header:header,claims:claims,data:data,signature:signature}},forEach=function(obj,fn){for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&fn(key,obj[key])},extend=function(objTo,objFrom){return forEach(objFrom,function(key,value){objTo[key]=value}),objTo},findKey=function(obj,fn,opt_this){for(var key in obj)if(fn.call(opt_this,obj[key],key,obj))return key},Hash=function(){return function Hash(){this.blockSize=-1}}(),Sha1=function(_super){function Sha1(){var _this=_super.call(this)||this;_this.chain_=[],_this.buf_=[],_this.W_=[],_this.pad_=[],_this.inbuf_=0,_this.total_=0,_this.blockSize=512/8,_this.pad_[0]=128;for(var i=1;i<_this.blockSize;++i)_this.pad_[i]=0;return _this.reset(),_this}return tslib_1.__extends(Sha1,_super),Sha1.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},Sha1.prototype.compress_=function(buf,opt_offset){opt_offset||(opt_offset=0);var W=this.W_;if('string'==typeof buf)for(var i=0;16>i;i++)W[i]=buf.charCodeAt(opt_offset)<<24|buf.charCodeAt(opt_offset+1)<<16|buf.charCodeAt(opt_offset+2)<<8|buf.charCodeAt(opt_offset+3),opt_offset+=4;else for(var i=0;16>i;i++)W[i]=buf[opt_offset]<<24|buf[opt_offset+1]<<16|buf[opt_offset+2]<<8|buf[opt_offset+3],opt_offset+=4;for(var i=16,t;80>i;i++)t=W[i-3]^W[i-8]^W[i-14]^W[i-16],W[i]=4294967295&(t<<1|t>>>31);for(var a=this.chain_[0],b=this.chain_[1],c=this.chain_[2],d=this.chain_[3],e=this.chain_[4],i=0,f,k;80>i;i++){40>i?20>i?(f=d^b&(c^d),k=1518500249):(f=b^c^d,k=1859775393):60>i?(f=b&c|d&(b|c),k=2400959708):(f=b^c^d,k=3395469782);var t=4294967295&(a<<5|a>>>27)+f+e+k+W[i];e=d,d=c,c=4294967295&(b<<30|b>>>2),b=a,a=t}this.chain_[0]=4294967295&this.chain_[0]+a,this.chain_[1]=4294967295&this.chain_[1]+b,this.chain_[2]=4294967295&this.chain_[2]+c,this.chain_[3]=4294967295&this.chain_[3]+d,this.chain_[4]=4294967295&this.chain_[4]+e},Sha1.prototype.update=function(bytes,opt_length){if(null!=bytes){void 0===opt_length&&(opt_length=bytes.length);for(var lengthMinusBlock=opt_length-this.blockSize,n=0,buf=this.buf_,inbuf=this.inbuf_;n<opt_length;){if(0==inbuf)for(;n<=lengthMinusBlock;)this.compress_(bytes,n),n+=this.blockSize;if('string'==typeof bytes){for(;n<opt_length;)if(buf[inbuf]=bytes.charCodeAt(n),++inbuf,++n,inbuf==this.blockSize){this.compress_(buf),inbuf=0;break}}else for(;n<opt_length;)if(buf[inbuf]=bytes[n],++inbuf,++n,inbuf==this.blockSize){this.compress_(buf),inbuf=0;break}}this.inbuf_=inbuf,this.total_+=opt_length}},Sha1.prototype.digest=function(){var digest=[],totalBits=8*this.total_;56>this.inbuf_?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var i=this.blockSize-1;56<=i;i--)this.buf_[i]=255&totalBits,totalBits/=256;this.compress_(this.buf_);for(var n=0,i=0;5>i;i++)for(var j=24;0<=j;j-=8)digest[n]=255&this.chain_[i]>>j,++n;return digest},Sha1}(Hash),ObserverProxy=function(){function ObserverProxy(executor,onNoObservers){var _this=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=onNoObservers,this.task.then(function(){executor(_this)}).catch(function(e){_this.error(e)})}return ObserverProxy.prototype.next=function(value){this.forEachObserver(function(observer){observer.next(value)})},ObserverProxy.prototype.error=function(error){this.forEachObserver(function(observer){observer.error(error)}),this.close(error)},ObserverProxy.prototype.complete=function(){this.forEachObserver(function(observer){observer.complete()}),this.close()},ObserverProxy.prototype.subscribe=function(nextOrObserver,error,complete){var _this=this,observer;if(void 0===nextOrObserver&&void 0===error&&void 0===complete)throw new Error('Missing Observer.');observer=implementsAnyMethods(nextOrObserver,['next','error','complete'])?nextOrObserver:{next:nextOrObserver,error:error,complete:complete},void 0===observer.next&&(observer.next=noop),void 0===observer.error&&(observer.error=noop),void 0===observer.complete&&(observer.complete=noop);var unsub=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{_this.finalError?observer.error(_this.finalError):observer.complete()}catch(e){}}),this.observers.push(observer),unsub},ObserverProxy.prototype.unsubscribeOne=function(i){void 0===this.observers||void 0===this.observers[i]||(delete this.observers[i],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},ObserverProxy.prototype.forEachObserver=function(fn){if(!this.finalized)for(var i=0;i<this.observers.length;i++)this.sendOne(i,fn)},ObserverProxy.prototype.sendOne=function(i,fn){var _this=this;this.task.then(function(){if(void 0!==_this.observers&&void 0!==_this.observers[i])try{fn(_this.observers[i])}catch(e){'undefined'!=typeof console&&console.error&&console.error(e)}})},ObserverProxy.prototype.close=function(err){var _this=this;this.finalized||(this.finalized=!0,void 0!==err&&(this.finalError=err),this.task.then(function(){_this.observers=void 0,_this.onNoObservers=void 0}))},ObserverProxy}();exports.assert=assert,exports.assertionError=assertionError,exports.base64=base64,exports.base64Decode=base64Decode,exports.base64Encode=function(str){var utf8Bytes=stringToByteArray(str);return base64.encodeByteArray(utf8Bytes,!0)},exports.CONSTANTS=CONSTANTS,exports.deepCopy=function deepCopy(value){return deepExtend(void 0,value)},exports.deepExtend=deepExtend,exports.patchProperty=function patchProperty(obj,prop,value){obj[prop]=value},exports.Deferred=Deferred,exports.getUA=getUA,exports.isMobileCordova=function(){return'undefined'!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA())},exports.isNodeSdk=function(){return!0===CONSTANTS.NODE_CLIENT||!0===CONSTANTS.NODE_ADMIN},exports.isReactNative=function(){return'object'==typeof navigator&&'ReactNative'===navigator.product},exports.ErrorFactory=ErrorFactory,exports.FirebaseError=FirebaseError,exports.patchCapture=function patchCapture(captureFake){var result=captureStackTrace;return captureStackTrace=captureFake,result},exports.jsonEval=jsonEval,exports.stringify=function stringify(data){return JSON.stringify(data)},exports.decode=decode,exports.isAdmin=function(token){var claims=decode(token).claims;return'object'==typeof claims&&!0===claims.admin},exports.issuedAtTime=function(token){var claims=decode(token).claims;return'object'==typeof claims&&claims.hasOwnProperty('iat')?claims.iat:null},exports.isValidFormat=function(token){var decoded=decode(token),claims=decoded.claims;return!!claims&&'object'==typeof claims&&claims.hasOwnProperty('iat')},exports.isValidTimestamp=function(token){var claims=decode(token).claims,now=Math.floor(new Date().getTime()/1e3),validSince,validUntil;return'object'==typeof claims&&(claims.hasOwnProperty('nbf')?validSince=claims.nbf:claims.hasOwnProperty('iat')&&(validSince=claims.iat),validUntil=claims.hasOwnProperty('exp')?claims.exp:validSince+86400),now&&validSince&&validUntil&&now>=validSince&&now<=validUntil},exports.clone=function(obj){return extend({},obj)},exports.contains=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)},exports.every=function(obj,fn){for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)&&!fn(key,obj[key]))return!1;return!0},exports.extend=extend,exports.findKey=findKey,exports.findValue=function(obj,fn,opt_this){var key=findKey(obj,fn,opt_this);return key&&obj[key]},exports.forEach=forEach,exports.getAnyKey=function(obj){for(var key in obj)return key},exports.getCount=function(obj){var rv=0;for(var key in obj)rv++;return rv},exports.getValues=function(obj){var res=[],i=0;for(var key in obj)res[i++]=obj[key];return res},exports.isEmpty=function(obj){for(var key in obj)return!1;return!0},exports.isNonNullObject=function(obj){return'object'==typeof obj&&null!==obj},exports.map=function(obj,f,opt_obj){var res={};for(var key in obj)res[key]=f.call(opt_obj,obj[key],key,obj);return res},exports.safeGet=function(obj,key){if(Object.prototype.hasOwnProperty.call(obj,key))return obj[key]},exports.querystring=function(querystringParams){var params=[];return forEach(querystringParams,function(key,value){Array.isArray(value)?value.forEach(function(arrayVal){params.push(encodeURIComponent(key)+'='+encodeURIComponent(arrayVal))}):params.push(encodeURIComponent(key)+'='+encodeURIComponent(value))}),params.length?'&'+params.join('&'):''},exports.querystringDecode=function(querystring){var obj={},tokens=querystring.replace(/^\?/,'').split('&');return tokens.forEach(function(token){if(token){var key=token.split('=');obj[key[0]]=key[1]}}),obj},exports.Sha1=Sha1,exports.async=function async(fn,onError){return function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];Promise.resolve(!0).then(function(){fn.apply(void 0,args)}).catch(function(error){onError&&onError(error)})}},exports.createSubscribe=function createSubscribe(executor,onNoObservers){var proxy=new ObserverProxy(executor,onNoObservers);return proxy.subscribe.bind(proxy)},exports.errorPrefix=errorPrefix,exports.validateArgCount=function(fnName,minCount,maxCount,argCount){var argError;if(argCount<minCount?argError='at least '+minCount:argCount>maxCount&&(argError=0===maxCount?'none':'no more than '+maxCount),argError){var error=fnName+' failed: Was called with '+argCount+(1===argCount?' argument.':' arguments.')+' Expects '+argError+'.';throw new Error(error)}},exports.validateCallback=function validateCallback(fnName,argumentNumber,callback,optional){if((!optional||callback)&&'function'!=typeof callback)throw new Error(errorPrefix(fnName,argumentNumber,optional)+'must be a valid function.')},exports.validateContextObject=function validateContextObject(fnName,argumentNumber,context,optional){if((!optional||context)&&('object'!=typeof context||null===context))throw new Error(errorPrefix(fnName,argumentNumber,optional)+'must be a valid context object.')},exports.validateNamespace=function validateNamespace(fnName,argumentNumber,namespace,optional){if((!optional||namespace)&&'string'!=typeof namespace)throw new Error(errorPrefix(fnName,argumentNumber,optional)+'must be a valid firebase namespace.')},exports.stringLength=function(str){for(var p=0,i=0,c;i<str.length;i++)c=str.charCodeAt(i),128>c?p++:2048>c?p+=2:55296<=c&&56319>=c?(p+=4,i++):p+=3;return p},exports.stringToByteArray=function(str){for(var out=[],p=0,i=0,c;i<str.length;i++){if(c=str.charCodeAt(i),55296<=c&&56319>=c){var high=c-55296;i++,assert(i<str.length,'Surrogate pair missing trail surrogate.');var low=str.charCodeAt(i)-56320;c=65536+(high<<10)+low}128>c?out[p++]=c:2048>c?(out[p++]=192|c>>6,out[p++]=128|63&c):65536>c?(out[p++]=224|c>>12,out[p++]=128|63&c>>6,out[p++]=128|63&c):(out[p++]=240|c>>18,out[p++]=128|63&c>>12,out[p++]=128|63&c>>6,out[p++]=128|63&c)}return out}},function(module,__webpack_exports__,__webpack_require__){'use strict';var _Mathround=Math.round,_Mathfloor2=Math.floor,_Mathmax2=Math.max;(function(global){function l(a){return'string'==typeof a}function m(a,b){a=a.split('.'),b=b||h;for(var c=0;c<a.length;c++)if(b=b[a[c]],null==b)return null;return b}function aa(){}function ba(a){var b=typeof a;if('object'==b){if(a){if(a instanceof Array)return'array';if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if('[object Window]'==c)return'object';if('[object Array]'==c||'number'==typeof a.length&&'undefined'!=typeof a.splice&&'undefined'!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable('splice'))return'array';if('[object Function]'==c||'undefined'!=typeof a.call&&'undefined'!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable('call'))return'function'}else return'null';}else if('function'==b&&'undefined'==typeof a.call)return'object';return b}function n(a){return'array'==ba(a)}function ca(a){var b=ba(a);return'array'==b||'object'==b&&'number'==typeof a.length}function q(a){return'function'==ba(a)}function r(a){var b=typeof a;return'object'==b&&null!=a||'function'==b}function ea(a){return a.call.apply(a.bind,arguments)}function fa(a,b){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function u(){return u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf('native code')?ea:fa,u.apply(null,arguments)}function v(a){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();return b.push.apply(b,arguments),a.apply(this,b)}}function x(a,b){function c(){}c.prototype=b.prototype,a.L=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.mh=function(a,c){for(var d=Array(arguments.length-2),f=2;f<arguments.length;f++)d[f-2]=arguments[f];return b.prototype[c].apply(a,d)}}function y(a){if(Error.captureStackTrace)Error.captureStackTrace(this,y);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=a+'')}function ha(a,b){a=a.split('%s');for(var c='',d=a.length-1,f=0;f<d;f++)c+=a[f]+(f<b.length?b[f]:'%s');y.call(this,c+a[d])}function ia(a){throw new ha('Failure'+(a?': '+a:''),Array.prototype.slice.call(arguments,1))}function z(){0!=ja&&(ka[this[t]||(this[t]=++da)]=this),this.Ka=this.Ka,this.Qa=this.Qa}function pa(a){a:{for(var b=qa,c=a.length,d=l(a)?a.split(''):a,f=0;f<c;f++)if(f in d&&b.call(void 0,d[f],f,a)){b=f;break a}b=-1}return 0>b?null:l(a)?a.charAt(b):a[b]}function ra(a){if(!n(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function sa(a,b){b=la(a,b);var c;return(c=0<=b)&&Array.prototype.splice.call(a,b,1),c}function ta(){return Array.prototype.concat.apply([],arguments)}function ua(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}function va(a){return /^[\s\xa0]*$/.test(a)}function xa(a,b){return a<b?-1:a>b?1:0}function B(a){return-1!=A.indexOf(a)}function Aa(a,b,c){for(var d in a)b.call(c,a[d],d,a)}function Ba(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function Ca(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b}function Da(a){var b={},c;for(c in a)b[c]=a[c];return b}function Fa(a){for(var f=1,c,d;f<arguments.length;f++){for(c in d=arguments[f],d)a[c]=d[c];for(var g=0;g<Ea.length;g++)c=Ea[g],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function Ga(a){return Ga[' '](a),a}function Ha(a,b){var c=Ia;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)}function Oa(){var a=h.document;return a?a.documentMode:void 0}function Ta(a){return Ha(a,function(){for(var b=0,c=wa(Pa+'').split('.'),d=wa(a+'').split('.'),f=_Mathmax2(c.length,d.length),g=0;0==b&&g<f;g++){var k=c[g]||'',p=d[g]||'';do{if(k=/(\d*)(\D*)(.*)/.exec(k)||['','','',''],p=/(\d*)(\D*)(.*)/.exec(p)||['','','',''],0==k[0].length&&0==p[0].length)break;b=xa(0==k[1].length?0:parseInt(k[1],10),0==p[1].length?0:parseInt(p[1],10))||xa(0==k[2].length,0==p[2].length)||xa(k[2],p[2]),k=k[3],p=p[3]}while(0==b)}return 0<=b})}function D(a,b){this.type=a,this.currentTarget=this.target=b,this.defaultPrevented=this.Ea=!1,this.Be=!0}function E(a,b){D.call(this,a?a.type:''),this.relatedTarget=this.currentTarget=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.key='',this.charCode=this.keyCode=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType='',this.fb=null,a&&this.Kf(a,b)}function F(a){return a&&a[ab]}function cb(a,b,c,d,f){this.listener=a,this.proxy=null,this.src=b,this.type=c,this.capture=!!d,this.Ob=f,this.key=++bb,this.Sa=this.Eb=!1}function db(a){this.src=a,this.J={},this.xb=0}function eb(a,b,c,d){for(var f=0,g;f<a.length;++f)if(g=a[f],!g.Sa&&g.listener==b&&g.capture==!!c&&g.Ob==d)return f;return-1}function ib(a,b,c,d,f){if(d&&d.once)return jb(a,b,c,d,f);if(n(b)){for(var g=0;g<b.length;g++)ib(a,b[g],c,d,f);return null}return c=kb(c),F(a)?a.nb(b,c,r(d)?!!d.capture:!!d,f):lb(a,b,c,!1,d,f)}function lb(a,b,c,d,f,g){if(!b)throw Error('Invalid event type');var k=r(f)?!!f.capture:!!f,p=G(a);if(p||(a[fb]=p=new db(a)),c=p.add(b,c,d,k,g),c.proxy)return c;if(d=mb(),c.proxy=d,d.src=a,d.listener=c,a.addEventListener)Za||(f=k),void 0===f&&(f=!1),a.addEventListener(b.toString(),d,f);else if(a.attachEvent)a.attachEvent(nb(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error('addEventListener and attachEvent are unavailable.');return c}function mb(){var a=ob,b=Xa?function(c){return a.call(b.src,b.listener,c)}:function(c){if(c=a.call(b.src,b.listener,c),!c)return c};return b}function jb(a,b,c,d,f){if(n(b)){for(var g=0;g<b.length;g++)jb(a,b[g],c,d,f);return null}return c=kb(c),F(a)?a.Oc(b,c,r(d)?!!d.capture:!!d,f):lb(a,b,c,!0,d,f)}function pb(a,b,c,d,f){if(n(b))for(var g=0;g<b.length;g++)pb(a,b[g],c,d,f);else d=r(d)?!!d.capture:!!d,c=kb(c),F(a)?a.ed(b,c,d,f):a&&(a=G(a))&&(b=a.jb(b,c,d,f))&&qb(b)}function qb(a){if('number'!=typeof a&&a&&!a.Sa){var b=a.src;if(F(b))b.Le(a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(nb(c),d):b.addListener&&b.removeListener&&b.removeListener(d),(c=G(b))?(c.ye(a),0==c.xb&&(c.src=null,b[fb]=null)):a.Vb()}}}function nb(a){return a in gb?gb[a]:gb[a]='on'+a}function rb(a,b,c,d){var f=!0;if((a=G(a))&&(b=a.J[b.toString()]))for(b=b.concat(),a=0;a<b.length;a++){var g=b[a];g&&g.capture==c&&!g.Sa&&(g=sb(g,d),f=f&&!1!==g)}return f}function sb(a,b){var c=a.listener,d=a.Ob||a.src;return a.Eb&&qb(a),c.call(d,b)}function ob(a,b){if(a.Sa)return!0;if(!Xa){var c=b||m('window.event');b=new E(c,this);var d=!0;if(!(0>c.keyCode||void 0!=c.returnValue)){a:{var f=!1;if(0==c.keyCode)try{c.keyCode=-1;break a}catch(k){f=!0}(f||void 0==c.returnValue)&&(c.returnValue=!0)}for(c=[],f=b.currentTarget;f;f=f.parentNode)c.push(f);for(a=a.type,f=c.length-1;!b.Ea&&0<=f;f--){b.currentTarget=c[f];var g=rb(c[f],a,!0,b);d=d&&g}for(f=0;!b.Ea&&f<c.length;f++)b.currentTarget=c[f],g=rb(c[f],a,!1,b),d=d&&g}return d}return sb(a,new E(b,this))}function G(a){return a=a[fb],a instanceof db?a:null}function kb(a){return q(a)?a:(a[tb]||(a[tb]=function(b){return a.handleEvent(b)}),a[tb])}function H(){z.call(this),this.ka=new db(this),this.Pe=this,this.Uc=null}function vb(a,b){this.Sf=100,this.ef=a,this.ug=b,this.Zb=0,this.Pb=null}function I(){this.lc=this.Va=null}function wb(){this.next=this.scope=this.Gc=null}function yb(a){h.setTimeout(function(){throw a},0)}function Ab(){var a=h.MessageChannel;if('undefined'==typeof a&&'undefined'!=typeof window&&window.postMessage&&window.addEventListener&&!B('Presto')&&(a=function(){var a=document.createElement('IFRAME');a.style.display='none',a.src='',document.documentElement.appendChild(a);var b=a.contentWindow;a=b.document,a.open(),a.write(''),a.close();var c='callImmediate'+Math.random(),d='file:'==b.location.protocol?'*':b.location.protocol+'//'+b.location.host;a=u(function(a){('*'==d||a.origin==d)&&a.data==c&&this.port1.onmessage()},this),b.addEventListener('message',a,!1),this.port1={},this.port2={postMessage:function(){b.postMessage(c,d)}}}),'undefined'!=typeof a&&!B('Trident')&&!B('MSIE')){var b=new a,c={},d=c;return b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var a=c.rd;c.rd=null,a()}},function(a){d.next={rd:a},d=d.next,b.port2.postMessage(0)}}return'undefined'!=typeof document&&'onreadystatechange'in document.createElement('SCRIPT')?function(a){var b=document.createElement('SCRIPT');b.onreadystatechange=function(){b.onreadystatechange=null,b.parentNode.removeChild(b),b=null,a(),a=null},document.documentElement.appendChild(b)}:function(a){h.setTimeout(a,0)}}function Cb(){if(h.Promise&&h.Promise.resolve){var a=h.Promise.resolve(void 0);Bb=function(){a.then(Db)}}else Bb=function(){var a=Db;!q(h.setImmediate)||h.Window&&h.Window.prototype&&!B('Edge')&&h.Window.prototype.setImmediate==h.setImmediate?(zb||(zb=Ab()),zb(a)):h.setImmediate(a)}}function Db(){for(var a;a=Fb.remove();){try{a.Gc.call(a.scope)}catch(b){yb(b)}Fb.wg(a)}Eb=!1}function Gb(a,b){H.call(this),this.Na=a||1,this.wb=b||h,this.nd=u(this.Rg,this),this.ie=w()}function Hb(a,b,c){if(q(a))c&&(a=u(a,c));else if(a&&'function'==typeof a.handleEvent)a=u(a.handleEvent,a);else throw Error('Invalid listener argument');return 2147483647<+b?-1:h.setTimeout(a,b||0)}function Ib(a,b,c){z.call(this),this.Uf=null==c?a:u(a,c),this.Na=b,this.Xe=u(this.fg,this),this.qc=[]}function Jb(a){z.call(this),this.i=a,this.o={}}function J(a,b,c){this.reset(a,b,c,void 0,void 0)}function Mb(a){this.pe=a,this.Zd=this.uc=this.mb=this.$b=null}function K(a,b){this.name=a,this.value=b}function Vb(a){Tb||(Tb=new Mb(''),Sb['']=Tb,Tb.Ge(Qb));var b;if(!(b=Sb[a])){b=new Mb(a);var c=a.lastIndexOf('.'),d=a.substr(c+1);c=Vb(a.substr(0,c)),c.Qe(d,b),b.Fg(c),Sb[a]=b}return b}function Wb(a,b){a&&a.info(b,void 0)}function L(a,b){a&&a.lf(b)}function Xb(){this.s=Vb('goog.labs.net.webChannel.WebChannelDebug'),this.Wc=!0}function Yb(a){D.call(this,'serverreachability',a)}function N(a){M.dispatchEvent(new Yb(M,a))}function Zb(a,b){D.call(this,'statevent',a),this.stat=b}function O(a){M.dispatchEvent(new Zb(M,a))}function $b(a,b,c){D.call(this,'timingevent',a),this.size=b,this.rtt=c}function ac(a,b,c){M.dispatchEvent(new $b(M,a,b,c))}function P(a,b){if(!q(a))throw Error('Fn must not be null and must be a function');return h.setTimeout(function(){a()},b)}function dc(){}function ec(){}function fc(){D.call(this,'d')}function gc(){D.call(this,'c')}function ic(){}function R(a,b,c,d,f){this.b=a,this.a=b,this.ra=c,this.R=d,this.Xc=f||1,this.Fc=new Jb(this),this.Ua=jc,a=La?125:void 0,this.Vc=new Gb(a),this.A=null,this.S=!1,this.Da=this.pa=this.ua=this.ic=this.qb=this.hd=this.Ga=null,this.ba=[],this.h=null,this.Bb=0,this.I=this.Fa=null,this.w=-1,this.Za=!1,this.Ra=0,this.ac=null,this.lb=this.Ed=this.yc=!1}function kc(a,b){return 0===a?'Non-200 return code ('+b+')':1===a?'XMLHTTP failure (no data)':2===a?'HttpConnection timeout':'Unknown error'}function nc(a){if(a.H&&'function'==typeof a.H)return a.H();if(l(a))return a.split('');if(ca(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return Ba(a)}function oc(a,b,c){if(a.forEach&&'function'==typeof a.forEach)a.forEach(b,c);else if(ca(a)||l(a))na(a,b,c);else{if(a.W&&'function'==typeof a.W)var d=a.W();else if(a.H&&'function'==typeof a.H)d=void 0;else if(ca(a)||l(a)){d=[];for(var f=a.length,g=0;g<f;g++)d.push(g)}else d=Ca(a);f=nc(a),g=f.length;for(var k=0;k<g;k++)b.call(c,f[k],d&&d[k],a)}}function S(a){this.D={},this.o=[],this.j=0;var c=arguments.length;if(1<c){if(c%2)throw Error('Uneven number of arguments');for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else a&&this.addAll(a)}function T(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function qc(a,b){if(a){a=a.split('&');for(var c=0;c<a.length;c++){var d=a[c].indexOf('='),f=null;if(0<=d){var g=a[c].substring(0,d);f=a[c].substring(d+1)}else g=a[c];b(g,f?decodeURIComponent(f.replace(/\+/g,' ')):'')}}}function U(a,b){this.xa=this.zb=this.qa='',this.Ca=null,this.ib=this.K='',this.O=this.Qf=!1;var c;a instanceof U?(this.O=void 0===b?a.O:b,this.tb(a.qa),this.cd(a.zb),this.rb(a.xa),this.sb(a.Ca),this.ec(a.K),this.bd(a.P.clone()),this.$c(a.ib)):a&&(c=(a+'').match(pc))?(this.O=!!b,this.tb(c[1]||'',!0),this.cd(c[2]||'',!0),this.rb(c[3]||'',!0),this.sb(c[4]),this.ec(c[5]||'',!0),this.bd(c[6]||'',!0),this.$c(c[7]||'',!0)):(this.O=!!b,this.P=new rc(null,this.O))}function Ac(a){return a instanceof U?a.clone():new U(a,void 0)}function Bc(a,b,c,d){var f=new U(null,void 0);return a&&f.tb(a),b&&f.rb(b),c&&f.sb(c),d&&f.ec(d),f}function yc(a,b){return a?b?decodeURI(a.replace(/%25/g,'%2525')):decodeURIComponent(a):''}function sc(a,b,c){return l(a)?(a=encodeURI(a).replace(b,Cc),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,'%$1')),a):null}function Cc(a){return a=a.charCodeAt(0),'%'+(15&a>>4).toString(16)+(15&a).toString(16)}function rc(a,b){this.j=this.m=null,this.ja=a||null,this.O=!!b}function Hc(a,b){this.b=a,this.a=b,this.f=this.A=null,this.bc=!1,this.K=null,this.w=-1,this.Ad=this.na=null}function Ic(){this.od=this.$d=null}function Jc(a){this.D=new S,a&&this.addAll(a)}function Kc(a){var b=typeof a;return'object'==b&&a||'function'==b?'o'+(a[t]||(a[t]=++da)):b.substr(0,1)+a}function Lc(a,b){this.Pc=a,this.map=b,this.context=null}function Mc(a){this.me=a||Nc,h.PerformanceNavigationTiming?(a=h.performance.getEntriesByType('navigation'),a=0<a.length&&('hq'==a[0].nextHopProtocol||'h2'==a[0].nextHopProtocol)):a=!!(h.vc&&h.vc.ke&&h.vc.ke()&&h.vc.ke().nh),this.Xb=a?this.me:1,this.v=null,1<this.Xb&&(this.v=new Jc),this.f=null,this.ba=[]}function Oc(){this.xg=this.rg=void 0}function Pc(){this.jg=new Oc}function Qc(a,b){var c=new Xb;c.debug('TestLoadImage: loading '+a);var d=new Image;d.onload=v(Rc,c,d,'TestLoadImage: loaded',!0,b),d.onerror=v(Rc,c,d,'TestLoadImage: error',!1,b),d.onabort=v(Rc,c,d,'TestLoadImage: abort',!1,b),d.ontimeout=v(Rc,c,d,'TestLoadImage: timeout',!1,b),h.setTimeout(function(){d.ontimeout&&d.ontimeout()},1E4),d.src=a}function Rc(a,b,c,d,f){try{a.debug(c),b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,f(d)}catch(g){a.cb(g)}}function V(a){H.call(this),this.headers=new S,this.Xa=a||null,this.ha=!1,this.mc=this.c=null,this.ge=this.Tb='',this.Pa=0,this.I='',this.Aa=this.Lc=this.Qb=this.Ec=!1,this.vb=0,this.hc=null,this.Ae=Tc,this.jc=this.lg=this.Ab=!1}function Wc(a){return C&&Ta(9)&&'number'==typeof a.timeout&&void 0!==a.ontimeout}function qa(a){return'content-type'==a.toLowerCase()}function Xc(a,b){return{type:b,lengthComputable:a.lengthComputable,loaded:a.loaded,total:a.total}}function Yc(a){var b='';return Aa(a,function(a,d){b+=d,b+=':',b+=a,b+='\r\n'}),b}function Zc(a,b,c){a:{for(d in c){var d=!1;break a}d=!0}if(d)return a;if(c=Yc(c),l(a)){if(b=encodeURIComponent(b+''),c=null==c?'':'='+encodeURIComponent(c+''),b+=c){if(c=a.indexOf('#'),0>c&&(c=a.length),d=a.indexOf('?'),0>d||d>c){d=c;var f=''}else f=a.substring(d+1,c);a=[a.substr(0,d),f,a.substr(c)],c=a[1],a[1]=b?c?c+'&'+b:b:c,a=a[0]+(a[1]?'?'+a[1]:'')+a[2]}return a}return a.l(b,c),a}function $c(a){this.Bd=22,this.De=0,this.M=[],this.a=new Xb,this.Ib=new Ic,this.na=this.md=this.hb=this.K=this.u=this.Kc=this.aa=this.gb=this.N=this.Rb=this.A=null,this.Te=!0,this.ag=this.Yb=0,this.kf=!!m('internalChannelParams.failFast',a),this.fd=this.Ja=this.wa=this.ia=this.ea=this.i=null,this.Se=!0,this.w=this.he=this.Sb=-1,this.rc=this.Ha=this.La=0,this.Ve=m('internalChannelParams.baseRetryDelayMs',a)||5E3,this.vg=m('internalChannelParams.retryDelaySeedMs',a)||1E4,this.nf=m('internalChannelParams.forwardChannelMaxRetries',a)||2,this.Od=m('internalChannelParams.forwardChannelRequestTimeoutMs',a)||2E4,this.Xa=a&&a.oh||void 0,this.Db=void 0,this.Ra=0,this.gc=a&&a.supportsCrossDomainXhr||!1,this.ra='',this.G=new Mc(a&&a.concurrentRequestLimit),this.kc=new Pc,this.ta=a&&void 0!==a.backgroundChannelTest?a.backgroundChannelTest:!0,(this.Nd=a&&a.fastHandshake||!1)&&!this.ta&&(this.a.T('Force backgroundChannelTest when fastHandshake is enabled.'),this.ta=!0),a&&a.Id&&this.a.Id()}function ad(){}function bd(){for(var b=arguments[0],c=1,d;c<arguments.length;c++)if(d=arguments[c],0==d.lastIndexOf('/',0))b=d;else{var f;(f=''==b)||(f=b.length-1,f=0<=f&&b.indexOf('/',f)==f),b=f?b+d:b+('/'+d)}return b}function cd(){if(C&&!(10<=+Ua))throw Error('Environmental error: no available transport.')}function W(a,b){H.call(this),this.b=new $c(b),this.yb=a,this.Qg=b&&b.testUrl?b.testUrl:bd(this.yb,'test'),this.s=Vb('goog.labs.net.webChannel.WebChannelBaseTransport'),this.Rc=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a['X-Client-Protocol']='webchannel':a={"X-Client-Protocol":'webchannel'}),this.b.ga(a),a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a['X-WebChannel-Content-Type']=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.zd&&(a?a['X-WebChannel-Client-Profile']=b.zd:a={"X-WebChannel-Client-Profile":b.zd}),this.b.Eg(a),(a=b&&b.httpHeadersOverwriteParam)&&!va(a)&&this.b.Cg(a),this.Og=b&&b.supportsCrossDomainXhr||!1,this.zg=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!va(b)&&(this.b.Dg(b),a=this.Rc,null!==a&&b in a&&(a=this.Rc,b in a&&delete a[b],(a=this.s)&&a.T('Ignore httpSessionIdParam also specified with messageUrlParams: '+b,void 0))),this.vd=new X(this)}function dd(a){fc.call(this);var b=a.__sm__;if(b){a:{for(var c in b){a=c;break a}a=void 0}(this.ne=a)&&(a=this.ne,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function ed(a){gc.call(this),this.status=1,this.errorCode=a}function X(a){this.b=a}function gd(){this.V=[],this.Z=[]}function hd(a,b){if(z.call(this),this.oe=a||0,this.Wb=b||10,this.oe>this.Wb)throw Error(id);this.fa=new gd,this.oa=new Jc,this.Ac=0,this.Nc=null,this.Cb()}function jd(a,b){this.fe=a,this.gd=b}function kd(a){this.Y=[],a&&this.Lf(a)}function ld(){kd.call(this)}function Y(a,b){this.Gd=void 0,this.cc=new ld,hd.call(this,a,b)}function Z(a,b,c,d){this.Jf=a,this.Ab=!!d,Y.call(this,b,c)}Object.defineProperty(__webpack_exports__,'__esModule',{value:!0}),__webpack_require__.d(__webpack_exports__,'createWebChannelTransport',function(){return src_1}),__webpack_require__.d(__webpack_exports__,'ErrorCode',function(){return src_2}),__webpack_require__.d(__webpack_exports__,'EventType',function(){return src_3}),__webpack_require__.d(__webpack_exports__,'WebChannel',function(){return src_4}),__webpack_require__.d(__webpack_exports__,'XhrIoPool',function(){return src_5});var commonjsGlobal='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,goog=goog||{},h=commonjsGlobal,t='closure_uid_'+(1E9*Math.random()>>>0),da=0,w=Date.now||function(){return+new Date},e;x(y,Error),y.prototype.name='CustomError',x(ha,y),ha.prototype.name='AssertionError';var ja=0,ka={};z.prototype.Ka=!1,z.prototype.bb=function(){if(!this.Ka&&(this.Ka=!0,this.F(),0!=ja)){var a=this[t]||(this[t]=++da);if(0!=ja)throw Error(this+' did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass\' method.');delete ka[a]}},z.prototype.F=function(){if(this.Qa)for(;this.Qa.length;)this.Qa.shift()()};var la=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if(l(a))return l(b)&&1==b.length?a.indexOf(b,0):-1;for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},ma=Array.prototype.lastIndexOf?function(a,b){return Array.prototype.lastIndexOf.call(a,b,a.length-1)}:function(a,b){var c=a.length-1;if(0>c&&(c=_Mathmax2(0,a.length+c)),l(a))return l(b)&&1==b.length?a.lastIndexOf(b,c):-1;for(;0<=c;c--)if(c in a&&a[c]===b)return c;return-1},na=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,f=l(a)?a.split(''):a,g=0;g<d;g++)g in f&&b.call(c,f[g],g,a)},oa=Array.prototype.some?function(a,b){return Array.prototype.some.call(a,b,void 0)}:function(a,b){for(var c=a.length,d=l(a)?a.split(''):a,f=0;f<c;f++)if(f in d&&b.call(void 0,d[f],f,a))return!0;return!1},wa=String.prototype.trim?function(a){return a.trim()}:function(a){return /^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]},A;a:{var ya=h.navigator;if(ya){var za=ya.userAgent;if(za){A=za;break a}}A=''}var Ea='constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf'.split(' ');Ga[' ']=aa;var Ja=B('Opera'),C=B('Trident')||B('MSIE'),Ka=B('Edge'),La=Ka||C,Ma=B('Gecko')&&(-1==A.toLowerCase().indexOf('webkit')||B('Edge'))&&!(B('Trident')||B('MSIE'))&&!B('Edge'),Na=-1!=A.toLowerCase().indexOf('webkit')&&!B('Edge'),Pa;a:{var Qa='',Ra=function(){var a=A;return Ma?/rv:([^\);]+)(\)|;)/.exec(a):Ka?/Edge\/([\d\.]+)/.exec(a):C?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):Na?/WebKit\/(\S+)/.exec(a):Ja?/(?:Version)[ \/]?(\S+)/.exec(a):void 0}();if(Ra&&(Qa=Ra?Ra[1]:''),C){var Sa=Oa();if(null!=Sa&&Sa>parseFloat(Qa)){Pa=Sa+'';break a}}Pa=Qa}var Ia={},Va=h.document,Ua;Ua=Va&&C?Oa()||('CSS1Compat'==Va.compatMode?parseInt(Pa,10):5):void 0;var Wa=Object.freeze||function(a){return a},Xa=!C||9<=+Ua,Ya=C&&!Ta('9'),Za=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},'passive',{get:function(){a=!0}});try{h.addEventListener('test',aa,b),h.removeEventListener('test',aa,b)}catch(c){}return a}();D.prototype.stopPropagation=function(){this.Ea=!0},D.prototype.preventDefault=function(){this.defaultPrevented=!0,this.Be=!1},x(E,D);var $a=Wa({2:'touch',3:'pen',4:'mouse'});E.prototype.Kf=function(a,b){var c=this.type=a.type,d=a.changedTouches?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.currentTarget=b,!(b=a.relatedTarget))'mouseover'==c?b=a.fromElement:'mouseout'==c&&(b=a.toElement);else if(Ma){a:{try{Ga(b.nodeName);var f=!0;break a}catch(g){}f=!1}f||(b=null)}this.relatedTarget=b,null===d?(this.offsetX=Na||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=Na||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0===a.clientX?a.pageX:a.clientX,this.clientY=void 0===a.clientY?a.pageY:a.clientY,this.screenX=a.screenX||0,this.screenY=a.screenY||0):(this.clientX=void 0===d.clientX?d.pageX:d.clientX,this.clientY=void 0===d.clientY?d.pageY:d.clientY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=a.button,this.keyCode=a.keyCode||0,this.key=a.key||'',this.charCode=a.charCode||('keypress'==c?a.keyCode:0),this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=l(a.pointerType)?a.pointerType:$a[a.pointerType]||'',this.state=a.state,this.fb=a,a.defaultPrevented&&this.preventDefault()},E.prototype.stopPropagation=function(){E.L.stopPropagation.call(this),this.fb.stopPropagation?this.fb.stopPropagation():this.fb.cancelBubble=!0},E.prototype.preventDefault=function(){E.L.preventDefault.call(this);var a=this.fb;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Ya)try{(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)&&(a.keyCode=-1)}catch(b){}};var ab='closure_listenable_'+(0|1E6*Math.random()),bb=0;cb.prototype.Vb=function(){this.Sa=!0,this.Ob=this.src=this.proxy=this.listener=null},e=db.prototype,e.add=function(a,b,c,d,f){var g=a.toString();a=this.J[g],a||(a=this.J[g]=[],this.xb++);var k=eb(a,b,d,f);return-1<k?(b=a[k],c||(b.Eb=!1)):(b=new cb(b,this.src,g,!!d,f),b.Eb=c,a.push(b)),b},e.remove=function(a,b,c,d){if(a=a.toString(),!(a in this.J))return!1;var f=this.J[a];return b=eb(f,b,c,d),!!(-1<b)&&(f[b].Vb(),Array.prototype.splice.call(f,b,1),0==f.length&&(delete this.J[a],this.xb--),!0)},e.ye=function(a){var b=a.type;b in this.J&&sa(this.J[b],a)&&(a.Vb(),0==this.J[b].length&&(delete this.J[b],this.xb--))},e.pb=function(a){a=a&&a.toString();for(var c in this.J)if(!a||c==a){for(var d=this.J[c],f=0;f<d.length;f++)d[f].Vb();delete this.J[c],this.xb--}},e.jb=function(a,b,c,d){a=this.J[a.toString()];var f=-1;return a&&(f=eb(a,b,c,d)),-1<f?a[f]:null};var fb='closure_lm_'+(0|1E6*Math.random()),gb={},tb='__closure_events_fn_'+(1E9*Math.random()>>>0);x(H,z),H.prototype[ab]=!0,e=H.prototype,e.addEventListener=function(a,b,c,d){ib(this,a,b,c,d)},e.removeEventListener=function(a,b,c,d){pb(this,a,b,c,d)},e.dispatchEvent=function(a){var c=this.Uc,b;if(c)for(b=[];c;c=c.Uc)b.push(c);c=this.Pe;var d=a.type||a;if(l(a))a=new D(a,c);else if(a instanceof D)a.target=a.target||c;else{var f=a;a=new D(d,c),Fa(a,f)}if(f=!0,b)for(var g=b.length-1,k;!a.Ea&&0<=g;g--)k=a.currentTarget=b[g],f=k.Lb(d,!0,a)&&f;if(a.Ea||(k=a.currentTarget=c,f=k.Lb(d,!0,a)&&f,a.Ea||(f=k.Lb(d,!1,a)&&f)),b)for(g=0;!a.Ea&&g<b.length;g++)k=a.currentTarget=b[g],f=k.Lb(d,!1,a)&&f;return f},e.F=function(){H.L.F.call(this),this.pg(),this.Uc=null},e.nb=function(a,b,c,d){return this.ka.add(a+'',b,!1,c,d)},e.Oc=function(a,b,c,d){return this.ka.add(a+'',b,!0,c,d)},e.ed=function(a,b,c,d){this.ka.remove(a+'',b,c,d)},e.Le=function(a){this.ka.ye(a)},e.pg=function(){this.ka&&this.ka.pb(void 0)},e.Lb=function(a,b,c){if(a=this.ka.J[a+''],!a)return!0;a=a.concat();for(var d=!0,f=0,g;f<a.length;++f)if(g=a[f],g&&!g.Sa&&g.capture==b){var k=g.listener,p=g.Ob||g.src;g.Eb&&this.Le(g),d=!1!==k.call(p,c)&&d}return d&&0!=c.Be},e.jb=function(a,b,c,d){return this.ka.jb(a+'',b,c,d)};var ub=h.JSON.stringify;vb.prototype.get=function(){if(0<this.Zb){this.Zb--;var a=this.Pb;this.Pb=a.next,a.next=null}else a=this.ef();return a},vb.prototype.put=function(a){this.ug(a),this.Zb<this.Sf&&(this.Zb++,a.next=this.Pb,this.Pb=a)};var xb=new vb(function(){return new wb},function(a){a.reset()});I.prototype.add=function(a,b){var c=this.Af();c.set(a,b),this.lc?this.lc.next=c:this.Va=c,this.lc=c},I.prototype.remove=function(){var a=null;return this.Va&&(a=this.Va,this.Va=this.Va.next,this.Va||(this.lc=null),a.next=null),a},I.prototype.wg=function(a){xb.put(a)},I.prototype.Af=function(){return xb.get()},wb.prototype.set=function(a,b){this.Gc=a,this.scope=b,this.next=null},wb.prototype.reset=function(){this.next=this.scope=this.Gc=null};var Eb=!1,Fb=new I,zb,Bb;x(Gb,H),e=Gb.prototype,e.enabled=!1,e.B=null,e.setInterval=function(a){this.Na=a,this.B&&this.enabled?(this.stop(),this.start()):this.B&&this.stop()},e.Rg=function(){if(this.enabled){var a=w()-this.ie;0<a&&a<.8*this.Na?this.B=this.wb.setTimeout(this.nd,this.Na-a):(this.B&&(this.wb.clearTimeout(this.B),this.B=null),this.ff(),this.enabled&&(this.stop(),this.start()))}},e.ff=function(){this.dispatchEvent('tick')},e.start=function(){this.enabled=!0,this.B||(this.B=this.wb.setTimeout(this.nd,this.Na),this.ie=w())},e.stop=function(){this.enabled=!1,this.B&&(this.wb.clearTimeout(this.B),this.B=null)},e.F=function(){Gb.L.F.call(this),this.stop(),delete this.wb},x(Ib,z),e=Ib.prototype,e.Ta=!1,e.ob=0,e.B=null,e.mf=function(){this.qc=arguments,this.B||this.ob?this.Ta=!0:this.Cc()},e.stop=function(){this.B&&(h.clearTimeout(this.B),this.B=null,this.Ta=!1,this.qc=[])},e.pause=function(){this.ob++},e.resume=function(){this.ob--,this.ob||!this.Ta||this.B||(this.Ta=!1,this.Cc())},e.F=function(){Ib.L.F.call(this),this.stop()},e.fg=function(){this.B=null,this.Ta&&!this.ob&&(this.Ta=!1,this.Cc())},e.Cc=function(){this.B=Hb(this.Xe,this.Na),this.Uf.apply(null,this.qc)},x(Jb,z);var Kb=[];e=Jb.prototype,e.nb=function(a,b,c,d){return this.Tf(a,b,c,d)},e.Tf=function(a,b,c,d){n(b)||(b&&(Kb[0]=b.toString()),b=Kb);for(var f=0,g;f<b.length&&(g=ib(a,b[f],c||this.handleEvent,d||!1,this.i||this),!!g);f++)this.o[g.key]=g;return this},e.Oc=function(a,b,c,d){return this.je(a,b,c,d)},e.je=function(a,b,c,d,f){if(n(b))for(var g=0;g<b.length;g++)this.je(a,b[g],c,d,f);else{if(a=jb(a,b,c||this.handleEvent,d,f||this.i||this),!a)return this;this.o[a.key]=a}return this},e.ed=function(a,b,c,d,f){if(n(b))for(var g=0;g<b.length;g++)this.ed(a,b[g],c,d,f);else c=c||this.handleEvent,d=r(d)?!!d.capture:!!d,f=f||this.i||this,c=kb(c),d=!!d,b=F(a)?a.jb(b,c,d,f):a?(a=G(a))?a.jb(b,c,d,f):null:null,b&&(qb(b),delete this.o[b.key])},e.pb=function(){Aa(this.o,function(a,b){this.o.hasOwnProperty(b)&&qb(a)},this),this.o={}},e.F=function(){Jb.L.F.call(this),this.pb()},e.handleEvent=function(){throw Error('EventHandler.handleEvent not implemented')},J.prototype.Md=null,J.prototype.reset=function(a){this.mb=a,delete this.Md},J.prototype.Bg=function(a){this.Md=a},J.prototype.Ge=function(a){this.mb=a},K.prototype.toString=function(){return this.name};var Nb=new K('SEVERE',1E3),Ob=new K('WARNING',900),Pb=new K('INFO',800),Qb=new K('CONFIG',700),Rb=new K('FINE',500);e=Mb.prototype,e.getName=function(){return this.pe},e.getParent=function(){return this.$b},e.pf=function(){return this.uc||(this.uc={}),this.uc},e.Ge=function(a){this.mb=a},e.Qd=function(){return this.mb?this.mb:this.$b?this.$b.Qd():(ia('Root logger has no level set.'),null)},e.Pf=function(a){return a.value>=this.Qd().value},e.log=function(a,b,c){this.Pf(a)&&(q(b)&&(b=b()),this.gf(this.uf(a,b,c)))},e.uf=function(a,b,c){return a=new J(a,b+'',this.pe),c&&a.Bg(c),a},e.ca=function(a,b){this.log(Nb,a,b)},e.T=function(a,b){this.log(Ob,a,b)},e.info=function(a,b){this.log(Pb,a,b)},e.lf=function(a){this.log(Rb,a,void 0)},e.gf=function(a){for(var b=this;b;)b.We(a),b=b.getParent()},e.We=function(a){if(this.Zd)for(var b=0,c;c=this.Zd[b];b++)c(a)},e.Fg=function(a){this.$b=a},e.Qe=function(a,b){this.pf()[a]=b};var Sb={},Tb=null;e=Xb.prototype,e.Id=function(){this.Wc=!1},e.Tg=function(a,b,c,d,f){var g=this;this.info(function(){return'XMLHTTP REQ ('+c+') [attempt '+d+']: '+a+'\n'+b+'\n'+g.Xf(f)})},e.Ug=function(a,b,c,d,f,g){this.info(function(){return'XMLHTTP RESP ('+c+') [ attempt '+d+']: '+a+'\n'+b+'\n'+f+' '+g})},e.Wa=function(a,b,c){var d=this;this.info(function(){return'XMLHTTP TEXT ('+a+'): '+d.ng(b)+(c?' '+c:'')})},e.Sg=function(a){this.info(function(){return'TIMEOUT: '+a})},e.debug=function(a){L(this.s,a)},e.cb=function(a,b){var c=this.s;c&&c.ca(b||'Exception',a)},e.info=function(a){Wb(this.s,a)},e.T=function(a){var b=this.s;b&&b.T(a,void 0)},e.ca=function(a){var b=this.s;b&&b.ca(a,void 0)},e.ng=function(a){if(!this.Wc)return a;if(!a)return null;try{var b=JSON.parse(a);if(b)for(var c=0;c<b.length;c++)n(b[c])&&this.Wf(b[c]);return ub(b)}catch(d){return this.debug('Exception parsing expected JS array - probably was not JS'),a}},e.Wf=function(a){if(!(2>a.length||(a=a[1],!n(a)||1>a.length))){var b=a[0];if('noop'!=b&&'stop'!=b&&'close'!=b)for(b=1;b<a.length;b++)a[b]=''}},e.Xf=function(a){if(!this.Wc)return a;if(!a)return null;var b='';a=a.split('&');for(var c=0,d;c<a.length;c++)if(d=a[c].split('='),1<d.length){var f=d[0];d=d[1];var g=f.split('_');b=2<=g.length&&'type'==g[1]?b+(f+'='+d+'&'):b+(f+'=redacted&')}return b};var M=new H;x(Yb,D),x(Zb,D),x($b,D);var bc={NO_ERROR:0,Vg:1,bh:2,ah:3,Yg:4,$g:5,dh:6,Ne:7,TIMEOUT:8,gh:9},cc={Xg:'complete',kh:'success',Oe:'error',Ne:'abort',ih:'ready',jh:'readystatechange',TIMEOUT:'timeout',eh:'incrementaldata',hh:'progress',Zg:'downloadprogress',lh:'uploadprogress'};dc.prototype.pd=null,dc.prototype.Vd=function(){return this.pd||(this.pd=this.Mf())};var Q={OPEN:'a',Wg:'b',Oe:'c',fh:'d'};x(fc,D),x(gc,D);var hc;x(ic,dc),ic.prototype.Dd=function(){var a=this.Wd();return a?new ActiveXObject(a):new XMLHttpRequest},ic.prototype.Mf=function(){var a={};return this.Wd()&&(a[0]=!0,a[1]=!0),a},ic.prototype.Wd=function(){if(!this.be&&'undefined'==typeof XMLHttpRequest&&'undefined'!=typeof ActiveXObject){for(var a=['MSXML2.XMLHTTP.6.0','MSXML2.XMLHTTP.3.0','MSXML2.XMLHTTP','Microsoft.XMLHTTP'],b=0,c;b<a.length;b++){c=a[b];try{return new ActiveXObject(c),this.be=c}catch(d){}}throw Error('Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed')}return this.be},hc=new ic;var jc=45E3,lc={},mc={};e=R.prototype,e.ga=function(a){this.A=a},e.setTimeout=function(a){this.Ua=a},e.He=function(a){this.Ra=a},e.Gg=function(a){this.ba=a},e.la=function(){return this.ba},e.kd=function(a,b){this.ic=1,this.ua=a.clone().Ub(),this.Da=b,this.yc=!0,this.Ce(null)},e.jd=function(a,b,c){this.ic=1,this.ua=a.clone().Ub(),this.Da=null,this.yc=b,this.Ce(c)},e.Ce=function(a){this.qb=w(),this.eb(),this.pa=this.ua.clone(),this.pa.dc('t',this.Xc),this.Bb=0,this.h=this.b.Jb(this.b.fc()?a:null),0<this.Ra&&(this.ac=new Ib(u(this.Me,this,this.h),this.Ra)),this.Fc.nb(this.h,'readystatechange',this.mg),a=this.A?Da(this.A):{},this.Da?(this.Fa||(this.Fa='POST'),a['Content-Type']='application/x-www-form-urlencoded',this.h.send(this.pa,this.Fa,this.Da,a)):(this.Fa='GET',this.h.send(this.pa,this.Fa,null,a)),N(1),this.a.Tg(this.Fa,this.pa,this.R,this.Xc,this.Da)},e.mg=function(a){a=a.target;var b=this.ac;b&&3==a.ma()?(this.a.debug('Throttling readystatechange.'),b.mf()):this.Me(a)},e.Me=function(a){try{a==this.h?this.hg():this.a.T('Called back with an unexpected xmlhttp')}catch(c){if(this.a.debug('Failed call to OnXmlHttpReadyStateChanged_'),this.h&&this.h.ya()){var b=this;this.a.cb(c,function(){return'ResponseText: '+b.h.ya()})}else this.a.cb(c,'No response text')}finally{}},e.hg=function(){var a=this.h.ma(),b=this.h.Ud(),c=this.h.za();if(!(3>a)&&(3!=a||La||this.h.ya())){this.Za||4!=a||7==b||(8==b||0>=c?N(3):N(2)),this.Fb();var d=this.h.za();if(this.w=d,b=this.h.ya(),!b){var f=this;this.a.debug(function(){return'No response text for uri '+f.pa+' status '+d})}if(this.S=200==d,this.a.Ug(this.Fa,this.pa,this.R,this.Xc,a,d),this.S){if(this.Ig())if(c=this.sf())this.a.Wa(this.R,c,'Initial handshake response via X-HTTP-Initial-Response'),this.lb=!0,this.Yc(c);else return this.S=!1,this.I=3,O(12),this.a.T('XMLHTTP Missing X_HTTP_INITIAL_RESPONSE ('+this.R+')'),this.Ia(),void this.Kb();this.yc?(this.Fd(a,b),La&&this.S&&3==a&&this.Ng()):(this.a.Wa(this.R,b,null),this.Yc(b)),4==a&&this.Ia(),this.S&&!this.Za&&(4==a?this.b.Tc(this):(this.S=!1,this.eb()))}else 400==d&&0<b.indexOf('Unknown SID')?(this.I=3,O(12),this.a.T('XMLHTTP Unknown SID ('+this.R+')')):(this.I=0,O(13),this.a.T('XMLHTTP Bad status '+d+' ('+this.R+')')),this.Ia(),this.Kb()}},e.Ig=function(){return this.Ed&&!this.lb},e.sf=function(){if(this.h){var a=this.h.kb('X-HTTP-Initial-Response');if(a&&!va(a))return a}return null},e.Ag=function(){this.Ed=!0},e.Fd=function(a,b){for(var c=!0,d;!this.Za&&this.Bb<b.length;)if(d=this.vf(b),d==mc){4==a&&(this.I=4,O(14),c=!1),this.a.Wa(this.R,null,'[Incomplete Response]');break}else if(d==lc){this.I=4,O(15),this.a.Wa(this.R,b,'[Invalid Chunk]'),c=!1;break}else this.a.Wa(this.R,d,null),this.Yc(d);4==a&&0==b.length&&(this.I=1,O(16),c=!1),this.S=this.S&&c,c||(this.a.Wa(this.R,b,'[Invalid Chunked Response]'),this.Ia(),this.Kb())},e.kg=function(){if(this.h){var a=this.h.ma(),b=this.h.ya();this.Bb<b.length&&(this.Fb(),this.Fd(a,b),this.S&&4!=a&&this.eb())}},e.Ng=function(){this.Fc.nb(this.Vc,'tick',this.kg),this.Vc.start()},e.vf=function(a){var b=this.Bb,c=a.indexOf('\n',b);return-1==c?mc:(b=+a.substring(b,c),isNaN(b))?lc:(c+=1,c+b>a.length)?mc:(a=a.substr(c,b),this.Bb=c+b,a)},e.yg=function(a){this.ic=2,this.ua=a.clone().Ub(),a=!1,h.navigator&&h.navigator.sendBeacon&&(a=h.navigator.sendBeacon(this.ua.toString(),'')),!a&&h.Image&&(new Image().src=this.ua,a=!0),a||(this.h=this.b.Jb(null),this.h.send(this.ua)),this.qb=w(),this.eb()},e.cancel=function(){this.Za=!0,this.Ia()},e.tg=function(a){a&&this.setTimeout(a),this.Ga&&(this.Fb(),this.eb())},e.eb=function(){this.hd=w()+this.Ua,this.Ke(this.Ua)},e.Ke=function(a){if(null!=this.Ga)throw Error('WatchDog timer not null');this.Ga=P(u(this.gg,this),a)},e.Fb=function(){this.Ga&&(h.clearTimeout(this.Ga),this.Ga=null)},e.gg=function(){this.Ga=null;var a=w();0<=a-this.hd?this.Df():(this.a.T('WatchDog timer called too early'),this.Ke(this.hd-a))},e.Df=function(){this.S&&this.a.ca('Received watchdog timeout even though request loaded successfully'),this.a.Sg(this.pa),2!=this.ic&&(N(3),O(17)),this.Ia(),this.I=2,this.Kb()},e.Kb=function(){this.b.de()||this.Za||this.b.Tc(this)},e.Ia=function(){this.Fb();var a=this.ac;a&&'function'==typeof a.bb&&a.bb(),this.ac=null,this.Vc.stop(),this.Fc.pb(),this.h&&(a=this.h,this.h=null,a.abort(),a.bb())},e.Hc=function(){return this.I},e.Yc=function(a){try{this.b.ue(this,a),N(4)}catch(b){this.a.cb(b,'Error in httprequest callback')}},e=S.prototype,e.C=function(){return this.j},e.H=function(){this.wc();for(var a=[],b=0;b<this.o.length;b++)a.push(this.D[this.o[b]]);return a},e.W=function(){return this.wc(),this.o.concat()},e.va=function(a){return T(this.D,a)},e.X=function(){return 0==this.j},e.clear=function(){this.D={},this.j=this.o.length=0},e.remove=function(a){return!!T(this.D,a)&&(delete this.D[a],this.j--,this.o.length>2*this.j&&this.wc(),!0)},e.wc=function(){if(this.j!=this.o.length){for(var a=0,b=0,c;a<this.o.length;)c=this.o[a],T(this.D,c)&&(this.o[b++]=c),a++;this.o.length=b}if(this.j!=this.o.length){var d={};for(b=a=0;a<this.o.length;)c=this.o[a],T(d,c)||(this.o[b++]=c,d[c]=1),a++;this.o.length=b}},e.get=function(a,b){return T(this.D,a)?this.D[a]:b},e.set=function(a,b){T(this.D,a)||(this.j++,this.o.push(a)),this.D[a]=b},e.addAll=function(a){if(a instanceof S)for(var b=a.W(),c=0;c<b.length;c++)this.set(b[c],a.get(b[c]));else for(b in a)this.set(b,a[b])},e.forEach=function(a,b){for(var c=this.W(),d=0;d<c.length;d++){var f=c[d],g=this.get(f);a.call(b,g,f,this)}},e.clone=function(){return new S(this)};var pc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;e=U.prototype,e.toString=function(){var a=[],b=this.qa;b&&a.push(sc(b,tc,!0),':');var c=this.xa;return(c||'file'==b)&&(a.push('//'),(b=this.zb)&&a.push(sc(b,tc,!0),'@'),a.push(encodeURIComponent(c+'').replace(/%25([0-9a-fA-F]{2})/g,'%$1')),c=this.Ca,null!=c&&a.push(':',c+'')),(c=this.K)&&(this.Ic()&&'/'!=c.charAt(0)&&a.push('/'),a.push(sc(c,'/'==c.charAt(0)?uc:wc,!0))),(c=this.Rd())&&a.push('?',c),(c=this.ib)&&a.push('#',sc(c,xc)),a.join('')},e.resolve=function(a){var b=this.clone(),c=a.Hf();c?b.tb(a.qa):c=a.If(),c?b.cd(a.zb):c=a.Ic(),c?b.rb(a.xa):c=a.Ff();var d=a.K;if(c)b.sb(a.Ca);else if(c=a.ae()){if('/'!=d.charAt(0))if(this.Ic()&&!this.ae())d='/'+d;else{var f=b.K.lastIndexOf('/');-1!=f&&(d=b.K.substr(0,f+1)+d)}if(f=d,'..'==f||'.'==f)d='';else if(-1!=f.indexOf('./')||-1!=f.indexOf('/.')){d=0==f.lastIndexOf('/',0),f=f.split('/');for(var g=[],k=0,p;k<f.length;)p=f[k++],'.'==p?d&&k==f.length&&g.push(''):'..'==p?((1<g.length||1==g.length&&''!=g[0])&&g.pop(),d&&k==f.length&&g.push('')):(g.push(p),d=!0);d=g.join('/')}else d=f}return c?b.ec(d):c=a.Gf(),c?b.bd(a.P.clone()):c=a.Ef(),c&&b.$c(a.ib),b},e.clone=function(){return new U(this)},e.tb=function(a,b){this.U(),(this.qa=b?yc(a,!0):a)&&(this.qa=this.qa.replace(/:$/,''))},e.Hf=function(){return!!this.qa},e.cd=function(a,b){this.U(),this.zb=b?yc(a):a},e.If=function(){return!!this.zb},e.rb=function(a,b){this.U(),this.xa=b?yc(a,!0):a},e.Ic=function(){return!!this.xa},e.sb=function(a){if(this.U(),a){if(a=+a,isNaN(a)||0>a)throw Error('Bad port number '+a);this.Ca=a}else this.Ca=null},e.Ff=function(){return null!=this.Ca},e.ec=function(a,b){this.U(),this.K=b?yc(a,!0):a},e.ae=function(){return!!this.K},e.Gf=function(){return''!==this.P.toString()},e.bd=function(a,b){this.U(),a instanceof rc?(this.P=a,this.P.ad(this.O)):(b||(a=sc(a,zc)),this.P=new rc(a,this.O))},e.Rd=function(){return this.P.toString()},e.getQuery=function(){return this.Rd()},e.l=function(a,b){this.U(),this.P.set(a,b)},e.dc=function(a,b){this.U(),n(b)||(b=[b+'']),this.P.Ie(a,b)},e.$c=function(a,b){this.U(),this.ib=b?yc(a):a},e.Ef=function(){return!!this.ib},e.Ub=function(){return this.U(),this.l('zx',_Mathfloor2(2147483648*Math.random()).toString(36)+Math.abs(_Mathfloor2(2147483648*Math.random())^w()).toString(36)),this},e.removeParameter=function(a){return this.U(),this.P.remove(a),this},e.U=function(){if(this.Qf)throw Error('Tried to modify a read-only Uri')},e.ad=function(a){this.O=a,this.P&&this.P.ad(a)};var tc=/[#\/\?@]/g,wc=/[#\?:]/g,uc=/[#\?]/g,zc=/[#\?@]/g,xc=/#/g;e=rc.prototype,e.$=function(){if(!this.m&&(this.m=new S,this.j=0,this.ja)){var a=this;qc(this.ja,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g,' ')),c)})}},e.C=function(){return this.$(),this.j},e.add=function(a,b){this.$(),this.Oa(),a=this.Ma(a);var c=this.m.get(a);return c||this.m.set(a,c=[]),c.push(b),this.j+=1,this},e.remove=function(a){return this.$(),a=this.Ma(a),!!this.m.va(a)&&(this.Oa(),this.j-=this.m.get(a).length,this.m.remove(a))},e.clear=function(){this.Oa(),this.m=null,this.j=0},e.X=function(){return this.$(),0==this.j},e.va=function(a){return this.$(),a=this.Ma(a),this.m.va(a)},e.forEach=function(a,b){this.$(),this.m.forEach(function(c,d){na(c,function(c){a.call(b,c,d,this)},this)},this)},e.W=function(){this.$();for(var a=this.m.H(),b=this.m.W(),c=[],d=0;d<b.length;d++)for(var f=a[d],g=0;g<f.length;g++)c.push(b[d]);return c},e.H=function(a){this.$();var b=[];if(l(a))this.va(a)&&(b=ta(b,this.m.get(this.Ma(a))));else{a=this.m.H();for(var c=0;c<a.length;c++)b=ta(b,a[c])}return b},e.set=function(a,b){return this.$(),this.Oa(),a=this.Ma(a),this.va(a)&&(this.j-=this.m.get(a).length),this.m.set(a,[b]),this.j+=1,this},e.get=function(a,b){return a?(a=this.H(a),0<a.length?a[0]+'':b):b},e.Ie=function(a,b){this.remove(a),0<b.length&&(this.Oa(),this.m.set(this.Ma(a),ua(b)),this.j+=b.length)},e.toString=function(){if(this.ja)return this.ja;if(!this.m)return'';for(var a=[],b=this.m.W(),c=0;c<b.length;c++){var d=b[c],f=encodeURIComponent(d+'');d=this.H(d);for(var g=0,k;g<d.length;g++)k=f,''!==d[g]&&(k+='='+encodeURIComponent(d[g]+'')),a.push(k)}return this.ja=a.join('&')},e.Oa=function(){this.ja=null},e.clone=function(){var a=new rc;return a.ja=this.ja,this.m&&(a.m=this.m.clone(),a.j=this.j),a},e.Ma=function(a){return a+='',this.O&&(a=a.toLowerCase()),a},e.ad=function(a){a&&!this.O&&(this.$(),this.Oa(),this.m.forEach(function(a,c){var b=c.toLowerCase();c!=b&&(this.remove(c),this.Ie(b,a))},this)),this.O=a},e.extend=function(){for(var b=0;b<arguments.length;b++)oc(arguments[b],function(a,b){this.add(b,a)},this)},x(function Gc(){},function Fc(){}),e=Hc.prototype,e.g=null,e.ga=function(a){this.A=a},e.connect=function(a){this.K=a,a=this.b.Sd(this.K),O(3);var b=this.b.Ib.$d;null==b?(a.dc('MODE','init'),!this.b.ta&&this.b.aa&&a.dc('X-HTTP-Session-Id',this.b.aa),this.f=new R(this,this.a,void 0,void 0,void 0),this.f.ga(this.A),this.f.jd(a,!1,null),this.g=0):(this.na=this.b.$a(b[0]),this.g=1,this.xd())},e.xd=function(){this.a.debug('TestConnection: starting stage 2');var a=this.b.Ib.od;if(null!=a)this.a.debug(function(){return'Buffered'}),O(4),a?(O(10),this.b.ub(this,!1)):(O(11),this.b.ub(this,!0));else{this.f=new R(this,this.a,void 0,void 0,void 0),this.f.ga(this.A);var b=this.b.Pd(this.na,this.K);O(4),b.dc('TYPE','xmlhttp');var c=this.b.aa,d=this.b.Kc;c&&d&&b.l(c,d),this.f.jd(b,!1,this.na)}},e.Jb=function(a){return this.b.Jb(a)},e.abort=function(){this.f&&(this.f.cancel(),this.f=null),this.w=-1},e.de=function(){return!1},e.ue=function(a,b){if(this.w=a.w,0!=this.g)1==this.g&&(this.bc?O(6):'11111'==b?(O(5),this.bc=!0,this.Ze()&&(this.w=200,this.f.cancel(),this.a.debug('Test connection succeeded; using streaming connection'),O(11),this.b.ub(this,!0))):(O(7),this.bc=!1));else if(this.a.debug('TestConnection: Got data for stage 1'),this.pc(a),b){try{var c=this.b.kc.zc(b)}catch(d){return this.a.cb(d),void this.b.dd(this)}this.na=this.b.$a(c[0])}else this.a.debug('TestConnection: Null responseText'),this.b.dd(this)},e.Tc=function(){this.w=this.f.w,this.f.S?0==this.g?(this.g=1,this.a.debug('TestConnection: request complete for initial check'),this.xd()):1==this.g&&(this.a.debug('TestConnection: request complete for stage 2'),this.bc?(this.a.debug('Test connection succeeded; using streaming connection'),O(11),this.b.ub(this,!0)):(this.a.debug('Test connection failed; not using streaming'),O(10),this.b.ub(this,!1))):(this.a.debug('TestConnection: request failed, in state '+this.g),0==this.g?O(8):1==this.g&&O(9),this.b.dd(this))},e.pc=function(a){if(!this.b.ta&&(a=a.h)){var b=a.kb('X-Client-Wire-Protocol');this.Ad=b?b:null,this.b.aa&&((a=a.kb('X-HTTP-Session-Id'))?this.b.Fe(a):this.a.T('Missing X_HTTP_SESSION_ID in the handshake response'))}},e.fc=function(){return this.b.fc()},e.Ba=function(){return this.b.Ba()},e.Ze=function(){return!C||10<=+Ua},e=Jc.prototype,e.C=function(){return this.D.C()},e.add=function(a){this.D.set(Kc(a),a)},e.addAll=function(a){a=nc(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])},e.pb=function(a){a=nc(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])},e.remove=function(a){return this.D.remove(Kc(a))},e.clear=function(){this.D.clear()},e.X=function(){return this.D.X()},e.contains=function(a){return this.D.va(Kc(a))},e.H=function(){return this.D.H()},e.clone=function(){return new Jc(this)};var Nc=10;e=Mc.prototype,e.ld=function(a){this.v||-1==a.indexOf('spdy')&&-1==a.indexOf('quic')&&-1==a.indexOf('h2')||(this.Xb=this.me,this.v=new Jc,this.f&&(this.oc(this.f),this.f=null))},e.ee=function(){return!!this.f||!!this.v&&this.v.C()>=this.Xb},e.xf=function(){return this.f?1:this.v?this.v.C():0},e.Jc=function(a){return this.f?this.f==a:!!this.v&&this.v.contains(a)},e.oc=function(a){this.v?this.v.add(a):this.f=a},e.ze=function(a){this.f&&this.f==a?this.f=null:this.v&&this.v.contains(a)&&this.v.remove(a)},e.cancel=function(){this.ba=this.la(),this.f?(this.f.cancel(),this.f=null):this.v&&!this.v.X()&&(na(this.v.H(),function(a){a.cancel()}),this.v.clear())},e.la=function(){if(null!=this.f)return this.ba.concat(this.f.la());if(null!=this.v&&!this.v.X()){var a=this.ba;return na(this.v.H(),function(b){a=a.concat(b.la())}),a}return ua(this.ba)},e.Re=function(a){this.ba=this.ba.concat(a)},e.$e=function(){this.ba.length=0},Oc.prototype.stringify=function(a){return h.JSON.stringify(a,this.rg)},Oc.prototype.parse=function(a){return h.JSON.parse(a,this.xg)},Pc.prototype.hf=function(a,b,c){var d=c||'';try{oc(a,function(a,c){var f=a;r(a)&&(f=ub(a)),b.push(d+c+'='+encodeURIComponent(f))})}catch(f){throw b.push(d+'type='+encodeURIComponent('_badmap')),f}},Pc.prototype.jf=function(a,b,c){for(var d=-1,f;;){f=['count='+b],-1==d?0<b?(d=a[0].Pc,f.push('ofs='+d)):d=0:f.push('ofs='+d);for(var g=!0,k=0;k<b;k++){var p=a[k].Pc,Ub=a[k].map;if(p-=d,0>p)d=_Mathmax2(0,a[k].Pc-100),g=!1;else try{this.hf(Ub,f,'req'+p+'_')}catch(md){c&&c(Ub)}}if(g)return f.join('&')}},Pc.prototype.zc=function(a){return this.jg.parse(a)};var Sc=h.JSON.parse;x(V,H);var Tc='';V.prototype.s=Vb('goog.net.XhrIo');var Uc=/^https?$/i,Vc=['POST','PUT'];e=V.prototype,e.Je=function(a){this.Ab=a},e.send=function(a,b,c,d){if(this.c)throw Error('[goog.net.XhrIo] Object is active with another request='+this.Tb+'; newUri='+a);b=b?b.toUpperCase():'GET',this.Tb=a,this.I='',this.Pa=0,this.ge=b,this.Ec=!1,this.ha=!0,this.c=this.df(),this.mc=this.Xa?this.Xa.Vd():hc.Vd(),this.c.onreadystatechange=u(this.te,this),this.lg&&'onprogress'in this.c&&(this.c.onprogress=u(function(a){this.re(a,!0)},this),this.c.upload&&(this.c.upload.onprogress=u(this.re,this)));try{L(this.s,this.da('Opening Xhr')),this.Lc=!0,this.c.open(b,a+'',!0),this.Lc=!1}catch(g){return L(this.s,this.da('Error opening Xhr: '+g.message)),void this.Ld(g)}a=c||'';var f=this.headers.clone();d&&oc(d,function(a,b){f.set(b,a)}),d=pa(f.W()),c=h.FormData&&a instanceof h.FormData,!(0<=la(Vc,b))||d||c||f.set('Content-Type','application/x-www-form-urlencoded;charset=utf-8'),f.forEach(function(a,b){this.c.setRequestHeader(b,a)},this),this.Ae&&(this.c.responseType=this.Ae),'withCredentials'in this.c&&this.c.withCredentials!==this.Ab&&(this.c.withCredentials=this.Ab);try{this.yd(),0<this.vb&&(this.jc=Wc(this.c),L(this.s,this.da('Will abort after '+this.vb+'ms if incomplete, xhr2 '+this.jc)),this.jc?(this.c.timeout=this.vb,this.c.ontimeout=u(this.Ua,this)):this.hc=Hb(this.Ua,this.vb,this)),L(this.s,this.da('Sending request')),this.Qb=!0,this.c.send(a),this.Qb=!1}catch(g){L(this.s,this.da('Send error: '+g.message)),this.Ld(g)}},e.df=function(){return this.Xa?this.Xa.Dd():hc.Dd()},e.Ua=function(){'undefined'!=typeof goog&&this.c&&(this.I='Timed out after '+this.vb+'ms, aborting',this.Pa=8,L(this.s,this.da(this.I)),this.dispatchEvent('timeout'),this.abort(8))},e.Ld=function(a){this.ha=!1,this.c&&(this.Aa=!0,this.c.abort(),this.Aa=!1),this.I=a,this.Pa=5,this.Jd(),this.Gb()},e.Jd=function(){this.Ec||(this.Ec=!0,this.dispatchEvent('complete'),this.dispatchEvent('error'))},e.abort=function(a){this.c&&this.ha&&(L(this.s,this.da('Aborting')),this.ha=!1,this.Aa=!0,this.c.abort(),this.Aa=!1,this.Pa=a||7,this.dispatchEvent('complete'),this.dispatchEvent('abort'),this.Gb())},e.F=function(){this.c&&(this.ha&&(this.ha=!1,this.Aa=!0,this.c.abort(),this.Aa=!1),this.Gb(!0)),V.L.F.call(this)},e.te=function(){this.Ka||(this.Lc||this.Qb||this.Aa?this.se():this.eg())},e.eg=function(){this.se()},e.se=function(){if(this.ha&&'undefined'!=typeof goog)if(this.mc[1]&&4==this.ma()&&2==this.za())L(this.s,this.da('Local request error detected and ignored'));else if(this.Qb&&4==this.ma())Hb(this.te,0,this);else if(this.dispatchEvent('readystatechange'),this.Mc()){L(this.s,this.da('Request complete')),this.ha=!1;try{this.Rf()?(this.dispatchEvent('complete'),this.dispatchEvent('success')):(this.Pa=6,this.I=this.Yd()+' ['+this.za()+']',this.Jd())}finally{this.Gb()}}},e.re=function(a,b){this.dispatchEvent(Xc(a,'progress')),this.dispatchEvent(Xc(a,b?'downloadprogress':'uploadprogress'))},e.Gb=function(a){if(this.c){this.yd();var b=this.c,c=this.mc[0]?aa:null;this.mc=this.c=null,a||this.dispatchEvent('ready');try{b.onreadystatechange=c}catch(d){(a=this.s)&&a.ca('Problem encountered resetting onreadystatechange: '+d.message,void 0)}}},e.yd=function(){this.c&&this.jc&&(this.c.ontimeout=null),this.hc&&(h.clearTimeout(this.hc),this.hc=null)},e.Ba=function(){return!!this.c},e.Mc=function(){return 4==this.ma()},e.Rf=function(){var a=this.za();a:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break a;default:b=!1;}return b||0===a&&!this.Of()},e.Of=function(){var a=(this.Tb+'').match(pc)[1]||null;return!a&&h.self&&h.self.location&&(a=h.self.location.protocol,a=a.substr(0,a.length-1)),Uc.test(a?a.toLowerCase():'')},e.ma=function(){return this.c?this.c.readyState:0},e.za=function(){try{return 2<this.ma()?this.c.status:-1}catch(a){return-1}},e.Yd=function(){try{return 2<this.ma()?this.c.statusText:''}catch(a){return L(this.s,'Can not get status: '+a.message),''}},e.ya=function(){try{return this.c?this.c.responseText:''}catch(a){return L(this.s,'Can not get responseText: '+a.message),''}},e.yf=function(a){if(this.c){var b=this.c.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),Sc(b)}},e.getResponseHeader=function(a){if(this.c&&this.Mc())return a=this.c.getResponseHeader(a),null===a?void 0:a},e.getAllResponseHeaders=function(){return this.c&&this.Mc()?this.c.getAllResponseHeaders()||'':''},e.kb=function(a){return this.c?this.c.getResponseHeader(a):null},e.Ud=function(){return this.Pa},e.Hc=function(){return l(this.I)?this.I:this.I+''},e.da=function(a){return a+' ['+this.ge+' '+this.Tb+' '+this.za()+']'},e=$c.prototype,e.tc=8,e.g=1,e.connect=function(a,b,c,d,f){this.a.debug('connect()'),O(0),this.K=b,this.gb=c||{},d&&void 0!==f&&(this.gb.OSID=d,this.gb.OAID=f),this.ta&&(this.a.debug('connect() bypassed channel-test.'),this.Ib.$d=[],this.Ib.od=!1),this.bf(a)},e.disconnect=function(){if(this.a.debug('disconnect()'),this.qd(),3==this.g){var a=this.Yb++,b=this.hb.clone();b.l('SID',this.ra),b.l('RID',a),b.l('TYPE','terminate'),this.Ya(b),new R(this,this.a,this.ra,a,void 0).yg(b)}this.qe()},e.bf=function(a){this.a.debug('connectTest_()'),this.Ja=new Hc(this,this.a),null===this.N&&this.Ja.ga(this.A);var b=a;this.N&&this.A&&(b=Zc(a,this.N,this.A)),this.Ja.connect(b)},e.af=function(){this.a.debug('connectChannel_()'),this.hb=this.Sd(this.K),this.Dc()},e.qd=function(){this.Ja&&(this.Ja.abort(),this.Ja=null),this.u&&(this.u.cancel(),this.u=null),this.ia&&(h.clearTimeout(this.ia),this.ia=null),this.Hb(),this.G.cancel(),this.ea&&(h.clearTimeout(this.ea),this.ea=null)},e.ga=function(a){this.A=a},e.Eg=function(a){this.Rb=a},e.Cg=function(a){this.N=a},e.Dg=function(a){this.aa=a},e.Fe=function(a){this.Kc=a},e.He=function(a){this.Ra=a},e.Hg=function(){this.gc=!0},e.Ee=function(a){this.i=a},e.Nf=function(){return!this.fd},e.Zc=function(a){1E3==this.M.length&&this.a.ca(function(){return'Already have 1000 queued maps upon queueing '+ub(a)}),this.M.push(new Lc(this.ag++,a)),3==this.g&&this.Dc()},e.qf=function(){return this.kf?0:this.nf},e.de=function(){return 0==this.g},e.getState=function(){return this.g},e.Dc=function(){this.G.ee()||this.ea||(this.ea=P(u(this.we,this),0),this.La=0)},e.Yf=function(a){return this.G.xf()>=this.G.Xb-(this.ea?1:0)?(this.a.ca('Unexpected retry request is scheduled.'),!1):this.ea?(this.a.debug('Use the retry request that is already scheduled.'),this.M=a.la().concat(this.M),!0):1==this.g||2==this.g||this.La>=this.qf()?!1:(this.a.debug('Going to retry POST'),this.ea=P(u(this.we,this,a),this.Xd(this.La)),this.La++,!0)},e.we=function(a){this.ea=null,this.Mg(a)},e.Mg=function(a){this.a.debug('startForwardChannel_'),1==this.g?a?this.a.ca('Not supposed to retry the open'):(this.ig(),this.g=2):3==this.g&&(a?this.le(a):0==this.M.length?this.a.debug('startForwardChannel_ returned: nothing to send'):this.G.ee()?this.a.ca('startForwardChannel_ returned: connection already in progress'):(this.le(),this.a.debug('startForwardChannel_ finished, sent request')))},e.ig=function(){this.a.debug('open_()'),this.Yb=_Mathfloor2(1E5*Math.random());var a=this.Yb++,b=new R(this,this.a,'',a,void 0),c=this.A;this.Rb&&(c?(c=Da(c),Fa(c,this.Rb)):c=this.Rb),null===this.N&&b.ga(c);var d=this.Hd(b),f=this.hb.clone();f.l('RID',a),0<this.Bd&&f.l('CVER',this.Bd),this.ta&&this.aa&&f.l('X-HTTP-Session-Id',this.aa),this.Ya(f),this.N&&c&&Zc(f,this.N,c),this.G.oc(b),this.Nd?(f.l('$req',d),f.l('SID','null'),b.Ag(),b.kd(f,null)):b.kd(f,d)},e.le=function(a){var b=a?a.R:this.Yb++,c=this.hb.clone();c.l('SID',this.ra),c.l('RID',b),c.l('AID',this.Sb),this.Ya(c),this.N&&this.A&&Zc(c,this.N,this.A),b=new R(this,this.a,this.ra,b,this.La+1),null===this.N&&b.ga(this.A),a&&this.sg(a),a=this.Hd(b),b.setTimeout(_Mathround(.5*this.Od)+_Mathround(.5*this.Od*Math.random())),this.G.oc(b),b.kd(c,a)},e.Ya=function(a){this.i&&oc({},function(b,c){a.l(c,b)})},e.Hd=function(a){var b=Math.min(this.M.length,1E3),c=this.i?u(this.i.Ue,this.i,this):null;return c=this.kc.jf(this.M,b,c),a.Gg(this.M.splice(0,b)),c},e.sg=function(a){this.M=a.la().concat(this.M)},e.Kd=function(){if(!this.u&&!this.ia){this.rc=1;var a=this.ve;Bb||Cb(),Eb||(Bb(),Eb=!0),Fb.add(a,this),this.Ha=0}},e.Qc=function(){return this.u||this.ia?(this.a.ca('Request already in progress'),!1):!(3<=this.Ha)&&(this.a.debug('Going to retry GET'),this.rc++,this.ia=P(u(this.ve,this),this.Xd(this.Ha)),this.Ha++,!0)},e.ve=function(){this.ia=null,this.Kg()},e.Kg=function(){this.a.debug('Creating new HttpRequest'),this.u=new R(this,this.a,this.ra,'rpc',this.rc),null===this.N&&this.u.ga(this.A),this.u.He(this.Ra);var a=this.md.clone();a.l('RID','rpc'),a.l('SID',this.ra),a.l('CI',this.fd?'0':'1'),a.l('AID',this.Sb),this.Ya(a),a.l('TYPE','xmlhttp'),this.N&&this.A&&Zc(a,this.N,this.A),this.Db&&this.u.setTimeout(this.Db),this.u.jd(a,!0,this.na),this.a.debug('New Request created')},e.ub=function(a,b){this.a.debug('Test Connection Finished');var c=a.Ad;c&&this.G.ld(c),this.fd=this.Se&&b,this.w=a.w,this.af()},e.dd=function(a){this.a.debug('Test Connection Failed'),this.w=a.w,this.sa(2)},e.ue=function(a,b){if(0!=this.g&&(this.u==a||this.G.Jc(a)))if(this.w=a.w,!a.lb&&this.G.Jc(a)&&3==this.g){try{var c=this.kc.zc(b)}catch(d){c=null}n(c)&&3==c.length?this.Cf(c,a):(this.a.debug('Bad POST response data returned'),this.sa(11))}else(a.lb||this.u==a)&&this.Hb(),va(b)||(c=this.kc.zc(b),this.dg(c,a))},e.Cf=function(a,b){0==a[0]?this.Bf(b):(this.he=a[1],b=this.he-this.Sb,0<b&&(a=a[2],this.a.debug(a+' bytes (in '+b+' arrays) are outstanding on the BackChannel'),this.Jg(a)&&!this.wa&&(this.wa=P(u(this.bg,this),6E3))))},e.Bf=function(a){if(this.a.debug('Server claims our backchannel is missing.'),this.ia)this.a.debug('But we are currently starting the request.');else{if(!this.u)this.a.T('We do not have a BackChannel established');else if(this.u.qb+3E3<a.qb)this.Hb(),this.u.cancel(),this.u=null;else return;this.Qc(),O(18)}},e.Jg=function(a){return 37500>a&&!this.Nf()&&0==this.Ha},e.$a=function(a){return this.Te?this.i?this.i.$a(a):a:null},e.bg=function(){null!=this.wa&&(this.wa=null,this.u.cancel(),this.u=null,this.Qc(),O(19))},e.Hb=function(){null!=this.wa&&(h.clearTimeout(this.wa),this.wa=null)},e.Tc=function(a){this.a.debug('Request complete');var b=null;if(this.u==a){this.Hb(),this.u=null;var c=2}else if(this.G.Jc(a))b=a.la(),this.G.ze(a),c=1;else return;if(this.w=a.w,0!=this.g)if(a.S)1==c?(ac(a.Da?a.Da.length:0,w()-a.qb,this.La),this.Dc()):this.Kd();else{var d=a.Hc();if(3==d||0==d&&0<this.w)this.a.debug('Not retrying due to error type');else{var f=this;if(this.a.debug(function(){return'Maybe retrying, last error: '+kc(d,f.w)}),1==c&&this.Yf(a)||2==c&&this.Qc())return;this.a.debug('Exceeded max number of retries')}b&&0<b.length&&this.G.Re(b),this.a.debug('Error: HTTP request failed'),1===d?this.sa(5):4===d?this.sa(10):3===d?this.sa(6):this.sa(2)}},e.Xd=function(a){var b=this.Ve+_Mathfloor2(Math.random()*this.vg);return this.Ba()||(this.a.debug('Inactive channel'),b*=2),b*a},e.pc=function(a){if(this.ta&&(a=a.h)){var b=a.kb('X-Client-Wire-Protocol');b&&this.G.ld(b),this.aa&&((a=a.kb('X-HTTP-Session-Id'))?(this.Fe(a),this.hb.l(this.aa,a)):this.a.T('Missing X_HTTP_SESSION_ID in the handshake response'))}},e.dg=function(a,b){for(var c=this.i&&this.i.sc?[]:null,d=0,f;d<a.length;d++)if(f=a[d],this.Sb=f[0],f=f[1],2!=this.g)3==this.g&&('stop'==f[0]||'close'==f[0]?(c&&0!=c.length&&(this.i.sc(this,c),c.length=0),'stop'==f[0]?this.sa(7):this.disconnect()):'noop'!=f[0]&&(c?c.push(f):this.i&&this.i.ud(f)),this.Ha=0);else if('c'==f[0]){this.ra=f[1],this.na=this.$a(f[2]);var g=f[3];null!=g&&(this.tc=g,this.a.info('VER='+this.tc)),g=f[4],null!=g&&(this.De=g,this.a.info('SVER='+this.De)),f=f[5],null!=f&&'number'==typeof f&&0<f&&(this.Db=f*=1.5,this.a.info('backChannelRequestTimeoutMs_='+f)),this.pc(b),this.g=3,this.i&&this.i.wd(),this.Lg(b)}else'stop'!=f[0]&&'close'!=f[0]||this.sa(7);c&&0!=c.length&&this.i.sc(this,c)},e.Lg=function(a){this.md=this.Pd(this.na,this.K),a.lb?(this.a.debug('Upgrade the handshake request to a backchannel.'),this.G.ze(a),a.tg(this.Db),this.u=a):this.Kd()},e.sa=function(a){if(this.a.info('Error code '+a),2==a){var b=null;this.i&&(b=null);var c=u(this.Pg,this);b||(b=new U('//www.google.com/images/cleardot.gif'),h.location&&'http'==h.location.protocol||b.tb('https'),b.Ub()),Qc(b.toString(),c)}else O(2);this.cg(a)},e.Pg=function(a){a?(this.a.info('Successfully pinged google.com'),O(2)):(this.a.info('Failed to ping google.com'),O(1))},e.cg=function(a){this.a.debug('HttpChannel: error - '+a),this.g=0,this.i&&this.i.td(a),this.qe(),this.qd()},e.qe=function(){if(this.g=0,this.w=-1,this.i){var a=this.G.la();if(0!=a.length||0!=this.M.length){var b=this;this.a.debug(function(){return'Number of undelivered maps, pending: '+a.length+', outgoing: '+b.M.length}),this.G.$e(),ua(this.M),this.M.length=0}this.i.sd()}},e.Sd=function(a){return a=this.Cd(null,a),this.a.debug('GetForwardChannelUri: '+a),a},e.Pd=function(a,b){return a=this.Cd(this.fc()?a:null,b),this.a.debug('GetBackChannelUri: '+a),a},e.Cd=function(a,b){var c=Ac(b);if(''!=c.xa)a&&c.rb(a+'.'+c.xa),c.sb(c.Ca);else{var d=h.location;c=Bc(d.protocol,a?a+'.'+d.hostname:d.hostname,+d.port,b)}return this.gb&&Aa(this.gb,function(a,b){c.l(b,a)}),a=this.aa,b=this.Kc,a&&b&&c.l(a,b),c.l('VER',this.tc),this.Ya(c),c},e.Jb=function(a){if(a&&!this.gc)throw Error('Can\'t create secondary domain capable XhrIo object.');return a=new V(this.Xa),a.Je(this.gc),a},e.Ba=function(){return!!this.i&&this.i.Ba()},e.fc=function(){return this.gc},e=ad.prototype,e.sc=null,e.wd=function(){},e.ud=function(){},e.td=function(){},e.sd=function(){},e.Ba=function(){return!0},e.Ue=function(){},e.$a=function(a){return a},cd.prototype.cf=function(a,b){return new W(a,b)},x(W,H),e=W.prototype,e.addEventListener=function(a,b,c,d){W.L.addEventListener.call(this,a,b,c,d)},e.removeEventListener=function(a,b,c,d){W.L.removeEventListener.call(this,a,b,c,d)},e.open=function(){this.b.Ee(this.vd),this.Og&&this.b.Hg(),this.b.connect(this.Qg,this.yb,this.Rc||void 0)},e.close=function(){this.b.disconnect()},e.send=function(a){if(l(a)){var b={};b.__data__=a,this.b.Zc(b)}else this.zg?(b={},b.__data__=ub(a),this.b.Zc(b)):this.b.Zc(a)},e.F=function(){this.b.Ee(null),delete this.vd,this.b.disconnect(),delete this.b,W.L.F.call(this)},x(dd,fc),x(ed,gc),x(X,ad),X.prototype.wd=function(){Wb(this.b.s,'WebChannel opened on '+this.b.yb),this.b.dispatchEvent('a')},X.prototype.ud=function(a){this.b.dispatchEvent(new dd(a))},X.prototype.td=function(a){Wb(this.b.s,'WebChannel aborted on '+this.b.yb+' due to channel error: '+a),this.b.dispatchEvent(new ed(a))},X.prototype.sd=function(){Wb(this.b.s,'WebChannel closed on '+this.b.yb),this.b.dispatchEvent('b')};var fd=v(function(a){function c(){}c.prototype=a.prototype;var d=new c;return a.apply(d,Array.prototype.slice.call(arguments,1)),d},cd);e=gd.prototype,e.Vf=function(){0==this.V.length&&(this.V=this.Z,this.V.reverse(),this.Z=[])},e.enqueue=function(a){this.Z.push(a)},e.ab=function(){return this.Vf(),this.V.pop()},e.C=function(){return this.V.length+this.Z.length},e.X=function(){return 0==this.V.length&&0==this.Z.length},e.clear=function(){this.V=[],this.Z=[]},e.contains=function(a){return 0<=la(this.V,a)||0<=la(this.Z,a)},e.remove=function(a){var b=this.V,c=ma(b,a);return 0<=c?(Array.prototype.splice.call(b,c,1),b=!0):b=!1,b||sa(this.Z,a)},e.H=function(){for(var a=[],b=this.V.length-1;0<=b;--b)a.push(this.V[b]);var c=this.Z.length;for(b=0;b<c;++b)a.push(this.Z[b]);return a},x(hd,z);var id='[goog.structs.Pool] Min can not be greater than max';e=hd.prototype,e.Mb=function(){var a=w();if(!(null!=this.Nc&&a-this.Nc<this.Ac)){var b=this.qg();return b&&(this.Nc=a,this.oa.add(b)),b}},e.og=function(a){return!!this.oa.remove(a)&&(this.nc(a),!0)},e.qg=function(){for(var a;0<this.Td()&&(a=this.fa.ab(),!this.Sc(a));)this.Cb();return!a&&this.C()<this.Wb&&(a=this.xc()),a},e.nc=function(a){this.oa.remove(a),this.Sc(a)&&this.C()<this.Wb?this.fa.enqueue(a):this.Bc(a)},e.Cb=function(){for(var a=this.fa;this.C()<this.oe;)a.enqueue(this.xc());for(;this.C()>this.Wb&&0<this.Td();)this.Bc(a.ab())},e.xc=function(){return{}},e.Bc=function(a){if('function'==typeof a.bb)a.bb();else for(var b in a)a[b]=null},e.Sc=function(a){return'function'!=typeof a.Ye||a.Ye()},e.contains=function(a){return this.fa.contains(a)||this.oa.contains(a)},e.C=function(){return this.fa.C()+this.oa.C()},e.rf=function(){return this.oa.C()},e.Td=function(){return this.fa.C()},e.X=function(){return this.fa.X()&&this.oa.X()},e.F=function(){if(hd.L.F.call(this),0<this.rf())throw Error('[goog.structs.Pool] Objects not released');delete this.oa;for(var a=this.fa;!a.X();)this.Bc(a.ab());delete this.fa},jd.prototype.getKey=function(){return this.fe},jd.prototype.clone=function(){return new jd(this.fe,this.gd)},e=kd.prototype,e.ce=function(a,b){var c=this.Y;c.push(new jd(a,b)),this.$f(c.length-1)},e.Lf=function(a){if(a instanceof kd){var b=a.W();if(a=a.H(),0>=this.C()){for(var c=this.Y,d=0;d<b.length;d++)c.push(new jd(b[d],a[d]));return}}else b=Ca(a),a=Ba(a);for(d=0;d<b.length;d++)this.ce(b[d],a[d])},e.remove=function(){var a=this.Y,b=a.length,c=a[0];if(!(0>=b))return 1==b?ra(a):(a[0]=a.pop(),this.Zf()),c.gd},e.Zf=function(){for(var a=0,b=this.Y,c=b.length,d=b[a];a<c>>1;){var f=this.tf(a),g=this.zf(a);if(f=g<c&&b[g].getKey()<b[f].getKey()?g:f,b[f].getKey()>d.getKey())break;b[a]=b[f],a=f}b[a]=d},e.$f=function(a){for(var b=this.Y,c=b[a],d;0<a&&(d=this.wf(a),b[d].getKey()>c.getKey());)b[a]=b[d],a=d;b[a]=c},e.tf=function(a){return 2*a+1},e.zf=function(a){return 2*a+2},e.wf=function(a){return a-1>>1},e.H=function(){for(var a=this.Y,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].gd);return b},e.W=function(){for(var a=this.Y,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].getKey());return b},e.va=function(a){return oa(this.Y,function(b){return b.getKey()==a})},e.clone=function(){return new kd(this)},e.C=function(){return this.Y.length},e.X=function(){return 0==this.Y.length},e.clear=function(){ra(this.Y)},x(ld,kd),ld.prototype.enqueue=function(a,b){this.ce(a,b)},ld.prototype.ab=function(){return this.remove()},x(Y,hd),e=Y.prototype,e.Mb=function(a,b){return a?void(this.cc.enqueue(void 0===b?100:b,a),this.Nb()):((a=Y.L.Mb.call(this))&&this.Ac&&(this.Gd=h.setTimeout(u(this.Nb,this),this.Ac)),a)},e.Nb=function(){for(var a=this.cc,b;0<a.C()&&(b=this.Mb(),b);)a.ab().apply(this,[b])},e.nc=function(a){Y.L.nc.call(this,a),this.Nb()},e.Cb=function(){Y.L.Cb.call(this),this.Nb()},e.F=function(){Y.L.F.call(this),h.clearTimeout(this.Gd),this.cc.clear(),this.cc=null},x(Z,Y),Z.prototype.xc=function(){var a=new V,b=this.Jf;return b&&b.forEach(function(b,d){a.headers.set(d,b)}),this.Ab&&a.Je(!0),a},Z.prototype.Sc=function(a){return!a.Ka&&!a.Ba()},cd.prototype.createWebChannel=cd.prototype.cf,W.prototype.send=W.prototype.send,W.prototype.open=W.prototype.open,W.prototype.close=W.prototype.close,bc.NO_ERROR=0,bc.TIMEOUT=8,bc.HTTP_ERROR=6,cc.COMPLETE='complete',ec.EventType=Q,Q.OPEN='a',Q.CLOSE='b',Q.ERROR='c',Q.MESSAGE='d',H.prototype.listen=H.prototype.nb,Z.prototype.getObject=Z.prototype.Mb,Z.prototype.releaseObject=Z.prototype.og,V.prototype.listenOnce=V.prototype.Oc,V.prototype.getLastError=V.prototype.Hc,V.prototype.getLastErrorCode=V.prototype.Ud,V.prototype.getStatus=V.prototype.za,V.prototype.getStatusText=V.prototype.Yd,V.prototype.getResponseJson=V.prototype.yf,V.prototype.getResponseText=V.prototype.ya,V.prototype.getResponseText=V.prototype.ya,V.prototype.send=V.prototype.send;var src={createWebChannelTransport:fd,ErrorCode:bc,EventType:cc,WebChannel:ec,XhrIoPool:Z},src_1=src.createWebChannelTransport,src_2=src.ErrorCode,src_3=src.EventType,src_4=src.WebChannel,src_5=src.XhrIoPool;__webpack_exports__['default']=src}).call(__webpack_exports__,__webpack_require__(0))},function(module,exports,__webpack_require__){function BindToEventDecorator(_event,_target,_listenIn,_removeIn){return function(propertyName,func){const scope=this,event=_event||propertyName,target=_target?document.querySelector(_target):this.el;if(!target)return void console.warn('Couldn\'t subscribe '+this.name+'.'+propertyName+' to '+event+' on '+_target+' because querySelector returned undefined.');const listenIn=_listenIn||'init',removeIn=_removeIn||'remove',listenFunc=this[listenIn],removeFunc=this[removeIn],boundFunc=func.bind(this);return this[listenIn]=function(){void 0!==listenFunc&&listenFunc.apply(scope,arguments),target.addEventListener(event,boundFunc)},this[removeIn]=function(){void 0!==removeFunc&&removeFunc.apply(scope,arguments),target.removeEventListener(event,boundFunc)},func}}const decorate=__webpack_require__(14).decorate;module.exports.bindEvent=function bindEvent(p1,p2){if('function'==typeof p1)return decorate(p1,BindToEventDecorator());if('object'==typeof p1&&'function'==typeof p2)return decorate(p2,BindToEventDecorator(p1.event,p1.target,p1.listenIn,p1.removeIn));throw new Error('bindEvent must take: (function), or a ([object], function)')},module.exports.bindEventPlayPause=function bindEventPlayPause(p1,p2){if('function'==typeof p1)return decorate(p1,BindToEventDecorator(void 0,void 0,'play','pause'));if('object'==typeof p1&&'function'==typeof p2)return decorate(p2,BindToEventDecorator(p1.event,p1.target,'play','pause'));throw new Error('bindEventPlayPause must take: (function), or a ([object], function)')}},function(){THREE.BufferGeometryUtils={computeTangents:function(geometry){function handleTriangle(a,b,c){vA.fromArray(positions,3*a),vB.fromArray(positions,3*b),vC.fromArray(positions,3*c),uvA.fromArray(uvs,2*a),uvB.fromArray(uvs,2*b),uvC.fromArray(uvs,2*c);var x1=vB.x-vA.x,x2=vC.x-vA.x,y1=vB.y-vA.y,y2=vC.y-vA.y,z1=vB.z-vA.z,z2=vC.z-vA.z,s1=uvB.x-uvA.x,s2=uvC.x-uvA.x,t1=uvB.y-uvA.y,t2=uvC.y-uvA.y,r=1/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r),tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r),tan1[a].add(sdir),tan1[b].add(sdir),tan1[c].add(sdir),tan2[a].add(tdir),tan2[b].add(tdir),tan2[c].add(tdir)}function handleVertex(v){n.fromArray(normals,3*v),n2.copy(n),t=tan1[v],tmp.copy(t),tmp.sub(n.multiplyScalar(n.dot(t))).normalize(),tmp2.crossVectors(n2,t),test=tmp2.dot(tan2[v]),w=0>test?-1:1,tangents[4*v]=tmp.x,tangents[4*v+1]=tmp.y,tangents[4*v+2]=tmp.z,tangents[4*v+3]=w}var index=geometry.index,attributes=geometry.attributes;if(null===index||void 0===attributes.position||void 0===attributes.normal||void 0===attributes.uv)return void console.warn('THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()');var indices=index.array,positions=attributes.position.array,normals=attributes.normal.array,uvs=attributes.uv.array,nVertices=positions.length/3;attributes.tangent===void 0&&geometry.addAttribute('tangent',new THREE.BufferAttribute(new Float32Array(4*nVertices),4));for(var tangents=attributes.tangent.array,tan1=[],tan2=[],i=0;i<nVertices;i++)tan1[i]=new THREE.Vector3,tan2[i]=new THREE.Vector3;var vA=new THREE.Vector3,vB=new THREE.Vector3,vC=new THREE.Vector3,uvA=new THREE.Vector2,uvB=new THREE.Vector2,uvC=new THREE.Vector2,sdir=new THREE.Vector3,tdir=new THREE.Vector3,groups=geometry.groups;0===groups.length&&(groups=[{start:0,count:indices.length}]);for(var i=0,il=groups.length;i<il;++i)for(var group=groups[i],start=group.start,count=group.count,j=start,jl=start+count;j<jl;j+=3)handleTriangle(indices[j+0],indices[j+1],indices[j+2]);for(var tmp=new THREE.Vector3,tmp2=new THREE.Vector3,n=new THREE.Vector3,n2=new THREE.Vector3,i=0,il=groups.length,w,t,test;i<il;++i)for(var group=groups[i],start=group.start,count=group.count,j=start,jl=start+count;j<jl;j+=3)handleVertex(indices[j+0]),handleVertex(indices[j+1]),handleVertex(indices[j+2])},mergeBufferGeometries:function(geometries,useGroups){for(var isIndexed=null!==geometries[0].index,attributesUsed=new Set(Object.keys(geometries[0].attributes)),morphAttributesUsed=new Set(Object.keys(geometries[0].morphAttributes)),attributes={},morphAttributes={},mergedGeometry=new THREE.BufferGeometry,offset=0,i=0,geometry;i<geometries.length;++i){if(geometry=geometries[i],isIndexed!=(null!==geometry.index))return null;for(var name in geometry.attributes){if(!attributesUsed.has(name))return null;void 0===attributes[name]&&(attributes[name]=[]),attributes[name].push(geometry.attributes[name])}for(var name in geometry.morphAttributes){if(!morphAttributesUsed.has(name))return null;void 0===morphAttributes[name]&&(morphAttributes[name]=[]),morphAttributes[name].push(geometry.morphAttributes[name])}if(mergedGeometry.userData&&(mergedGeometry.userData.mergedUserData=mergedGeometry.userData.mergedUserData||[],mergedGeometry.userData.mergedUserData.push(geometry.userData)),useGroups){var count;if(isIndexed)count=geometry.index.count;else if(void 0!==geometry.attributes.position)count=geometry.attributes.position.count;else return null;mergedGeometry.addGroup(offset,count,i),offset+=count}}if(isIndexed){for(var indexOffset=0,mergedIndex=[],i=0,index;i<geometries.length;++i){index=geometries[i].index;for(var j=0;j<index.count;++j)mergedIndex.push(index.getX(j)+indexOffset);indexOffset+=geometries[i].attributes.position.count}mergedGeometry.setIndex(mergedIndex)}for(var name in attributes){var mergedAttribute=this.mergeBufferAttributes(attributes[name]);if(!mergedAttribute)return null;mergedGeometry.addAttribute(name,mergedAttribute)}for(var name in morphAttributes){var numMorphTargets=morphAttributes[name][0].length;if(0===numMorphTargets)break;mergedGeometry.morphAttributes=mergedGeometry.morphAttributes||{},mergedGeometry.morphAttributes[name]=[];for(var i=0,morphAttributesToMerge;i<numMorphTargets;++i){morphAttributesToMerge=[];for(var j=0;j<morphAttributes[name].length;++j)morphAttributesToMerge.push(morphAttributes[name][j][i]);var mergedMorphAttribute=this.mergeBufferAttributes(morphAttributesToMerge);if(!mergedMorphAttribute)return null;mergedGeometry.morphAttributes[name].push(mergedMorphAttribute)}}return mergedGeometry},mergeBufferAttributes:function(attributes){for(var arrayLength=0,i=0,TypedArray,itemSize,normalized,attribute;i<attributes.length;++i){if(attribute=attributes[i],attribute.isInterleavedBufferAttribute)return null;if(void 0==TypedArray&&(TypedArray=attribute.array.constructor),TypedArray!==attribute.array.constructor)return null;if(void 0==itemSize&&(itemSize=attribute.itemSize),itemSize!==attribute.itemSize)return null;if(void 0==normalized&&(normalized=attribute.normalized),normalized!==attribute.normalized)return null;arrayLength+=attribute.array.length}for(var array=new TypedArray(arrayLength),offset=0,i=0;i<attributes.length;++i)array.set(attributes[i].array,offset),offset+=attributes[i].array.length;return new THREE.BufferAttribute(array,itemSize,normalized)}}},function(){var _Mathmin3=Math.min,_Mathsqrt=Math.sqrt,_MathPI=Math.PI,_Mathmax3=Math.max;THREE.OrbitControls=function(object,domElement){function getAutoRotationAngle(){return 2*_MathPI/60/60*scope.autoRotateSpeed}function getZoomScale(){return Math.pow(0.95,scope.zoomSpeed)}function rotateLeft(angle){sphericalDelta.theta-=angle}function rotateUp(angle){sphericalDelta.phi-=angle}function dollyIn(dollyScale){scope.object.isPerspectiveCamera?scale/=dollyScale:scope.object.isOrthographicCamera?(scope.object.zoom=_Mathmax3(scope.minZoom,_Mathmin3(scope.maxZoom,scope.object.zoom*dollyScale)),scope.object.updateProjectionMatrix(),zoomChanged=!0):(console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.'),scope.enableZoom=!1)}function dollyOut(dollyScale){scope.object.isPerspectiveCamera?scale*=dollyScale:scope.object.isOrthographicCamera?(scope.object.zoom=_Mathmax3(scope.minZoom,_Mathmin3(scope.maxZoom,scope.object.zoom/dollyScale)),scope.object.updateProjectionMatrix(),zoomChanged=!0):(console.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.'),scope.enableZoom=!1)}function handleMouseDownRotate(event){rotateStart.set(event.clientX,event.clientY)}function handleMouseDownDolly(event){dollyStart.set(event.clientX,event.clientY)}function handleMouseDownPan(event){panStart.set(event.clientX,event.clientY)}function handleMouseMoveRotate(event){rotateEnd.set(event.clientX,event.clientY),rotateDelta.subVectors(rotateEnd,rotateStart);var element=scope.domElement===document?scope.domElement.body:scope.domElement;rotateLeft(2*_MathPI*rotateDelta.x/element.clientWidth*scope.rotateSpeed),rotateUp(2*_MathPI*rotateDelta.y/element.clientHeight*scope.rotateSpeed),rotateStart.copy(rotateEnd),scope.update()}function handleMouseMoveDolly(event){dollyEnd.set(event.clientX,event.clientY),dollyDelta.subVectors(dollyEnd,dollyStart),0<dollyDelta.y?dollyIn(getZoomScale()):0>dollyDelta.y&&dollyOut(getZoomScale()),dollyStart.copy(dollyEnd),scope.update()}function handleMouseMovePan(event){panEnd.set(event.clientX,event.clientY),panDelta.subVectors(panEnd,panStart),pan(panDelta.x,panDelta.y),panStart.copy(panEnd),scope.update()}function handleMouseUp(){}function handleMouseWheel(event){0>event.deltaY?dollyOut(getZoomScale()):0<event.deltaY&&dollyIn(getZoomScale()),scope.update()}function handleKeyDown(event){switch(event.keyCode){case scope.keys.UP:pan(0,scope.keyPanSpeed),scope.update();break;case scope.keys.BOTTOM:pan(0,-scope.keyPanSpeed),scope.update();break;case scope.keys.LEFT:pan(scope.keyPanSpeed,0),scope.update();break;case scope.keys.RIGHT:pan(-scope.keyPanSpeed,0),scope.update();}}function handleTouchStartRotate(event){rotateStart.set(event.touches[0].pageX,event.touches[0].pageY)}function handleTouchStartDolly(event){var dx=event.touches[0].pageX-event.touches[1].pageX,dy=event.touches[0].pageY-event.touches[1].pageY,distance=_Mathsqrt(dx*dx+dy*dy);dollyStart.set(0,distance)}function handleTouchStartPan(event){panStart.set(event.touches[0].pageX,event.touches[0].pageY)}function handleTouchMoveRotate(event){rotateEnd.set(event.touches[0].pageX,event.touches[0].pageY),rotateDelta.subVectors(rotateEnd,rotateStart);var element=scope.domElement===document?scope.domElement.body:scope.domElement;rotateLeft(2*_MathPI*rotateDelta.x/element.clientWidth*scope.rotateSpeed),rotateUp(2*_MathPI*rotateDelta.y/element.clientHeight*scope.rotateSpeed),rotateStart.copy(rotateEnd),scope.update()}function handleTouchMoveDolly(event){var dx=event.touches[0].pageX-event.touches[1].pageX,dy=event.touches[0].pageY-event.touches[1].pageY,distance=_Mathsqrt(dx*dx+dy*dy);dollyEnd.set(0,distance),dollyDelta.subVectors(dollyEnd,dollyStart),0<dollyDelta.y?dollyOut(getZoomScale()):0>dollyDelta.y&&dollyIn(getZoomScale()),dollyStart.copy(dollyEnd),scope.update()}function handleTouchMovePan(event){panEnd.set(event.touches[0].pageX,event.touches[0].pageY),panDelta.subVectors(panEnd,panStart),pan(panDelta.x,panDelta.y),panStart.copy(panEnd),scope.update()}function handleTouchEnd(){}function onMouseDown(event){if(!1!==scope.enabled){switch(event.preventDefault(),event.button){case scope.mouseButtons.ORBIT:if(!1===scope.enableRotate)return;handleMouseDownRotate(event),state=STATE.ROTATE;break;case scope.mouseButtons.ZOOM:if(!1===scope.enableZoom)return;handleMouseDownDolly(event),state=STATE.DOLLY;break;case scope.mouseButtons.PAN:if(!1===scope.enablePan)return;handleMouseDownPan(event),state=STATE.PAN;}state!==STATE.NONE&&(document.addEventListener('mousemove',onMouseMove,!1),document.addEventListener('mouseup',onMouseUp,!1),scope.dispatchEvent(startEvent))}}function onMouseMove(event){if(!1!==scope.enabled)switch(event.preventDefault(),state){case STATE.ROTATE:if(!1===scope.enableRotate)return;handleMouseMoveRotate(event);break;case STATE.DOLLY:if(!1===scope.enableZoom)return;handleMouseMoveDolly(event);break;case STATE.PAN:if(!1===scope.enablePan)return;handleMouseMovePan(event);}}function onMouseUp(event){!1===scope.enabled||(handleMouseUp(event),document.removeEventListener('mousemove',onMouseMove,!1),document.removeEventListener('mouseup',onMouseUp,!1),scope.dispatchEvent(endEvent),state=STATE.NONE)}function onMouseWheel(event){!1===scope.enabled||!1===scope.enableZoom||state!==STATE.NONE&&state!==STATE.ROTATE||(event.preventDefault(),event.stopPropagation(),scope.dispatchEvent(startEvent),handleMouseWheel(event),scope.dispatchEvent(endEvent))}function onKeyDown(event){!1===scope.enabled||!1===scope.enableKeys||!1===scope.enablePan||handleKeyDown(event)}function onTouchStart(event){if(!1!==scope.enabled){switch(event.touches.length){case 1:if(!1===scope.enableRotate)return;handleTouchStartRotate(event),state=STATE.TOUCH_ROTATE;break;case 2:if(!1===scope.enableZoom)return;handleTouchStartDolly(event),state=STATE.TOUCH_DOLLY;break;case 3:if(!1===scope.enablePan)return;handleTouchStartPan(event),state=STATE.TOUCH_PAN;break;default:state=STATE.NONE;}state!==STATE.NONE&&scope.dispatchEvent(startEvent)}}function onTouchMove(event){if(!1!==scope.enabled)switch(event.preventDefault(),event.stopPropagation(),event.touches.length){case 1:if(!1===scope.enableRotate)return;if(state!==STATE.TOUCH_ROTATE)return;handleTouchMoveRotate(event);break;case 2:if(!1===scope.enableZoom)return;if(state!==STATE.TOUCH_DOLLY)return;handleTouchMoveDolly(event);break;case 3:if(!1===scope.enablePan)return;if(state!==STATE.TOUCH_PAN)return;handleTouchMovePan(event);break;default:state=STATE.NONE;}}function onTouchEnd(event){!1===scope.enabled||(handleTouchEnd(event),scope.dispatchEvent(endEvent),state=STATE.NONE)}function onContextMenu(event){!1===scope.enabled||event.preventDefault()}this.object=object,this.domElement=domElement===void 0?document:domElement,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=Infinity,this.minZoom=0,this.maxZoom=Infinity,this.minPolarAngle=0,this.maxPolarAngle=_MathPI,this.minAzimuthAngle=-Infinity,this.maxAzimuthAngle=Infinity,this.enableDamping=!1,this.dampingFactor=0.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return spherical.phi},this.getAzimuthalAngle=function(){return spherical.theta},this.saveState=function(){scope.target0.copy(scope.target),scope.position0.copy(scope.object.position),scope.zoom0=scope.object.zoom},this.reset=function(){scope.target.copy(scope.target0),scope.object.position.copy(scope.position0),scope.object.zoom=scope.zoom0,scope.object.updateProjectionMatrix(),scope.dispatchEvent(changeEvent),scope.update(),state=STATE.NONE},this.update=function(){var offset=new THREE.Vector3,quat=new THREE.Quaternion().setFromUnitVectors(object.up,new THREE.Vector3(0,1,0)),quatInverse=quat.clone().inverse(),lastPosition=new THREE.Vector3,lastQuaternion=new THREE.Quaternion;return function update(){var position=scope.object.position;return offset.copy(position).sub(scope.target),offset.applyQuaternion(quat),spherical.setFromVector3(offset),scope.autoRotate&&state===STATE.NONE&&rotateLeft(getAutoRotationAngle()),spherical.theta+=sphericalDelta.theta,spherical.phi+=sphericalDelta.phi,spherical.theta=_Mathmax3(scope.minAzimuthAngle,_Mathmin3(scope.maxAzimuthAngle,spherical.theta)),spherical.phi=_Mathmax3(scope.minPolarAngle,_Mathmin3(scope.maxPolarAngle,spherical.phi)),spherical.makeSafe(),spherical.radius*=scale,spherical.radius=_Mathmax3(scope.minDistance,_Mathmin3(scope.maxDistance,spherical.radius)),scope.target.add(panOffset),offset.setFromSpherical(spherical),offset.applyQuaternion(quatInverse),position.copy(scope.target).add(offset),scope.object.lookAt(scope.target),!0===scope.enableDamping?(sphericalDelta.theta*=1-scope.dampingFactor,sphericalDelta.phi*=1-scope.dampingFactor):sphericalDelta.set(0,0,0),scale=1,panOffset.set(0,0,0),(zoomChanged||lastPosition.distanceToSquared(scope.object.position)>EPS||8*(1-lastQuaternion.dot(scope.object.quaternion))>EPS)&&(scope.dispatchEvent(changeEvent),lastPosition.copy(scope.object.position),lastQuaternion.copy(scope.object.quaternion),zoomChanged=!1,!0)}}(),this.dispose=function(){scope.domElement.removeEventListener('contextmenu',onContextMenu,!1),scope.domElement.removeEventListener('mousedown',onMouseDown,!1),scope.domElement.removeEventListener('wheel',onMouseWheel,!1),scope.domElement.removeEventListener('touchstart',onTouchStart,!1),scope.domElement.removeEventListener('touchend',onTouchEnd,!1),scope.domElement.removeEventListener('touchmove',onTouchMove,!1),document.removeEventListener('mousemove',onMouseMove,!1),document.removeEventListener('mouseup',onMouseUp,!1),window.removeEventListener('keydown',onKeyDown,!1)};var scope=this,changeEvent={type:'change'},startEvent={type:'start'},endEvent={type:'end'},STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},state=STATE.NONE,EPS=1e-6,spherical=new THREE.Spherical,sphericalDelta=new THREE.Spherical,scale=1,panOffset=new THREE.Vector3,zoomChanged=!1,rotateStart=new THREE.Vector2,rotateEnd=new THREE.Vector2,rotateDelta=new THREE.Vector2,panStart=new THREE.Vector2,panEnd=new THREE.Vector2,panDelta=new THREE.Vector2,dollyStart=new THREE.Vector2,dollyEnd=new THREE.Vector2,dollyDelta=new THREE.Vector2,panLeft=function(){var v=new THREE.Vector3;return function panLeft(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,0),v.multiplyScalar(-distance),panOffset.add(v)}}(),panUp=function(){var v=new THREE.Vector3;return function panUp(distance,objectMatrix){v.setFromMatrixColumn(objectMatrix,1),v.multiplyScalar(distance),panOffset.add(v)}}(),pan=function(){var offset=new THREE.Vector3;return function pan(deltaX,deltaY){var element=scope.domElement===document?scope.domElement.body:scope.domElement;if(scope.object.isPerspectiveCamera){var position=scope.object.position;offset.copy(position).sub(scope.target);var targetDistance=offset.length();targetDistance*=Math.tan(scope.object.fov/2*_MathPI/180),panLeft(2*deltaX*targetDistance/element.clientHeight,scope.object.matrix),panUp(2*deltaY*targetDistance/element.clientHeight,scope.object.matrix)}else scope.object.isOrthographicCamera?(panLeft(deltaX*(scope.object.right-scope.object.left)/scope.object.zoom/element.clientWidth,scope.object.matrix),panUp(deltaY*(scope.object.top-scope.object.bottom)/scope.object.zoom/element.clientHeight,scope.object.matrix)):(console.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.'),scope.enablePan=!1)}}();scope.domElement.addEventListener('contextmenu',onContextMenu,!1),scope.domElement.addEventListener('mousedown',onMouseDown,!1),scope.domElement.addEventListener('wheel',onMouseWheel,!1),scope.domElement.addEventListener('touchstart',onTouchStart,!1),scope.domElement.addEventListener('touchend',onTouchEnd,!1),scope.domElement.addEventListener('touchmove',onTouchMove,!1),window.addEventListener('keydown',onKeyDown,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn('THREE.OrbitControls: .center has been renamed to .target'),this.target}},noZoom:{get:function(){return console.warn('THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.'),!this.enableZoom},set:function(value){console.warn('THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.'),this.enableZoom=!value}},noRotate:{get:function(){return console.warn('THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.'),!this.enableRotate},set:function(value){console.warn('THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.'),this.enableRotate=!value}},noPan:{get:function(){return console.warn('THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.'),!this.enablePan},set:function(value){console.warn('THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.'),this.enablePan=!value}},noKeys:{get:function(){return console.warn('THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.'),!this.enableKeys},set:function(value){console.warn('THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.'),this.enableKeys=!value}},staticMoving:{get:function(){return console.warn('THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.'),!this.enableDamping},set:function(value){console.warn('THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.'),this.enableDamping=!value}},dynamicDampingFactor:{get:function(){return console.warn('THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.'),this.dampingFactor},set:function(value){console.warn('THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.'),this.dampingFactor=value}}})},function(module,exports,__webpack_require__){var _Mathfloor3=Math.floor;(function(process){function AlgoliaSearchCore(applicationID,apiKey,opts){var debug=__webpack_require__(8)('algoliasearch'),clone=__webpack_require__(1),isArray=__webpack_require__(9),map=__webpack_require__(6),usage='Usage: algoliasearch(applicationID, apiKey, opts)';if(!0!==opts._allowEmptyCredentials&&!applicationID)throw new errors.AlgoliaSearchError('Please provide an application ID. '+usage);if(!0!==opts._allowEmptyCredentials&&!apiKey)throw new errors.AlgoliaSearchError('Please provide an API key. '+usage);this.applicationID=applicationID,this.apiKey=apiKey,this.hosts={read:[],write:[]},opts=opts||{},this._timeouts=opts.timeouts||{connect:1*1e3,read:2*1e3,write:30*1e3},opts.timeout&&(this._timeouts.connect=this._timeouts.read=this._timeouts.write=opts.timeout);var protocol=opts.protocol||'https:';if(/:$/.test(protocol)||(protocol+=':'),'http:'!==protocol&&'https:'!==protocol)throw new errors.AlgoliaSearchError('protocol must be `http:` or `https:` (was `'+opts.protocol+'`)');if(this._checkAppIdData(),!opts.hosts){var defaultHosts=map(this._shuffleResult,function(hostNumber){return applicationID+'-'+hostNumber+'.algolianet.com'}),mainSuffix=(!1===opts.dsn?'':'-dsn')+'.algolia.net';this.hosts.read=[this.applicationID+mainSuffix].concat(defaultHosts),this.hosts.write=[this.applicationID+'.algolia.net'].concat(defaultHosts)}else isArray(opts.hosts)?(this.hosts.read=clone(opts.hosts),this.hosts.write=clone(opts.hosts)):(this.hosts.read=clone(opts.hosts.read),this.hosts.write=clone(opts.hosts.write));this.hosts.read=map(this.hosts.read,prepareHost(protocol)),this.hosts.write=map(this.hosts.write,prepareHost(protocol)),this.extraHeaders={},this.cache=opts._cache||{},this._ua=opts._ua,this._useCache=void 0===opts._useCache||opts._cache||opts._useCache,this._useRequestCache=this._useCache&&opts._useRequestCache,this._useFallback=void 0===opts.useFallback||opts.useFallback,this._setTimeout=opts._setTimeout,debug('init done, %j',this)}function prepareHost(protocol){return function prepare(host){return protocol+'//'+host.toLowerCase()}}function safeJSONStringify(obj){if(void 0===Array.prototype.toJSON)return JSON.stringify(obj);var toJSON=Array.prototype.toJSON;delete Array.prototype.toJSON;var out=JSON.stringify(obj);return Array.prototype.toJSON=toJSON,out}function shuffle(array){for(var currentIndex=array.length,temporaryValue,randomIndex;0!==currentIndex;)randomIndex=_Mathfloor3(Math.random()*currentIndex),currentIndex-=1,temporaryValue=array[currentIndex],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}function removeCredentials(headers){var newHeaders={};for(var headerName in headers)if(Object.prototype.hasOwnProperty.call(headers,headerName)){var value;value='x-algolia-api-key'==headerName||'x-algolia-application-id'==headerName?'**hidden for security purposes**':headers[headerName],newHeaders[headerName]=value}return newHeaders}module.exports=AlgoliaSearchCore;var errors=__webpack_require__(5),exitPromise=__webpack_require__(51),IndexCore=__webpack_require__(44),store=__webpack_require__(54),RESET_APP_DATA_TIMER=process.env.RESET_APP_DATA_TIMER&&parseInt(process.env.RESET_APP_DATA_TIMER,10)||1e3*(2*60);AlgoliaSearchCore.prototype.initIndex=function(indexName){return new IndexCore(this,indexName)},AlgoliaSearchCore.prototype.setExtraHeader=function(name,value){this.extraHeaders[name.toLowerCase()]=value},AlgoliaSearchCore.prototype.getExtraHeader=function(name){return this.extraHeaders[name.toLowerCase()]},AlgoliaSearchCore.prototype.unsetExtraHeader=function(name){delete this.extraHeaders[name.toLowerCase()]},AlgoliaSearchCore.prototype.addAlgoliaAgent=function(algoliaAgent){-1===this._ua.indexOf(';'+algoliaAgent)&&(this._ua+=';'+algoliaAgent)},AlgoliaSearchCore.prototype._jsonRequest=function(initialOpts){function doRequest(requester,reqOpts){function retryRequest(){return requestDebug('retrying request'),client._incrementHostIndex(initialOpts.hostType),doRequest(requester,reqOpts)}function retryRequestWithHigherTimeout(){return requestDebug('retrying request with higher timeout'),client._incrementHostIndex(initialOpts.hostType),client._incrementTimeoutMultipler(),reqOpts.timeouts=client._getTimeoutsForRequest(initialOpts.hostType),doRequest(requester,reqOpts)}client._checkAppIdData();var startTime=new Date;if(client._useCache&&!client._useRequestCache&&(cacheID=initialOpts.url),client._useCache&&!client._useRequestCache&&body&&(cacheID+='_body_'+reqOpts.body),isCacheValidWithCurrentID(!client._useRequestCache,cache,cacheID)){requestDebug('serving response from cache');var responseText=cache[cacheID];return client._promise.resolve({body:JSON.parse(responseText),responseText:responseText})}if(tries>=client.hosts[initialOpts.hostType].length)return!hasFallback||usingFallback?(requestDebug('could not get any response'),client._promise.reject(new errors.AlgoliaSearchError('Cannot connect to the AlgoliaSearch API.'+' Send an email to support@algolia.com to report and resolve the issue.'+' Application id was: '+client.applicationID,{debugData:debugData}))):(requestDebug('switching to fallback'),tries=0,reqOpts.method=initialOpts.fallback.method,reqOpts.url=initialOpts.fallback.url,reqOpts.jsonBody=initialOpts.fallback.body,reqOpts.jsonBody&&(reqOpts.body=safeJSONStringify(reqOpts.jsonBody)),headers=client._computeRequestHeaders({additionalUA:additionalUA,headers:initialOpts.headers}),reqOpts.timeouts=client._getTimeoutsForRequest(initialOpts.hostType),client._setHostIndexByType(0,initialOpts.hostType),usingFallback=!0,doRequest(client._request.fallback,reqOpts));var currentHost=client._getHostByType(initialOpts.hostType),url=currentHost+reqOpts.url,options={body:reqOpts.body,jsonBody:reqOpts.jsonBody,method:reqOpts.method,headers:headers,timeouts:reqOpts.timeouts,debug:requestDebug,forceAuthHeaders:reqOpts.forceAuthHeaders};return requestDebug('method: %s, url: %s, headers: %j, timeouts: %d',options.method,url,options.headers,options.timeouts),requester===client._request.fallback&&requestDebug('using fallback'),requester.call(client,url,options).then(function success(httpResponse){var status=httpResponse&&httpResponse.body&&httpResponse.body.message&&httpResponse.body.status||httpResponse.statusCode||httpResponse&&httpResponse.body&&200;requestDebug('received response: statusCode: %s, computed statusCode: %d, headers: %j',httpResponse.statusCode,status,httpResponse.headers);var httpResponseOk=2===_Mathfloor3(status/100),endTime=new Date;if(debugData.push({currentHost:currentHost,headers:removeCredentials(headers),content:body||null,contentLength:void 0===body?null:body.length,method:reqOpts.method,timeouts:reqOpts.timeouts,url:reqOpts.url,startTime:startTime,endTime:endTime,duration:endTime-startTime,statusCode:status}),httpResponseOk)return client._useCache&&!client._useRequestCache&&cache&&(cache[cacheID]=httpResponse.responseText),{responseText:httpResponse.responseText,body:httpResponse.body};var shouldRetry=4!==_Mathfloor3(status/100);if(shouldRetry)return tries+=1,retryRequest();requestDebug('unrecoverable error');var unrecoverableError=new errors.AlgoliaSearchError(httpResponse.body&&httpResponse.body.message,{debugData:debugData,statusCode:status});return client._promise.reject(unrecoverableError)},function tryFallback(err){requestDebug('error: %s, stack: %s',err.message,err.stack);var endTime=new Date;return debugData.push({currentHost:currentHost,headers:removeCredentials(headers),content:body||null,contentLength:void 0===body?null:body.length,method:reqOpts.method,timeouts:reqOpts.timeouts,url:reqOpts.url,startTime:startTime,endTime:endTime,duration:endTime-startTime}),err instanceof errors.AlgoliaSearchError||(err=new errors.Unknown(err&&err.message,err)),tries+=1,err instanceof errors.Unknown||err instanceof errors.UnparsableJSON||tries>=client.hosts[initialOpts.hostType].length&&(usingFallback||!hasFallback)?(err.debugData=debugData,client._promise.reject(err)):err instanceof errors.RequestTimeout?retryRequestWithHigherTimeout():retryRequest()})}function isCacheValidWithCurrentID(useRequestCache,currentCache,currentCacheID){return client._useCache&&useRequestCache&&currentCache&&void 0!==currentCache[currentCacheID]}function interopCallbackReturn(request,callback){return isCacheValidWithCurrentID(client._useRequestCache,cache,cacheID)&&request.catch(function(){delete cache[cacheID]}),'function'==typeof initialOpts.callback?void request.then(function okCb(content){exitPromise(function(){initialOpts.callback(null,callback(content))},client._setTimeout||setTimeout)},function nookCb(err){exitPromise(function(){initialOpts.callback(err)},client._setTimeout||setTimeout)}):request.then(callback)}this._checkAppIdData();var requestDebug=__webpack_require__(8)('algoliasearch:'+initialOpts.url),additionalUA=initialOpts.additionalUA||'',cache=initialOpts.cache,client=this,tries=0,usingFallback=!1,hasFallback=client._useFallback&&client._request.fallback&&initialOpts.fallback,body,cacheID,headers;this.apiKey.length>500&&void 0!==initialOpts.body&&(void 0!==initialOpts.body.params||void 0!==initialOpts.body.requests)?(initialOpts.body.apiKey=this.apiKey,headers=this._computeRequestHeaders({additionalUA:additionalUA,withApiKey:!1,headers:initialOpts.headers})):headers=this._computeRequestHeaders({additionalUA:additionalUA,headers:initialOpts.headers}),void 0!==initialOpts.body&&(body=safeJSONStringify(initialOpts.body)),requestDebug('request start');var debugData=[];if(client._useCache&&client._useRequestCache&&(cacheID=initialOpts.url),client._useCache&&client._useRequestCache&&body&&(cacheID+='_body_'+body),isCacheValidWithCurrentID(client._useRequestCache,cache,cacheID)){requestDebug('serving request from cache');var maybePromiseForCache=cache[cacheID],promiseForCache='function'==typeof maybePromiseForCache.then?maybePromiseForCache:client._promise.resolve({responseText:maybePromiseForCache});return interopCallbackReturn(promiseForCache,function(content){return JSON.parse(content.responseText)})}var request=doRequest(client._request,{url:initialOpts.url,method:initialOpts.method,body:body,jsonBody:initialOpts.body,timeouts:client._getTimeoutsForRequest(initialOpts.hostType),forceAuthHeaders:initialOpts.forceAuthHeaders});return client._useCache&&client._useRequestCache&&cache&&(cache[cacheID]=request),interopCallbackReturn(request,function(content){return content.body})},AlgoliaSearchCore.prototype._getSearchParams=function(args,params){if(args===void 0||null===args)return params;for(var key in args)null!==key&&void 0!==args[key]&&args.hasOwnProperty(key)&&(params+=''===params?'':'&',params+=key+'='+encodeURIComponent('[object Array]'===Object.prototype.toString.call(args[key])?safeJSONStringify(args[key]):args[key]));return params},AlgoliaSearchCore.prototype._computeRequestHeaders=function(options){var forEach=__webpack_require__(3),ua=options.additionalUA?this._ua+';'+options.additionalUA:this._ua,requestHeaders={"x-algolia-agent":ua,"x-algolia-application-id":this.applicationID};return!1!==options.withApiKey&&(requestHeaders['x-algolia-api-key']=this.apiKey),this.userToken&&(requestHeaders['x-algolia-usertoken']=this.userToken),this.securityTags&&(requestHeaders['x-algolia-tagfilters']=this.securityTags),forEach(this.extraHeaders,function addToRequestHeaders(value,key){requestHeaders[key]=value}),options.headers&&forEach(options.headers,function addToRequestHeaders(value,key){requestHeaders[key]=value}),requestHeaders},AlgoliaSearchCore.prototype.search=function(queries,opts,callback){var isArray=__webpack_require__(9),map=__webpack_require__(6);if(!isArray(queries))throw new Error('Usage: client.search(arrayOfQueries[, callback])');'function'==typeof opts?(callback=opts,opts={}):void 0===opts&&(opts={});var client=this,postObj={requests:map(queries,function prepareRequest(query){var params='';return void 0!==query.query&&(params+='query='+encodeURIComponent(query.query)),{indexName:query.indexName,params:client._getSearchParams(query.params,params)}})},JSONPParams=map(postObj.requests,function prepareJSONPParams(request,requestId){return requestId+'='+encodeURIComponent('/1/indexes/'+encodeURIComponent(request.indexName)+'?'+request.params)}).join('&'),url='/1/indexes/*/queries';return void 0!==opts.strategy&&(url+='?strategy='+opts.strategy),this._jsonRequest({cache:this.cache,method:'POST',url:url,body:postObj,hostType:'read',fallback:{method:'GET',url:'/1/indexes/*',body:{params:JSONPParams}},callback:callback})},AlgoliaSearchCore.prototype.searchForFacetValues=function(queries){var isArray=__webpack_require__(9),map=__webpack_require__(6),usage='Usage: client.searchForFacetValues([{indexName, params: {facetName, facetQuery, ...params}}, ...queries])';if(!isArray(queries))throw new Error(usage);var client=this;return client._promise.all(map(queries,function performQuery(query){if(!query||query.indexName===void 0||query.params.facetName===void 0||query.params.facetQuery===void 0)throw new Error(usage);var clone=__webpack_require__(1),omit=__webpack_require__(17),indexName=query.indexName,params=query.params,facetName=params.facetName,filteredParams=omit(clone(params),function(keyName){return'facetName'===keyName}),searchParameters=client._getSearchParams(filteredParams,'');return client._jsonRequest({cache:client.cache,method:'POST',url:'/1/indexes/'+encodeURIComponent(indexName)+'/facets/'+encodeURIComponent(facetName)+'/query',hostType:'read',body:{params:searchParameters}})}))},AlgoliaSearchCore.prototype.setSecurityTags=function(tags){if('[object Array]'===Object.prototype.toString.call(tags)){for(var strTags=[],i=0;i<tags.length;++i)if('[object Array]'===Object.prototype.toString.call(tags[i])){for(var oredTags=[],j=0;j<tags[i].length;++j)oredTags.push(tags[i][j]);strTags.push('('+oredTags.join(',')+')')}else strTags.push(tags[i]);tags=strTags.join(',')}this.securityTags=tags},AlgoliaSearchCore.prototype.setUserToken=function(userToken){this.userToken=userToken},AlgoliaSearchCore.prototype.clearCache=function(){this.cache={}},AlgoliaSearchCore.prototype.setRequestTimeout=function(milliseconds){milliseconds&&(this._timeouts.connect=this._timeouts.read=this._timeouts.write=milliseconds)},AlgoliaSearchCore.prototype.setTimeouts=function(timeouts){this._timeouts=timeouts},AlgoliaSearchCore.prototype.getTimeouts=function(){return this._timeouts},AlgoliaSearchCore.prototype._getAppIdData=function(){var data=store.get(this.applicationID);return null!==data&&this._cacheAppIdData(data),data},AlgoliaSearchCore.prototype._setAppIdData=function(data){return data.lastChange=new Date().getTime(),this._cacheAppIdData(data),store.set(this.applicationID,data)},AlgoliaSearchCore.prototype._checkAppIdData=function(){var data=this._getAppIdData(),now=new Date().getTime();return null===data||now-data.lastChange>RESET_APP_DATA_TIMER?this._resetInitialAppIdData(data):data},AlgoliaSearchCore.prototype._resetInitialAppIdData=function(data){var newData=data||{};return newData.hostIndexes={read:0,write:0},newData.timeoutMultiplier=1,newData.shuffleResult=newData.shuffleResult||shuffle([1,2,3]),this._setAppIdData(newData)},AlgoliaSearchCore.prototype._cacheAppIdData=function(data){this._hostIndexes=data.hostIndexes,this._timeoutMultiplier=data.timeoutMultiplier,this._shuffleResult=data.shuffleResult},AlgoliaSearchCore.prototype._partialAppIdDataUpdate=function(newData){var foreach=__webpack_require__(3),currentData=this._getAppIdData();return foreach(newData,function(value,key){currentData[key]=value}),this._setAppIdData(currentData)},AlgoliaSearchCore.prototype._getHostByType=function(hostType){return this.hosts[hostType][this._getHostIndexByType(hostType)]},AlgoliaSearchCore.prototype._getTimeoutMultiplier=function(){return this._timeoutMultiplier},AlgoliaSearchCore.prototype._getHostIndexByType=function(hostType){return this._hostIndexes[hostType]},AlgoliaSearchCore.prototype._setHostIndexByType=function(hostIndex,hostType){var clone=__webpack_require__(1),newHostIndexes=clone(this._hostIndexes);return newHostIndexes[hostType]=hostIndex,this._partialAppIdDataUpdate({hostIndexes:newHostIndexes}),hostIndex},AlgoliaSearchCore.prototype._incrementHostIndex=function(hostType){return this._setHostIndexByType((this._getHostIndexByType(hostType)+1)%this.hosts[hostType].length,hostType)},AlgoliaSearchCore.prototype._incrementTimeoutMultipler=function(){var timeoutMultiplier=Math.max(this._timeoutMultiplier+1,4);return this._partialAppIdDataUpdate({timeoutMultiplier:timeoutMultiplier})},AlgoliaSearchCore.prototype._getTimeoutsForRequest=function(hostType){return{connect:this._timeouts.connect*this._timeoutMultiplier,complete:this._timeouts[hostType]*this._timeoutMultiplier}}}).call(exports,__webpack_require__(4))},function(module,exports,__webpack_require__){function IndexCore(algoliasearch,indexName){this.indexName=indexName,this.as=algoliasearch,this.typeAheadArgs=null,this.typeAheadValueOption=null,this.cache={}}var buildSearchMethod=__webpack_require__(16),deprecate=__webpack_require__(49),deprecatedMessage=__webpack_require__(50);module.exports=IndexCore,IndexCore.prototype.clearCache=function(){this.cache={}},IndexCore.prototype.search=buildSearchMethod('query'),IndexCore.prototype.similarSearch=buildSearchMethod('similarQuery'),IndexCore.prototype.browse=function(query,queryParameters,callback){var merge=__webpack_require__(52),indexObj=this,page,hitsPerPage;0===arguments.length||1===arguments.length&&'function'==typeof arguments[0]?(page=0,callback=arguments[0],query=void 0):'number'==typeof arguments[0]?(page=arguments[0],'number'==typeof arguments[1]?hitsPerPage=arguments[1]:'function'==typeof arguments[1]&&(callback=arguments[1],hitsPerPage=void 0),query=void 0,queryParameters=void 0):'object'==typeof arguments[0]?('function'==typeof arguments[1]&&(callback=arguments[1]),queryParameters=arguments[0],query=void 0):'string'==typeof arguments[0]&&'function'==typeof arguments[1]&&(callback=arguments[1],queryParameters=void 0),queryParameters=merge({},queryParameters||{},{page:page,hitsPerPage:hitsPerPage,query:query});var params=this.as._getSearchParams(queryParameters,'');return this.as._jsonRequest({method:'POST',url:'/1/indexes/'+encodeURIComponent(indexObj.indexName)+'/browse',body:{params:params},hostType:'read',callback:callback})},IndexCore.prototype.browseFrom=function(cursor,callback){return this.as._jsonRequest({method:'POST',url:'/1/indexes/'+encodeURIComponent(this.indexName)+'/browse',body:{cursor:cursor},hostType:'read',callback:callback})},IndexCore.prototype.searchForFacetValues=function(params,callback){var clone=__webpack_require__(1),omit=__webpack_require__(17);if(params.facetName===void 0||params.facetQuery===void 0)throw new Error('Usage: index.searchForFacetValues({facetName, facetQuery, ...params}[, callback])');var facetName=params.facetName,filteredParams=omit(clone(params),function(keyName){return'facetName'===keyName}),searchParameters=this.as._getSearchParams(filteredParams,'');return this.as._jsonRequest({method:'POST',url:'/1/indexes/'+encodeURIComponent(this.indexName)+'/facets/'+encodeURIComponent(facetName)+'/query',hostType:'read',body:{params:searchParameters},callback:callback})},IndexCore.prototype.searchFacet=deprecate(function(params,callback){return this.searchForFacetValues(params,callback)},deprecatedMessage('index.searchFacet(params[, callback])','index.searchForFacetValues(params[, callback])')),IndexCore.prototype._search=function(params,url,callback,additionalUA){return this.as._jsonRequest({cache:this.cache,method:'POST',url:url||'/1/indexes/'+encodeURIComponent(this.indexName)+'/query',body:{params:params},hostType:'read',fallback:{method:'GET',url:'/1/indexes/'+encodeURIComponent(this.indexName),body:{params:params}},callback:callback,additionalUA:additionalUA})},IndexCore.prototype.getObject=function(objectID,attrs,callback){var indexObj=this;(1===arguments.length||'function'==typeof attrs)&&(callback=attrs,attrs=void 0);var params='';if(attrs!==void 0){params='?attributes=';for(var i=0;i<attrs.length;++i)0!==i&&(params+=','),params+=attrs[i]}return this.as._jsonRequest({method:'GET',url:'/1/indexes/'+encodeURIComponent(indexObj.indexName)+'/'+encodeURIComponent(objectID)+params,hostType:'read',callback:callback})},IndexCore.prototype.getObjects=function(objectIDs,attributesToRetrieve,callback){var isArray=__webpack_require__(9),map=__webpack_require__(6);if(!isArray(objectIDs))throw new Error('Usage: index.getObjects(arrayOfObjectIDs[, callback])');var indexObj=this;(1===arguments.length||'function'==typeof attributesToRetrieve)&&(callback=attributesToRetrieve,attributesToRetrieve=void 0);var body={requests:map(objectIDs,function prepareRequest(objectID){var request={indexName:indexObj.indexName,objectID:objectID};return attributesToRetrieve&&(request.attributesToRetrieve=attributesToRetrieve.join(',')),request})};return this.as._jsonRequest({method:'POST',url:'/1/indexes/*/objects',hostType:'read',body:body,callback:callback})},IndexCore.prototype.as=null,IndexCore.prototype.indexName=null,IndexCore.prototype.typeAheadArgs=null,IndexCore.prototype.typeAheadValueOption=null},function(module,exports,__webpack_require__){'use strict';var AlgoliaSearchCore=__webpack_require__(43),createAlgoliasearch=__webpack_require__(46);module.exports=createAlgoliasearch(AlgoliaSearchCore,'(lite) ')},function(module,exports,__webpack_require__){'use strict';var global=__webpack_require__(143),Promise=global.Promise||__webpack_require__(140).Promise;module.exports=function createAlgoliasearch(AlgoliaSearch,uaSuffix){function algoliasearch(applicationID,apiKey,opts){var cloneDeep=__webpack_require__(1);return opts=cloneDeep(opts||{}),opts._ua=opts._ua||algoliasearch.ua,new AlgoliaSearchBrowser(applicationID,apiKey,opts)}function AlgoliaSearchBrowser(){AlgoliaSearch.apply(this,arguments)}var inherits=__webpack_require__(18),errors=__webpack_require__(5),inlineHeaders=__webpack_require__(47),jsonpRequest=__webpack_require__(48),places=__webpack_require__(53);uaSuffix=uaSuffix||'',!1,algoliasearch.version=__webpack_require__(55),algoliasearch.ua='Algolia for vanilla JavaScript '+uaSuffix+algoliasearch.version,algoliasearch.initPlaces=places(algoliasearch),global.__algolia={debug:__webpack_require__(8),algoliasearch:algoliasearch};var support={hasXMLHttpRequest:'XMLHttpRequest'in global,hasXDomainRequest:'XDomainRequest'in global};return support.hasXMLHttpRequest&&(support.cors='withCredentials'in new XMLHttpRequest),inherits(AlgoliaSearchBrowser,AlgoliaSearch),AlgoliaSearchBrowser.prototype._request=function request(url,opts){return new Promise(function wrapRequest(resolve,reject){function onTimeout(){timedOut=!0,req.abort(),reject(new errors.RequestTimeout)}function onConnect(){connected=!0,clearTimeout(reqTimeout),reqTimeout=setTimeout(onTimeout,opts.timeouts.complete)}if(!support.cors&&!support.hasXDomainRequest)return void reject(new errors.Network('CORS not supported'));url=inlineHeaders(url,opts.headers);var body=opts.body,req=support.cors?new XMLHttpRequest:new XDomainRequest,connected=!1,reqTimeout,timedOut;reqTimeout=setTimeout(onTimeout,opts.timeouts.connect),req.onprogress=function onProgress(){connected||onConnect()},'onreadystatechange'in req&&(req.onreadystatechange=function onReadyStateChange(){!connected&&1<req.readyState&&onConnect()}),req.onload=function onLoad(){if(!timedOut){clearTimeout(reqTimeout);var out;try{out={body:JSON.parse(req.responseText),responseText:req.responseText,statusCode:req.status,headers:req.getAllResponseHeaders&&req.getAllResponseHeaders()||{}}}catch(e){out=new errors.UnparsableJSON({more:req.responseText})}out instanceof errors.UnparsableJSON?reject(out):resolve(out)}},req.onerror=function onError(event){timedOut||(clearTimeout(reqTimeout),reject(new errors.Network({more:event})))},req instanceof XMLHttpRequest?(req.open(opts.method,url,!0),opts.forceAuthHeaders&&(req.setRequestHeader('x-algolia-application-id',opts.headers['x-algolia-application-id']),req.setRequestHeader('x-algolia-api-key',opts.headers['x-algolia-api-key']))):req.open(opts.method,url),support.cors&&(body&&('POST'===opts.method?req.setRequestHeader('content-type','application/x-www-form-urlencoded'):req.setRequestHeader('content-type','application/json')),req.setRequestHeader('accept','application/json')),body?req.send(body):req.send()})},AlgoliaSearchBrowser.prototype._request.fallback=function requestFallback(url,opts){return url=inlineHeaders(url,opts.headers),new Promise(function wrapJsonpRequest(resolve,reject){jsonpRequest(url,opts,function jsonpRequestDone(err,content){return err?void reject(err):void resolve(content)})})},AlgoliaSearchBrowser.prototype._promise={reject:function rejectPromise(val){return Promise.reject(val)},resolve:function resolvePromise(val){return Promise.resolve(val)},delay:function delayPromise(ms){return new Promise(function resolveOnTimeout(resolve){setTimeout(resolve,ms)})},all:function all(promises){return Promise.all(promises)}},algoliasearch}},function(module,exports,__webpack_require__){'use strict';module.exports=function inlineHeaders(url,headers){return url+=/\?/.test(url)?'&':'?',url+encode(headers)};var encode=__webpack_require__(147)},function(module,exports,__webpack_require__){'use strict';module.exports=function jsonpRequest(url,opts,cb){function success(){opts.debug('JSONP: success');done||timedOut||(done=!0,!cbCalled&&(opts.debug('JSONP: Fail. Script loaded but did not call the callback'),clean(),cb(new errors.JSONPScriptFail)))}function clean(){clearTimeout(ontimeout),script.onload=null,script.onreadystatechange=null,script.onerror=null,head.removeChild(script)}function removeGlobals(){try{delete window[cbName],delete window[cbName+'_loaded']}catch(e){window[cbName]=window[cbName+'_loaded']=void 0}}if('GET'!==opts.method)return void cb(new Error('Method '+opts.method+' '+url+' is not supported by JSONP.'));opts.debug('JSONP: start');var cbCalled=!1,timedOut=!1;JSONPCounter+=1;var head=document.getElementsByTagName('head')[0],script=document.createElement('script'),cbName='algoliaJSONP_'+JSONPCounter,done=!1;window[cbName]=function(data){return removeGlobals(),timedOut?void opts.debug('JSONP: Late answer, ignoring'):void(cbCalled=!0,clean(),cb(null,{body:data,responseText:JSON.stringify(data)}))},url+='&callback='+cbName,opts.jsonBody&&opts.jsonBody.params&&(url+='&'+opts.jsonBody.params);var ontimeout=setTimeout(function timeout(){opts.debug('JSONP: Script timeout'),timedOut=!0,clean(),cb(new errors.RequestTimeout)},opts.timeouts.complete);script.onreadystatechange=function readystatechange(){('loaded'===this.readyState||'complete'===this.readyState)&&success()},script.onload=success,script.onerror=function error(){opts.debug('JSONP: Script error');done||timedOut||(clean(),cb(new errors.JSONPScriptError))},script.async=!0,script.defer=!0,script.src=url,head.appendChild(script)};var errors=__webpack_require__(5),JSONPCounter=0},function(module){module.exports=function deprecate(fn,message){var warned=!1;return function deprecated(){return warned||(console.warn(message),warned=!0),fn.apply(this,arguments)}}},function(module){module.exports=function deprecatedMessage(previousUsage,newUsage){var githubAnchorLink=previousUsage.toLowerCase().replace(/[\.\(\)]/g,'');return'algoliasearch: `'+previousUsage+'` was replaced by `'+newUsage+'`. Please see https://github.com/algolia/algoliasearch-client-javascript/wiki/Deprecated#'+githubAnchorLink}},function(module){module.exports=function exitPromise(fn,_setTimeout){_setTimeout(fn,0)}},function(module,exports,__webpack_require__){var foreach=__webpack_require__(3);module.exports=function merge(destination){var sources=Array.prototype.slice.call(arguments);return foreach(sources,function(source){for(var keyName in source)source.hasOwnProperty(keyName)&&('object'==typeof destination[keyName]&&'object'==typeof source[keyName]?destination[keyName]=merge({},destination[keyName],source[keyName]):void 0!==source[keyName]&&(destination[keyName]=source[keyName]))}),destination}},function(module,exports,__webpack_require__){module.exports=function createPlacesClient(algoliasearch){return function places(appID,apiKey,opts){var cloneDeep=__webpack_require__(1);opts=opts&&cloneDeep(opts)||{},opts.hosts=opts.hosts||['places-dsn.algolia.net','places-1.algolianet.com','places-2.algolianet.com','places-3.algolianet.com'],(0===arguments.length||'object'==typeof appID||void 0===appID)&&(appID='',apiKey='',opts._allowEmptyCredentials=!0);var client=algoliasearch(appID,apiKey,opts),index=client.initIndex('places');return index.search=buildSearchMethod('query','/1/places/query'),index.getObject=function(objectID,callback){return this.as._jsonRequest({method:'GET',url:'/1/places/'+encodeURIComponent(objectID),hostType:'read',callback:callback})},index}};var buildSearchMethod=__webpack_require__(16)},function(module,exports,__webpack_require__){(function(global){function localStorageFailure(key,e){return debug('localStorage failed with',e),cleanup(),store=moduleStore,store.get(key)}function getOrSet(key,data){return 1===arguments.length?store.get(key):store.set(key,data)}function supportsLocalStorage(){try{return'localStorage'in global&&null!==global.localStorage&&(global.localStorage[localStorageNamespace]||global.localStorage.setItem(localStorageNamespace,JSON.stringify({})),!0)}catch(_){return!1}}function cleanup(){try{global.localStorage.removeItem(localStorageNamespace)}catch(_){}}var debug=__webpack_require__(8)('algoliasearch:src/hostIndexState.js'),localStorageNamespace='algoliasearch-client-js',moduleStore={state:{},set:function(key,data){return this.state[key]=data,this.state[key]},get:function(key){return this.state[key]||null}},store;store=supportsLocalStorage()?{set:function(key,data){moduleStore.set(key,data);try{var namespace=JSON.parse(global.localStorage[localStorageNamespace]);return namespace[key]=data,global.localStorage[localStorageNamespace]=JSON.stringify(namespace),namespace[key]}catch(e){return localStorageFailure(key,e)}},get:function(key){try{return JSON.parse(global.localStorage[localStorageNamespace])[key]||null}catch(e){return localStorageFailure(key,e)}}}:moduleStore,module.exports={get:getOrSet,set:getOrSet,supportsLocalStorage:supportsLocalStorage}}).call(exports,__webpack_require__(0))},function(module){'use strict';module.exports='3.29.0'},function(module){module.exports={vertexShader:`
    varying vec2 uvs;
    void main() {
      uvs.xy = uv.xy;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    }
  `,fragmentShader:`
    varying vec2 uvs;
    uniform sampler2D src;

    void main() {
      gl_FragColor = texture2D(src, uvs);
    }
`}},function(module){module.exports={vertexShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      vec4 p = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      worldPos = (modelMatrix * vec4( position, 1.0 )).xyz;
      gl_Position = p;
    }
  `,fragmentShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    uniform vec3 tunnelNeon;
    uniform vec3 leftLaser;
    uniform vec3 rightLaser;
    uniform vec3 floorNeon;
    uniform vec3 textGlow;
    uniform sampler2D src;

    void main() {
      float mask;
      vec4 col = texture2D(src, uvs);

      // tunnel neon
      mask = step(0.87, uvs.x) *  step(0.5, uvs.y) * (1.0 - step(0.935, uvs.x)) * ( 1.0 - step(0.75, uvs.y));
      col.xyz = mix(col.xyz, col.xyz * tunnelNeon, mask);

      // floor & corridor neons
      mask = step(0.935, uvs.x) * step(0.5, uvs.y) * ( 1.0 - step(0.75, uvs.y));
      col.xyz = mix(col.xyz, col.xyz * floorNeon, mask);

      // left laser
      mask = step(0.5, uvs.x) * (1.0 - step(0.625, uvs.x)) * (1.0 - step(0.5, uvs.y));
      col.xyz = mix(col.xyz, col.xyz * leftLaser, mask);

      // right laser
      mask = step(0.625, uvs.x) * (1.0 - step(0.75, uvs.x)) * (1.0 - step(0.5, uvs.y));
      col.xyz = mix(col.xyz, col.xyz * rightLaser, mask);

      // text glows
      mask = step(0.87, uvs.x) *  step(0.25, uvs.y) * (1.0 - step(0.935, uvs.x)) * ( 1.0 - step(0.5, uvs.y));
      col.xyz = mix(col.xyz, col.xyz * textGlow, mask);

      gl_FragColor = col;
    }
  `}},function(module){module.exports={vertexShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      vec4 p = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      worldPos = (modelMatrix * vec4( position, 1.0 )).xyz;
      gl_Position = p;
    }
  `,fragmentShader:`
    #define FOG_RADIUS  55.0
    #define FOG_FALLOFF 48.0
    #define FOG_COLOR_MULT 0.8
    varying vec2 uvs;
    varying vec3 worldPos;
    uniform vec3 skyColor;
    uniform vec3 backglowColor;
    uniform sampler2D src;

    void main() {
      vec4 col = texture2D(src, uvs);
      float mask;

      // bg
      mask = step(0.5, uvs.x);
      col.xyz = mix(col.xyz * skyColor, col.xyz, mask);

      // backglow
      mask = step(0.5, uvs.x) * step(0.5, uvs.y) * (1.0 - step(0.75, uvs.x));
      col.xyz = mix(col.xyz, col.xyz * backglowColor, mask);

      float fogDensity = 1.0 - pow(clamp(distance(worldPos, vec3(0., 0., -FOG_RADIUS)) / FOG_FALLOFF, 0.0, 1.0), 1.5);
      fogDensity += clamp(0.2 - pow(distance(worldPos, vec3(0.0, 0.0, worldPos.z)) / 10.0, 2.0), 0.0, 1.0);
      col.xyz = mix(col.xyz, backglowColor * FOG_COLOR_MULT, fogDensity);

      gl_FragColor = col;
    }
  `}},function(){AFRAME.registerComponent('active-color',{dependencies:['material'],schema:{active:{default:!1},color:{default:'#ffffff'}},init:function(){this.defaultColor=this.el.getAttribute('material').color,this.materialObj={color:this.data.color,opacity:1}},update:function(){var el=this.el;this.data.active?(el.setAttribute('material',this.materialObj),el.object3D.visible=!0):(el.setAttribute('material','color',this.defaultColor),el.components.animation__mouseleave&&setTimeout(()=>{el.emit('mouseleave',null,!1)}))}}),AFRAME.registerComponent('active-text-color',{dependencies:['text'],schema:{active:{default:!1},color:{default:'#333'}},init:function(){this.defaultColor=this.el.getAttribute('text').color},update:function(){var el=this.el;this.data.active?el.setAttribute('text','color',this.data.color):el.setAttribute('text','color',this.defaultColor)}})},function(){const NUM_VALUES_PER_BOX=90;AFRAME.registerComponent('audio-columns',{schema:{analyser:{type:'selector',default:'#audioAnalyser'},height:{default:1},mirror:{default:3},scale:{default:4},separation:{default:0.3},thickness:{default:0.1}},init:function(){var objData=document.getElementById('audiocolumnObj').data,loader=new THREE.OBJLoader,columnGeometry=loader.parse(objData).children[0].geometry;this.analyser=this.data.analyser.components.audioanalyser,this.frequencyBinCount=this.analyser.data.fftSize/2;const geometries=[];let zPosition=0;for(let i=0;i<this.frequencyBinCount;i++)for(let side=0;2>side;side++){const box=columnGeometry.clone();this.initBox(box,0===side?1:-1,zPosition),geometries.push(box),zPosition-=this.data.separation}this.geometry=THREE.BufferGeometryUtils.mergeBufferGeometries(geometries);const mesh=new THREE.Mesh(this.geometry,this.el.sceneEl.systems.materials.stageNormal);this.el.setObject3D('mesh',mesh)},tick:function(){for(let i=0,yScale;i<2*this.frequencyBinCount;i+=2){if(yScale=this.data.height/2+this.analyser.levels[Math.floor(i/2)]/256*this.data.scale,isNaN(yScale))return;this.setBoxHeight(2*this.frequencyBinCount-i-1,yScale),this.setBoxHeight(2*this.frequencyBinCount-i-2,yScale),this.geometry.attributes.position.needsUpdate=!0}},initBox:function(box,flip,zPosition){const data=this.data;for(let v=0;v<box.attributes.position.array.length;v+=3)box.attributes.position.array[v+2]+=zPosition,box.attributes.position.array[v+1]*=data.height/2,box.attributes.position.array[v]+=flip*data.mirror},setBoxHeight:function(boxNumber,height){const boxIndex=boxNumber*NUM_VALUES_PER_BOX;for(let i=boxIndex,yValue;i<boxIndex+NUM_VALUES_PER_BOX;i+=3)yValue=this.geometry.attributes.position.array[i+1],this.geometry.attributes.position.array[i+1]=0<=yValue?height:-1*height}})},function(){const ANIME=AFRAME.ANIME||AFRAME.anime;AFRAME.registerComponent('beams',{schema:{isPlaying:{default:!1},poolSize:{default:3}},init:function(){this.beams=[],this.currentRed=0,this.currentBlue=0,this.clearBeams=this.clearBeams.bind(this),this.el.sceneEl.addEventListener('cleargame',this.clearBeams)},update:function(){for(let i=0;i<this.beams.length;i++)this.beams[i].time&&(this.beams[i].visible=this.data.isPlaying)},play:function(){var loader=new THREE.OBJLoader,objData,loader,redGeometry,blueGeometry;objData=document.getElementById('redbeamObj').data,redGeometry=loader.parse(objData).children[0].geometry,objData=document.getElementById('bluebeamObj').data,blueGeometry=loader.parse(objData).children[0].geometry,this.redBeams=this.createBeamPool(redGeometry,this.el.sceneEl.systems.materials.stageAdditive),this.blueBeams=this.createBeamPool(blueGeometry,this.el.sceneEl.systems.materials.stageAdditive)},tick:function(t,dt){if(this.data.isPlaying)for(let i=0,beam;i<this.beams.length;i++)(beam=this.beams[i],!!beam.visible)&&(beam.time+=dt,beam.animation.tick(beam.time))},createBeamPool:function(geometry,material){const beams=[];for(let i=0,beam;i<this.data.poolSize;i++)beam=new THREE.Mesh(geometry,material),beam.visible=!1,beam.animation=ANIME({autoplay:!1,targets:beam.scale,x:1e-5,duration:300,easing:'easeInCubic',complete:()=>{beam.visible=!1}}),this.el.object3D.add(beam),beams.push(beam),this.beams.push(beam);return beams},newBeam:function(color,position){var beam;'red'===color?(beam=this.redBeams[this.currentRed],this.currentRed=(this.currentRed+1)%this.redBeams.length,beam.position.set(position.x,position.y,position.z+this.currentRed/50)):(beam=this.blueBeams[this.currentBlue],this.currentBlue=(this.currentBlue+1)%this.blueBeams.length,beam.position.set(position.x,position.y,position.z+this.currentBlue/50)),beam.visible=!0,beam.scale.x=1,beam.time=0},clearBeams:function(){for(let i=0;i<this.beams.length;i++)this.beams[i].visible=!1,this.beams[i].time=0,this.beams[i].scale.x=1}})},function(){var audioContext=new window.AudioContext,sourceCreatedCallback;const LAYER_BOTTOM='bottom',LAYER_TOP='top',VOLUME=0.25;THREE.Audio.prototype.play=function(){if(!0===this.isPlaying)return void console.warn('THREE.Audio: Audio is already playing.');if(!1===this.hasPlaybackControl)return void console.warn('THREE.Audio: this Audio has no playback control.');var source=this.context.createBufferSource();return source.buffer=this.buffer,source.detune.value=this.detune,source.loop=this.loop,source.onended=this.onEnded.bind(this),source.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,sourceCreatedCallback&&sourceCreatedCallback(source),source.start(this.startTime,this.offset),this.isPlaying=!0,this.source=source,this.connect()},AFRAME.registerComponent('beat-hit-sound',{directionsToSounds:{up:'',down:'',upleft:'left',upright:'right',downleft:'left',downright:'right',left:'left',right:'right'},init:function(){this.currentBeatEl=null,this.currentCutDirection='',this.processSound=this.processSound.bind(this),sourceCreatedCallback=this.sourceCreatedCallback.bind(this);for(let i=1;10>=i;i++)this.el.setAttribute(`sound__beathit${i}`,{poolSize:4,src:`#hitSound${i}`,volume:VOLUME}),this.el.setAttribute(`sound__beathit${i}left`,{poolSize:4,src:`#hitSound${i}left`,volume:VOLUME}),this.el.setAttribute(`sound__beathit${i}right`,{poolSize:4,src:`#hitSound${i}right`,volume:VOLUME})},play:function(){for(let i=1;10>=i;i++)this.el.components[`sound__beathit${i}`].loaded||(this.el.setAttribute(`sound__beathit${i}`,'src',''),this.el.setAttribute(`sound__beathit${i}`,'src',`#hitSound${i}`)),this.el.components[`sound__beathit${i}left`].loaded||(this.el.setAttribute(`sound__beathit${i}left`,'src',''),this.el.setAttribute(`sound__beathit${i}left`,'src',`#hitSound${i}left`)),this.el.components[`sound__beathit${i}right`].loaded||(this.el.setAttribute(`sound__beathit${i}right`,'src',''),this.el.setAttribute(`sound__beathit${i}right`,'src',`#hitSound${i}right`))},playSound:function(beatEl,cutDirection){const rand=1+Math.floor(10*Math.random()),dir=this.directionsToSounds[cutDirection||'up'],soundPool=this.el.components[`sound__beathit${rand}${dir}`];this.currentBeatEl=beatEl,soundPool.playSound(this.processSound)},processSound:function(audio){audio.detune=0,this.currentBeatEl.object3D.getWorldPosition(audio.position)},sourceCreatedCallback:function(source){const layer=this.getLayer(this.currentBeatEl.object3D.position.y);layer===LAYER_BOTTOM?source.detune.setValueAtTime(-400,0):layer===LAYER_TOP&&source.detune.setValueAtTime(200,0),'down'===this.currentCutDirection&&source.detune.linearRampToValueAtTime(-400,1),'up'===this.currentCutDirection&&source.detune.linearRampToValueAtTime(400,1)},getLayer:function(y){return 1===y?LAYER_BOTTOM:1.7===y?LAYER_TOP:'middle'}})},function(module,__webpack_exports__,__webpack_require__){'use strict';function lessThan(a,b){return a._time-b._time}Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0__constants_beat__=__webpack_require__(10),__WEBPACK_IMPORTED_MODULE_1__utils__=__webpack_require__(2),__WEBPACK_IMPORTED_MODULE_1__utils___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__utils__);let skipDebug=AFRAME.utils.getUrlParameter('skip')||0;skipDebug=parseInt(skipDebug,10),AFRAME.registerComponent('beat-loader',{dependencies:['stage-colors'],schema:{beatAnticipationTime:{default:1.1},beatSpeed:{default:8},beatWarmupTime:{default:__WEBPACK_IMPORTED_MODULE_0__constants_beat__.b/1e3},beatWarmupSpeed:{default:__WEBPACK_IMPORTED_MODULE_0__constants_beat__.a},challengeId:{type:'string'},difficulty:{type:'string'},isPlaying:{default:!1},menuSelectedChallengeId:{type:'string'}},orientationsHumanized:['up','down','left','right','upleft','upright','downleft','downright'],horizontalPositions:[-0.75,-0.25,0.25,0.75],horizontalPositionsHumanized:{0:'left',1:'middleleft',2:'middleright',3:'right'},positionHumanized:{topLeft:{layer:2,index:0},topCenterLeft:{layer:2,index:1},topCenterRight:{layer:2,index:2},topRight:{layer:2,index:3},middleLeft:{layer:1,index:0},middleCenterLeft:{layer:1,index:1},middleCenterRight:{layer:1,index:2},middleRight:{layer:1,index:3},bottomLeft:{layer:0,index:0},bottomCenterLeft:{layer:0,index:1},bottomCenterRight:{layer:0,index:2},bottomRight:{layer:0,index:3}},verticalPositionsHumanized:{0:'bottom',1:'middle',2:'top'},init:function(){this.audioAnalyserEl=document.getElementById('audioanalyser'),this.beatData=null,this.beatDataProcessed=!1,this.beatContainer=document.getElementById('beatContainer'),this.beatsTime=void 0,this.beatsPreloadTime=0,this.beatsPreloadTimeTotal=1e3*(this.data.beatAnticipationTime+this.data.beatWarmupTime),this.bpm=void 0,this.xhr=null,this.stageColors=this.el.components['stage-colors'],this.swordOffset=1.5,this.twister=document.getElementById('twister'),this.leftStageLasers=document.getElementById('leftStageLasers'),this.rightStageLasers=document.getElementById('rightStageLasers'),this.el.addEventListener('cleargame',this.clearBeats.bind(this))},update:function(oldData){const data=this.data;return!oldData.challengeId&&data.challengeId&&this.beatData?void this.processBeats():void(!data.menuSelectedChallengeId||!data.difficulty||(data.menuSelectedChallengeId!==oldData.menuSelectedChallengeId||data.difficulty!==oldData.difficulty)&&this.fetchBeats())},fetchBeats:function(){var el=this.el;this.xhr&&this.xhr.abort();let url=__WEBPACK_IMPORTED_MODULE_1__utils___default.a.getS3FileUrl(this.data.menuSelectedChallengeId,`${this.data.difficulty}.json`);const xhr=this.xhr=new XMLHttpRequest;el.emit('beatloaderstart'),console.log(`[beat-loader] Fetching ${url}...`),xhr.open('GET',url),xhr.addEventListener('load',()=>{this.beatData=JSON.parse(xhr.responseText),this.beatDataProcessed=!1,this.xhr=null,this.el.sceneEl.emit('beatloaderfinish',null,!1)}),xhr.send()},processBeats:function(){this.beatsTime=0,this.beatsPreloadTime=0,this.beatData._events.sort(lessThan),this.beatData._obstacles.sort(lessThan),this.beatData._notes.sort(lessThan),this.bpm=this.beatData._beatsPerMinute;const events=this.beatData._events;if(events.length&&0>events[0]._time)for(let i=0;0>events[i]._time;i++)this.generateEvent(events[i]);this.beatDataProcessed=!0,console.log('[beat-loader] Finished processing beat data.')},tick:function(time,delta){if(this.data.isPlaying&&this.data.challengeId&&this.beatData){const prevBeatsTime=this.beatsTime+skipDebug;if(void 0===this.beatsPreloadTime){const song=this.el.components.song;if(!song.isPlaying)return;this.beatsTime=1e3*(song.getCurrentTime()+this.data.beatAnticipationTime+this.data.beatWarmupTime)}else this.beatsTime=this.beatsPreloadTime;const beatsTime=this.beatsTime+skipDebug,bpm=this.beatData._beatsPerMinute,msPerBeat=1e3*60/this.beatData._beatsPerMinute,notes=this.beatData._notes;for(let i=0,noteTime;i<notes.length;++i)noteTime=notes[i]._time*msPerBeat,noteTime>prevBeatsTime&&noteTime<=beatsTime&&(notes[i].time=noteTime,this.generateBeat(notes[i]));const obstacles=this.beatData._obstacles;for(let i=0,noteTime;i<obstacles.length;++i)noteTime=obstacles[i]._time*msPerBeat,noteTime>prevBeatsTime&&noteTime<=beatsTime&&this.generateWall(obstacles[i]);const events=this.beatData._events;for(let i=0,noteTime;i<events.length;++i)noteTime=events[i]._time*msPerBeat,noteTime>prevBeatsTime&&noteTime<=beatsTime&&this.generateEvent(events[i]);void 0===this.beatsPreloadTime||(this.beatsPreloadTime>=this.beatsPreloadTimeTotal?(this.el.sceneEl.emit('beatloaderpreloadfinish',null,!1),this.beatsPreloadTime=void 0):this.beatsPreloadTime+=delta)}},generateBeat:function(){const beatObj={};return function(noteInfo){const data=this.data;let type=8===noteInfo._cutDirection?'dot':'arrow',color;0===noteInfo._type?color='red':1===noteInfo._type?color='blue':(type='mine',color=void 0);const beatEl=this.requestBeat(type,color);beatEl&&(beatObj.anticipationPosition=-data.beatAnticipationTime*data.beatSpeed-this.swordOffset,beatObj.color=color,beatObj.cutDirection=this.orientationsHumanized[noteInfo._cutDirection],beatObj.horizontalPosition=this.horizontalPositionsHumanized[noteInfo._lineIndex],beatObj.speed=this.data.beatSpeed,beatObj.type=type,beatObj.verticalPosition=this.verticalPositionsHumanized[noteInfo._lineLayer],beatObj.warmupPosition=-data.beatWarmupTime*data.beatWarmupSpeed,beatEl.setAttribute('beat',beatObj),beatEl.components.beat.updatePosition(),beatEl.play(),beatEl.components.beat.onGenerate())}}(),generateWall:function(){const wallObj={};return function(wallInfo){const el=this.el.sceneEl.components.pool__wall.requestEntity();if(el){const data=this.data,speed=this.data.beatSpeed,durationSeconds=60*(wallInfo._duration/this.bpm);wallObj.anticipationPosition=-data.beatAnticipationTime*data.beatSpeed-this.swordOffset,wallObj.durationSeconds=durationSeconds,wallObj.horizontalPosition=this.horizontalPositionsHumanized[wallInfo._lineIndex],wallObj.isCeiling=1===wallInfo._type,wallObj.speed=speed,wallObj.warmupPosition=-data.beatWarmupTime*data.beatWarmupSpeed,wallObj.width=wallInfo._width,el.setAttribute('wall',wallObj),el.play()}}}(),generateEvent:function(event){switch(event._type){case 0:this.stageColors.setColor('bg',event._value);break;case 1:this.stageColors.setColor('tunnel',event._value);break;case 2:this.stageColors.setColor('leftlaser',event._value);break;case 3:this.stageColors.setColor('rightlaser',event._value);break;case 4:this.stageColors.setColor('floor',event._value);break;case 8:this.twister.components.twister.pulse(event._value);break;case 9:this.twister.components.twister.pulse(event._value);break;case 12:this.leftStageLasers.components['stage-lasers'].pulse(event._value);break;case 13:this.rightStageLasers.components['stage-lasers'].pulse(event._value);}},requestBeat:function(type,color){var beatPoolName='pool__beat-'+type,pool;return color&&(beatPoolName+='-'+color),pool=this.el.sceneEl.components[beatPoolName],pool?pool.requestEntity():void console.warn('Pool '+beatPoolName+' unavailable')},clearBeats:function(){this.beatsPreloadTime=0,this.beatsTime=0;for(let i=0,child;i<this.beatContainer.children.length;i++)child=this.beatContainer.children[i],child.components.beat&&child.components.beat.returnToPool(!0),child.components.wall&&child.components.wall.returnToPool(!0)}})},function(module,__webpack_exports__,__webpack_require__){'use strict';function getGravityVelocity(velocity,timeDelta){return velocity+-9.8*(timeDelta/1e3)}var _MathPI2=Math.PI,_Mathmax4=Math.max;Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0__constants_beat__=__webpack_require__(10);const COLORS=__webpack_require__(7),auxObj3D=new THREE.Object3D,BEAT_WARMUP_ROTATION_TIME=750,DESTROYED_SPEED=1,ONCE={once:!0},SCORE_POOL={OK:'pool__beatscoreok',GOOD:'pool__beatscoregood',GREAT:'pool__beatscoregreat',SUPER:'pool__beatscoresuper'};AFRAME.registerComponent('beat',{schema:{anticipationPosition:{default:0},color:{default:'red',oneOf:['red','blue']},cutDirection:{default:'down'},debug:{default:!1},horizontalPosition:{default:'middleleft',oneOf:['left','middleleft','middleright','right']},size:{default:0.4},speed:{default:8},type:{default:'arrow',oneOf:['arrow','dot','mine']},verticalPosition:{default:'middle',oneOf:['bottom','middle','top']},warmupPosition:{default:0}},materialColor:{blue:COLORS.BEAT_BLUE,red:COLORS.BEAT_RED},cutColor:{blue:'#fff',red:'#fff'},models:{arrow:'beatObjTemplate',dot:'beatObjTemplate',mine:'mineObjTemplate'},signModels:{arrowred:'arrowRedObjTemplate',arrowblue:'arrowBlueObjTemplate',dotred:'dotRedObjTemplate',dotblue:'dotBlueObjTemplate'},orientations:[180,0,270,90,225,135,315,45,0],rotations:{up:180,down:0,left:270,right:90,upleft:225,upright:135,downleft:315,downright:45},horizontalPositions:{left:-0.75,middleleft:-0.25,middleright:0.25,right:0.75},verticalPositions:{bottom:0.7,middle:1.2,top:1.7},init:function(){this.backToPool=!1,this.beams=document.getElementById('beams').components.beams,this.beatBoundingBox=new THREE.Box3,this.currentRotationWarmupTime=0,this.cutDirection=new THREE.Vector3,this.destroyed=!1,this.gravityVelocity=0,this.hitEventDetail={},this.hitBoundingBox=new THREE.Box3,this.poolName=void 0,this.returnToPoolTimer=800,this.rotationAxis=new THREE.Vector3,this.saberEls=this.el.sceneEl.querySelectorAll('[saber-controls]'),this.scoreEl=null,this.scoreElTime=void 0,this.startPositionZ=void 0,this.rightCutPlanePoints=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.leftCutPlanePoints=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.mineParticles=document.getElementById('mineParticles'),this.wrongElLeft=document.getElementById('wrongLeft'),this.wrongElRight=document.getElementById('wrongRight'),this.missElLeft=document.getElementById('missLeft'),this.missElRight=document.getElementById('missRight'),this.particles=document.getElementById('saberParticles'),this.mineParticles=document.getElementById('mineParticles'),this.superCuts=document.querySelectorAll('.superCutFx'),this.superCutIdx=0,this.explodeEventDetail={position:null,rotation:null},this.saberColors={right:'blue',left:'red'},this.onEndStroke=this.onEndStroke.bind(this),this.initBlock(),'mine'===this.data.type?this.initMineFragments():this.initFragments()},updatePosition:function(){const el=this.el,data=this.data;el.object3D.position.set(this.horizontalPositions[data.horizontalPosition],this.verticalPositions[data.verticalPosition],data.anticipationPosition+data.warmupPosition),el.object3D.rotation.z=THREE.Math.degToRad(this.rotations[data.cutDirection])},update:function(){this.updatePosition(),this.updateBlock(),this.updateFragments(),this.poolName='mine'===this.data.type?`pool__beat-mine`:`pool__beat-${this.data.type}-${this.data.color}`},pause:function(){this.el.object3D.visible=!1,'mine'!==this.data.type&&(this.partLeftEl.object3D.visible=!1,this.partRightEl.object3D.visible=!1)},play:function(){this.blockEl.object3D.visible=!0,this.destroyed=!1,this.el.object3D.visible=!0},tock:function(time,timeDelta){const el=this.el,data=this.data,position=el.object3D.position,rotation=el.object3D.rotation;if(this.destroyed)this.tockDestroyed(timeDelta);else{if(position.z>-1.65&&this.checkCollisions(),position.z<data.anticipationPosition){let newPositionZ=position.z+__WEBPACK_IMPORTED_MODULE_0__constants_beat__.a*(timeDelta/1e3);newPositionZ<data.anticipationPosition?position.z=newPositionZ:(position.z=data.anticipationPosition,this.beams.newBeam(this.data.color,position))}else position.z+=this.data.speed*(timeDelta/1e3),rotation.z=this.startRotationZ;if(position.z>data.anticipationPosition-0.4&&this.currentRotationWarmupTime<BEAT_WARMUP_ROTATION_TIME){const progress=AFRAME.ANIME.easings.easeOutBack(this.currentRotationWarmupTime/BEAT_WARMUP_ROTATION_TIME);el.object3D.rotation.z=this.rotationZStart+progress*this.rotationZChange,this.currentRotationWarmupTime+=timeDelta}this.backToPool=2<=position.z,this.backToPool&&this.missHit()}this.returnToPool()},onGenerate:function(){this.startRotationZ=this.el.object3D.rotation.z,this.currentRotationWarmupTime=0,this.rotationZChange=_MathPI2/5,0.5<Math.random&&(this.rotationZChange*=-1),this.el.object3D.rotation.z-=this.rotationZChange,this.rotationZStart=this.el.object3D.rotation.z,'mine'==this.data.type&&this.resetMineFragments()},initBlock:function(){var el=this.el,blockEl=this.blockEl=document.createElement('a-entity'),signEl=this.signEl=document.createElement('a-entity');blockEl.setAttribute('mixin','beatBlock'),blockEl.setAttribute('mixin','beatSign'),signEl.object3D.position.z+=0.02,blockEl.appendChild(signEl),el.appendChild(blockEl)},updateBlock:function(){const blockEl=this.blockEl,signEl=this.signEl;if(blockEl)if(blockEl.setAttribute('material',{metalness:0.7,roughness:0.1,sphericalEnvMap:'#envmapTexture',emissive:this.materialColor[this.data.color],emissiveIntensity:0.05,color:this.materialColor[this.data.color]}),this.setObjModelFromTemplate(blockEl,this.models[this.data.type]),blockEl.object3D.scale.set(1,1,1),blockEl.object3D.scale.multiplyScalar(3.45).multiplyScalar(this.data.size),'mine'===this.data.type){const model=blockEl.getObject3D('mesh');model?model.material=this.el.sceneEl.systems.materials['mineMaterial'+this.data.color]:blockEl.addEventListener('model-loaded',()=>{model.material=this.el.sceneEl.systems.materials['mineMaterial'+this.data.color]},ONCE)}else signEl.setAttribute('materials',{name:'stageAdditive'}),this.setObjModelFromTemplate(signEl,this.signModels[this.data.type+this.data.color])},initFragments:function(){var cutEl,partEl;partEl=this.partLeftEl=document.createElement('a-entity'),cutEl=this.cutLeftEl=document.createElement('a-entity'),partEl.appendChild(cutEl),this.el.appendChild(partEl),partEl=this.partRightEl=document.createElement('a-entity'),cutEl=this.cutRightEl=document.createElement('a-entity'),partEl.appendChild(cutEl),this.el.appendChild(partEl),this.initCuttingClippingPlanes()},initMineFragments:function(){var fragments=this.el.sceneEl.systems['mine-fragments-loader'].fragments.children,material=this.el.sceneEl.systems.materials['mineMaterial'+this.data.color],fragment;this.randVec=new THREE.Vector3(Math.random()*_MathPI2,Math.random()*_MathPI2,Math.random()*_MathPI2),this.mineFragments=[],this.mineBroken=document.createElement('a-entity'),this.el.appendChild(this.mineBroken);for(var i=0;i<fragments.length;i++)fragment=new THREE.Mesh(fragments[i].geometry,material),fragment.speed=new THREE.Vector3,fragment.speed.set(Math.random()-0.5,Math.random()-0.5,Math.random()-0.5),this.mineFragments.push(fragment),this.mineBroken.object3D.add(fragment)},updateFragments:function(){var cutLeftEl=this.cutLeftEl,cutRightEl=this.cutRightEl,partLeftEl=this.partLeftEl,partRightEl=this.partRightEl;return partLeftEl?'mine'===this.data.type?void this.resetMineFragments():void(partLeftEl.setAttribute('material',{metalness:0.7,roughness:0.1,sphericalEnvMap:'#envmapTexture',emissive:this.materialColor[this.data.color],emissiveIntensity:0.05,color:this.materialColor[this.data.color],side:'double'}),this.setObjModelFromTemplate(partLeftEl,this.models.dot),partLeftEl.object3D.visible=!1,cutLeftEl.setAttribute('material',{shader:'flat',color:this.data.cutColor,side:'double'}),this.setObjModelFromTemplate(cutLeftEl,this.models.dot),partRightEl.setAttribute('material',{metalness:0.7,roughness:0.1,sphericalEnvMap:'#envmapTexture',emissive:this.materialColor[this.data.color],emissiveIntensity:0.05,color:this.materialColor[this.data.color],side:'double'}),this.setObjModelFromTemplate(partRightEl,this.models.dot),partRightEl.object3D.visible=!1,cutRightEl.setAttribute('material',{shader:'flat',color:this.data.cutColor,side:'double'}),this.setObjModelFromTemplate(cutRightEl,this.models.dot)):void 0},resetMineFragments:function(){if('mine'===this.data.type)for(let i=0,fragment;i<this.mineFragments.length;i++)fragment=this.mineFragments[i],fragment.visible=!1,fragment.position.set(0,0,0),fragment.scale.set(1,1,1),fragment.speed.set(5*Math.random()-2.5,5*Math.random()-2.5,5*Math.random()-2.5)},wrongHit:function(hand){var wrongEl='left'===hand?this.wrongElLeft:this.wrongElRight;wrongEl&&(wrongEl.object3D.position.copy(this.el.object3D.position),wrongEl.object3D.position.y+=0.2,wrongEl.object3D.position.z-=0.5,wrongEl.object3D.visible=!0,wrongEl.emit('beatwrong',null,!0),this.destroyed=!0)},missHit:function(hand){var missEl='left'===hand?this.missElLeft:this.missElRight;missEl&&'mine'!==this.data.type&&(missEl.object3D.position.copy(this.el.object3D.position),missEl.object3D.position.y+=0.2,missEl.object3D.position.z-=0.5,missEl.object3D.visible=!0,missEl.emit('beatmiss',null,!0),AFRAME.utils.getUrlParameter('synctest')&&console.log(this.el.sceneEl.components.song.getCurrentTime()))},destroyBeat:function(){var parallelPlaneMaterial=new THREE.MeshBasicMaterial({color:'#00008b',side:THREE.DoubleSide}),planeMaterial=new THREE.MeshBasicMaterial({color:'grey',side:THREE.DoubleSide}),point1=new THREE.Vector3,point2=new THREE.Vector3,point3=new THREE.Vector3;return function(saberEl){var cutThickness=this.cutThickness=0.02,direction=this.cutDirection,leftBorderInnerPlane=this.leftBorderInnerPlane,leftBorderOuterPlane=this.leftBorderOuterPlane,leftCutPlane=this.leftCutPlane,rightBorderInnerPlane=this.rightBorderInnerPlane,rightBorderOuterPlane=this.rightBorderOuterPlane,rightCutPlane=this.rightCutPlane,trailPoints=saberEl.components.trail.saberTrajectory,coplanarPoint,planeGeometry,planeMesh;if(point1.copy(trailPoints[0].top),point2.copy(trailPoints[0].center),point3.copy(trailPoints[trailPoints.length-1].top),direction.copy(point1).sub(point3),this.partRightEl.object3D.position.set(0,0,0),this.partRightEl.object3D.rotation.set(0,0,0),this.partRightEl.object3D.updateMatrixWorld(),this.partRightEl.object3D.worldToLocal(this.rightCutPlanePoints[0].copy(point1)),this.partRightEl.object3D.worldToLocal(this.rightCutPlanePoints[1].copy(point2)),this.partRightEl.object3D.worldToLocal(this.rightCutPlanePoints[2].copy(point3)),this.partLeftEl.object3D.position.set(0,0,0),this.partLeftEl.object3D.rotation.set(0,0,0),this.partLeftEl.object3D.updateMatrixWorld(),this.partLeftEl.object3D.worldToLocal(this.leftCutPlanePoints[0].copy(point3)),this.partLeftEl.object3D.worldToLocal(this.leftCutPlanePoints[1].copy(point2)),this.partLeftEl.object3D.worldToLocal(this.leftCutPlanePoints[2].copy(point1)),this.generateCutClippingPlanes(),this.data.debug){coplanarPoint=new THREE.Vector3,planeGeometry=new THREE.PlaneGeometry(4,4,1,1),rightCutPlane.coplanarPoint(coplanarPoint),planeGeometry.lookAt(rightCutPlane.normal),planeGeometry.translate(coplanarPoint.x,coplanarPoint.y,coplanarPoint.z),planeMesh=new THREE.Mesh(planeGeometry,planeMaterial),this.el.sceneEl.setObject3D('rightCutPlane',planeMesh),planeGeometry=new THREE.PlaneGeometry(4,4,1,1),rightBorderOuterPlane.coplanarPoint(coplanarPoint),planeGeometry.lookAt(rightBorderOuterPlane.normal),planeGeometry.translate(coplanarPoint.x,coplanarPoint.y,coplanarPoint.z);const parallelPlaneMesh=new THREE.Mesh(planeGeometry,parallelPlaneMaterial);this.el.sceneEl.setObject3D('planeParallel',parallelPlaneMesh)}this.blockEl.object3D.visible=!1;const partRightMaterial=this.partRightEl.getObject3D('mesh').material;partRightMaterial.clippingPlanes=partRightMaterial.clippingPlanes||[],partRightMaterial.clippingPlanes.length=0,partRightMaterial.clippingPlanes.push(rightCutPlane);const cutRightMaterial=this.cutRightEl.getObject3D('mesh').material;cutRightMaterial.clippingPlanes=cutRightMaterial.clippingPlanes||[],cutRightMaterial.clippingPlanes.length=0,cutRightMaterial.clippingPlanes.push(rightBorderOuterPlane),cutRightMaterial.clippingPlanes.push(rightBorderInnerPlane);const partLeftMaterial=this.partLeftEl.getObject3D('mesh').material;partLeftMaterial.clippingPlanes=partLeftMaterial.clippingPlanes||[],partLeftMaterial.clippingPlanes.length=0,partLeftMaterial.clippingPlanes.push(leftCutPlane);const cutLeftMaterial=this.cutLeftEl.getObject3D('mesh').material;cutLeftMaterial.clippingPlanes=cutLeftMaterial.clippingPlanes||[],cutLeftMaterial.clippingPlanes.length=0,cutLeftMaterial.clippingPlanes.push(leftBorderInnerPlane),cutLeftMaterial.clippingPlanes.push(leftBorderOuterPlane),this.partLeftEl.object3D.visible=!0,this.partRightEl.object3D.visible=!0,this.el.sceneEl.renderer.localClippingEnabled=!0,this.destroyed=!0,this.gravityVelocity=0.1,this.rotationAxis.copy(this.rightCutPlanePoints[0]).sub(this.rightCutPlanePoints[1]),this.returnToPoolTimer=800,auxObj3D.up.copy(rightCutPlane.normal),auxObj3D.lookAt(direction),this.explodeEventDetail.position=this.el.object3D.position,this.explodeEventDetail.rotation=auxObj3D.rotation,this.particles.emit('explode',this.explodeEventDetail,!1)}}(),destroyMine:function(){for(let i=0;i<this.mineFragments.length;i++)this.mineFragments[i].visible=!0;this.blockEl.object3D.visible=!1,this.destroyed=!0,this.gravityVelocity=0.1,this.returnToPoolTimer=800,this.explodeEventDetail.position=this.el.object3D.position,this.explodeEventDetail.rotation=this.randVec,this.mineParticles.emit('explode',this.explodeEventDetail,!1)},initCuttingClippingPlanes:function(){this.leftCutPlanePointsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.rightCutPlanePointsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.rightCutPlane=new THREE.Plane,this.rightBorderOuterPlane=new THREE.Plane,this.rightBorderInnerPlane=new THREE.Plane,this.leftCutPlane=new THREE.Plane,this.leftBorderOuterPlane=new THREE.Plane,this.leftBorderInnerPlane=new THREE.Plane},generateCutClippingPlanes:function(){var leftBorderInnerPlane=this.leftBorderInnerPlane,leftBorderOuterPlane=this.leftBorderOuterPlane,leftCutPlane=this.leftCutPlane,leftCutPlanePointsWorld=this.leftCutPlanePointsWorld,partLeftEl=this.partLeftEl,partRightEl=this.partRightEl,rightBorderInnerPlane=this.rightBorderInnerPlane,rightBorderOuterPlane=this.rightBorderOuterPlane,rightCutPlane=this.rightCutPlane,rightCutPlanePointsWorld=this.rightCutPlanePointsWorld;partRightEl.object3D.updateMatrixWorld(),partRightEl.object3D.localToWorld(rightCutPlanePointsWorld[0].copy(this.rightCutPlanePoints[0])),partRightEl.object3D.localToWorld(rightCutPlanePointsWorld[1].copy(this.rightCutPlanePoints[1])),partRightEl.object3D.localToWorld(rightCutPlanePointsWorld[2].copy(this.rightCutPlanePoints[2])),partLeftEl.object3D.updateMatrixWorld(),partLeftEl.object3D.localToWorld(leftCutPlanePointsWorld[0].copy(this.leftCutPlanePoints[0])),partLeftEl.object3D.localToWorld(leftCutPlanePointsWorld[1].copy(this.leftCutPlanePoints[1])),partLeftEl.object3D.localToWorld(leftCutPlanePointsWorld[2].copy(this.leftCutPlanePoints[2])),rightCutPlane.setFromCoplanarPoints(rightCutPlanePointsWorld[0],rightCutPlanePointsWorld[1],rightCutPlanePointsWorld[2]),rightBorderOuterPlane.set(rightCutPlane.normal,rightCutPlane.constant+this.cutThickness),leftCutPlane.setFromCoplanarPoints(leftCutPlanePointsWorld[0],leftCutPlanePointsWorld[1],leftCutPlanePointsWorld[2]),leftBorderOuterPlane.set(leftCutPlane.normal,leftCutPlane.constant+this.cutThickness),rightBorderInnerPlane.setFromCoplanarPoints(rightCutPlanePointsWorld[2],rightCutPlanePointsWorld[1],rightCutPlanePointsWorld[0]),leftBorderInnerPlane.setFromCoplanarPoints(leftCutPlanePointsWorld[2],leftCutPlanePointsWorld[1],leftCutPlanePointsWorld[0])},returnToPool:function(force){(this.backToPool||force)&&this.el.sceneEl.components[this.poolName].returnEntity(this.el)},checkCollisions:function(){const cutDirection=this.data.cutDirection,saberColors=this.saberColors,saberEls=this.saberEls,hitBoundingBox=this.hitColliderEl&&this.hitBoundingBox.setFromObject(this.hitColliderEl.getObject3D('mesh')),beatBoundingBox=this.beatBoundingBox.setFromObject(this.blockEl.getObject3D('mesh'));var wrongHandHit;for(let i=0;i<saberEls.length;i++){let saberBoundingBox=saberEls[i].components['saber-controls'].boundingBox,saberControls,maxAngle;if(!saberBoundingBox)break;const hand=saberEls[i].getAttribute('saber-controls').hand;if(saberBoundingBox.intersectsBox(beatBoundingBox)){if(this.el.emit(`beatcollide${hand}`,null,!0),this.el.parentNode.components['beat-hit-sound'].playSound(this.el),'mine'===this.data.type){this.el.emit('minehit',null,!0),this.destroyMine();break}if(this.destroyBeat(saberEls[i]),saberEls[i].components['saber-controls'].swinging&&this.data.color===saberColors[hand]){if(this.hitSaberEl=saberEls[i],this.hitSaberEl.addEventListener('strokeend',this.onEndStroke,ONCE),saberControls=saberEls[i].components['saber-controls'],this.hitHand=hand,saberControls.maxAnglePlaneX=0,saberControls.maxAnglePlaneY=0,saberControls.maxAnglePlaneXY=0,'arrow'===this.data.type){if(saberControls.updateStrokeDirection(),!saberControls.strokeDirection[this.data.cutDirection]){this.wrongHit(hand);break}maxAngle='up'===cutDirection||'down'===cutDirection?saberControls.maxAnglePlaneX:'left'===cutDirection||'right'===cutDirection?saberControls.maxAnglePlaneY:saberControls.maxAnglePlaneXY}else maxAngle=_Mathmax4(saberControls.maxAnglePlaneX,saberControls.maxAnglePlaneY,saberControls.maxAnglePlaneXY);wrongHandHit=void 0,this.angleBeforeHit=maxAngle}else wrongHandHit=hand;break}wrongHandHit&&this.wrongHit(wrongHandHit)}},onEndStroke:function(){var cutDirection=this.data.cutDirection,hitEventDetail=this.hitEventDetail,saberControls=this.hitSaberEl.components['saber-controls'],maxAngle;const saberRotation=3.14/12;maxAngle='up'===cutDirection||'down'===cutDirection?saberControls.maxAnglePlaneX:'left'===cutDirection||'right'===cutDirection?saberControls.maxAnglePlaneY:saberControls.maxAnglePlaneXY;const angleBeforeHit=_Mathmax4(0,180*(this.angleBeforeHit-saberRotation)/_MathPI2),angleAfterHit=_Mathmax4(0,180*(maxAngle-saberRotation)/_MathPI2);let score=0;score+=85<=angleBeforeHit?70:70*(angleBeforeHit/80),score+=60<=angleAfterHit?30:30*(angleAfterHit/60),hitEventDetail.score=score,this.el.emit('beathit',hitEventDetail,!0),this.el.sceneEl.emit('textglowbold',null,!1);let beatScorePool;60>score?beatScorePool=SCORE_POOL.OK:80>score?beatScorePool=SCORE_POOL.GOOD:100>score?beatScorePool=SCORE_POOL.GREAT:(beatScorePool=SCORE_POOL.SUPER,this.superCuts[this.superCutIdx].components.supercutfx.createSuperCut(this.el.object3D.position),this.superCutIdx=(this.superCutIdx+1)%this.superCuts.length);const scoreEl=this.el.sceneEl.components[beatScorePool].requestEntity();scoreEl&&(scoreEl.object3D.position.copy(this.el.object3D.position),scoreEl.play(),scoreEl.emit('beatscorestart',null,!1))},tockDestroyed:function(){var leftCutNormal=new THREE.Vector3,leftRotation=0,rightCutNormal=new THREE.Vector3,rightRotation=0,rotationStep=2*_MathPI2/150,fragment;return function(timeDelta){if(this.gravityVelocity=getGravityVelocity(this.gravityVelocity,timeDelta),this.el.object3D.position.y+=this.gravityVelocity*(timeDelta/1e3),'mine'==this.data.type){for(var i=0;i<this.mineFragments.length;i++)(fragment=this.mineFragments[i],!!fragment.visible)&&(fragment.position.addScaledVector(fragment.speed,timeDelta/1e3),fragment.scale.multiplyScalar(0.97),0.1>fragment.scale.y&&(fragment.visible=!1));return}rightCutNormal.copy(this.rightCutPlane.normal).multiplyScalar(DESTROYED_SPEED*(timeDelta/500)),rightCutNormal.y=0,this.partRightEl.object3D.position.add(rightCutNormal),this.partRightEl.object3D.setRotationFromAxisAngle(this.rotationAxis,rightRotation),rightRotation=rightRotation>=2*_MathPI2?0:rightRotation+rotationStep,leftCutNormal.copy(this.leftCutPlane.normal).multiplyScalar(DESTROYED_SPEED*(timeDelta/500)),leftCutNormal.y=0,this.partLeftEl.object3D.position.add(leftCutNormal),this.partLeftEl.object3D.setRotationFromAxisAngle(this.rotationAxis,leftRotation),leftRotation=leftRotation>=2*_MathPI2?0:leftRotation+rotationStep,this.generateCutClippingPlanes(),this.returnToPoolTimer-=timeDelta,this.backToPool=0>=this.returnToPoolTimer}}(),setObjModelFromTemplate:function(){const geometries={};return function(el,templateId){if(!geometries[templateId]){const templateEl=document.getElementById(templateId);if(templateEl.getObject3D('mesh'))geometries[templateId]=templateEl.getObject3D('mesh').children[0].geometry;else return void templateEl.addEventListener('model-loaded',()=>{geometries[templateId]=templateEl.getObject3D('mesh').children[0].geometry,this.setObjModelFromTemplate(el,templateId)})}el.getObject3D('mesh')||el.setObject3D('mesh',new THREE.Mesh),el.getObject3D('mesh').geometry=geometries[templateId]}}()})},function(){AFRAME.registerComponent('console-shortcuts',{play:function(){window.$=val=>document.querySelector(val),window.$$=val=>document.querySelectorAll(val),window.$$$=val=>document.querySelector(`[${val}]`).getAttribute(val),window.$$$$=val=>document.querySelector(`[${val}]`).components[val],window.scene=this.el,window.state=this.el.systems.state.state}})},function(){AFRAME.registerComponent('copy-texture',{dependencies:['geometry','material'],schema:{from:{type:'selector'}},init:function(){const data=this.data;data.from.addEventListener('materialtextureloaded',()=>{this.copyTexture()}),this.copyTexture()},copyTexture:function(){const el=this.el,target=this.data.from,material=el.getObject3D('mesh').material;target.getObject3D('mesh')&&(material.map=target.getObject3D('mesh').material.map,material.map&&(material.map.needsUpdate=!0,material.needsUpdate=!0))}})},function(){AFRAME.registerComponent('cursor-laser',{dependencies:['geometry'],schema:{enabled:{default:!0}},init:function(){const el=this.el;this.saberEl=this.el.closest('.saber');const geometry=this.el.getAttribute('geometry');el.object3D.position.z=-1*geometry.height/2,this.originalSize=geometry.height,this.currentLength=geometry.height},update:function(){this.el.object3D.visible=this.data.enabled},tick:function(){const el=this.el;if(this.data.enabled){const cursor=this.saberEl.components.cursor;if(cursor){const intersectedEl=cursor.intersectedEl;if(!intersectedEl)return el.object3D.position.z=-25,el.object3D.scale.x=0.75,el.getObject3D('mesh').scale.y=50,void(this.currentLength=1);const intersection=this.saberEl.components.raycaster.intersections[0];intersection&&(el.object3D.scale.x=1,el.object3D.position.z=-intersection.distance/2,el.getObject3D('mesh').scale.y=this.currentLength=intersection.distance)}}}})},function(){AFRAME.registerComponent('cursor-mesh',{schema:{active:{default:!0},cursorEl:{type:'selector'}},init:function(){this.scenePivotEl=document.getElementById('scenePivot')},update:function(){this.el.object3D.visible=this.data.active},tick:function(){var cursorEl=this.data.cursorEl,el=this.el,scenePivotEl=this.scenePivotEl,cursor,intersection,intersectedEl;if(this.data.active&&(cursor=cursorEl.components.cursor,!!cursor)){if(intersectedEl=cursorEl.components.cursor.intersectedEl,intersectedEl)el.object3D.visible=!0;else return void(el.object3D.visible=!1);intersection=cursorEl.components.raycaster.getIntersection(intersectedEl),intersection&&(el.object3D.position.copy(intersection.point),scenePivotEl&&el.object3D.rotation.copy(scenePivotEl.object3D.rotation))}}})},function(){AFRAME.registerComponent('debug-beat-loader',{dependencies:['beat-loader'],schema:{beatEnabled:{default:!1},stageEnabled:{default:!1}},init:function(){this.beatLoader=this.el.components['beat-loader'],this.selectedBeat={color:'red',position:'middleCenterLeft',type:'arrow',orientation:'up'},this.beats={},this.onKeyDown=this.onKeyDown.bind(this),(this.data.stageEnabled||AFRAME.utils.getUrlParameter('debugstage'))&&this.addDebugStageControls(),(this.data.beatEnabled||'gameplay'===AFRAME.utils.getUrlParameter('debugstate').trim())&&(window.addEventListener('keydown',this.onKeyDown),this.addDebugBeatControls())},spawn:function(){var self=this;Object.keys(this.beats).forEach(function(key){self.generateBeat(self.beats[key])})},generateBeat:function(beatInfo){var type;return'wall'===beatInfo.type?void this.generateWall(beatInfo):void(type='mine'===beatInfo.type?3:'red'===beatInfo.color?0:1,this.beatLoader.generateBeat({_lineIndex:this.beatLoader.positionHumanized[beatInfo.position].index,_lineLayer:this.beatLoader.positionHumanized[beatInfo.position].layer,_cutDirection:'dot'===beatInfo.type?8:this.beatLoader.orientationsHumanized.indexOf(beatInfo.orientation),_type:type}))},generateWall:function(wallInfo){this.beatLoader.bpm=90,this.beatLoader.generateWall({_lineIndex:this.beatLoader.positionHumanized[wallInfo.position].index,_width:1,_duration:3})},onKeyDown:function(event){const keyCode=event.keyCode;switch(keyCode){case 32:{this.spawn();break}}},addDebugBeatControls:function(){function addMenu(name){const menuDiv=document.createElement('div');return menuDiv.id=name,menuDiv.style.marginBottom='20px',menuDiv.style.width='500px',menuDiv.style.display='inline-block',parentDiv.appendChild(menuDiv),menuDiv}function addButton(text,containerEl,clickHandler){const div=document.createElement('div');return div.classList.add('button'),div.id=text,div.style.width='100px',div.style.height='30px',div.style.background='#000',div.style.color='#fff',div.style.zIndex=999999999,div.style.padding='5px',div.style.margin='5px',div.style.font='14px sans-serif',div.style.textAlign='center',div.style.lineHeight='30px',div.style.cursor='pointer',div.style.display='inline-block',div.innerHTML=text,containerEl.appendChild(div),div.addEventListener('click',clickHandler||function onClick(){const buttons=div.parentElement.querySelectorAll('.button');for(let i=0;i<buttons.length;i++)buttons[i].style.background='#000';div.style.background='#66f',self.selectedBeat[div.parentElement.id]=this.id,self['selected'+div.parentElement.id.charAt(0).toUpperCase()+div.parentElement.id.slice(1)+'El']=this}),div}const parentDiv=document.createElement('div'),self=this;parentDiv.style.position='absolute',parentDiv.style.right='0',parentDiv.style.top='0',parentDiv.style.padding='10px',parentDiv.style.width='500px',parentDiv.style.height='600px',document.body.appendChild(parentDiv),function addTypeBeatMenu(){const menuDiv=addMenu('type');addButton('arrow',menuDiv),addButton('dot',menuDiv),addButton('mine',menuDiv),addButton('wall',menuDiv),parentDiv.appendChild(menuDiv)}(),function addColorBeatMenu(){const menuDiv=addMenu('color');addButton('blue',menuDiv),addButton('red',menuDiv),parentDiv.appendChild(menuDiv)}(),function addOrientationMenu(){const menuDiv=addMenu('orientation');addButton('top',menuDiv),addButton('left',menuDiv),addButton('right',menuDiv),addButton('down',menuDiv),parentDiv.appendChild(menuDiv)}(),function setBeatButton(){var buttonEl=addButton('Set Beat',parentDiv,function(){var color='mine'===self.selectedBeat.type?'':' '+self.selectedBeat.color,orientation='arrow'===self.selectedBeat.type?' '+self.selectedBeat.orientation:'';self.selectedBeat={position:self.selectedBeat.position,type:self.selectedBeat.type,orientation:self.selectedBeat.orientation,color:self.selectedBeat.color};self.selectedPositionEl&&(self.selectedPositionEl.innerHTML=self.selectedBeat.type+color+orientation,self.beats[self.selectedPositionEl.id]={position:self.selectedBeat.position,type:self.selectedBeat.type,orientation:self.selectedBeat.orientation,color:self.selectedBeat.color})});buttonEl.style.width='460px',buttonEl.style.bottomMargin='10px'}(),function addBeatPositionMenu(){const menuDiv=addMenu('position');addButton('topLeft',menuDiv),addButton('topCenterLeft',menuDiv),addButton('topCenterRight',menuDiv),addButton('topRight',menuDiv),addButton('middleLeft',menuDiv),addButton('middleCenterLeft',menuDiv),addButton('middleCenterRight',menuDiv),addButton('middleRight',menuDiv),addButton('bottomLeft',menuDiv),addButton('bottomCenterLeft',menuDiv),addButton('bottomCenterRight',menuDiv),addButton('bottomRight',menuDiv)}(),function addGenerateButton(){const buttonEl=addButton('Spawn (Space Bar)',parentDiv,()=>{self.spawn()});buttonEl.style.width='460px',buttonEl.style.bottomMargin='10px'}()},addDebugStageControls:function(){var currControl=0;const addControl=(i,name,type)=>{const div=document.createElement('div');div.style.position='absolute',div.id='stagecontrol'+i,div.style.width='100px',div.style.height='30px',div.style.top='element'===type?'20px':'70px',div.style.background='#000',div.style.color='#fff',div.style.zIndex=999999999,div.style.padding='5px',div.style.font='14px sans-serif',div.style.textAlign='center',div.style.cursor='pointer',div.style.left=20+120*i+'px',div.innerHTML=name,'element'===type?div.addEventListener('click',()=>{document.getElementById('stagecontrol'+currControl).style.background='#000',div.style.background='#66f',currControl=i}):div.addEventListener('click',()=>{this.beatLoader.generateEvent({_type:currControl,_value:i})}),document.body.appendChild(div)};['sky','tunnelNeon','leftStageLasers','rightStageLasers','floor'].forEach((id,i)=>{addControl(i,id,'element')}),['off','blue','blue','bluefade','','red','red','redfade'].forEach((id,i)=>{addControl(i,id,'value')})}})},function(){AFRAME.registerComponent('debug-controller',{init:function(){var primaryHand,secondaryHand;AFRAME.utils.getUrlParameter('debug')&&(console.log('%c debug-controller enabled ','background: #111; color: red'),this.isCloning=!1,this.isDeleting=!1,this.isTriggerDown=!1,window.addEventListener('mousemove',this.onMouseMove.bind(this)),primaryHand=document.getElementById('rightHand'),secondaryHand=document.getElementById('leftHand'),window.addEventListener('click',evt=>{evt.isTrusted&&(primaryHand.emit('triggerdown'),primaryHand.emit('triggerup'))}),'oculus'===AFRAME.utils.getUrlParameter('debug')?(primaryHand.emit('controllerconnected',{name:'oculus-touch-controls'}),secondaryHand.emit('controllerconnected',{name:'oculus-touch-controls'}),primaryHand.setAttribute('controller','controllerType','oculus-touch-controls'),secondaryHand.setAttribute('controller','controllerType','oculus-touch-controls')):(primaryHand.emit('controllerconnected',{name:'vive-controls'}),secondaryHand.emit('controllerconnected',{name:'vive-controls'}),primaryHand.setAttribute('controller','controllerType','vive-controls'),secondaryHand.setAttribute('controller','controllerType','vive-controls')),this.el.emit('enter-vr',null,!1),document.addEventListener('keydown',evt=>{var primaryPosition,primaryRotation,secondaryPosition,secondaryRotation;return evt.shiftKey?32===evt.keyCode?void(this.isTriggerDown?(primaryHand.emit('triggerup'),this.isTriggerDown=!1):(primaryHand.emit('triggerdown'),this.isTriggerDown=!0)):81===evt.keyCode?void(this.isSecondaryTriggerDown?(secondaryHand.emit('triggerup'),this.isSecondaryTriggerDown=!1):(secondaryHand.emit('triggerdown'),this.isSecondaryTriggerDown=!0)):void(78===evt.keyCode&&(this.secondaryGripDown?(secondaryHand.emit('gripup'),this.secondaryGripDown=!1):(secondaryHand.emit('gripdown'),this.secondaryGripDown=!0)),77===evt.keyCode&&(this.primaryGripDown?(primaryHand.emit('gripup'),this.primaryGripDown=!1):(primaryHand.emit('gripdown'),this.primaryGripDown=!0)),49===evt.keyCode&&secondaryHand.emit('menudown'),evt.ctrlKey?(secondaryPosition=secondaryHand.getAttribute('position'),72===evt.keyCode&&(secondaryPosition.x-=0.01),74===evt.keyCode&&(secondaryPosition.y-=0.01),75===evt.keyCode&&(secondaryPosition.y+=0.01),76===evt.keyCode&&(secondaryPosition.x+=0.01),(59===evt.keyCode||186===evt.keyCode)&&(secondaryPosition.z-=0.01),222===evt.keyCode&&(secondaryPosition.z+=0.01),secondaryHand.setAttribute('position',AFRAME.utils.clone(secondaryPosition))):(primaryPosition=primaryHand.getAttribute('position'),72===evt.keyCode&&(primaryPosition.x-=0.01),74===evt.keyCode&&(primaryPosition.y-=0.01),75===evt.keyCode&&(primaryPosition.y+=0.01),76===evt.keyCode&&(primaryPosition.x+=0.01),(59===evt.keyCode||186===evt.keyCode)&&(primaryPosition.z-=0.01),222===evt.keyCode&&(primaryPosition.z+=0.01),primaryHand.setAttribute('position',AFRAME.utils.clone(primaryPosition))),evt.ctrlKey?(secondaryRotation=secondaryHand.getAttribute('rotation'),89===evt.keyCode&&(secondaryRotation.x-=10),79===evt.keyCode&&(secondaryRotation.x+=10),85===evt.keyCode&&(secondaryRotation.y-=10),73===evt.keyCode&&(secondaryRotation.y+=10),secondaryHand.setAttribute('rotation',AFRAME.utils.clone(secondaryRotation))):(primaryRotation=primaryHand.getAttribute('rotation'),89===evt.keyCode&&(primaryRotation.x-=10),79===evt.keyCode&&(primaryRotation.x+=10),85===evt.keyCode&&(primaryRotation.y-=10),73===evt.keyCode&&(primaryRotation.y+=10),primaryHand.setAttribute('rotation',AFRAME.utils.clone(primaryRotation)))):void 0}))},play:function(){var primaryHand,secondaryHand;this.bounds=document.body.getBoundingClientRect();AFRAME.utils.getUrlParameter('debug')&&(primaryHand=document.getElementById('rightHand'),secondaryHand=document.getElementById('leftHand'),secondaryHand.object3D.position.set(-0.2,1.5,-0.5),primaryHand.object3D.position.set(0.2,1.5,-0.5),secondaryHand.setAttribute('rotation',{x:35,y:0,z:0}))},onMouseMove:function(){const direction=new THREE.Vector3,mouse=new THREE.Vector2,cameraPos=new THREE.Vector3;return function(evt){const bounds=this.bounds,camera=this.el.sceneEl.camera,left=evt.clientX-bounds.left,top=evt.clientY-bounds.top;mouse.x=2*(left/bounds.width)-1,mouse.y=2*(-top/bounds.height)-1,document.getElementById('camera').object3D.getWorldPosition(cameraPos),direction.set(mouse.x,mouse.y,0.5).unproject(camera).sub(cameraPos).normalize();const handPos=document.getElementById('rightHand').object3D.position,distance=-cameraPos.z/direction.z;camera.getWorldPosition(handPos).add(direction.multiplyScalar(distance)),handPos.y+=0.8}}()})},function(){AFRAME.registerComponent('debug-cursor',{init:function(){},log:function(event,intersectedEl,color){intersectedEl.id?console.log(`%c[${event}] ${intersectedEl.id}`,`color: ${color}`):(console.log(`%c[${event}]`,`color: ${color}`),console.log(intersectedEl))}})},function(){AFRAME.registerComponent('debug-song-time',{dependencies:['song'],init:function(){AFRAME.utils.getUrlParameter('debug-song-time')&&setInterval(()=>{console.log(this.el.components.song.getCurrentTime())},250)}})},function(){AFRAME.registerComponent('debug-state',{play:function(){const flags=AFRAME.utils.getUrlParameter('debugstate').trim();flags&&setTimeout(()=>{flags.split(',').forEach(flag=>{this.el.sceneEl.emit(`debug${flag.trim()}`,null,!1)})},500)}})},function(){AFRAME.registerComponent('difficulty-background',{schema:{enabled:{type:!1}},update:function(){this.data.enabled?this.el.setAttribute('raycastable',''):this.el.removeAttribute('raycastable')}})},function(module,__webpack_exports__,__webpack_require__){'use strict';function createGeometry(color){colorHelper.set(color);const geometries=[{height:0.1831,radius:0.0055},{height:0.1832,radius:0.0065},{height:0.1833,radius:0.0075},{height:0.1834,radius:0.0085}].map((cylinderData,i)=>{const cylinder=new THREE.CylinderBufferGeometry(cylinderData.radius,cylinderData.radius,cylinderData.height),colorArray=[];for(let i=0;i<cylinder.attributes.position.array.length;i+=3)colorArray[i]=colorHelper.r,colorArray[i+1]=colorHelper.g,colorArray[i+2]=colorHelper.b;cylinder.addAttribute('color',new THREE.Float32BufferAttribute(colorArray,3));const alphaUvs=__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aframe_atlas_uvs_component__.getGridUvs)(0,i,1,4),uvs=cylinder.attributes.uv.array;for(let i=0;i<uvs.length;i+=6)uvs[i]=alphaUvs[0].x,uvs[i+1]=alphaUvs[0].y,uvs[i+2]=alphaUvs[1].x,uvs[i+3]=alphaUvs[1].y,uvs[i+4]=alphaUvs[2].x,uvs[i+5]=alphaUvs[2].y;return cylinder.attributes.uv.needsUpdate=!0,cylinder}),geometry=THREE.BufferGeometryUtils.mergeBufferGeometries(geometries);return geometry}Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0_aframe_atlas_uvs_component__=__webpack_require__(11),__WEBPACK_IMPORTED_MODULE_0_aframe_atlas_uvs_component___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_aframe_atlas_uvs_component__);__webpack_require__(12);const colorHelper=new THREE.Color,geometry=createGeometry(),material=new THREE.MeshBasicMaterial({alphaMap:function createAlphaMap(){const alphaCanvas=document.createElement('canvas');alphaCanvas.height=1,alphaCanvas.width=4;const ctx=alphaCanvas.getContext('2d');return ctx.fillStyle='rgb(10, 10, 10)',ctx.fillRect(0,0,1,1),ctx.fillStyle='rgb(15, 15, 15)',ctx.fillRect(1,0,1,1),ctx.fillStyle='rgb(23, 23 ,23)',ctx.fillRect(2,0,1,1),ctx.fillStyle='rgb(28, 28, 28)',ctx.fillRect(3,0,1,1),setTimeout(()=>{alphaCanvas.style.position='fixed',alphaCanvas.style.zIndex=999999999999,alphaCanvas.style.left=0,alphaCanvas.style.top=0,document.body.appendChild(alphaCanvas)},1e3),new THREE.CanvasTexture(alphaCanvas)}(),transparent:!0,vertexColors:THREE.VertexColors});AFRAME.registerComponent('fake-glow',{schema:{color:{default:'#FFF'}},play:function(){this.el.setObject3D('mesh',new THREE.Mesh(createGeometry(this.data.color),material))}})},function(module,exports,__webpack_require__){const COLORS=__webpack_require__(7),HIT_COLOR=new THREE.Color(COLORS.NEON_RED),BORDER_COLOR=new THREE.Color(COLORS.NEON_BLUE);AFRAME.registerShader('floorShader',{schema:{normalMap:{type:'map',is:'uniform'},envMap:{type:'map',is:'uniform'},hitRight:{type:'vec3',is:'uniform',default:{x:0,y:1,z:0}},hitLeft:{type:'vec3',is:'uniform',default:{x:0,y:0,z:0}}},vertexShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      vec4 p = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      worldPos = (modelMatrix * vec4( position, 1.0 )).xyz;
      gl_Position = p;
    }
  `,fragmentShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    uniform vec3 color;
    uniform sampler2D normalMap;
    uniform sampler2D envMap;
    uniform vec3 hitRight;
    uniform vec3 hitLeft;

    #define HIT_COLOR vec3(${HIT_COLOR.r}, ${HIT_COLOR.g}, ${HIT_COLOR.b})
    #define BORDER_COLOR vec3(${BORDER_COLOR.r}, ${BORDER_COLOR.g}, ${BORDER_COLOR.b})

    vec3 drawCircle(vec3 p, vec3 center, float radius, float edgeWidth, vec3 color) {
      return color*(1.0-smoothstep(radius, radius+edgeWidth, length(p-center)));
    }

    void main() {
      vec2 p = uvs.xy - 0.5;
      vec3 border = vec3(smoothstep(0.49, 0.495, abs(p.x)) + smoothstep(0.49, 0.495, abs(p.y)));
      border += BORDER_COLOR * (smoothstep(0.475, 0.495, abs(p.x)) + smoothstep(0.475, 0.495, abs(p.y))) * .7;
      p*= 4.0;

      vec3 hitColor = HIT_COLOR;
      vec3 hit = vec3(0.0);

      hit += drawCircle(worldPos, hitRight, 0.04, 0.05, hitColor);
      hit += drawCircle(worldPos, hitRight, 0.02, 0.03, vec3(0.7, 0.7, 0.7));
      hit += drawCircle(worldPos, hitLeft, 0.04, 0.05, hitColor);
      hit += drawCircle(worldPos, hitLeft, 0.02, 0.03, vec3(0.7, 0.7, 0.7));

      vec3 normal = normalize(texture2D(normalMap, uvs).xyz);

      // environment reflection
      vec3 reflectVec = normalize(reflect(normalize(worldPos - cameraPosition), normal));
      //vec3 reflectView = normalize((viewMatrix * vec4(reflectVec, 0.0)).xyz + vec3(0.0, 0.0, 1.0));

      vec3 ref = texture2D(envMap, reflectVec.xy * vec2(0.3, 1.0) + vec2(0.75, -cameraPosition.z * 0.05)).xyz * 0.14;

      gl_FragColor = vec4(ref + border + hit, 1.0);
    }
  `})},function(){AFRAME.registerComponent('gameover',{schema:{isGameOver:{default:!1}},init:function(){this.beatContainer=document.getElementById('beatContainer'),this.gameOverEls=document.querySelectorAll('[animation__gameover]')},update:function(oldData){this.data;!oldData.isGameOver&&this.data.isGameOver&&(this.triggerAnimations(),this.countDown=1),oldData.isGameOver&&!this.data.isGameOver&&this.reset()},tick:function(time,delta){!this.data.isGameOver||0<=this.countDown&&(this.beatContainer.object3D.position.z=1.5*-Math.pow(1-this.countDown,2),this.countDown-=delta/1e3)},reset:function(){this.beatContainer.object3D.position.z=0,this.el.sceneEl.setAttribute('stage-colors','color','blue')},triggerAnimations:function(){for(let i=0;i<this.gameOverEls.length;i++)this.gameOverEls[i].emit('gameover',null,!1);this.el.emit('textglowoff',null,!1),this.el.emit('bgcolorgameover',null,!1)}})},function(){let i=0;AFRAME.registerComponent('gpu-preloader',{dependencies:['materials'],play:function(){this.preloadMineEnvMaps(),setTimeout(()=>{this.preloadAtlas(),this.preloadLogo(),this.preloadBeatEnvMap(),this.preloadCutParticles(),this.preloadKeyboard(),this.preloadPlayButton(),this.preloadSearchPrevPage(),this.preloadGenres()},1e3)},preloadAtlas:function(){const stage=document.querySelector('#stageObj');this.preloadTexture(stage.getObject3D('mesh').children[0].material.uniforms.src.value)},preloadLogo:function(){const logo=document.querySelector('#logoBody');this.preloadTexture(logo.getObject3D('mesh').children[0].material.uniforms.src.value)},preloadBeamMap:function(){const beams=document.querySelector('[beams]');this.preloadTexture(beams.components.beams.texture)},preloadBeatEnvMap:function(){const beat=document.querySelector('#beatContainer [mixin~="beat"]');beat.object3D.traverse(node=>{node.material&&(node.material.envMap&&this.preloadTexture(node.material.envMap),node.material.map&&this.preloadTexture(node.material.map))})},preloadCutParticles:function(){const particles=document.querySelector('#saberParticles');this.preloadTexture(particles.components.particleplayer.material.map)},preloadKeyboard:function(){const keyboard=document.getElementById('keyboard').components['super-keyboard'];this.preloadTexture(keyboard.kbImg.getObject3D('mesh').material.map),this.preloadTexture(keyboard.keyColorPlane.getObject3D('mesh').material.map)},preloadMineEnvMaps:function(){const stageColors=this.el.sceneEl.components['stage-colors'];this.el.sceneEl.addEventListener('mineredenvmaploaded',()=>{this.preloadTexture(stageColors.mineEnvMap.red)}),this.el.sceneEl.addEventListener('mineblueenvmaploaded',()=>{this.preloadTexture(stageColors.mineEnvMap.blue)})},preloadMissMap:function(){const miss=document.querySelector('#missLeft');this.preloadTexture(miss.getObject3D('mesh').material.map)},preloadPlayButton:function(){const playButton=document.querySelector('#playButton');this.preloadTexture(playButton.getObject3D('mesh').material.map)},preloadSearchPrevPage:function(){const prevPage=document.querySelector('#searchPrevPage');this.preloadTexture(prevPage.children[0].getObject3D('mesh').material.map)},preloadWallMap:function(){const wall=document.querySelector('a-entity[wall]');this.preloadTexture(wall.getObject3D('mesh').material.uniforms.tex.value),this.preloadTexture(wall.getObject3D('mesh').material.uniforms.env.value)},preloadWrongMap:function(){const wrong=document.querySelector('#wrongLeft');this.preloadTexture(wrong.getObject3D('mesh').material.map)},preloadGenres:function(){const genres=document.querySelector('.genreIcon');this.preloadTexture(genres.getObject3D('mesh').material.map)},preloadTexture:function(texture){return texture&&texture.image?texture.image.complete?void this.el.renderer.setTexture2D(texture,i++%8):void console.warn('[gpu-preloader] Error preloading, image not loaded',texture):void console.warn('[gpu-preloader] Error preloading texture',texture)}})},function(){AFRAME.registerComponent('hack',{play:function(){const interval=setInterval(()=>{this.el.sceneEl.is('vr-mode')||(this.el.sceneEl.enterVR(),clearInterval(interval))},1e3)}})},function(){const events=['triggerdown','gripdown','abuttondown','bbuttondown','xbuttondown','ybuttondown','trackpaddown'];AFRAME.registerComponent('hand-swapper',{schema:{enabled:{default:!1}},init:function(){this.swapHand=this.swapHand.bind(this),events.forEach(event=>{this.el.addEventListener(event,this.swapHand)})},swapHand:function(){this.data.enabled&&this.el.sceneEl.emit('activehandswap',null,!1)}})},function(){AFRAME.registerComponent('haptics-saber',{init:function(){const el=this.el;this.isColliding=!1,this.tick=AFRAME.utils.throttleTick(this.tick.bind(this),100),el.setAttribute('haptics__saber',{dur:100,force:0.075}),el.addEventListener('mouseenter',evt=>{if(evt.detail&&evt.detail.intersectedEl){const intersectedEl=evt.detail.intersectedEl;return intersectedEl.classList.contains('blade')&&intersectedEl!==el?void(this.isColliding=!0,this.el.components.haptics__saber.pulse()):void(this.isColliding=!1)}}),el.addEventListener('mouseleave',()=>{this.isColliding=!1})},tick:function(){this.isColliding&&this.el.components.haptics__saber.pulse()}})},function(){AFRAME.registerComponent('haptics-wall',{init:function(){const el=this.el;this.isHittingWall=!1,el.setAttribute('haptics__wall',{dur:50,force:0.075}),this.checkIfHittingWall=this.checkIfHittingWall.bind(this),el.addEventListener('mouseenter',this.checkIfHittingWall),el.addEventListener('mouseleave',this.checkIfHittingWall),this.tick=AFRAME.utils.throttleTick(this.tick.bind(this),50)},checkIfHittingWall:function(){const intersectedEls=this.el.components.raycaster__game.intersectedEls;this.isHittingWall=!1;for(let i=0;i<intersectedEls.length;i++)if(intersectedEls[i].components.wall)return void(this.isHittingWall=!0)},tick:function(){this.isHittingWall&&this.el.components.haptics__wall.pulse()}})},function(){AFRAME.registerComponent('history',{schema:{challengeId:{type:'string'},songName:{type:'string'},songSubName:{type:'string'}},update:function(){const data=this.data;history.pushState('',data.songName,updateQueryParam(window.location.href,'challenge',data.challengeId)),document.title=`Super Saber - ${data.songName}`}})},function(){AFRAME.registerComponent('intro-song',{schema:{isPlaying:{default:!0},isSearching:{default:!1}},init:function(){this.analyserEl=document.getElementById('audioAnalyser'),this.audio=document.getElementById('introSong'),this.timeout=null},update:function(oldData){const audio=this.audio;this.el.sceneEl.isPlaying&&(oldData.isSearching||!this.data.isSearching)&&(!oldData.isPlaying&&this.data.isPlaying&&(this.analyserEl.components.audioanalyser.resumeContext(),this.analyserEl.setAttribute('audioanalyser','src',audio),this.fadeInAudio()),oldData.isPlaying&&!this.data.isPlaying&&audio.pause())},pause:function(){this.audio.pause()},play:function(){this.fadeInAudio()},fadeInAudio:function(){if(!AFRAME.utils.getUrlParameter('mute')){const context=this.analyserEl.components.audioanalyser.context,gainNode=this.analyserEl.components.audioanalyser.gainNode;gainNode.gain.setValueAtTime(0,context.currentTime),this.audio.play(),gainNode.gain.linearRampToValueAtTime(0.5,context.currentTime+0.5)}}})},function(){AFRAME.registerComponent('keyboard-raycastable',{dependencies:['super-keyboard'],schema:{condition:{default:''}},play:function(){this.el.components['super-keyboard'].kbImg.setAttribute('bind-toggle__raycastable',this.data.condition)}})},function(module,exports,__webpack_require__){const firebase=__webpack_require__(141);__webpack_require__(142);AFRAME.registerComponent('leaderboard',{schema:{apiKey:{type:'string'},authDomain:{type:'string'},databaseURL:{type:'string'},projectId:{type:'string'},storageBucket:{type:'string'},messagingSenderId:{type:'string'},challengeId:{default:''},menuSelectedChallengeId:{default:''},isVictory:{default:!1}},init:function(){this.qualifyingIndex=void 0,this.scores=[],this.eventDetail={scores:this.scores},this.addEventDetail={scoreData:void 0,index:void 0},this.username=localStorage.getItem('supersaberusername')||'Super Zealot',this.el.addEventListener('leaderboardusername',evt=>{this.username=evt.detail.value,localStorage.setItem('supersaberusername',this.username)}),this.el.addEventListener('leaderboardsubmit',this.addScore.bind(this))},update:function(oldData){!firebase.apps.length&&this.data.apiKey&&(firebase.initializeApp({apiKey:this.data.apiKey,authDomain:this.data.authDomain,databaseURL:this.data.databaseURL,projectId:this.data.projectId,storageBucket:this.data.storageBucket,messagingSenderId:this.data.messagingSenderId}),this.firestore=firebase.firestore(),this.firestore.settings({timestampsInSnapshots:!0}),this.db=this.firestore.collection('scores')),!oldData.isVictory&&this.data.isVictory&&this.checkLeaderboardQualify(),this.data.menuSelectedChallengeId&&oldData.menuSelectedChallengeId!==this.data.menuSelectedChallengeId&&this.fetchScores(this.data.menuSelectedChallengeId),this.data.challengeId&&oldData.challengeId!==this.data.challengeId&&this.fetchScores(this.data.challengeId)},addScore:function(){const state=this.el.sceneEl.systems.state.state;if(state.isVictory){const scoreData={accuracy:state.score.accuracy,challengeId:state.challenge.id,score:state.score.score,username:this.username,difficulty:state.challenge.difficulty,time:new Date};this.db.add(scoreData),this.addEventDetail.scoreData=scoreData,this.el.emit('leaderboardscoreadded',this.addEventDetail,!1)}},fetchScores:function(challengeId){const state=this.el.sceneEl.systems.state.state,query=this.db.where('challengeId','==',challengeId).where('difficulty','==',state.menuSelectedChallenge.id?state.menuSelectedChallenge.difficulty:state.challenge.difficulty).orderBy('score','desc').orderBy('time','asc').limit(10);query.get().then(snapshot=>{this.eventDetail.challengeId=challengeId,this.scores.length=0,snapshot.empty||snapshot.forEach(score=>this.scores.push(score.data())),this.el.sceneEl.emit('leaderboard',this.eventDetail,!1)}).catch(e=>{console.error('[firestore]',e)})},checkLeaderboardQualify:function(){const state=this.el.sceneEl.systems.state.state,score=state.score.score;if(this.scores.length<10)return this.qualifyingIndex=this.scores.length,void this.el.sceneEl.emit('leaderboardqualify',this.scores.length,!1);for(let i=0;i<this.scores.length;i++)if(score>this.scores[i].score)return this.qualifyingIndex=i,void this.el.sceneEl.emit('leaderboardqualify',i,!1)}})},function(){var ONCE={once:!0};AFRAME.registerComponent('logo-light',{init:function(){this.logoBack=document.getElementById('logoBack'),this.logoFront=document.getElementById('logoFront'),this.logoFrontU=document.getElementById('logoFrontU')},play:function(){setTimeout(()=>{this.el.setAttribute('light',{type:'spot',penumbra:1,intensity:5,angle:20}),this.waitAndUpdate(this.logoBack),this.waitAndUpdate(this.logoFront),this.waitAndUpdate(this.logoFrontU)},1e3)},waitAndUpdate:function(el){el.getObject3D('mesh')?el.object3D.traverse(this.updateMaterials):el.addEventListener('model-loaded',()=>{el.object3D.traverse(this.updateMaterials)},ONCE)},updateMaterials:function(node){node.material&&(node.material.needsUpdate=!0)}})},function(){var _Mathfloor4=Math.floor;AFRAME.registerComponent('logoflicker',{schema:{delay:{default:1e3},active:{default:!0}},init:function(){this.setOff=this.setOff.bind(this),this.setOn=this.setOn.bind(this),this.timeout=0,this.sparks=document.getElementById('logosparks'),this.sparkPositions=[{position:new THREE.Vector3(0,0.1,0)},{position:new THREE.Vector3(0.3,0.8,0)},{position:new THREE.Vector3(-0.3,0.8,0)}]},update:function(oldData){this.data.active!==oldData.active&&(this.data.active?this.setOn():clearTimeout(this.timeout))},setOff:function(){this.el.object3D.visible=!1,this.sparks.emit('logoflicker',this.sparkPositions[_Mathfloor4(Math.random()*this.sparkPositions.length)],!1),this.timeout=setTimeout(this.setOn,50)},setOn:function(){this.el.object3D.visible=!0,this.timeout=setTimeout(this.setOff,_Mathfloor4(3*this.data.delay/10+Math.random()*this.data.delay))}})},function(module,exports,__webpack_require__){const COLORS=__webpack_require__(7),flatShaders=__webpack_require__(56),stageAdditiveShaders=__webpack_require__(57),stageNormalShaders=__webpack_require__(58);AFRAME.registerSystem('materials',{init:function(){'loading'===document.readyState?document.addEventListener('DOMContentLoaded',this.createMaterials.bind(this)):this.createMaterials()},createMaterials:function(){this.stageNormal=new THREE.ShaderMaterial({uniforms:{skyColor:{value:new THREE.Color(COLORS.SKY_BLUE)},backglowColor:{value:new THREE.Color(COLORS.BG_BLUE)},src:{value:new THREE.TextureLoader().load(document.getElementById('atlasImg').src)}},vertexShader:stageNormalShaders.vertexShader,fragmentShader:stageNormalShaders.fragmentShader,fog:!1,transparent:!0}),this.stageAdditive=new THREE.ShaderMaterial({uniforms:{tunnelNeon:{value:new THREE.Color(COLORS.NEON_RED)},floorNeon:{value:new THREE.Color(COLORS.NEON_RED)},leftLaser:{value:new THREE.Color(COLORS.NEON_BLUE)},rightLaser:{value:new THREE.Color(COLORS.NEON_BLUE)},textGlow:{value:new THREE.Color(COLORS.TEXT_OFF)},src:{value:new THREE.TextureLoader().load(document.getElementById('atlasImg').src)}},vertexShader:stageAdditiveShaders.vertexShader,fragmentShader:stageAdditiveShaders.fragmentShader,blending:THREE.AdditiveBlending,fog:!1,transparent:!0}),this.logo=new THREE.ShaderMaterial({uniforms:{src:{value:new THREE.TextureLoader().load(document.getElementById('logotexImg').src)}},vertexShader:flatShaders.vertexShader,fragmentShader:flatShaders.fragmentShader,depthTest:!1,fog:!1,transparent:!0}),this.logoadditive=new THREE.ShaderMaterial({uniforms:{src:{value:new THREE.TextureLoader().load(document.getElementById('logotexImg').src)}},vertexShader:flatShaders.vertexShader,fragmentShader:flatShaders.fragmentShader,depthTest:!1,blending:THREE.AdditiveBlending,fog:!1,transparent:!0}),this.mineMaterialred=new THREE.MeshStandardMaterial({roughness:0.38,metalness:0.48,color:new THREE.Color(COLORS.MINE_RED),emissive:new THREE.Color(COLORS.MINE_RED_EMISSION),envMap:new THREE.TextureLoader().load('assets/img/mineenviro-red.jpg')}),this.mineMaterialblue=new THREE.MeshStandardMaterial({roughness:0.38,metalness:0.48,color:new THREE.Color(COLORS.MINE_BLUE),emissive:new THREE.Color(COLORS.MINE_BLUE_EMISSION),envMap:new THREE.TextureLoader().load('assets/img/mineenviro-blue.jpg')})}}),AFRAME.registerComponent('materials',{schema:{name:{default:''},recursive:{default:!0}},update:function(){if(''!==this.data.name){const material=this.system[this.data.name];if(!material)return void console.warn(`undefined material "${this.system[this.data.name]}"`);const mesh=this.el.getObject3D('mesh');mesh?this.applyMaterial(mesh):this.el.addEventListener('model-loaded',this.applyMaterial.bind(this))}},applyMaterial:function(obj){const material=this.system[this.data.name];obj.detail&&(obj=obj.detail.model),this.data.recursive?obj.traverse(o=>{'Mesh'===o.type&&(o.material=material)}):obj.material=material}})},function(){var keyEventsRegistered=!1,results=null,hoveredIndex;const PER_PAGE=6;AFRAME.registerComponent('menu-controls',{schema:{enabled:{default:!0},page:{default:0},selectedChallengeId:{default:''}},init:function(){const el=this.el;results=document.getElementById('searchResultList').children,this.goPrevResult=this.goPrevResult.bind(this),this.goNextResult=this.goNextResult.bind(this),this.select=this.select.bind(this),this.unselect=this.unselect.bind(this),el.addEventListener('thumbupstart',this.goPrevResult),el.addEventListener('thumbdownstart',this.goNextResult),el.addEventListener('thumbleftstart',this.unselect),el.addEventListener('thumbrightstart',this.select),el.addEventListener('mouseenter',()=>{!el.components.cursor.intersectedEl||el.components.cursor.intersectedEl.closest('#searchResultList')&&this.cancelMenuControls()}),AFRAME.utils.getUrlParameter('debug')&&!keyEventsRegistered&&(window.addEventListener('keydown',evt=>{37===evt.keyCode&&this.unselect(),38===evt.keyCode&&this.goPrevResult(),39===evt.keyCode&&this.select(),40===evt.keyCode&&this.goNextResult()}),keyEventsRegistered=!0)},goPrevResult:function(){return this.data.enabled?void 0==hoveredIndex?void this.hoverResult(0):void(0<hoveredIndex?results[hoveredIndex-1].dataset.id===this.data.selectedChallengeId?0>hoveredIndex-2?this.goPrevPage():this.hoverResult(hoveredIndex-2):this.hoverResult(hoveredIndex-1):this.goPrevPage()):void 0},goPrevPage:function(){this.hoverResult(PER_PAGE-1),this.el.sceneEl.emit('searchprevpage',null,!1)},goNextResult:function(){return this.data.enabled?void 0==hoveredIndex?void this.hoverResult(0):void(hoveredIndex<PER_PAGE-1?results[hoveredIndex+1].dataset.id===this.data.selectedChallengeId?hoveredIndex+2>PER_PAGE-1?this.goNextPage():this.hoverResult(hoveredIndex+2):this.hoverResult(hoveredIndex+1):this.goNextPage()):void 0},goNextPage:function(){this.hoverResult(0),this.el.sceneEl.emit('searchnextpage',null,!1)},select:function(){this.data.enabled&&void 0!=hoveredIndex&&this.el.sceneEl.emit('menuchallengeselect',results[hoveredIndex].dataset.id,!1)},unselect:function(){!this.data.enabled||this.data.selectedChallengeId&&this.el.sceneEl.emit('menuchallengeunselect',null,!1)},hoverResult:function(i){hoveredIndex!=void 0&&results[hoveredIndex].querySelector('.searchResultBackground').emit('mouseleave',null,!1),hoveredIndex=i,results[i].querySelector('.searchResultBackground').emit('mouseenter',null,!1)},cancelMenuControls:function(){void 0===hoveredIndex||(results[hoveredIndex].querySelector('.searchResultBackground').emit('mouseleave',null,!1),hoveredIndex=void 0)}})},function(module,exports,__webpack_require__){var bindEvent=__webpack_require__(15).bindEvent;AFRAME.registerComponent('menu-difficulty-select',{init:function(){this.el.sceneEl.addEventListener('menuchallengeselect',()=>{this.el.object3D.visible=!1,setTimeout(()=>{this.el.components.layout.update(),this.el.object3D.visible=!0},150)})},click:bindEvent(function(evt){this.el.sceneEl.emit('menudifficultyselect',evt.target.closest('.difficultyOption').dataset.difficulty,!1)})})},function(module,__webpack_exports__,__webpack_require__){'use strict';Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0__utils__=__webpack_require__(2),__WEBPACK_IMPORTED_MODULE_0__utils___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__utils__);AFRAME.registerComponent('menu-selected-challenge-image',{schema:{selectedChallengeId:{type:'string'}},update:function(){const el=this.el;this.data.selectedChallengeId&&el.setAttribute('material','src',__WEBPACK_IMPORTED_MODULE_0__utils___default.a.getS3FileUrl(this.data.selectedChallengeId,'image.jpg'))}})},function(){AFRAME.registerComponent('menu-slide-animation',{schema:{isSearching:{default:!1},menuSelectedChallengeId:{type:'string'}},init:function(){this.isLeft=!1},update:function(oldData){const data=this.data;return this.isLeft?(!oldData.menuSelectedChallengeId||data.menuSelectedChallengeId||data.isSearching||this.rightMenu(),void(!oldData.isSearching||data.isSearching||data.menuSelectedChallengeId||this.rightMenu())):void(!this.isLeft&&(!oldData.menuSelectedChallengeId&&data.menuSelectedChallengeId&&this.leftMenu(),!oldData.isSearching&&data.isSearching&&this.leftMenu()))},rightMenu:function(){this.isLeft&&(this.el.components.animation__menuright.beginAnimation(),this.isLeft=!1)},leftMenu:function(){this.isLeft||(this.el.components.animation__menuleft.beginAnimation(),this.isLeft=!0)}})},function(){const objLoader=new THREE.OBJLoader;AFRAME.registerSystem('mine-fragments-loader',{init:function(){this.fragments=null;const objData=document.getElementById('mineBrokenObj');objData.addEventListener('loaded',evt=>{this.fragments=objLoader.parse(evt.target.data)})}})},function(){const COMBO_PROGRESS_MAP={0:0,1:0.5,2:0,3:0.25,4:0.5,5:0.75,6:0,7:0.125,8:0.25,9:0.375,10:0.5,11:0.625,12:0.75,13:0.875};AFRAME.registerComponent('multiplier-ring',{dependencies:['geometry','material'],schema:{combo:{default:0},multiplier:{default:1}},init:function(){this.animationSet={from:void 0,to:void 0},this.progress=this.el.getObject3D('mesh').material.uniforms.progress,this.el.setAttribute('animation',{property:'components.material.material.uniforms.progress.value',dur:100,autoplay:!1})},update:function(){this.updateRing()},updateRing:function(){const data=this.data,el=this.el,progress=this.progress;if(8===data.multiplier)return void(progress.value=1);const animationSet=this.animationSet;animationSet.from=progress.value,animationSet.to=COMBO_PROGRESS_MAP[data.combo],el.setAttribute('animation',animationSet),el.components.animation.beginAnimation()}})},function(module){function transformPlane(particleIndex,geometry,originalArray,position,rotation,scale){const array=geometry.attributes.position.array,index=particleIndex*NUM_PLANE_POSITIONS;tri.vertices[0].set(originalArray[index+0],originalArray[index+1],originalArray[index+2]),tri.vertices[1].set(originalArray[index+3],originalArray[index+4],originalArray[index+5]),tri.vertices[2].set(originalArray[index+6],originalArray[index+7],originalArray[index+8]),null!==scale&&tri.scale(scale.x,scale.y,scale.z),rotation&&(tri.rotateX(rotation.x),tri.rotateY(rotation.y),tri.rotateZ(rotation.z)),tri.vertices[0].add(position),tri.vertices[1].add(position),tri.vertices[2].add(position),array[index+0]=tri.vertices[0].x,array[index+1]=tri.vertices[0].y,array[index+2]=tri.vertices[0].z,array[index+3]=tri.vertices[1].x,array[index+4]=tri.vertices[1].y,array[index+5]=tri.vertices[1].z,array[index+6]=tri.vertices[2].x,array[index+7]=tri.vertices[2].y,array[index+8]=tri.vertices[2].z,tri.vertices[0].set(originalArray[index+3],originalArray[index+4],originalArray[index+5]),tri.vertices[1].set(originalArray[index+6],originalArray[index+7],originalArray[index+8]),tri.vertices[2].set(originalArray[index+9],originalArray[index+10],originalArray[index+11]),null!==scale&&tri.scale(scale.x,scale.y,scale.z),rotation&&(tri.rotateX(rotation.x),tri.rotateY(rotation.y),tri.rotateZ(rotation.z)),tri.vertices[0].add(position),tri.vertices[1].add(position),tri.vertices[2].add(position),array[index+9]=tri.vertices[2].x,array[index+10]=tri.vertices[2].y,array[index+11]=tri.vertices[2].z,geometry.attributes.position.needsUpdate=!0}function copyArray(dest,src){dest.length=0;for(let i=0;i<src.length;i++)dest[i]=src[i]}var _Mathfloor5=Math.floor,_MathPI3=Math.PI;const NUM_PLANE_POSITIONS=12,BLENDINGS={normal:THREE.NormalBlending,additive:THREE.AdditiveBlending,substractive:THREE.SubstractiveBlending,multiply:THREE.MultiplyBlending},SHADERS={flat:THREE.MeshBasicMaterial,lambert:THREE.MeshLambertMaterial,phong:THREE.MeshPhongMaterial,standard:THREE.MeshStandardMaterial},OFFSCREEN_VEC3=new THREE.Vector3(-99999,-99999,-99999);AFRAME.registerComponent('particleplayer',{schema:{blending:{default:'additive',oneOf:['normal','additive','multiply','substractive']},color:{default:'#fff',type:'color'},count:{default:'100%'},delay:{default:0,type:'int'},dur:{default:1e3,type:'int'},img:{type:'selector'},interpolate:{default:!1},loop:{default:'false'},on:{default:'init'},poolSize:{default:5,type:'int'},protation:{type:'vec3'},pscale:{default:1,type:'float'},scale:{default:1,type:'float'},initialScale:{type:'vec3'},finalScale:{type:'vec3'},animateScale:{default:!1},shader:{default:'flat',oneOf:['flat','lambert','phong','standard']},src:{type:'selector'}},multiple:!0,init:function(){this.frame=0,this.framedata=null,this.indexPool=null,this.lastFrame=0,this.material=null,this.msPerFrame=0,this.numFrames=0,this.numParticles=0,this.originalVertexPositions=[],this.particleCount=0,this.particleSystems=[],this.protation=!1,this.restPositions=[],this.restRotations=[],this.sprite_rotation=!1,this.systems=null,this.useRotation=!1,this.useAge=!1,this.scaleAnim=new THREE.Vector3,this.partScale=new THREE.Vector3(1,1,1)},update:function(oldData){const data=this.data;if(data.src){oldData.on!==data.on&&(oldData.on&&this.el.removeEventListener(oldData.on,this.start),'play'!==data.on&&this.el.addEventListener(data.on,this.start.bind(this))),this.partScale.set(1,1,1),this.loadParticlesJSON(data.src,data.scale),this.numFrames=this.framedata.length,this.numParticles=0<this.numFrames?this.framedata[0].length:0,this.particleCount='%'===data.count[data.count.length-1]?_Mathfloor5(parseInt(data.count)*this.numParticles/100):parseInt(data.count),this.particleCount=Math.min(this.numParticles,Math.max(0,this.particleCount)),this.msPerFrame=data.dur/this.numFrames,this.indexPool=Array(this.numParticles);const materialParams={color:new THREE.Color(data.color),side:THREE.DoubleSide,blending:BLENDINGS[data.blending],map:data.img?new THREE.TextureLoader().load(data.img.src):null,depthWrite:!1,opacity:data.opacity,transparent:!!data.img||'normal'!==data.blending||1>data.opacity};this.material=void 0===SHADERS[data.shader]?new SHADERS.flat(materialParams):new SHADERS[data.shader](materialParams),this.createParticles(data.poolSize),'init'===data.on&&this.start()}},loadParticlesJSON:function(json,scale){var alive;this.restPositions.length=0,this.restRotations.length=0;const jsonData=JSON.parse(json.data),frames=jsonData.frames,precision=jsonData.precision;this.useRotation=jsonData.rotation,this.useAge=jsonData.age!==void 0&&jsonData.age,this.sprite_rotation=!1!==jsonData.sprite_rotation&&{x:jsonData.sprite_rotation[0]/precision,y:jsonData.sprite_rotation[1]/precision,z:jsonData.sprite_rotation[2]/precision},this.framedata=Array(frames.length);for(let frameIndex=0;frameIndex<frames.length;frameIndex++){this.framedata[frameIndex]=Array(frames[frameIndex].length);for(let particleIndex=0,rawP;particleIndex<frames[frameIndex].length;particleIndex++){rawP=frames[frameIndex][particleIndex],alive=0!==rawP;let p=this.framedata[frameIndex][particleIndex]={position:alive?{x:rawP[0]/precision*scale,y:rawP[1]/precision*scale,z:rawP[2]/precision*scale}:null,alive:alive};this.useRotation&&(p.rotation=alive?{x:rawP[3]/precision,y:rawP[4]/precision,z:rawP[5]/precision}:null),this.useAge&&(p.age=alive?rawP[6]/precision:0),alive&&0===frameIndex&&(this.restPositions[particleIndex]=p.position?{x:p.position.y,y:p.position.y,z:p.position.z}:null,this.restRotations[particleIndex]=p.rotation?{x:p.rotation.y,y:p.rotation.y,z:p.rotation.z}:null)}}},createParticles:function(){const tempGeometries=[];return function(numParticleSystems){const data=this.data;var loop=parseInt(this.data.loop);this.particleSystems.length=0,isNaN(loop)&&(loop='true'===this.data.loop?Number.MAX_VALUE:0);for(let i=0,particleSystem;i<numParticleSystems;i++){particleSystem={active:!1,activeParticleIndices:Array(this.particleCount),loopCount:0,loopTotal:loop,mesh:null,time:0};const ratio=data.img?data.img.width/data.img.height:1;tempGeometries.length=0;for(let p=0,geometry;p<this.numParticles;p++)geometry=new THREE.PlaneBufferGeometry(0.1*ratio*data.pscale,0.1*data.pscale),!1===this.sprite_rotation?(geometry.rotateX(this.data.protation.x*_MathPI3/180),geometry.rotateY(this.data.protation.y*_MathPI3/180),geometry.rotateZ(this.data.protation.z*_MathPI3/180)):(geometry.rotateX(this.sprite_rotation.x),geometry.rotateY(this.sprite_rotation.y),geometry.rotateZ(this.sprite_rotation.z)),tempGeometries.push(geometry);let mergedBufferGeometry=THREE.BufferGeometryUtils.mergeBufferGeometries(tempGeometries);particleSystem.mesh=new THREE.Mesh(mergedBufferGeometry,this.material),particleSystem.mesh.visible=!1,this.el.setObject3D(`particleplayer${i}`,particleSystem.mesh),copyArray(this.originalVertexPositions,mergedBufferGeometry.attributes.position.array);for(let i=0;i<mergedBufferGeometry.attributes.position.array.length;i++)mergedBufferGeometry.attributes.position.array[i]=-99999;for(let i=0;i<particleSystem.activeParticleIndices.length;i++)particleSystem.activeParticleIndices[i]=i;this.particleSystems.push(particleSystem)}}}(),start:function(evt){0<this.data.delay?setTimeout(()=>this.startAfterDelay(evt),this.data.delay):this.startAfterDelay(evt)},startAfterDelay:function(evt){var found=-1,oldestTime=0,position=evt?evt.detail.position:null,rotation=evt?evt.detail.rotation:null,particleSystem;position instanceof THREE.Vector3||(position=new THREE.Vector3),rotation instanceof THREE.Euler||(rotation=new THREE.Euler);for(var i=0;i<this.particleSystems.length;i++){if(!1===this.particleSystems[i].active){found=i;break}this.particleSystems[i].time>oldestTime&&(found=i,oldestTime=this.particleSystems[i].time)}if(-1!==found)return particleSystem=this.particleSystems[found],particleSystem.active=!0,particleSystem.loopCount=1,particleSystem.mesh.visible=!0,particleSystem.mesh.position.copy(position),particleSystem.mesh.rotation.copy(rotation),particleSystem.time=0,this.resetParticles(particleSystem),particleSystem},doLoop:function(particleSystem){particleSystem.loopCount++,particleSystem.frame=-1,particleSystem.time=0,this.resetParticles(particleSystem)},resetParticle:function(particleSystem,particleIndex){const geometry=particleSystem.mesh.geometry;this.restPositions[particleIndex]?transformPlane(particleIndex,geometry,this.originalVertexPositions,this.restPositions[particleIndex],this.useRotation&&this.restRotations[particleIndex],null):transformPlane(particleIndex,geometry,this.originalVertexPositions,OFFSCREEN_VEC3,void 0,null)},resetParticles:function(particleSystem){var i,rand;if(this.particleCount===this.numParticles){for(i=0;i<this.numParticles;i++)this.resetParticle(particleSystem,i);return}const geometry=particleSystem.mesh.geometry;for(i=0;i<this.numParticles;i++)i<this.particleCount&&transformPlane(particleSystem.activeParticleIndices[i],geometry,this.originalVertexPositions,OFFSCREEN_VEC3,void 0,null),this.indexPool[i]=i;for(i=0;i<this.particleCount;i++)rand=i+_Mathfloor5(Math.random()*(this.numParticles-i)),particleSystem.activeParticleIndices[i]=this.indexPool[rand],this.indexPool[rand]=this.indexPool[i],this.resetParticle(particleSystem,particleSystem.activeParticleIndices[i])},tick:function(){const helperPositionVec3=new THREE.Vector3;return function(time,delta){var useRotation=this.useRotation,frame,fdata,fdataNext,frameTime,relTime,interpolate;const scaleSystem=this.data.animateScale&&!this.useAge,scaleParticle=this.data.animateScale&&this.useAge;for(let particleSystemIndex=0,particleSystem;particleSystemIndex<this.particleSystems.length;particleSystemIndex++)if(particleSystem=this.particleSystems[particleSystemIndex],!!particleSystem.active){interpolate=this.data.interpolate&&this.data.dur/this.numFrames>delta,relTime=particleSystem.time/this.data.dur,frame=relTime*this.numFrames,fdata=this.framedata[_Mathfloor5(frame)],interpolate&&(frameTime=frame-_Mathfloor5(frame),fdataNext=frame<this.numFrames-1?this.framedata[_Mathfloor5(frame)+1]:null),scaleSystem&&this.partScale.lerpVectors(this.data.initialScale,this.data.finalScale,relTime);for(let activeParticleIndex=0;activeParticleIndex<particleSystem.activeParticleIndices.length;activeParticleIndex++){let particleIndex=particleSystem.activeParticleIndices[activeParticleIndex],rotation=useRotation&&fdata[particleIndex].rotation;if(scaleParticle&&this.partScale.lerpVectors(this.data.initialScale,this.data.finalScale,fdata[particleIndex].age),!fdata[particleIndex].alive){transformPlane(particleIndex,particleSystem.mesh.geometry,this.originalVertexPositions,OFFSCREEN_VEC3,void 0,null);continue}interpolate&&fdataNext&&fdataNext[particleIndex].alive?(helperPositionVec3.lerpVectors(fdata[particleIndex].position,fdataNext[particleIndex].position,frameTime),transformPlane(particleIndex,particleSystem.mesh.geometry,this.originalVertexPositions,helperPositionVec3,rotation,this.partScale)):transformPlane(particleIndex,particleSystem.mesh.geometry,this.originalVertexPositions,fdata[particleIndex].position,rotation,this.partScale)}if(particleSystem.time+=delta,particleSystem.time>=this.data.dur){particleSystem.loopCount<particleSystem.loopTotal?(this.el.emit('particleplayerloop',null,!1),this.doLoop(particleSystem)):(this.el.emit('particleplayerfinished',null,!1),particleSystem.active=!1,particleSystem.mesh.visible=!1);continue}}}}(),_transformPlane:transformPlane});const tri=function(){const tri=new THREE.Geometry;return tri.vertices.push(new THREE.Vector3),tri.vertices.push(new THREE.Vector3),tri.vertices.push(new THREE.Vector3),tri.faces.push(new THREE.Face3(0,1,2)),tri}();module.exports.transformPlane=transformPlane},function(){AFRAME.registerComponent('pause',{schema:{isPaused:{default:!1}},update:function(){this.data.isPaused&&this.el.isPlaying?this.el.pause():!this.data.isPaused&&!this.el.isPlaying&&this.el.sceneEl.isPlaying&&this.el.play()}})},function(){AFRAME.registerComponent('pauser',{schema:{enabled:{default:!0}},init:function(){this.pauseGame=this.pauseGame.bind(this),this.el.sceneEl.addEventListener('controllerconnected',evt=>{'vive-controls'===evt.detail.name?this.el.addEventListener('menudown',this.pauseGame):this.el.addEventListener('thumbstickdown',this.pauseGame)}),document.addEventListener('visibilitychange',()=>{'hidden'===document.visibilityState&&this.pauseGame()})},pauseGame:function(){this.data.enabled&&this.el.sceneEl.emit('pausegame',null,!1)}})},function(module,exports,__webpack_require__){var SoundPool=__webpack_require__(134);AFRAME.registerSystem('play-sound',{init:function(){this.lastSoundPlayed='',this.lastSoundPlayedTime=0,this.pools={}},createPool:function(sound,volume){this.pools[sound]||(this.pools[sound]=new SoundPool(sound,volume))},playSound:function(sound,volume){this.pools[sound]||this.createPool(sound,volume),this.pools[sound].play(),this.lastSoundPlayed=sound,this.lastSoundTime=this.el.time}}),AFRAME.registerComponent('play-sound',{schema:{enabled:{default:!0},event:{type:'string'},sound:{type:'string'},volume:{type:'number',default:1}},multiple:!0,init:function(){this.el.addEventListener(this.data.event,()=>{this.data.enabled&&this.system.playSound(this.src,this.data.volume)})},update:function(){this.src=this.data.sound,this.data.sound.startsWith('#')&&(this.src=document.querySelector(this.data.sound).getAttribute('src'))}})},function(){AFRAME.registerComponent('raycaster-target',{schema:{bindToggle:{default:''},depth:{type:'number'},height:{type:'number'},position:{type:'vec3',default:{x:0,y:0,z:0}},rotation:{type:'vec3',default:{x:0,y:0,z:0}},useBoxTarget:{default:!1},width:{type:'number'}},init:function(){var boxGeometry={primitive:'box'},planeGeometry={primitive:'plane'};return function(){var data=this.data,el=this.el,geometry,raycastTarget;raycastTarget=document.createElement('a-entity'),raycastTarget.classList.add('raycasterTarget'),data.bindToggle?raycastTarget.setAttribute('bind-toggle__raycastable',data.bindToggle):raycastTarget.setAttribute('data-raycastable',''),data.useBoxTarget?(geometry=boxGeometry,geometry.depth=data.depth,geometry.height=data.height,geometry.width=data.width):(geometry=planeGeometry,geometry.height=data.height,geometry.width=data.width),raycastTarget.setAttribute('geometry',geometry),raycastTarget.object3D.visible=!1,raycastTarget.object3D.position.copy(data.position),raycastTarget.object3D.rotation.x=THREE.Math.degToRad(data.rotation.x),raycastTarget.object3D.rotation.y=THREE.Math.degToRad(data.rotation.y),raycastTarget.object3D.rotation.z=THREE.Math.degToRad(data.rotation.z),el.appendChild(raycastTarget)}}()})},function(){AFRAME.registerComponent('recenter',{schema:{enabled:{default:!0}},init:function(){this.el.sceneEl;this.recenter=this.recenter.bind(this),document.querySelectorAll('[tracked-controls]').forEach(controlEl=>{controlEl.addEventListener('menudown',this.recenter),controlEl.addEventListener('thumbstickdown',this.recenter)}),this.el.addEventListener('recenter',this.recenter)},recenter:function(){var euler=new THREE.Euler,matrix=new THREE.Matrix4,rotationMatrix=new THREE.Matrix4,translationMatrix=new THREE.Matrix4;return function(){const el=this.el;if(this.data.enabled){const camera=el.sceneEl.camera.el.object3D;matrix.identity(),euler.set(0,-1*camera.rotation.y,0),rotationMatrix.makeRotationFromEuler(euler),translationMatrix.makeTranslation(-1*camera.position.x,0,-1*camera.position.z),matrix.multiply(rotationMatrix).multiply(translationMatrix),matrix.decompose(el.object3D.position,el.object3D.quaternion,el.object3D.scale),el.object3D.updateMatrixWorld(!0),el.emit('recentered',null,!1)}}}()})},function(){AFRAME.registerComponent('saber-controls',{schema:{bladeEnabled:{default:!1},hand:{default:'right',oneOf:['left','right']},isPaused:{default:!1},strokeMinSpeed:{default:2e-3},strokeMinDuration:{default:30}},init:function(){var el=this.el,data=this.data;this.boundingBox=new THREE.Box3,this.controllerType='',this.xPlaneNormal=new THREE.Vector3(0,1,0),this.yPlaneNormal=new THREE.Vector3(1,0,0),this.xyPlaneNormal=new THREE.Vector3(1,1,0),this.bladeTipPosition=new THREE.Vector3,this.bladePosition=new THREE.Vector3,this.bladeVector=new THREE.Vector3,this.bladeTipPreviousPosition=new THREE.Vector3,this.projectedBladeVector=new THREE.Vector3,this.saberPosition=new THREE.Vector3,this.swinging=!1,this.strokeCount=0,this.distanceSamples=[],this.deltaSamples=[],this.startStrokePosition=new THREE.Vector3,this.strokeDirectionVector=new THREE.Vector3,this.strokeDirection={down:!1,left:!1,right:!1,up:!1},this.accumulatedDistance=0,this.accumulatedDelta=0,el.addEventListener('controllerconnected',this.initSaber.bind(this));const hand={hand:data.hand,model:!1};el.setAttribute('oculus-touch-controls',hand),el.setAttribute('vive-controls',hand),el.setAttribute('windows-motion-controls',hand),this.bladeEl=this.el.querySelector('.blade')},update:function(oldData){!oldData.bladeEnabled&&this.data.bladeEnabled&&this.bladeEl.emit('drawblade')},tick:function(time,delta){this.data.bladeEnabled&&(this.boundingBox.setFromObject(this.bladeEl.getObject3D('mesh')),this.detectStroke(delta))},detectStroke:function(delta){var distanceSamples=this.distanceSamples,data=this.data,distance;this.bladeTipPosition.set(0,0,-0.8),this.bladePosition.set(0,0,0);const saberObj=this.el.object3D;saberObj.parent.updateMatrixWorld(),saberObj.localToWorld(this.bladeTipPosition),saberObj.localToWorld(this.bladePosition),this.bladeVector.copy(this.bladeTipPosition).sub(this.bladePosition).normalize();var anglePlaneX=this.projectedBladeVector.copy(this.bladeTipPosition).projectOnPlane(this.xPlaneNormal).angleTo(this.bladeVector),anglePlaneY=this.projectedBladeVector.copy(this.bladeTipPosition).projectOnPlane(this.yPlaneNormal).angleTo(this.bladeVector),anglePlaneXY=this.projectedBladeVector.copy(this.bladeTipPosition).projectOnPlane(this.xyPlaneNormal).angleTo(this.bladeVector);if(distance=this.bladeTipPreviousPosition.sub(this.bladeTipPosition).length(),5===this.distanceSamples.length&&(this.accumulatedDistance-=this.distanceSamples.shift(),this.accumulatedDelta-=this.deltaSamples.shift()),this.distanceSamples.push(distance),this.accumulatedDistance+=distance,this.deltaSamples.push(delta),this.accumulatedDelta+=delta,this.accumulatedDistance/this.accumulatedDelta>this.data.strokeMinSpeed){this.swinging||(this.startStrokePosition.copy(this.bladeTipPosition),this.swinging=!0,this.strokeDuration=0,this.maxAnglePlaneX=0,this.maxAnglePlaneY=0,this.maxAnglePlaneXY=0),this.updateStrokeDirection(),this.strokeDuration+=delta;const anglePlaneXIncreased=anglePlaneX>this.maxAnglePlaneX,anglePlaneYIncreased=anglePlaneY>this.maxAnglePlaneY,anglePlaneXYIncreased=anglePlaneXY>this.maxAnglePlaneXY;this.maxAnglePlaneX=anglePlaneXIncreased?anglePlaneX:this.maxAnglePlaneX,this.maxAnglePlaneY=anglePlaneYIncreased?anglePlaneY:this.maxAnglePlaneY,this.maxAnglePlaneXY=anglePlaneXYIncreased?anglePlaneXY:this.maxAnglePlaneXY,anglePlaneXIncreased||anglePlaneYIncreased||this.endStroke()}else this.endStroke();this.bladeTipPreviousPosition.copy(this.bladeTipPosition)},endStroke:function(){if(this.swinging&&!(this.strokeDuration<this.data.strokeMinDuration)){this.swinging=!1,this.accumulatedDistance=0,this.accumulatedDelta=0,this.maxAnglePlaneX=0,this.maxAnglePlaneY=0,this.maxAnglePlaneXY=0;for(let i=0;i<this.distanceSamples.length;i++)this.distanceSamples[i]=0;for(let i=0;i<this.deltaSamples.length;i++)this.deltaSamples[i]=0;this.el.emit('strokeend')}},updateStrokeDirection:function(){this.strokeDirectionVector.copy(this.bladeTipPosition).sub(this.startStrokePosition);0===this.strokeDirectionVector.x&&0===this.strokeDirectionVector.y||(this.strokeDirection.right=0<this.strokeDirectionVector.x,this.strokeDirection.left=0>this.strokeDirectionVector.x,this.strokeDirection.up=0<this.strokeDirectionVector.y,this.strokeDirection.down=0>this.strokeDirectionVector.y)},initSaber:function(evt){this.controllerType=evt.detail.name,this.el.setAttribute('cursor',this.config[this.controllerType].cursor||{})},config:{"oculus-touch-controls":{cursor:{downEvents:['triggerdown','gripdown','abuttondown','bbuttondown','xbuttondown','ybuttondown'],upEvents:['triggerup','gripup','abuttonup','bbuttonup','xbuttonup','ybuttonup']}},"vive-controls":{cursor:{downEvents:['trackpaddown','triggerdown','gripdown'],upEvents:['trackpadup','triggerup','gripup']}},"windows-motion-controls":{cursor:{downEvents:['trackpaddown','triggerdown','gripdown'],upEvents:['trackpadup','triggerup','gripup']}}}})},function(){AFRAME.registerComponent('saber-particles',{schema:{enabled:{default:!1},hand:{type:'string'}},init:function(){this.hiddenIntersection={x:999,y:0,z:0},this.intersectedEl=null,this.particles=document.getElementById('sparkParticles'),this.particleEventDetail={position:new THREE.Vector3,rotation:new THREE.Euler},this.particleEvent={detail:this.particleEventDetail},this.particleSystem=null,this.saberEnter=this.saberEnter.bind(this),this.saberLeave=this.saberLeave.bind(this)},pause:function(){this.el.removeEventListener('mouseenter',this.saberEnter),this.el.removeEventListener('mouseleave',this.saberLeave)},play:function(){this.el.addEventListener('mouseenter',this.saberEnter),this.el.addEventListener('mouseleave',this.saberLeave),this.particlesDur=this.particles.getAttribute('particleplayer').dur},saberEnter:function(evt){this.data.enabled&&evt.target===this.el&&evt.detail.intersectedEl.hasAttribute('data-saber-particles')&&(this.intersectedEl=evt.detail.intersectedEl)},saberLeave:function(evt){if(evt.detail.target===this.el){if(this.intersectedEl.components.wall||'floor'===this.intersectedEl.id){const uniform=this.data.hand==='right'?'hitRight':'hitLeft',material=this.intersectedEl.getObject3D('mesh').material;material.uniforms[uniform].value=this.hiddenIntersection}this.intersectedEl=null,this.particleSystem=null}},tick:function(){if(this.data.enabled&&this.intersectedEl){const raycaster=this.el.components.raycaster__game,intersection=raycaster.getIntersection(this.intersectedEl);intersection&&(this.particleSystem&&this.particleSystem.active?this.particleSystem.mesh.position.copy(intersection.point):(this.particleEventDetail.position.copy(intersection.point),this.particleSystem=this.particles.components.particleplayer.startAfterDelay(this.particleEvent)))}}})},function(){AFRAME.registerComponent('score-beat',{schema:{type:{type:'string'}},play:function(){this.poolComponent=`pool__beatscore${this.data.type}`,this.startTime=this.el.sceneEl.time},tick:function(time){time>this.startTime+1200&&this.el.sceneEl.components[this.poolComponent].returnEntity(this.el)}})},function(){AFRAME.registerComponent('score-texts',{schema:{isSongLoading:{default:!1}},init:function(){this.textEls=this.el.querySelectorAll('[text]');for(let i=0;i<this.textEls.length;i++)this.textEls[i].setAttribute('animation__fadein',{autoplay:!1,property:'components.text.material.uniforms.opacity.value',delay:250,dur:750,easing:'easeInOutCubic',from:0,to:1})},update:function(oldData){if(oldData.isSongLoading&&!this.data.isSongLoading){for(let i=0;i<this.textEls.length;i++)this.textEls[i].components.animation__fadein.beginAnimation();this.el.sceneEl.emit('textglownormal',null,!1)}if(!oldData.isSongLoading&&this.data.isSongLoading){for(let i=0;i<this.textEls.length;i++)this.textEls[i].components.text.material.uniforms.opacity.value=0;this.el.sceneEl.emit('textglowoff',null,!1)}}})},function(module,__webpack_exports__,__webpack_require__){'use strict';Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0__utils__=__webpack_require__(2),__WEBPACK_IMPORTED_MODULE_0__utils___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__utils__),CANVAS_HEIGHT=512,HEIGHT=64,NUM_PER_PAGE=6,WIDTH=64,IMAGE_HEIGHT_CANVAS=HEIGHT*(CANVAS_HEIGHT/(HEIGHT*NUM_PER_PAGE));AFRAME.registerComponent('search-thumbnail-atlas',{dependencies:['geometry','material'],schema:{dummyUpdater:{type:'string'}},init:function(){const canvas=this.canvas=document.createElement('canvas');canvas.setAttribute('id','thumbnailAtlasMap'),canvas.height=CANVAS_HEIGHT,canvas.width=WIDTH,this.ctx=canvas.getContext('2d'),this.clearCanvas(),document.body.appendChild(canvas);const alphaCanvas=this.alphaCanvas=document.createElement('canvas');alphaCanvas.setAttribute('id','thumbnailAlphaMap'),alphaCanvas.height=CANVAS_HEIGHT,alphaCanvas.width=WIDTH,this.alphaCtx=alphaCanvas.getContext('2d'),document.body.appendChild(alphaCanvas),this.el.components.material.material.alphaMap=new THREE.CanvasTexture(alphaCanvas),this.el.setAttribute('material','src',canvas),this.images=[],this.lastNumResults=NUM_PER_PAGE},update:function(){var el=this.el;const results=el.sceneEl.systems.state.state.searchResultsPage;for(let i=0,img;i<results.length;i++)img=this.images[i]=this.images[i]||document.createElement('img'),img.crossOrigin='anonymous',img.src=__WEBPACK_IMPORTED_MODULE_0__utils___default.a.getS3FileUrl(results[i].id,'image.jpg'),img.complete?this.draw(img,i):img.onload=()=>{this.draw(img,i)};results.length!==this.lastNumResults&&this.updateAlphaMap(results.length),this.lastNumResults=results.length},draw:function(img,i){this.ctx.drawImage(img,0,i*IMAGE_HEIGHT_CANVAS,WIDTH,IMAGE_HEIGHT_CANVAS),this.el.getObject3D('mesh').material.map.needsUpdate=!0},clearCanvas:function(){const canvas=this.canvas;this.ctx.fillStyle='#111',this.ctx.fillRect(0,0,canvas.width,canvas.height)},updateAlphaMap:function(numResults){const canvas=this.alphaCanvas,ctx=this.alphaCtx;ctx.fillStyle='#FFF',ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle='#000',ctx.fillRect(0,numResults*IMAGE_HEIGHT_CANVAS,canvas.width,canvas.height-numResults*IMAGE_HEIGHT_CANVAS),this.el.getObject3D('mesh').material.alphaMap.needsUpdate=!0,this.el.getObject3D('mesh').material.needsUpdate=!0}})},function(module,exports,__webpack_require__){var algoliasearch=__webpack_require__(45),bindEvent=__webpack_require__(15).bindEvent,client=algoliasearch('QULTOY3ZWU','be07164192471df7e97e6fa70c1d041d'),algolia=client.initIndex('supersaber');AFRAME.registerComponent('search',{init:function(){this.eventDetail={query:'',results:[]},this.popularHits=null,this.queryObject={hitsPerPage:100,query:''},this.search(''),this.queryObject.hitsPerPage=30,this.el.sceneEl.addEventListener('searchclear',()=>{this.search('')})},superkeyboardchange:bindEvent(function(evt){evt.target!==this.el||this.search(evt.detail.value)}),search:function(query){return!query&&this.popularHits?(this.eventDetail.results=this.popularHits,this.eventDetail.query='',void this.el.sceneEl.emit('searchresults',this.eventDetail)):void(this.eventDetail.query=query,this.queryObject.query=query,algolia.search(this.queryObject,(err,content)=>err?(this.el.sceneEl.emit('searcherror',null,!1),void console.error(err)):void(!query&&(this.popularHits=content.hits),this.eventDetail.results=content.hits,this.el.sceneEl.emit('searchresults',this.eventDetail))))}}),AFRAME.registerComponent('search-genre',{init:function(){this.eventDetail={isGenreSearch:!0,genre:'',results:[]},this.queryObject={filters:'',hitsPerPage:100},this.el.addEventListener('click',evt=>{this.search(evt.target.closest('.genre').dataset.bindForKey)})},search:function(genre){this.queryObject.filters='Video Games'===genre?`genre:"Video Game" OR genre:"Video Games"`:`genre:"${genre}"`,algolia.search(this.queryObject,(err,content)=>err?(this.el.sceneEl.emit('searcherror',null,!1),void console.error(err)):void(this.eventDetail.genre=genre,this.eventDetail.results=content.hits,this.el.sceneEl.emit('searchresults',this.eventDetail)))}}),AFRAME.registerComponent('search-result-list',{init:function(){const obv=new MutationObserver(mutations=>{for(let i=0;i<mutations.length;i++)'data-index'===mutations[i].attributeName&&this.refreshLayout()});obv.observe(this.el,{attributes:!0,childList:!1,subtree:!0})},refreshLayout:function(){this.el.emit('layoutrefresh',null,!1)},click:bindEvent(function(evt){this.el.sceneEl.emit('menuchallengeselect',evt.target.closest('.searchResult').dataset.id,!1)})}),AFRAME.registerComponent('search-song-name-selected',{schema:{anchor:{default:0},index:{default:0},offset:{default:0},selectedChallengeId:{default:''}},update:function(){const data=this.data,el=this.el;el.object3D.visible=!!data.selectedChallengeId&&-1!==data.index,el.object3D.position.y=data.index*data.offset+data.anchor}})},function(module,exports,__webpack_require__){var utils=__webpack_require__(2);AFRAME.registerComponent('song-preview-system',{schema:{challengeId:{default:''},debug:{default:!1},isSearching:{default:!1},isSongLoading:{default:!1},selectedChallengeId:{type:'string'}},init:function(){this.analyserEl=document.getElementById('audioAnalyser'),this.audio=document.createElement('audio'),this.audioStore={},this.preloadedAudioIds=[],this.preloadQueue=[]},update:function(oldData){const data=this.data;return!oldData.challengeId&&data.challengeId?void((0===this.analyserEl.components.audioanalyser.volume||1>this.audio.currentTime)&&this.stopSong()):(!oldData.selectedChallengeId||data.selectedChallengeId||data.isSearching||this.stopSong(),oldData.isSongLoading&&!data.isSongLoading?void this.stopSong():void(data.selectedChallengeId&&oldData.selectedChallengeId!==data.selectedChallengeId&&(this.audio&&this.stopSong(),!this.preloadedAudioIds.includes(data.selectedChallengeId)&&data.selectedChallengeId!==this.currentLoadingId&&this.prioritizePreloadSong(),this.playSong(data.selectedChallengeId))))},log:function(str){this.data.debug&&console.log(str)},prioritizePreloadSong:function(){const data=this.data,preloadQueue=this.preloadQueue;this.log(`[song-preview] Prioritizing loading of ${data.selectedChallengeId}`),this.priorityLoadingChallengeId=data.selectedChallengeId,this.audioStore[data.selectedChallengeId].addEventListener('loadeddata',()=>{this.log(`[song-preview] Finished load of priority ${data.selectedChallengeId}`),this.preloadedAudioIds.push(data.selectedChallengeId),this.priorityLoadingChallengeId='',preloadQueue.length&&(this.log(`[song-preview] Resuming queue with ${preloadQueue[0].challengeId}`),this.preloadMetadata(preloadQueue[0]))}),this.audioStore[data.selectedChallengeId].src=utils.getS3FileUrl(data.selectedChallengeId,'song.ogg');for(let i=0;i<preloadQueue.length;i++)if(preloadQueue[i].challengeId===data.selectedChallengeId){preloadQueue.splice(i,1);break}},queuePreloadSong:function(challengeId,previewStartTime){if(!this.audioStore[challengeId]){const audio=document.createElement('audio');audio.crossOrigin='anonymous',audio.dataset.previewStartTime=previewStartTime,this.audioStore[challengeId]=audio;let src=utils.getS3FileUrl(challengeId,'song.ogg');this.currentLoadingId?this.preloadQueue.push({audio:audio,challengeId:challengeId,src:src}):this.preloadMetadata({audio:audio,challengeId:challengeId,src:src})}},preloadMetadata:function(preloadItem){const audio=preloadItem.audio;this.log(`[song-preview] Preloading song preview ${preloadItem.challengeId}`),audio.addEventListener('loadedmetadata',()=>{this.log(`[song-preview] Finished preloading song preview ${preloadItem.challengeId}`),this.preloadedAudioIds.push(preloadItem.challengeId),this.currentLoadingId='',this.log(`[song-preview] ${this.preloadQueue.length} in queue`),this.preloadQueue.length&&!this.priorityLoadingChallengeId&&this.preloadMetadata(this.preloadQueue.shift())}),audio.preload='metadata',audio.src=preloadItem.src,this.currentLoadingId=preloadItem.challengeId},stopSong:function(){this.audio&&(this.audio.paused||this.audio.pause())},playSong:function(challengeId){if(challengeId){this.audio=this.audioStore[challengeId],this.audio.load(),this.audio.volume=0.5,this.audio.currentTime=this.audio.dataset.previewStartTime,this.analyserEl.setAttribute('audioanalyser','src',this.audio);const audioanalyser=this.analyserEl.components.audioanalyser;audioanalyser.resumeContext(),this.audio.play(),audioanalyser.xhr&&audioanalyser.xhr.abort(),audioanalyser.fetchAudioBuffer(utils.getS3FileUrl(challengeId,'song.ogg'))}},clearSong:function(challengeId){let audio=this.audioStore[challengeId];audio.preload='none';let index;for(let i=0;i<this.preloadQueue.length;i++)if(this.preloadQueue[i].id===challengeId){index=i;break}index&&this.preloadQueue.splice(index,1)}}),AFRAME.registerComponent('song-preview',{schema:{challengeId:{type:'string'},previewStartTime:{type:'number'}},update:function(oldData){oldData.challengeId&&this.data.challengeId!==oldData.challengeId&&this.el.sceneEl.components['song-preview-system'].clearSong(oldData.challengeId),this.el.sceneEl.components['song-preview-system'].queuePreloadSong(this.data.challengeId,this.data.previewStartTime)}})},function(){AFRAME.registerComponent('song-progress-ring',{dependencies:['geometry','material'],schema:{enabled:{default:!1}},init:function(){this.tick=AFRAME.utils.throttleTick(this.tick.bind(this),1e3),this.progress=this.el.getObject3D('mesh').material.uniforms.progress,this.el.sceneEl.addEventListener('cleargame',()=>{this.progress.value=0})},update:function(){this.progress.value=0},updateRing:function(){const source=this.el.sceneEl.components.song.source;if(source){const progress=this.el.sceneEl.components.song.getCurrentTime()/source.buffer.duration;this.progress.value=progress}},tick:function(){this.data.enabled&&this.updateRing()}})},function(module,exports,__webpack_require__){const utils=__webpack_require__(2),GAME_OVER_LENGTH=3.5,ONCE={once:!0},BASE_VOLUME=0.75;let skipDebug=AFRAME.utils.getUrlParameter('skip');!skipDebug||(skipDebug=parseInt(skipDebug)/1e3),AFRAME.registerComponent('song',{schema:{analyserEl:{type:'selector',default:'#audioAnalyser'},challengeId:{default:''},isBeatsPreloaded:{default:!1},isGameOver:{default:!1},isPlaying:{default:!1},isVictory:{default:!1}},init:function(){this.analyserSetter={buffer:!0},this.audioAnalyser=this.data.analyserEl.components.audioanalyser,this.context=this.audioAnalyser.context,this.isPlaying=!1,this.songLoadingIndicator=document.getElementById('songLoadingIndicator'),this.songStartTime=0,this.victory=this.victory.bind(this),this.audioAnalyser.gainNode.gain.value=BASE_VOLUME,this.el.addEventListener('gamemenurestart',this.onRestart.bind(this)),this.el.addEventListener('wallhitstart',this.onWallHitStart.bind(this)),this.el.addEventListener('wallhitend',this.onWallHitEnd.bind(this)),!1},update:function(oldData){var data=this.data;return!oldData.isGameOver&&data.isGameOver?void this.onGameOver():(oldData.isGameOver&&!data.isGameOver&&(this.audioAnalyser.gainNode.value=BASE_VOLUME),!oldData.isVictory&&data.isVictory)?(this.data.analyserEl.addEventListener('audioanalyserbuffersource',evt=>{this.audioAnalyser.resumeContext();const gain=this.audioAnalyser.gainNode.gain;gain.cancelScheduledValues(0),gain.setValueAtTime(0.05,0),this.source=evt.detail,this.source.start()},ONCE),void this.audioAnalyser.refreshSource()):(!oldData.isBeatsPreloaded&&this.data.isBeatsPreloaded&&this.source&&this.startAudio(),oldData.challengeId&&!data.challengeId?void this.stopAudio():void(oldData.challengeId!==data.challengeId&&data.challengeId&&(this.el.sceneEl.emit('songloadstart',null,!1),this.getAudio().then(()=>{this.el.sceneEl.emit('songloadfinish',null,!1)}).catch(console.error)),oldData.isPlaying&&!data.isPlaying&&this.audioAnalyser.suspendContext(),!oldData.isPlaying&&data.isPlaying&&this.source&&this.audioAnalyser.resumeContext()))},getAudio:function(){const data=this.data;return this.isPlaying=!1,new Promise(resolve=>(data.analyserEl.addEventListener('audioanalyserbuffersource',evt=>{this.source=evt.detail,resolve(this.source)},ONCE),this.analyserSetter.src=utils.getS3FileUrl(data.challengeId,'song.ogg'),data.analyserEl.setAttribute('audioanalyser',this.analyserSetter),this.audioAnalyser.xhr.response?(this.songLoadingIndicator.setAttribute('material','progress',1),void this.el.sceneEl.emit('songfetchfinish',null,!1)):void this.audioAnalyser.xhr.addEventListener('progress',evt=>{this.onFetchProgress(evt)})))},stopAudio:function(){return this.source?void(this.source.stop(),this.source.disconnect(),this.source=null,this.isPlaying=!1):void console.warn('[song] Tried to stopAudio, but not playing.')},victory:function(){this.data.isPlaying&&this.el.sceneEl.emit('victory',null,!1)},onFetchProgress:function(evt){const progress=evt.loaded/evt.total;this.songLoadingIndicator.setAttribute('material','progress',progress),1<=progress&&this.el.sceneEl.emit('songfetchfinish',null,!1)},onGameOver:function(){this.isPlaying=!1;const playbackRate=this.source.playbackRate;playbackRate.setValueAtTime(playbackRate.value,this.context.currentTime),playbackRate.linearRampToValueAtTime(0,this.context.currentTime+GAME_OVER_LENGTH);const gain=this.audioAnalyser.gainNode.gain;gain.setValueAtTime(gain.value,this.context.currentTime),gain.linearRampToValueAtTime(0,this.context.currentTime+GAME_OVER_LENGTH),setTimeout(()=>{this.data.isGameOver&&this.stopAudio()},3500)},onRestart:function(){this.isPlaying=!1,this.source&&this.source.disconnect();const gain=this.audioAnalyser.gainNode.gain;gain.cancelScheduledValues(0),this.data.analyserEl.addEventListener('audioanalyserbuffersource',evt=>{this.source=evt.detail,this.el.sceneEl.emit('songloadfinish',null,!1)},ONCE),this.audioAnalyser.refreshSource()},onWallHitStart:function(){const gain=this.audioAnalyser.gainNode.gain;gain.linearRampToValueAtTime(0.2,this.context.currentTime+0.1)},onWallHitEnd:function(){const gain=this.audioAnalyser.gainNode.gain;gain.linearRampToValueAtTime(BASE_VOLUME,this.context.currentTime+0.1)},startAudio:function(){const gain=this.audioAnalyser.gainNode.gain;gain.setValueAtTime(BASE_VOLUME,this.context.currentTime),this.songStartTime=this.context.currentTime,this.source.onended=this.victory,this.source.start(0,skipDebug),this.isPlaying=!0},getCurrentTime:function(){return this.context.currentTime-this.songStartTime}})},function(){AFRAME.registerComponent('stage-colors',{dependencies:['background'],schema:{color:{default:'blue',oneOf:['blue','red']}},init:function(){this.colorCodes=['off','blue','blue','bluefade','','red','red','redfade'],this.el.addEventListener('cleargame',this.resetColors.bind(this))},update:function(){this.updateColors(this.data.color)},setColor:function(target,code){this.el.emit(`${target}color${this.colorCodes[code]}`,null,!1)},resetColors:function(){this.updateColors('blue'),this.el.emit('bgcolorblue',null,!1),this.el.emit('tunnelcolorred',null,!1),this.el.emit('floorcolorred',null,!1),this.el.emit('leftlasercolorblue',null,!1),this.el.emit('rightlasercolorblue',null,!1)},updateColors:function(){}})},function(){AFRAME.registerComponent('stage-lasers',{schema:{enabled:{default:!0}},init:function(){this.speed=0,this.lasers=[this.el.children[0].object3D,this.el.children[1].object3D,this.el.children[2].object3D]},pulse:function(speed){this.speed=speed/8},tick:function(time,delta){if(0!==this.speed)return delta/=1e3,!this.data.enabled&&(this.speed*=0.97,0.01>Math.abs(this.speed))?void(this.speed=0):void(this.lasers[0].rotation.z+=this.speed*delta,this.lasers[1].rotation.z-=1.01*(this.speed*delta),this.lasers[2].rotation.z+=1.02*(this.speed*delta))}})},function(){AFRAME.registerShader('stageShader',{schema:{color:{type:'vec3',is:'uniform',default:{x:0,y:0,z:0}},fogColor:{type:'vec3',is:'uniform',default:{x:0,y:0.48,z:0.72}},src:{type:'map',is:'uniform'}},vertexShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      vec4 p = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      worldPos = (modelMatrix * vec4( position, 1.0 )).xyz;
      gl_Position = p;
    }
  `,fragmentShader:`
    #define FOG_RADIUS  50.0
    #define FOG_FALLOFF 45.0
    varying vec2 uvs;
    varying vec3 worldPos;
    uniform vec3 color;
    uniform vec3 fogColor;
    uniform sampler2D src;

    void main() {
      vec4 col = texture2D(src, uvs);
      col.xyz = mix(fogColor, col.xyz, clamp(distance(worldPos, vec3(0., 0., -FOG_RADIUS)) / FOG_FALLOFF, 0., 1.));
      gl_FragColor = col;
    }
  `})},function(){AFRAME.registerComponent('stats-param',{init:function(){'true'===AFRAME.utils.getUrlParameter('stats')&&this.el.setAttribute('stats','')}})},function(){AFRAME.registerComponent('stepback',{init:function(){this.message=document.getElementById('stepback'),this.camera=document.getElementById('camera'),this.lastTime=0,this.limit=-(this.el.getAttribute('geometry').height/2-0.6),this.throttling=300},tick:function(time){if(!(time-this.lastTime<this.throttling)){var camPos=this.camera.object3D.position,msgPos=this.message.object3D.position;camPos.z<this.limit?(this.throttling=20,this.message.object3D.visible=!0,this.message.getObject3D('mesh').material.opacity=1-Math.abs(camPos.z-msgPos.z),msgPos.x=camPos.x,msgPos.y=camPos.y):(this.message.object3D.visible=!1,this.throttling=300),this.lastTime=time}}})},function(){AFRAME.registerComponent('sub-object',{schema:{from:{type:'selector'},name:{type:'string'}},init:function(){var el=this.el,data=this.data;data.from.addEventListener('model-loaded',evt=>{const model=evt.detail.model,subset=model.getObjectByName(data.name);el.setObject3D('mesh',subset.clone()),el.setAttribute('material','shader','flat'),el.emit('subobjectloaded',null,!1)})}})},function(){function findFontChar(chars,code){for(var i=0;i<chars.length;i++)if(chars[i].id===code)return chars[i];return null}var _Mathfloor6=Math.floor,KEYBOARDS={supersaber:{wrapCount:20,inputOffsetY:8e-3,inputOffsetX:0.08,img:'keyboard.png',hoverImg:'keyboard-hover.png',layout:[{key:'1',x:0.014,y:0.024,w:0.094,h:0.183},{key:'2',x:0.108,y:0.024,w:0.094,h:0.183},{key:'3',x:0.203,y:0.024,w:0.095,h:0.183},{key:'4',x:0.299,y:0.024,w:0.094,h:0.183},{key:'5',x:0.394,y:0.024,w:0.093,h:0.183},{key:'6',x:0.487,y:0.024,w:0.095,h:0.183},{key:'7',x:0.583,y:0.024,w:0.093,h:0.183},{key:'8',x:0.677,y:0.024,w:0.095,h:0.183},{key:'9',x:0.772,y:0.024,w:0.093,h:0.183},{key:'0',x:0.866,y:0.024,w:0.093,h:0.183},{key:'q',x:0.014,y:0.215,w:0.094,h:0.183},{key:'w',x:0.108,y:0.215,w:0.094,h:0.183},{key:'e',x:0.203,y:0.215,w:0.095,h:0.183},{key:'r',x:0.299,y:0.215,w:0.094,h:0.183},{key:'t',x:0.394,y:0.215,w:0.093,h:0.183},{key:'y',x:0.487,y:0.215,w:0.095,h:0.183},{key:'i',x:0.677,y:0.215,w:0.095,h:0.183},{key:'u',x:0.583,y:0.215,w:0.093,h:0.183},{key:'o',x:0.772,y:0.215,w:0.093,h:0.183},{key:'p',x:0.866,y:0.215,w:0.093,h:0.183},{key:'a',x:0.063,y:0.405,w:0.094,h:0.183},{key:'s',x:0.158,y:0.405,w:0.094,h:0.183},{key:'d',x:0.253,y:0.405,w:0.095,h:0.183},{key:'f',x:0.349,y:0.405,w:0.094,h:0.183},{key:'g',x:0.443,y:0.405,w:0.093,h:0.183},{key:'h',x:0.537,y:0.405,w:0.095,h:0.183},{key:'j',x:0.633,y:0.405,w:0.092,h:0.183},{key:'k',x:0.726,y:0.405,w:0.095,h:0.183},{key:'l',x:0.821,y:0.405,w:0.093,h:0.183},{key:'z',x:0.111,y:0.598,w:0.093,h:0.181},{key:'x',x:0.205,y:0.598,w:0.095,h:0.181},{key:'c',x:0.301,y:0.598,w:0.095,h:0.181},{key:'v',x:0.396,y:0.598,w:0.093,h:0.181},{key:'b',x:0.49,y:0.598,w:0.094,h:0.181},{key:'n',x:0.585,y:0.598,w:0.094,h:0.181},{key:'m',x:0.68,y:0.598,w:0.093,h:0.181},{key:'Delete',x:0.777,y:0.598,w:0.137,h:0.181},{key:' ',x:0.297,y:0.788,w:0.381,h:0.201},{key:'Escape',x:0.013,y:0.797,w:0.137,h:0.181},{key:'Insert',x:0.014,y:-1e-3,w:0.01,h:5e-3}]}};if('undefined'==typeof AFRAME)throw new Error('Component attempted to register before AFRAME was available.');var FontFactors={roboto:17,aileronsemibold:20,dejavu:20.5,exo2bold:20,exo2semibold:20.3,kelsonsans:22.8,monoid:19.5,mozillavr:9.5,sourcecodepro:20.3};AFRAME.registerComponent('super-keyboard',{schema:{align:{default:'left',oneOf:['left','center','right']},blinkingSpeed:{type:'int',default:400},filters:{type:'array'},font:{default:'aileronsemibold'},hand:{type:'selector'},imagePath:{default:'.'},injectToRaycasterObjects:{default:!0},inputColor:{type:'color',default:'#6699ff'},interval:{type:'int',default:50},keyBgColor:{type:'color',default:'#000'},keyColor:{type:'color',default:'#6699ff'},keyHoverColor:{type:'color',default:'#1A407F'},keyPressColor:{type:'color',default:'#5290F6'},label:{type:'string',default:''},labelColor:{type:'color',default:'#aaa'},maxLength:{type:'int',default:0},model:{default:'basic'},show:{default:!0},value:{type:'string',default:''},width:{default:0.8}},init:function(){this.el.addEventListener('click',this.click.bind(this)),this.changeEventDetail={},this.textInputObject={},this.keys=null,this.focused=!1,this.keyHover=null,this.prevCheckTime=null,this.shift=!1,this.rawValue=this.data.value,this.defaultValue=this.data.value,this.userFilterFunc=null,this.intervalId=0,this.kbImg=document.createElement('a-entity'),this.kbImg.classList.add('keyboardRaycastable'),this.kbImg.classList.add('superKeyboardImage'),this.kbImg.addEventListener('raycaster-intersected',this.hover.bind(this)),this.kbImg.addEventListener('raycaster-intersected-cleared',this.blur.bind(this)),this.el.appendChild(this.kbImg),this.label=document.createElement('a-entity'),this.label.setAttribute('text',{align:'center',font:this.data.font,baseline:'bottom',lineHeight:40,shader:'msdf',negate:!0,value:this.data.label,color:this.data.labelColor,width:this.data.width,wrapCount:30}),this.el.appendChild(this.label),this.textInput=document.createElement('a-entity'),this.textInput.setAttribute('mixin','superKeyboardTextInput'),this.textInput.setAttribute('text',{align:this.data.align,font:this.data.font,lineHeight:35,value:this.data.value,color:this.data.inputColor,width:this.data.width,wrapCount:20}),this.el.appendChild(this.textInput),this.cursor=document.createElement('a-entity'),this.cursor.object3D.position.set(0,0,1e-3),this.cursor.setAttribute('material',{shader:'flat',color:this.data.inputColor}),this.textInput.appendChild(this.cursor),this.cursorUpdated=!1,this.keyBgColor=new THREE.Color,this.keyHoverColor=new THREE.Color,this.keyPressColor=new THREE.Color;var self=this;document.addEventListener('keydown',function(ev){if('t'===ev.key){for(var ss='',s='abcdefghijklmopqrstuvQWIEUTGASDLIGKBXACQWETL102394676457',l=_Mathfloor6(20*Math.random()),i=0;i<l;i++)ss+=s[_Mathfloor6(Math.random()*s.length)];self.el.setAttribute('super-keyboard',{value:ss})}}),document.addEventListener('show',this.open.bind(this)),this.hand=null,this.handListenersSet=!1,this.raycaster=null},update:function(oldData){var kbdata=KEYBOARDS[this.data.model],w=this.data.width,h=this.data.width/2;if(void 0===kbdata)return void console.error('super-keyboard ERROR: model "'+this.data.model+'" undefined.');oldData&&this.defaultValue===oldData.defaultValue?this.updateTextInput(this.filter(this.rawValue)):(this.rawValue=this.data.value,this.defaultValue=this.data.value,this.updateTextInput(this.filter(this.data.value))),(this.data.width!==oldData.width||this.data.height!==oldData.height||this.data.keyColor!==oldData.keyColor)&&(this.kbImg.setAttribute('geometry',{primitive:'plane',width:w,height:h}),this.kbImg.setAttribute('material',{shader:'flat',src:this.data.imagePath+'/'+kbdata.img,color:this.data.keyColor,transparent:!0})),(this.data.label!==oldData.label||this.data.labelColor!==oldData.labelColor||this.data.width!==oldData.width)&&(this.label.setAttribute('text',{value:this.data.label,color:this.data.labelColor,width:this.data.width}),this.label.object3D.position.set(0,0.35*w,-0.02)),(this.data.width!==oldData.width||this.data.keyBgColor!==oldData.keyBgColor)&&this.initKeyColorPlane();var inputx='center'===this.data.align?0:kbdata.inputOffsetX*w;'right'===this.data.align&&(inputx*=-1),(this.data.font!==oldData.font||this.data.inputColor!==oldData.inputColor||this.data.width!==oldData.width||this.data.align!==oldData.align)&&this.textInput.setAttribute('text',{font:this.data.font,color:this.data.inputColor,width:w,wrapCount:kbdata.wrapCount,align:this.data.align});for(var i=0,kdata;i<kbdata.layout.length;i++)kdata=kbdata.layout[i],'Insert'===kdata.key&&(this.inputRect=kdata);this.textInput.object3D.position.set(inputx,w/4-(this.inputRect.y+this.inputRect.h/2)*w/2+kbdata.inputOffsetY*w,2e-3),this.data.width!==oldData.width&&this.cursor.setAttribute('geometry',{primitive:'plane',width:0.03*w,height:0.01*w}),this.updateCursorPosition(),this.setupHand(),this.keyBgColor.set(this.data.keyBgColor),this.keyHoverColor.set(this.data.keyHoverColor),this.keyPressColor.set(this.data.keyPressColor),this.data.show?this.open():this.close()},tick:function(time){var intersection;if(!(this.prevCheckTime&&time-this.prevCheckTime<this.data.interval)){if(!this.prevCheckTime)return void(this.prevCheckTime=time);if(this.raycaster&&this.focused&&(intersection=this.raycaster.getIntersection(this.kbImg),!!intersection))for(var uv=intersection.uv,keys=KEYBOARDS[this.data.model].layout,i=0,k;i<keys.length;i++)if(k=keys[i],uv.x>k.x&&uv.x<k.x+k.w&&1-uv.y>k.y&&1-uv.y<k.y+k.h){this.keyHover!==k&&(this.keyHover=k,this.updateKeyColorPlane(this.keyHover.key,this.keyHoverColor));break}}},play:function(){this.cursorUpdated&&this.startBlinking()},pause:function(){this.stopBlinking()},initKeyColorPlane:function(){var kbdata=KEYBOARDS[this.data.model],keyColorPlane=this.keyColorPlane=document.createElement('a-entity');keyColorPlane.classList.add('superKeyboardKeyColorPlane'),keyColorPlane.object3D.position.z=1e-3,keyColorPlane.object3D.visible=!1,keyColorPlane.setAttribute('geometry',{primitive:'plane',buffer:!1}),keyColorPlane.setAttribute('material',{shader:'flat',color:this.data.keyBgColor,transparent:!0}),kbdata.hoverImg&&keyColorPlane.setAttribute('material',{src:this.data.imagePath+'/'+kbdata.hoverImg}),keyColorPlane.addEventListener('componentinitialized',function(evt){'material'===evt.detail.name&&(kbdata.hoverImg||(this.getObject3D('mesh').material.blending=THREE.AdditiveBlending))}),this.el.appendChild(keyColorPlane)},updateKeyColorPlane:function(key,color){var kbdata=KEYBOARDS[this.data.model],keyColorPlane=this.keyColorPlane;if(!key)return void(keyColorPlane.object3D.visible=!1);for(var i=0,kdata;i<kbdata.layout.length;i++)if(kdata=kbdata.layout[i],kdata.key===key){var w=this.data.width,h=this.data.width/2,keyw=kdata.w*w,keyh=kdata.h*h;keyColorPlane.object3D.scale.x=keyw,keyColorPlane.object3D.scale.y=keyh,keyColorPlane.object3D.position.x=kdata.x*w-w/2+keyw/2,keyColorPlane.object3D.position.y=(1-kdata.y)*h-h/2-keyh/2,keyColorPlane.getObject3D('mesh').material.color.copy(color);var geometry=keyColorPlane.getObject3D('mesh').geometry,uvSet=geometry.faceVertexUvs[0],kdataY=1-kdata.y;uvSet[0][0].set(kdata.x,kdataY),uvSet[0][1].set(kdata.x,kdataY-kdata.h),uvSet[0][2].set(kdata.x+kdata.w,kdataY),uvSet[1][0].set(kdata.x,kdataY-kdata.h),uvSet[1][1].set(kdata.x+kdata.w,kdataY-kdata.h),uvSet[1][2].set(kdata.x+kdata.w,kdataY),geometry.uvsNeedUpdate=!0;break}keyColorPlane.object3D.visible=!0},setupHand:function(){if(this.hand&&this.hand.ownRaycaster&&this.hand.removeAttribute('raycaster'),this.hand=this.data.hand?this.data.hand:document.querySelector(['[cursor]','[vive-controls]','[tracked-controls]','[oculus-touch-controls]','[windows-motion-controls]','[hand-controls]','[daydream-controls] [cursor] > [raycaster]'].join(',')),!this.hand)console.error('super-keyboard: no controller found. Add <a-entity> with controller or specify with super-keyboard="hand: #selectorToController".');else{if(!this.hand.hasLoaded)return void this.hand.addEventListener('loaded',this.setupHand.bind(this));var raycaster=this.hand.components.raycaster,params={};if(!raycaster)this.hand.ownRaycaster=!0,params.showLine=this.data.show,params.enabled=this.data.show,this.data.injectToRaycasterObjects&&(params.objects='.keyboardRaycastable'),this.hand.setAttribute('raycaster',params);else if(this.hand.ownRaycaster=!1,this.data.injectToRaycasterObjects){var objs=raycaster.data.objects.split(',');-1===objs.indexOf('.keyboardRaycastable')&&objs.push('.keyboardRaycastable'),params.objects=objs.join(',').replace(/^,/,''),this.hand.setAttribute('raycaster',params)}this.raycaster=this.hand.components.raycaster}},filter:function(str){if(''===str)return'';for(var i=0;i<this.data.filters.length;i++)switch(this.data.filters[i]){case'custom':{this.userFilterFunc&&(str=this.userFilterFunc(str));break}case'allupper':{str=str.toUpperCase();break}case'alllower':{str=str.toLowerCase();break}case'title':{str=str.split(' ').map(function(s){return s[0].toUpperCase()+s.substr(1)}).join(' ');break}case'numbers':{str=str.split('').filter(function(c){return!isNaN(parseInt(c))||'.'===c}).join('');break}case'first':{str=str[0].toUpperCase()+str.substr(1);break}case'trim':{str=str.trim();break}}return 0<this.data.maxLength?str.substr(0,this.data.maxLength):str},click:function(){if(this.keyHover){switch(this.keyHover.key){case'Enter':{this.accept();break}case'Insert':return;case'Delete':{this.rawValue=this.rawValue.substr(0,this.rawValue.length-1);var newValue=this.filter(this.rawValue);this.el.setAttribute('super-keyboard','value',newValue),this.updateTextInput(newValue),this.changeEventDetail.value=newValue,this.el.emit('superkeyboardchange',this.changeEventDetail);break}case'Shift':{this.shift=!this.shift,this.keyHover.el.setAttribute('material','color',this.shift?this.data.keyHoverColor:this.data.keyBgColor);break}case'Escape':{this.dismiss();break}default:{if(0<this.data.maxLength&&this.rawValue.length>this.data.maxLength)break;this.rawValue+=this.shift?this.keyHover.key.toUpperCase():this.keyHover.key;var newValue=this.filter(this.rawValue);this.el.setAttribute('super-keyboard','value',newValue),this.updateTextInput(newValue),this.changeEventDetail.value=newValue,this.el.emit('superkeyboardchange',this.changeEventDetail);break}}this.updateKeyColorPlane(this.keyHover.key,this.keyPressColor);var self=this;setTimeout(function(){self.updateKeyColorPlane(self.keyHover.key,self.keyHoverColor)},100),this.updateCursorPosition()}},open:function(){this.el.object3D.visible=!0,this.hand&&this.hand.ownRaycaster&&this.hand.setAttribute('raycaster',{showLine:!0,enabled:!0})},close:function(){this.el.object3D.visible=!1,this.hand&&this.hand.ownRaycaster&&this.hand.setAttribute('raycaster',{showLine:!1,enabled:!1})},accept:function(){this.el.object3D.visible=!1,this.hand&&this.hand.ownRaycaster&&this.hand.setAttribute('raycaster',{showLine:!1,enabled:!1}),this.el.emit('superkeyboardinput',{value:this.data.value}),this.data.show=!1},dismiss:function(){this.data.value=this.defaultValue,this.updateTextInput(),this.el.object3D.visible=!1,this.hand&&this.hand.ownRaycaster&&this.hand.setAttribute('raycaster',{showLine:!1,enabled:!1}),this.el.emit('superkeyboarddismiss'),this.data.show=!1},blur:function(){this.focused=!1,this.keyHover&&'Shift'!==this.keyHover.key&&this.updateKeyColorPlane(this.keyHover.key,this.keyBgColor),this.keyHover=null},hover:function(){this.focused=!0},startBlinking:function(){this.stopBlinking(),this.intervalId=window.setInterval(this.blink.bind(this),this.data.blinkingSpeed)},stopBlinking:function(){window.clearInterval(this.intervalId),this.intervalId=0},blink:function(){this.cursor.object3D.visible=!this.cursor.object3D.visible},setCustomFilter:function(f){this.userFilterFunc=f},addCustomModel:function(name,model){name&&(KEYBOARDS[name]=model)},updateCursorPosition:function(){var font=this.textInput.components.text.currentFont;if(!font){var self=this;return this.cursor.object3D.visible=!1,void window.setTimeout(function(){self.updateCursorPosition(),self.startBlinking()},700)}var w=this.data.width,kbdata=KEYBOARDS[this.data.model],posy=-this.inputRect.h/2*w/2.4+kbdata.inputOffsetY*w,ratio=this.data.width/this.textInput.components.text.data.wrapCount,pos=0,fontFactor=FontFactors[this.textInput.components.text.data.font];fontFactor===void 0&&(fontFactor=20);for(var i=0,char;i<this.data.value.length;i++)char=findFontChar(font.chars,this.data.value.charCodeAt(i)),pos+=char.width+char.xadvance*(32===char.id?2:1);'center'===this.data.align?pos=0.0011*(pos*ratio*fontFactor)/2+0.02*w:'left'===this.data.align?(pos=0.0011*(pos*ratio*fontFactor)+0.02*w,pos-=w/2):'right'===this.data.align&&(pos=0.0011*(-pos*ratio*fontFactor)-0.02*w,pos+=w/2),this.cursor.object3D.position.set(pos,posy,1e-3),this.cursorUpdated=!0},updateTextInput:function(value){this.textInputObject.value=value||this.data.value,this.textInput.setAttribute('text',this.textInputObject)}})},function(){AFRAME.registerShader('superCutFxShader',{schema:{startTime:{type:'float',is:'uniform'},timems:{type:'time',is:'uniform'}},vertexShader:`
    varying vec2 uvs;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    }
  `,fragmentShader:`
    uniform float startTime;
    uniform float timems;
    varying vec2 uvs;
    varying vec3 worldPos;

    #define COLOR vec3(0, 0.67, 0.98)

    void main() {
      float time = (timems - startTime) / 2000.0;
      vec2 p = uvs.xy - 0.5;
      float r = p.x * p.x + p.y * p.y;
      float alpha = 1.0 - smoothstep(time - 0.01, time, r);
      alpha *= smoothstep(time - 0.1, time, r);
      alpha *= 1.0 - time * 5.5;
      gl_FragColor = vec4(COLOR, alpha);
    }
  `})},function(){AFRAME.registerComponent('supercutfx',{init:function(){this.startTime=-1100},createSuperCut:function(position){const mesh=this.el.getObject3D('mesh');this.el.object3D.position.copy(position),this.el.object3D.position.z=-1,this.el.object3D.visible=!0,this.startTime=this.el.sceneEl.time,mesh.material.uniforms.startTime.value=this.startTime-50,this.el.play()},tick:function(time){time>this.startTime+1e3&&(this.el.object3D.visible=!1,this.el.pause())}})},function(){AFRAME.registerComponent('text-counter',{dependencies:['text'],schema:{decimals:{default:0},dur:{default:2e3,type:'int'},enabled:{default:!1},emit:{default:!1},prefix:{default:''},suffix:{default:''},value:{default:0,type:'float'}},init:function(){this.currentValue=0,this.hasCompleted=!1,this.textValue={value:''}},update:function(){this.currentValue=0,this.textValue.value=`${this.data.prefix}${this.decimals(0)}${this.data.suffix}`,this.el.setAttribute('text',this.textValue),this.hasCompleted=!1},tick:function(time,timeDelta){!this.data.enabled||this.hasCompleted||(this.currentValue+=this.data.value*(timeDelta/this.data.dur),this.currentValue>=this.data.value&&(this.currentValue=this.data.value,this.data.emit&&this.el.emit('textcounterdone',null,!1),this.hasCompleted=!0),this.textValue.value=`${this.data.prefix}${this.decimals(this.currentValue)}${this.data.suffix}`,this.el.setAttribute('text',this.textValue))},decimals:function(n){var d=Math.pow(10,this.data.decimals);return(parseInt(n*d)/d).toFixed(this.data.decimals)}})},function(){AFRAME.registerComponent('text-uppercase',{schema:{value:{type:'string'}},update:function(){this.el.setAttribute('text','value',this.data.value.toUpperCase())}})},function(){AFRAME.registerComponent('toggle-pause-play',{schema:{isPlaying:{default:!1}},update:function(){const action=this.data.isPlaying?'pause':'play';parent.postMessage(JSON.stringify({verify:'game-action',action}),'*')}})},function(){AFRAME.registerComponent('trail',{schema:{color:{type:'color'},enabled:{default:!1},hand:{type:'string'}},init:function(){var geometry=this.geometry=new THREE.BufferGeometry,maxPoints=this.maxPoints=12,vertices=this.vertices=new Float32Array(36*maxPoints),colors=this.colors=new Float32Array(48*maxPoints),bladeColor=this.bladeColor=new THREE.Color(this.data.color);this.bladeColor={red:bladeColor.r,green:bladeColor.g,blue:bladeColor.b,alpha:1},this.saberEl=this.el.querySelector('.blade'),this.layers=0,this.saberTrajectory=[{top:new THREE.Vector3(-0.5,0,0),center:new THREE.Vector3(0,0,0),bottom:new THREE.Vector3(0.5,0,0)},{top:new THREE.Vector3(-0.5,0.5,0),center:new THREE.Vector3(0,0.5,0),bottom:new THREE.Vector3(0.5,0.5,0)},{top:new THREE.Vector3(-0.5,1,0),center:new THREE.Vector3(0,1,0),bottom:new THREE.Vector3(0.5,1,0)}],geometry.addAttribute('position',new THREE.BufferAttribute(vertices,3).setDynamic(!0)),geometry.addAttribute('vertexColor',new THREE.BufferAttribute(colors,4).setDynamic(!0));const material=new THREE.ShaderMaterial({side:THREE.DoubleSide,vertexColors:THREE.VertexColors,transparent:!0,blending:THREE.AdditiveBlending,vertexShader:['varying vec4 vColor;','attribute vec4 vertexColor;','void main() {','vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);','vColor = vertexColor;','gl_Position = projectionMatrix * modelViewPosition;','}'].join(''),fragmentShader:['varying vec4 vColor;','void main() {','gl_FragColor = vColor;','}'].join('')}),mesh=this.mesh=new THREE.Mesh(geometry,material);mesh.frustumCulled=!1,mesh.vertices=vertices,this.el.sceneEl.setObject3D(`trail__${this.data.hand}`,mesh)},update:function(oldData){!oldData.enabled&&this.data.enabled&&(this.enabledTime=this.el.sceneEl.time,this.mesh.visible=!1),oldData.enabled&&!this.data.enabled&&(this.mesh.visible=!1)},tock:function(time){this.data.enabled&&(!this.mesh.visible&&time>this.enabledTime+250&&(this.mesh.visible=!0),this.sampleSaberPosition())},addLayer:function(length){var startX=-1,segments=this.segments,dx=2/segments,colors=this.colors,vertices=this.vertices,color=this.bladeColor;this.layers>=this.maxLayers&&(this.layers=0);const bottomLayer=this.layers*length;length=bottomLayer+length;const indexOffset=18*(this.layers*segments),colorOffset=24*(this.layers*segments);for(var i=0;i<segments;++i)vertices[indexOffset+18*i]=startX+i*dx,vertices[indexOffset+18*i+1]=bottomLayer,vertices[indexOffset+18*i+2]=0,colors[colorOffset+24*i]=color.red,colors[colorOffset+24*i+1]=color.green,colors[colorOffset+24*i+2]=color.blue,colors[colorOffset+24*i+3]=color.alpha,vertices[indexOffset+18*i+3]=startX+i*dx,vertices[indexOffset+18*i+4]=length,vertices[indexOffset+18*i+5]=0,colors[colorOffset+24*i+4]=color.red,colors[colorOffset+24*i+5]=color.green,colors[colorOffset+24*i+6]=color.blue,colors[colorOffset+24*i+7]=color.alpha,vertices[indexOffset+18*i+6]=startX+i*dx+dx,vertices[indexOffset+18*i+7]=length,vertices[indexOffset+18*i+8]=0,colors[colorOffset+24*i+8]=color.red,colors[colorOffset+24*i+9]=color.green,colors[colorOffset+24*i+10]=color.blue,colors[colorOffset+24*i+11]=color.alpha,vertices[indexOffset+18*i+9]=startX+i*dx+dx,vertices[indexOffset+18*i+10]=bottomLayer,vertices[indexOffset+18*i+11]=0,colors[colorOffset+24*i+12]=color.red,colors[colorOffset+24*i+13]=color.green,colors[colorOffset+24*i+14]=color.blue,colors[colorOffset+24*i+15]=color.alpha,vertices[indexOffset+18*i+12]=startX+i*dx,vertices[indexOffset+18*i+13]=bottomLayer,vertices[indexOffset+18*i+14]=0,colors[colorOffset+24*i+16]=color.red,colors[colorOffset+24*i+17]=color.green,colors[colorOffset+24*i+18]=color.blue,colors[colorOffset+24*i+19]=color.alpha,vertices[indexOffset+18*i+15]=startX+i*dx+dx,vertices[indexOffset+18*i+16]=length,vertices[indexOffset+18*i+17]=0,colors[colorOffset+24*i+20]=color.red,colors[colorOffset+24*i+21]=color.green,colors[colorOffset+24*i+22]=color.blue,colors[colorOffset+24*i+23]=color.alpha;this.layers++,this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.vertexColor.needsUpdate=!0,this.geometry.attributes.uv.needsUpdate=!0},initGeometry:function(){var saberTrajectory=this.saberTrajectory,vertices=this.geometry.attributes.position.array,colors=this.geometry.attributes.vertexColor.array,color=this.bladeColor,i,previousPoint,currentPoint,alpha,previousAlpha;for(i=1;i<saberTrajectory.length;i++)1===i&&(previousAlpha=alpha),alpha=1-(saberTrajectory.length-i)/saberTrajectory.length,currentPoint=saberTrajectory[i],previousPoint=saberTrajectory[i-1],vertices[36*i]=previousPoint.center.x,vertices[36*i+1]=previousPoint.center.y,vertices[36*i+2]=previousPoint.center.z,colors[48*i]=color.red,colors[48*i+1]=color.green,colors[48*i+2]=color.blue,colors[48*i+3]=0.2*previousAlpha,vertices[36*i+3]=currentPoint.top.x,vertices[36*i+4]=currentPoint.top.y,vertices[36*i+5]=currentPoint.top.z,colors[48*i+4]=color.red,colors[48*i+5]=color.green,colors[48*i+6]=color.blue,colors[48*i+7]=alpha,vertices[36*i+6]=previousPoint.top.x,vertices[36*i+7]=previousPoint.top.y,vertices[36*i+8]=previousPoint.top.z,colors[48*i+8]=color.red,colors[48*i+9]=color.green,colors[48*i+10]=color.blue,colors[48*i+11]=previousAlpha,vertices[36*i+9]=previousPoint.center.x,vertices[36*i+10]=previousPoint.center.y,vertices[36*i+11]=previousPoint.center.z,colors[48*i+12]=color.red,colors[48*i+13]=color.green,colors[48*i+14]=color.blue,colors[48*i+15]=0.2*previousAlpha,vertices[36*i+12]=currentPoint.center.x,vertices[36*i+13]=currentPoint.center.y,vertices[36*i+14]=currentPoint.center.z,colors[48*i+16]=color.red,colors[48*i+17]=color.green,colors[48*i+18]=color.blue,colors[48*i+19]=0.2*alpha,vertices[36*i+15]=currentPoint.top.x,vertices[36*i+16]=currentPoint.top.y,vertices[36*i+17]=currentPoint.top.z,colors[48*i+20]=color.red,colors[48*i+21]=color.green,colors[48*i+22]=color.blue,colors[48*i+23]=alpha,vertices[36*i+18]=previousPoint.bottom.x,vertices[36*i+19]=previousPoint.bottom.y,vertices[36*i+20]=previousPoint.bottom.z,colors[48*i+24]=color.red,colors[48*i+25]=color.green,colors[48*i+26]=color.blue,colors[48*i+27]=0,vertices[36*i+21]=currentPoint.center.x,vertices[36*i+22]=currentPoint.center.y,vertices[36*i+23]=currentPoint.center.z,colors[48*i+28]=color.red,colors[48*i+29]=color.green,colors[48*i+30]=color.blue,colors[48*i+31]=0.2*alpha,vertices[36*i+24]=previousPoint.center.x,vertices[36*i+25]=previousPoint.center.y,vertices[36*i+26]=previousPoint.center.z,colors[48*i+32]=color.red,colors[48*i+33]=color.green,colors[48*i+34]=color.blue,colors[48*i+35]=0.2*previousAlpha,vertices[36*i+27]=previousPoint.bottom.x,vertices[36*i+28]=previousPoint.bottom.y,vertices[36*i+29]=previousPoint.bottom.z,colors[48*i+36]=color.red,colors[48*i+37]=color.green,colors[48*i+38]=color.blue,colors[48*i+39]=0,vertices[36*i+30]=currentPoint.bottom.x,vertices[36*i+31]=currentPoint.bottom.y,vertices[36*i+32]=currentPoint.bottom.z,colors[48*i+40]=color.red,colors[48*i+41]=color.green,colors[48*i+42]=color.blue,colors[48*i+43]=0,vertices[36*i+33]=currentPoint.center.x,vertices[36*i+34]=currentPoint.center.y,vertices[36*i+35]=currentPoint.center.z,colors[48*i+44]=color.red,colors[48*i+45]=color.green,colors[48*i+46]=color.blue,colors[48*i+47]=0.2*alpha,previousAlpha=alpha;this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.vertexColor.needsUpdate=!0},sampleSaberPosition:function(){var saberEl=this.saberEl,saberObject,sample;this.saberTrajectory.length===this.maxPoints?(sample=this.saberTrajectory.shift(),sample.top.set(0,-0.4,0),sample.center.set(0,0,0),sample.bottom.set(0,0.4,0)):sample={top:new THREE.Vector3(0,-0.4,0),center:new THREE.Vector3(0,0,0),bottom:new THREE.Vector3(0,0.4,0)},saberObject=saberEl.object3D,saberObject.parent.updateMatrixWorld(),saberObject.localToWorld(sample.top),saberObject.localToWorld(sample.center),saberObject.localToWorld(sample.bottom),this.saberTrajectory.push(sample),this.initGeometry()}})},function(){AFRAME.registerComponent('tutorial-2d',{init:function(){this.el.sceneEl.canvas.style.display='none'},play:function(){this.el.sceneEl.canvas.style.display='block',document.getElementById('tutorial2d').style.display='none',document.getElementById('loadingText2d').style.display='none'}})},function(){var _Mathabs=Math.abs;const NUM_VALUES_PER_SEGMENT=75;AFRAME.registerComponent('twister',{schema:{enabled:{default:!1},twist:{default:0},vertices:{default:4,type:'int'},count:{default:12,type:'int'},positionIncrement:{default:1.4},radiusIncrement:{default:0.4},thickness:{default:0.37}},init:function(){this.currentTwist=0,this.animate=!1,this.geometry=null},pulse:function(twist){this.data.enabled&&(twist=0==twist?0.03+0.25*Math.random():Math.min(0.4*twist,0.4),twist*=0.5>Math.random()?-1:1,this.el.setAttribute('twister',{twist:twist}))},update:function(){var radius=6,segments=[];if(1e-3<_Mathabs(this.data.twist-this.currentTwist))return void(this.animate=!0);this.clear();for(var i=0;i<this.data.count;i++){let segment=this.createSegment(radius);segment.translate(0,this.data.positionIncrement*i,0),segments.push(segment),radius+=this.data.radiusIncrement}this.geometry=THREE.BufferGeometryUtils.mergeBufferGeometries(segments);var material=this.el.sceneEl.systems.materials.stageNormal,mesh=new THREE.Mesh(this.geometry,material);this.el.object3D.add(mesh)},createSegment:function(radius){const R=this.data.thickness;var points=[new THREE.Vector2(radius-R,R),new THREE.Vector2(radius-R,-R),new THREE.Vector2(radius+R,-R),new THREE.Vector2(radius+R,R),new THREE.Vector2(radius-R,R)],geometry;geometry=new THREE.LatheBufferGeometry(points,this.data.vertices);for(let i=0;i<geometry.attributes.uv.array.length;i+=2)geometry.attributes.uv.array[i]=0.77,geometry.attributes.uv.array[i+1]=1e-3;return geometry},clear:function(){this.el.object3D.remove(this.el.object3D.children[0]),this.geometry&&this.geometry.dispose(),this.geometry=new THREE.BufferGeometry},tick:function(time,delta){if(this.animate){var posArray=this.geometry.attributes.position.array,rotation,x,y,sin,cos,diff;delta*=1e-3,diff=(this.data.twist-this.currentTwist)*delta,this.currentTwist+=diff,rotation=3*diff;for(var s=0;s<this.data.count;s++){for(var i=0;i<NUM_VALUES_PER_SEGMENT;i+=3)cos=Math.cos(rotation),sin=Math.sin(rotation),x=posArray[s*NUM_VALUES_PER_SEGMENT+i],y=posArray[s*NUM_VALUES_PER_SEGMENT+i+2],posArray[s*NUM_VALUES_PER_SEGMENT+i]=x*cos-y*sin,posArray[s*NUM_VALUES_PER_SEGMENT+i+2]=y*cos+x*sin;rotation*=1.05}this.geometry.attributes.position.needsUpdate=!0,1e-3>_Mathabs(this.data.twist-this.currentTwist)&&(this.animate=!1)}}})},function(){var colorHelper=new THREE.Color;AFRAME.registerComponent('vertex-colors-buffer',{schema:{baseColor:{type:'color'},itemSize:{default:3}},update:function(oldData){var data=this.data,el=this.el,self=this,colors,i,geometry,mesh;if(mesh=this.el.getObject3D('mesh'),!mesh||!mesh.geometry)return void el.addEventListener('object3dset',function reUpdate(evt){'mesh'!==evt.detail.type||(el.removeEventListener('object3dset',reUpdate),self.update(oldData))});if(geometry=mesh.geometry,!geometry.attributes.position)return void console.warn('Geometry has no vertices',el);for(geometry.attributes.color||geometry.addAttribute('color',new THREE.BufferAttribute(new Float32Array(geometry.attributes.position.array.length),3)),colors=geometry.attributes.color.array,colorHelper.set(data.baseColor),i=0;i<colors.length;i+=data.itemSize)colors[i]=colorHelper.r,colors[i+1]=colorHelper.g,colors[i+2]=colorHelper.b;geometry.attributes.color.needsUpdate=!0}})},function(){AFRAME.registerComponent('victory-accuracy-ring',{dependencies:['geometry','material'],schema:{accuracy:{default:0}},update:function(){this.el.getObject3D('mesh').material.uniforms.progress.value=0,this.el.setAttribute('animation','to',this.data.accuracy/100),this.el.components.animation.beginAnimation()}})},function(){AFRAME.registerComponent('victory-rank',{schema:{rank:{type:'string'}},update:function(){const rank=this.data.rank;if(rank)switch(this.el.setAttribute('text','value',rank),rank[0]){case'S':{this.setColor('#FFF');break}case'A':{this.setColor('#c2d076');break}case'B':{this.setColor('#23f0c7');break}case'C':{this.setColor('#ffe347');break}case'D':{this.setColor('#ce6c47');break}case'F':{this.setColor('#960200');break}}},setColor:function(color){this.el.setAttribute('text','color',color)}})},function(){AFRAME.registerComponent('visible-raycastable',{schema:{default:!0},update:function(){this.el.object3D.visible=this.data,this.data?this.el.setAttribute('raycastable',''):this.el.removeAttribute('raycastable','')}})},function(module,exports,__webpack_require__){const COLORS=__webpack_require__(7),WALL_COLOR=new THREE.Color(COLORS.NEON_RED),WALL_BG=new THREE.Color(COLORS.SKY_RED);AFRAME.registerShader('wallShader',{schema:{iTime:{type:'time',is:'uniform'},hitRight:{type:'vec3',is:'uniform',default:{x:0,y:1,z:0}},hitLeft:{type:'vec3',is:'uniform',default:{x:0,y:0,z:0}}},vertexShader:`
    varying vec2 uvs;
    varying vec3 nrml;
    varying vec3 worldPos;
    void main() {
      uvs.xy = uv.xy;
      nrml.xyz = normal.xyz;
      vec4 p = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      worldPos = (modelMatrix * vec4( position, 1.0 )).xyz;
      gl_Position = p;
    }
  `,fragmentShader:`
    varying vec2 uvs;
    varying vec3 nrml;
    varying vec3 worldPos;
    uniform float iTime;
    //uniform sampler2D env;
    uniform vec3 hitRight;
    uniform vec3 hitLeft;

    #define SEED 19.1254
    #define time (3.0 + iTime)/1000.0 * 0.15

    float noise(vec3 uv) {
      return fract(sin(uv.x*123243. + uv.y*424. + uv.z*642. + SEED) * 1524.);
    }

    vec3 drawCircle(vec3 p, vec3 center, float radius, float edgeWidth, vec3 color) {
      return color * (1.0 - smoothstep(radius, radius + edgeWidth, length(p - center)));
    }

    float smoothNoise(vec3 uvw, float frec){
      vec3 luvw = vec3(smoothstep(0.0, 1.0, fract(uvw.xy * frec)), fract(uvw.z * frec));
      vec3 id = floor(uvw * frec);
      float blt = noise(id);
      float brt = noise(id + vec3(1.0, 0.0, 0.0));
      float tlt = noise(id + vec3(0.0, 1.0, 0.0));
      float trt = noise(id + vec3(1.0, 1.0, 0.0));

      float blb = noise(id + vec3(0.0, 0.0, 1.0));
      float brb = noise(id + vec3(1.0, 0.0, 1.0));
      float tlb = noise(id + vec3(0.0, 1.0, 1.0));
      float trb = noise(id + vec3(1.0, 1.0, 1.0));

      float a = mix(blt, brt, luvw.x);
      float b = mix(tlt, trt, luvw.x);
      float c = mix(a, b, luvw.y);

      float d = mix(blb, brb, luvw.x);
      float e = mix(tlb, trb, luvw.x);
      float f = mix(d, e, luvw.y);

      return mix(c, f, luvw.z);
    }

    #define WALL_COLOR vec3(${WALL_COLOR.r}, ${WALL_COLOR.g}, ${WALL_COLOR.b})
    #define WALL_BG vec3(${WALL_BG.r}, ${WALL_BG.g}, ${WALL_BG.b})

    void main() {
      vec2 uv1 = uvs.xy-0.5;
      float angle = time / 10.0;
      vec2 uv;
      uv.x = uv1.x * cos(angle) - uv1.y * sin(angle);
      uv.y = uv1.y * cos(angle) + uv1.x * sin(angle);
      uv.x += sin(uv.y * 2.7 + time / 1.7) * 0.2;
      uv.y += sin(uv.x * 3.1 + time / 2.4) * 0.3;

      float w, r, bg;
      r = smoothNoise(vec3(uv + worldPos.x, time / 2.0), 3.0) * 0.65;
      r += smoothNoise(vec3(uv, time / 6.0), 8.0) * 0.3;
      r += smoothNoise(vec3(uv, time / 14.0), 50.0) * 0.04;

      bg = smoothstep(0.5, 1.0, r) + smoothstep(0.5, 0.0, r);
      r = smoothstep(0.4, 0.50, r) - smoothstep(0.50, 0.6, r);
      w = smoothstep(0.97, 1.0, r);


      r += smoothstep(0.44, 0.50, abs(uv1.x));
      r += smoothstep(0.44, 0.50, abs(uv1.y));

      w += smoothstep(0.49, 0.498, abs(uv1.x));
      w += smoothstep(0.49, 0.498, abs(uv1.y));

      w *= 0.9;
      bg *= 0.5;

      vec3 COL = WALL_COLOR;
      vec3 BG = WALL_BG * 0.1;

      vec3 col = vec3(r * COL.r + w + BG.r, r * COL.g + w + BG.g, r * COL.b + w + BG.b);

      vec3 hit;
      hit = drawCircle(worldPos, hitRight, 0.04, 0.05, COL);
      hit += drawCircle(worldPos, hitRight, 0.02, 0.03, vec3(0.7, 0.7, 0.7));
      hit += drawCircle(worldPos, hitLeft, 0.04, 0.05, COL);
      hit += drawCircle(worldPos, hitLeft, 0.02, 0.03, vec3(0.7, 0.7, 0.7));

      gl_FragColor = vec4(col + hit, 0.7 + w + hit.x);
    }
`})},function(module,__webpack_exports__,__webpack_require__){'use strict';Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0__constants_beat__=__webpack_require__(10);const CEILING_THICKNESS=1.5;AFRAME.registerComponent('wall',{schema:{anticipationPosition:{default:0},durationSeconds:{default:0},height:{default:1.3},horizontalPosition:{default:'middleleft',oneOf:['left','middleleft','middleright','right']},isCeiling:{default:!1},speed:{default:1},warmupPosition:{default:0},width:{default:1}},horizontalPositions:{left:-0.75,middleleft:-0.25,middleright:0.25,right:0.75},init:function(){this.maxZ=10},update:function(){const el=this.el,data=this.data,width=data.width*0.5,halfDepth=data.durationSeconds*data.speed/2;return data.isCeiling?(el.object3D.position.set(0,1.4+CEILING_THICKNESS/2,data.anticipationPosition+data.warmupPosition-halfDepth),void el.object3D.scale.set(width,CEILING_THICKNESS,data.durationSeconds*data.speed)):void(el.object3D.position.set(this.horizontalPositions[data.horizontalPosition]+width/2-0.25,data.height+0.1,data.anticipationPosition+data.warmupPosition-halfDepth),el.object3D.scale.set(width,2.5,data.durationSeconds*data.speed))},pause:function(){this.el.object3D.visible=!1,this.el.removeAttribute('data-collidable-head')},play:function(){this.el.object3D.visible=!0,this.el.setAttribute('data-collidable-head',''),this.el.setAttribute('data-saber-particles',''),this.el.setAttribute('raycastable-game','')},tock:function(time,timeDelta){const data=this.data,halfDepth=data.durationSeconds*data.speed/2,position=this.el.object3D.position;if(position.z<data.anticipationPosition-halfDepth){let newPositionZ=position.z+__WEBPACK_IMPORTED_MODULE_0__constants_beat__.a*(timeDelta/1e3);position.z=newPositionZ<data.anticipationPosition-halfDepth?newPositionZ:data.anticipationPosition-halfDepth}else position.z+=this.data.speed*(timeDelta/1e3);return this.el.object3D.position.z>this.maxZ+halfDepth?void this.returnToPool():void 0},returnToPool:function(){this.el.sceneEl.components.pool__wall.returnEntity(this.el),this.el.object3D.position.z=9999,this.el.pause(),this.el.removeAttribute('data-collidable-head'),this.el.removeAttribute('raycastable-game')}})},function(module){module.exports=[{name:'Pop',row:1,column:1},{name:'R&B',row:1,column:2},{name:'Rap',row:1,column:3},{name:'Rock',row:1,column:4},{name:'Soundtrack',row:1,column:5},{name:'Video Games',row:1,column:6},{name:'Electronic',row:2,column:1},{name:'Hip Hop',row:2,column:2},{name:'House',row:2,column:3},{name:'J-Pop',row:2,column:4},{name:'K-Pop',row:2,column:5},{name:'Meme',row:2,column:6},{name:'Alternative',row:3,column:1},{name:'Anime',row:3,column:2},{name:'Comedy',row:3,column:3},{name:'Disney',row:3,column:4},{name:'Dubstep',row:3,column:5},{name:'EDM',row:3,column:6}]},function(module,exports,__webpack_require__){function requireAll(req){req.keys().forEach(req)}__webpack_require__(12),__webpack_require__(20),__webpack_require__(11),__webpack_require__(21),__webpack_require__(22),__webpack_require__(23),__webpack_require__(24),__webpack_require__(25),__webpack_require__(26),__webpack_require__(27),__webpack_require__(28),__webpack_require__(30),__webpack_require__(29),__webpack_require__(31),requireAll(__webpack_require__(33)),requireAll(__webpack_require__(34)),__webpack_require__(32)},function(module){module.exports=function SoundPool(src,volume){var currSound=0,pool=[],sound;return sound=new Audio(src),sound.volume=volume,pool.push(sound),{play:function(){0===pool[currSound].currentTime&&pool[currSound].ended||(sound=new Audio(src),sound.volume=volume,pool.push(sound),currSound++),(0===pool[currSound].currentTime||pool[currSound].ended)&&pool[currSound].play(),currSound=(currSound+1)%pool.length}}}},function(module,exports,__webpack_require__){function computeSearchPagination(state){let numPages=_Mathceil(state.search.results.length/SEARCH_PER_PAGE);state.search.hasPrev=0<state.search.page,state.search.hasNext=state.search.page<numPages-1,state.search.songNameTexts='',state.search.songSubNameTexts='',state.searchResultsPage.length=0,state.searchResultsPage.__dirty=!0;for(let i=state.search.page*SEARCH_PER_PAGE;i<state.search.page*SEARCH_PER_PAGE+SEARCH_PER_PAGE&&!!state.search.results[i];i++)state.searchResultsPage.push(state.search.results[i]),state.search.songNameTexts+=truncate(state.search.results[i].songName,SONG_NAME_TRUNCATE).toUpperCase()+'\n',state.search.songSubNameTexts+=truncate(state.search.results[i].songSubName,SONG_SUB_NAME_TRUNCATE)+'\n';for(let i=0;i<state.searchResultsPage.length;i++)state.searchResultsPage[i].index=i;computeMenuSelectedChallengeIndex(state)}function truncate(str,length){return str?str.length>=length?str.substring(0,length-3)+'...':str:''}function difficultyComparator(a,b){const aIndex=DIFFICULTIES.indexOf(a),bIndex=DIFFICULTIES.indexOf(b);return aIndex<bIndex?-1:aIndex>bIndex?1:0}function takeDamage(state){state.isPlaying&&(state.score.combo=0,state.score.multiplier=1<state.score.multiplier?_Mathceil(state.score.multiplier/2):1,AFRAME.utils.getUrlParameter('godmode')||state.damage++)}function resetScore(state){state.damage=0,state.score.beatsHit=0,state.score.beatsMissed=0,state.score.combo=0,state.score.maxCombo=0,state.score.score=0,state.score.multiplier=1}function computeMenuSelectedChallengeIndex(state){state.menuSelectedChallenge.index=-1;for(let i=0;i<state.searchResultsPage.length;i++)if(state.searchResultsPage[i].id===state.menuSelectedChallenge.id){state.menuSelectedChallenge.index=i;break}}function formatSongLength(songLength){songLength/=60;const minutes=`${_Mathfloor7(songLength)}`;return`${minutes}:${Math.round(60*(songLength-minutes))}`}function computeBeatsText(state){state.score.beatsText=`${state.score.beatsHit} / ${state.score.beatsMissed+state.score.beatsHit} BEATS`}function clearLeaderboard(state){state.leaderboard.length=0,state.leaderboard.__dirty=!0,state.leaderboardNames='',state.leaderboardScores='',state.leaderboardFetched=!1}function updateMenuSongInfo(state,challenge){state.menuSelectedChallenge.songInfoText=`By ${truncate(challenge.author,12)} ${challenge.genre&&'Uncategorized'!==challenge.genre?'/ '+challenge.genre:''}\n${challenge.downloads} Downloads\nUpvotes: ${challenge.upvotes} / Downvotes: ${challenge.downvotes}\n${formatSongLength(challenge.songDuration)} / ${challenge.numBeats[state.menuSelectedChallenge.difficulty]} beats`}function updateScoreAccuracy(state){const currentNumBeats=state.score.beatsHit+state.score.beatsMissed;state.score.accuracy=100*(state.score.score/(110*currentNumBeats))}var _Mathfloor7=Math.floor,_Mathceil=Math.ceil,utils=__webpack_require__(2);const challengeDataStore={},SEARCH_PER_PAGE=6,SONG_NAME_TRUNCATE=24,SONG_SUB_NAME_TRUNCATE=32,DAMAGE_DECAY=0.25,DEBUG_CHALLENGE={author:'Superman',difficulty:'Expert',id:'31',image:'assets/img/molerat.jpg',songName:'Friday',songLength:100,songSubName:'Rebecca Black'};AFRAME.registerState({nonBindedStateKeys:['genres'],initialState:{activeHand:localStorage.getItem('hand')||'right',challenge:{author:'',difficulty:'',id:AFRAME.utils.getUrlParameter('challenge'),image:'',isLoading:!1,isBeatsPreloaded:!1,numBeats:void 0,songDuration:0,songName:'',songSubName:''},controllerType:'',damage:0,genre:'',genres:__webpack_require__(132),genreMenuOpen:!1,inVR:!1,isGameOver:!1,isPaused:!1,isPlaying:!1,isSearching:!1,isSongFetching:!1,isSongLoading:!1,isVictory:!1,leaderboard:[],leaderboardFetched:!1,leaderboardQualified:!1,leaderboardNames:'',leaderboardScores:'',menuActive:!0,menuDifficulties:[],menuSelectedChallenge:{author:'',difficulty:'',downloads:'',downloadsText:'',genre:'',id:'',index:-1,image:'',numBeats:void 0,songDuration:0,songInfoText:'',songLength:void 0,songName:'',songSubName:''},score:{accuracy:0,beatsHit:0,beatsMissed:0,beatsText:'',combo:0,maxCombo:0,multiplier:1,rank:'',score:0},search:{active:!0,page:0,hasError:!1,hasNext:!1,hasPrev:!1,query:'',results:[],songNameTexts:'',songSubNameTexts:''},searchResultsPage:[]},handlers:{activehandswap:state=>{state.activeHand='right'===state.activeHand?'left':'right',localStorage.setItem('activeHand',state.activeHand)},beathit:(state,payload)=>{state.damage>DAMAGE_DECAY&&(state.damage-=DAMAGE_DECAY),state.score.beatsHit++,state.score.combo++,state.score.combo>state.score.maxCombo&&(state.score.maxCombo=state.score.combo),payload.score=isNaN(payload.score)?100:payload.score,state.score.score+=_Mathfloor7(payload.score*state.score.multiplier),state.score.multiplier=2>state.score.combo?1:6>state.score.combo?2:14>state.score.combo?4:8,updateScoreAccuracy(state)},beatmiss:state=>{state.score.beatsMissed++,takeDamage(state),updateScoreAccuracy(state)},beatwrong:state=>{state.score.beatsMissed++,takeDamage(state),updateScoreAccuracy(state)},beatloaderfinish:state=>{state.challenge.isLoading=!1},beatloaderpreloadfinish:state=>{state.menuActive||(state.challenge.isBeatsPreloaded=!0)},beatloaderstart:state=>{state.challenge.isBeatsPreloaded=!1,state.challenge.isLoading=!0},controllerconnected:(state,payload)=>{state.controllerType=payload.name},debuggameplay:state=>{resetScore(state),Object.assign(state.challenge,state.menuSelectedChallenge),state.menuActive=!1,state.menuSelectedChallenge.id='',state.isSearching=!1,state.isSongLoading=!1},debuggameover:state=>{state.isGameOver=!0,state.menuActive=!1},debugloading:state=>{DEBUG_CHALLENGE.id='-1',Object.assign(state.menuSelectedChallenge,DEBUG_CHALLENGE),Object.assign(state.challenge,DEBUG_CHALLENGE),state.menuActive=!1,state.isSongFetching=!0,state.isSongLoading=!0},debugvictory:state=>{Object.assign(state.menuSelectedChallenge,DEBUG_CHALLENGE),Object.assign(state.challenge,DEBUG_CHALLENGE),state.isVictory=!0,state.leaderboardQualified=!0,state.menuActive=!1,state.score.accuracy=74.99,state.score.beatsHit=125,state.score.beatsMissed=125,state.score.maxCombo=123,state.score.rank='C',state.score.score=9001,computeBeatsText(state)},gamemenuresume:state=>{state.isPaused=!1},gamemenurestart:state=>{resetScore(state),state.challenge.isBeatsPreloaded=!1,state.isGameOver=!1,state.isPaused=!1,state.isSongLoading=!0,state.isVictory=!1,state.leaderboardQualified=!1},gamemenuexit:state=>{resetScore(state),state.challenge.isBeatsPreloaded=!1,state.isGameOver=!1,state.isPaused=!1,state.isVictory=!1,state.menuActive=!0,state.challenge.id='',state.leaderboardQualified=!1},genreclear:state=>{state.genre=''},genremenuclose:state=>{state.genreMenuOpen=!1},genremenuopen:state=>{state.genreMenuOpen=!0},keyboardclose:state=>{state.isSearching=!1},keyboardopen:state=>{state.isSearching=!0,state.menuSelectedChallenge.id=''},leaderboard:(state,payload)=>{state.leaderboard.length=0,state.leaderboardFetched=!0,state.leaderboardNames='',state.leaderboardScores='';for(let i=0,score;i<payload.scores.length;i++)score=payload.scores[i],state.leaderboard.push(score),state.leaderboardNames+=`${score.username} (${score.accuracy||0}%)\n`,state.leaderboardScores+=`${score.score}\n`;state.leaderboardLoading=!1},leaderboardqualify:state=>{state.leaderboardQualified=!0},leaderboardscoreadded:(state,payload)=>{state.leaderboard.splice(payload.index,0,payload.scoreData),state.leaderboardNames='',state.leaderboardScores='';for(let i=0,score;i<10;i++)score=state.leaderboard[i],state.leaderboardNames+=`${score.username} (${score.accuracy||0}%)\n`,state.leaderboardScores+=`${score.score}\n`},leaderboardsubmit:state=>{state.leaderboardQualified=!1},menuchallengeselect:(state,id)=>{let challenge=challengeDataStore[id];Object.assign(state.menuSelectedChallenge,challenge),state.menuDifficulties.length=0;for(let i=0;i<challenge.difficulties.length;i++)state.menuDifficulties.unshift(challenge.difficulties[i]);state.menuDifficulties.sort(difficultyComparator),state.menuSelectedChallenge.difficulty=state.menuDifficulties[0],state.menuSelectedChallenge.image=utils.getS3FileUrl(id,'image.jpg'),updateMenuSongInfo(state,challenge),computeMenuSelectedChallengeIndex(state),state.isSearching=!1,clearLeaderboard(state),state.leaderboardLoading=!0},menuchallengeunselect:state=>{state.menuSelectedChallenge.id='',clearLeaderboard(state)},menudifficultyselect:(state,difficulty)=>{state.menuSelectedChallenge.difficulty=difficulty,updateMenuSongInfo(state,state.menuSelectedChallenge),clearLeaderboard(state),state.leaderboardLoading=!0},minehit:state=>{takeDamage(state)},pausegame:state=>{state.isPlaying&&(state.isPaused=!0)},playbuttonclick:state=>{resetScore(state),Object.assign(state.challenge,state.menuSelectedChallenge),state.menuActive=!1,state.menuSelectedChallenge.id='',state.isSearching=!1,state.isSongLoading=!0},searcherror:state=>{state.search.hasError=!0},searchprevpage:function(state){0===state.search.page||(state.search.page--,computeSearchPagination(state))},searchnextpage:function(state){state.search.page>_Mathfloor7(state.search.results.length/SEARCH_PER_PAGE)||(state.search.page++,computeSearchPagination(state))},searchresults:(state,payload)=>{var i;for(state.search.hasError=!1,state.search.page=0,state.search.query=payload.query,state.search.results=payload.results,i=0;i<payload.results.length;i++){let result=payload.results[i];result.songSubName=result.songSubName||'Unknown Artist',result.shortSongName=truncate(result.songName,SONG_NAME_TRUNCATE).toUpperCase(),result.shortSongSubName=truncate(result.songSubName,SONG_SUB_NAME_TRUNCATE),challengeDataStore[result.id]=result}computeSearchPagination(state),payload.isGenreSearch?(state.genreMenuOpen=!1,state.genre=payload.genre,state.menuSelectedChallenge.id=''):(state.genre='',computeMenuSelectedChallengeIndex(state))},songfetchfinish:state=>{state.isSongFetching=!1},songloadcancel:state=>{state.challenge.isBeatsPreloaded=!1,state.challenge.isLoading=!1,state.isSongLoading=!1,state.isSongFetching=!1,state.menuActive=!0},songloadfinish:state=>{state.isSongFetching=!1,state.isSongLoading=!1},songloadstart:state=>{state.isSongFetching=!0,state.isSongLoading=!0},"enter-vr":state=>{state.inVR=!0},"exit-vr":state=>{state.inVR=!1},victory:function(state){state.isVictory=!0;const accuracy=100*(state.score.score/(110*state.challenge.numBeats));state.score.accuracy=isNaN(accuracy)?0:accuracy,state.score.score=isNaN(state.score.score)?0:state.score.score,state.score.rank=95<=accuracy?'S':93<=accuracy?'A':90<=accuracy?'A-':88<=accuracy?'B+':83<=accuracy?'B':80<=accuracy?'B-':78<=accuracy?'C+':73<=accuracy?'C':70<=accuracy?'C-':60<=accuracy?'D':'F',computeBeatsText(state)},victoryfake:function(state){state.score.accuracy='74.99',state.score.rank='C'},wallhitstart:function(state){takeDamage(state)}},computeState:state=>{state.isPlaying=!state.menuActive&&!state.isPaused&&!state.isVictory&&!state.isGameOver&&!state.challenge.isLoading&&!state.isSongLoading&&!!state.challenge.id;const anyMenuOpen=state.menuActive||state.isPaused||state.isVictory||state.isGameOver||state.isSongLoading||state.isSongFetching;state.leftRaycasterActive=anyMenuOpen&&'left'===state.activeHand&&state.inVR,state.rightRaycasterActive=anyMenuOpen&&'right'===state.activeHand&&state.inVR,state.loadingText=state.isSongLoading?state.isSongFetching?'Downloading song...':'Processing song...':''}});const DIFFICULTIES=['Easy','Normal','Hard','Expert','ExpertPlus']},function(module,exports,__webpack_require__){var escape=__webpack_require__(138);exports=module.exports=__webpack_require__(137)(!1),exports.push([module.i,'html {\n  background: #000;\n}\n\n#vrButton {\n  position: absolute;\n  background: url('+escape(__webpack_require__(152))+') no-repeat;\n  background-size: cover;\n  border: 0;\n  cursor: pointer;\n  right: 20px;\n  bottom: 20px;\n  z-index: 9999999;\n  width: 84px;\n  height: 47px;\n}\n\n#vrButton.a-hidden {\n  visibility: hidden;\n}\n\n#vrButton:active {\n  border: 0;\n}\n\n#vrButton:hover {\n  background-position: 0 -50.5px;\n}\n\n.a-loader-title {\n  animation: loaderTitle 1s infinite alternate;\n  color: rgba(0,0,0,0);\n  background: none;\n  background-image: url('+escape(__webpack_require__(153))+');\n  height: 36.2vh;\n  background-repeat: no-repeat;\n  background-position: center;\n  margin-top: 0;\n  background-size: contain;\n  margin-left: -1vh;\n}\n\n@keyframes loaderTitle {\n  0% { opacity: 1; }\n  50% { opacity: 0.8; }\n  100% { opacity: 1; }\n}\n\n#tutorial2d {\n  position: absolute;\n  width: 60%;\n  left: 20%;\n  top: 35%;\n}\n\n@media (max-width: 1280px) {\n  #tutorial2d {\n    width: 80%;\n    left: 10%;\n  }\n}\n',''])},function(module){function cssWithMappingToString(item,useSourceMap){var content=item[1]||'',cssMapping=item[3];if(!cssMapping)return content;if(useSourceMap&&'function'==typeof btoa){var sourceMapping=toComment(cssMapping),sourceURLs=cssMapping.sources.map(function(source){return'/*# sourceURL='+cssMapping.sourceRoot+source+' */'});return[content].concat(sourceURLs).concat([sourceMapping]).join('\n')}return[content].join('\n')}function toComment(sourceMap){var base64=btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));return'/*# '+('sourceMappingURL=data:application/json;charset=utf-8;base64,'+base64)+' */'}module.exports=function(useSourceMap){var list=[];return list.toString=function toString(){return this.map(function(item){var content=cssWithMappingToString(item,useSourceMap);return item[2]?'@media '+item[2]+'{'+content+'}':content}).join('')},list.i=function(modules,mediaQuery){'string'==typeof modules&&(modules=[[null,modules,'']]);for(var alreadyImportedModules={},i=0,id;i<this.length;i++)id=this[i][0],'number'==typeof id&&(alreadyImportedModules[id]=!0);for(i=0;i<modules.length;i++){var item=modules[i];'number'==typeof item[0]&&alreadyImportedModules[item[0]]||(mediaQuery&&!item[2]?item[2]=mediaQuery:mediaQuery&&(item[2]='('+item[2]+') and ('+mediaQuery+')'),list.push(item))}},list}},function(module){module.exports=function escape(url){return'string'==typeof url?(/^['"].*['"]$/.test(url)&&(url=url.slice(1,-1)),/["'() \t\n]/.test(url)?'"'+url.replace(/"/g,'\\"').replace(/\n/g,'\\n')+'"':url):url}},function(module,exports,__webpack_require__){module.exports=function setup(env){function selectColor(namespace){let hash=0;for(let i=0;i<namespace.length;i++)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return createDebug.colors[Math.abs(hash)%createDebug.colors.length]}function createDebug(namespace){function debug(...args){if(!debug.enabled)return;const self=debug,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,args[0]=createDebug.coerce(args[0]),'string'!=typeof args[0]&&args.unshift('%O');let index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,(match,format)=>{if('%%'===match)return match;index++;const formatter=createDebug.formatters[format];if('function'==typeof formatter){const val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),createDebug.formatArgs.call(self,args);const logFn=self.log||createDebug.log;logFn.apply(self,args)}let prevTime;return debug.namespace=namespace,debug.enabled=createDebug.enabled(namespace),debug.useColors=createDebug.useColors(),debug.color=selectColor(namespace),debug.destroy=destroy,debug.extend=extend,'function'==typeof createDebug.init&&createDebug.init(debug),createDebug.instances.push(debug),debug}function destroy(){const index=createDebug.instances.indexOf(this);return-1!==index&&(createDebug.instances.splice(index,1),!0)}function extend(namespace,delimiter){return createDebug(this.namespace+('undefined'==typeof delimiter?':':delimiter)+namespace)}function toNamespace(regexp){return regexp.toString().substring(2,regexp.toString().length-2).replace(/\.\*\?$/,'*')}return createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=function coerce(val){return val instanceof Error?val.stack||val.message:val},createDebug.disable=function disable(){const namespaces=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(namespace=>'-'+namespace)].join(',');return createDebug.enable(''),namespaces},createDebug.enable=function enable(namespaces){createDebug.save(namespaces),createDebug.names=[],createDebug.skips=[];let i;const split=('string'==typeof namespaces?namespaces:'').split(/[\s,]+/),len=split.length;for(i=0;i<len;i++)split[i]&&(namespaces=split[i].replace(/\*/g,'.*?'),'-'===namespaces[0]?createDebug.skips.push(new RegExp('^'+namespaces.substr(1)+'$')):createDebug.names.push(new RegExp('^'+namespaces+'$')));for(i=0;i<createDebug.instances.length;i++){const instance=createDebug.instances[i];instance.enabled=createDebug.enabled(instance.namespace)}},createDebug.enabled=function enabled(name){if('*'===name[name.length-1])return!0;let i,len;for(i=0,len=createDebug.skips.length;i<len;i++)if(createDebug.skips[i].test(name))return!1;for(i=0,len=createDebug.names.length;i<len;i++)if(createDebug.names[i].test(name))return!0;return!1},createDebug.humanize=__webpack_require__(144),Object.keys(env).forEach(key=>{createDebug[key]=env[key]}),createDebug.instances=[],createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=selectColor,createDebug.enable(createDebug.load()),createDebug}},function(module,exports,__webpack_require__){(function(process,global){(function(global,factory){module.exports=factory()})(this,function(){'use strict';function objectOrFunction(x){var type=typeof x;return null!==x&&('object'==type||'function'==type)}function isFunction(x){return'function'==typeof x}function useVertxTimer(){return'undefined'==typeof vertxNext?useSetTimeout():function(){vertxNext(flush)}}function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}function flush(){for(var i=0;i<len;i+=2){var callback=queue[i],arg=queue[i+1];callback(arg),queue[i]=void 0,queue[i+1]=void 0}len=0}function then(onFulfillment,onRejection){var parent=this,child=new this.constructor(noop);void 0===child[PROMISE_ID]&&makePromise(child);var _state=parent._state;if(_state){var callback=arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result)})}else subscribe(parent,child,onFulfillment,onRejection);return child}function resolve$1(object){var Constructor=this;if(object&&'object'==typeof object&&object.constructor===Constructor)return object;var promise=new Constructor(noop);return resolve(promise,object),promise}function noop(){}function selfFulfillment(){return new TypeError('You cannot resolve a promise with itself')}function cannotReturnOwn(){return new TypeError('A promises callback cannot return that same promise.')}function getThen(promise){try{return promise.then}catch(error){return TRY_CATCH_ERROR.error=error,TRY_CATCH_ERROR}}function tryThen(then$$1,value,fulfillmentHandler,rejectionHandler){try{then$$1.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then$$1){asap(function(promise){var sealed=!1,error=tryThen(then$$1,thenable,function(value){sealed||(sealed=!0,thenable===value?fulfill(promise,value):resolve(promise,value))},function(reason){sealed||(sealed=!0,reject(promise,reason))},'Settle: '+(promise._label||' unknown promise'));!sealed&&error&&(sealed=!0,reject(promise,error))},promise)}function handleOwnThenable(promise,thenable){thenable._state===FULFILLED?fulfill(promise,thenable._result):thenable._state===REJECTED?reject(promise,thenable._result):subscribe(thenable,void 0,function(value){return resolve(promise,value)},function(reason){return reject(promise,reason)})}function handleMaybeThenable(promise,maybeThenable,then$$1){maybeThenable.constructor===promise.constructor&&then$$1===then&&maybeThenable.constructor.resolve===resolve$1?handleOwnThenable(promise,maybeThenable):then$$1===TRY_CATCH_ERROR?(reject(promise,TRY_CATCH_ERROR.error),TRY_CATCH_ERROR.error=null):void 0===then$$1?fulfill(promise,maybeThenable):isFunction(then$$1)?handleForeignThenable(promise,maybeThenable,then$$1):fulfill(promise,maybeThenable)}function resolve(promise,value){promise===value?reject(promise,selfFulfillment()):objectOrFunction(value)?handleMaybeThenable(promise,value,getThen(value)):fulfill(promise,value)}function publishRejection(promise){promise._onerror&&promise._onerror(promise._result),publish(promise)}function fulfill(promise,value){promise._state!==PENDING||(promise._result=value,promise._state=FULFILLED,0!==promise._subscribers.length&&asap(publish,promise))}function reject(promise,reason){promise._state!==PENDING||(promise._state=REJECTED,promise._result=reason,asap(publishRejection,promise))}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers,length=_subscribers.length;parent._onerror=null,_subscribers[length]=child,_subscribers[length+FULFILLED]=onFulfillment,_subscribers[length+REJECTED]=onRejection,0===length&&parent._state&&asap(publish,parent)}function publish(promise){var subscribers=promise._subscribers,settled=promise._state;if(0!==subscribers.length){for(var child=void 0,callback=void 0,detail=promise._result,i=0;i<subscribers.length;i+=3)child=subscribers[i],callback=subscribers[i+settled],child?invokeCallback(settled,child,callback,detail):callback(detail);promise._subscribers.length=0}}function tryCatch(callback,detail){try{return callback(detail)}catch(e){return TRY_CATCH_ERROR.error=e,TRY_CATCH_ERROR}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value,error,succeeded,failed;if(!hasCallback)value=detail,succeeded=!0;else if(value=tryCatch(callback,detail),value===TRY_CATCH_ERROR?(failed=!0,error=value.error,value.error=null):succeeded=!0,promise===value)return void reject(promise,cannotReturnOwn());promise._state!==PENDING||(hasCallback&&succeeded?resolve(promise,value):failed?reject(promise,error):settled===FULFILLED?fulfill(promise,value):settled===REJECTED&&reject(promise,value))}function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){resolve(promise,value)},function rejectPromise(reason){reject(promise,reason)})}catch(e){reject(promise,e)}}function nextId(){return id++}function makePromise(promise){promise[PROMISE_ID]=id++,promise._state=void 0,promise._result=void 0,promise._subscribers=[]}function validationError(){return new Error('Array Methods must be provided an Array')}function needsResolver(){throw new TypeError('You must pass a resolver function as the first argument to the promise constructor')}function needsNew(){throw new TypeError('Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.')}var _isArray=Array.isArray?Array.isArray:function(x){return'[object Array]'===Object.prototype.toString.call(x)};var isArray=_isArray,len=0,vertxNext=void 0,customSchedulerFn=void 0,asap=function asap(callback,arg){queue[len]=callback,queue[len+1]=arg,len+=2,2==len&&(customSchedulerFn?customSchedulerFn(flush):scheduleFlush())},browserWindow='undefined'==typeof window?void 0:window,browserGlobal=browserWindow||{},BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver,isNode='undefined'==typeof self&&'undefined'!=typeof process&&'[object process]'==={}.toString.call(process),isWorker='undefined'!=typeof Uint8ClampedArray&&'undefined'!=typeof importScripts&&'undefined'!=typeof MessageChannel,queue=Array(1e3),scheduleFlush=void 0;scheduleFlush=isNode?function useNextTick(){return function(){return process.nextTick(flush)}}():BrowserMutationObserver?function useMutationObserver(){var iterations=0,observer=new BrowserMutationObserver(flush),node=document.createTextNode('');return observer.observe(node,{characterData:!0}),function(){node.data=iterations=++iterations%2}}():isWorker?function useMessageChannel(){var channel=new MessageChannel;return channel.port1.onmessage=flush,function(){return channel.port2.postMessage(0)}}():void 0===browserWindow&&'function'=='function'?function attemptVertx(){try{var vertx=Function('return this')().require('vertx');return vertxNext=vertx.runOnLoop||vertx.runOnContext,useVertxTimer()}catch(e){return useSetTimeout()}}():useSetTimeout();var PROMISE_ID=Math.random().toString(36).substring(2),PENDING=void 0,FULFILLED=1,REJECTED=2,TRY_CATCH_ERROR={error:null},id=0,Enumerator=function(){function Enumerator(Constructor,input){this._instanceConstructor=Constructor,this.promise=new Constructor(noop),this.promise[PROMISE_ID]||makePromise(this.promise),isArray(input)?(this.length=input.length,this._remaining=input.length,this._result=Array(this.length),0===this.length?fulfill(this.promise,this._result):(this.length=this.length||0,this._enumerate(input),0===this._remaining&&fulfill(this.promise,this._result))):reject(this.promise,validationError())}return Enumerator.prototype._enumerate=function _enumerate(input){for(var i=0;this._state===PENDING&&i<input.length;i++)this._eachEntry(input[i],i)},Enumerator.prototype._eachEntry=function _eachEntry(entry,i){var c=this._instanceConstructor,resolve$$1=c.resolve;if(resolve$$1===resolve$1){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING)this._settledAt(entry._state,i,entry._result);else if('function'!=typeof _then)this._remaining--,this._result[i]=entry;else if(c===Promise$1){var promise=new c(noop);handleMaybeThenable(promise,entry,_then),this._willSettleAt(promise,i)}else this._willSettleAt(new c(function(resolve$$1){return resolve$$1(entry)}),i)}else this._willSettleAt(resolve$$1(entry),i)},Enumerator.prototype._settledAt=function _settledAt(state,i,value){var promise=this.promise;promise._state===PENDING&&(this._remaining--,state===REJECTED?reject(promise,value):this._result[i]=value),0===this._remaining&&fulfill(promise,this._result)},Enumerator.prototype._willSettleAt=function _willSettleAt(promise,i){var enumerator=this;subscribe(promise,void 0,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})},Enumerator}(),Promise$1=function(){function Promise(resolver){this[PROMISE_ID]=nextId(),this._result=this._state=void 0,this._subscribers=[],noop!==resolver&&('function'!=typeof resolver&&needsResolver(),this instanceof Promise?initializePromise(this,resolver):needsNew())}return Promise.prototype.catch=function _catch(onRejection){return this.then(null,onRejection)},Promise.prototype.finally=function _finally(callback){var promise=this,constructor=promise.constructor;return promise.then(function(value){return constructor.resolve(callback()).then(function(){return value})},function(reason){return constructor.resolve(callback()).then(function(){throw reason})})},Promise}();return Promise$1.prototype.then=then,Promise$1.all=function all(entries){return new Enumerator(this,entries).promise},Promise$1.race=function race(entries){var Constructor=this;return isArray(entries)?new Constructor(function(resolve,reject){for(var length=entries.length,i=0;i<length;i++)Constructor.resolve(entries[i]).then(resolve,reject)}):new Constructor(function(_,reject){return reject(new TypeError('You must pass an array to race.'))})},Promise$1.resolve=resolve$1,Promise$1.reject=function reject$1(reason){var Constructor=this,promise=new Constructor(noop);return reject(promise,reason),promise},Promise$1._setScheduler=function setScheduler(scheduleFn){customSchedulerFn=scheduleFn},Promise$1._setAsap=function setAsap(asapFn){asap=asapFn},Promise$1._asap=asap,Promise$1.polyfill=function polyfill(){var local;if('undefined'!=typeof global)local=global;else if('undefined'!=typeof self)local=self;else try{local=Function('return this')()}catch(e){throw new Error('polyfill failed because global object is unavailable in this environment')}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if('[object Promise]'===promiseToString&&!P.cast)return}local.Promise=Promise$1},Promise$1.Promise=Promise$1,Promise$1})}).call(exports,__webpack_require__(4),__webpack_require__(0))},function(module,exports,__webpack_require__){'use strict';__webpack_require__(37);var firebase=function _interopDefault(ex){return ex&&'object'==typeof ex&&'default'in ex?ex['default']:ex}(__webpack_require__(13));module.exports=firebase},function(module,__webpack_exports__,__webpack_require__){'use strict';Object.defineProperty(__webpack_exports__,'__esModule',{value:!0});var __WEBPACK_IMPORTED_MODULE_0__firebase_firestore__=__webpack_require__(35),__WEBPACK_IMPORTED_MODULE_0__firebase_firestore___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__firebase_firestore__)},function(module,exports,__webpack_require__){(function(global){var win;win='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,module.exports=win}).call(exports,__webpack_require__(0))},function(module){function parse(str){if(str+='',!(100<str.length)){var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(match){var n=parseFloat(match[1]),type=(match[2]||'ms').toLowerCase();return'years'===type||'year'===type||'yrs'===type||'yr'===type||'y'===type?n*y:'days'===type||'day'===type||'d'===type?n*d:'hours'===type||'hour'===type||'hrs'===type||'hr'===type||'h'===type?n*h:'minutes'===type||'minute'===type||'mins'===type||'min'===type||'m'===type?n*m:'seconds'===type||'second'===type||'secs'===type||'sec'===type||'s'===type?n*s:'milliseconds'===type||'millisecond'===type||'msecs'===type||'msec'===type||'ms'===type?n:void 0}}}function fmtShort(ms){return ms>=d?_Mathround2(ms/d)+'d':ms>=h?_Mathround2(ms/h)+'h':ms>=m?_Mathround2(ms/m)+'m':ms>=s?_Mathround2(ms/s)+'s':ms+'ms'}function fmtLong(ms){return plural(ms,d,'day')||plural(ms,h,'hour')||plural(ms,m,'minute')||plural(ms,s,'second')||ms+' ms'}function plural(ms,n,name){return ms<n?void 0:ms<1.5*n?Math.floor(ms/n)+' '+name:Math.ceil(ms/n)+' '+name+'s'}var _Mathround2=Math.round,s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;module.exports=function(val,options){options=options||{};var type=typeof val;if('string'==type&&0<val.length)return parse(val);if('number'==type&&!1===isNaN(val))return options.long?fmtLong(val):fmtShort(val);throw new Error('val is not a non-empty string or a valid number. val='+JSON.stringify(val))}},function(module,exports,__webpack_require__){'use strict';var has=Object.prototype.hasOwnProperty,toStr=Object.prototype.toString,slice=Array.prototype.slice,isArgs=__webpack_require__(146),isEnumerable=Object.prototype.propertyIsEnumerable,hasDontEnumBug=!isEnumerable.call({toString:null},'toString'),hasProtoEnumBug=isEnumerable.call(function(){},'prototype'),dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],equalsConstructorPrototype=function(o){var ctor=o.constructor;return ctor&&ctor.prototype===o},excludedKeys={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},hasAutomationEqualityBug=function(){if('undefined'==typeof window)return!1;for(var k in window)try{if(!excludedKeys['$'+k]&&has.call(window,k)&&null!==window[k]&&'object'==typeof window[k])try{equalsConstructorPrototype(window[k])}catch(e){return!0}}catch(e){return!0}return!1}(),equalsConstructorPrototypeIfNotBuggy=function(o){if('undefined'==typeof window||!hasAutomationEqualityBug)return equalsConstructorPrototype(o);try{return equalsConstructorPrototype(o)}catch(e){return!1}},keysShim=function keys(object){var isObject=null!==object&&'object'==typeof object,isFunction='[object Function]'===toStr.call(object),isArguments=isArgs(object),isString=isObject&&'[object String]'===toStr.call(object),theKeys=[];if(!isObject&&!isFunction&&!isArguments)throw new TypeError('Object.keys called on a non-object');if(isString&&0<object.length&&!has.call(object,0))for(var i=0;i<object.length;++i)theKeys.push(i+'');if(isArguments&&0<object.length)for(var j=0;j<object.length;++j)theKeys.push(j+'');else for(var name in object)!(hasProtoEnumBug&&isFunction&&'prototype'==name)&&has.call(object,name)&&theKeys.push(name+'');if(hasDontEnumBug)for(var skipConstructor=equalsConstructorPrototypeIfNotBuggy(object),k=0;k<dontEnums.length;++k)!(skipConstructor&&'constructor'===dontEnums[k])&&has.call(object,dontEnums[k])&&theKeys.push(dontEnums[k]);return theKeys};keysShim.shim=function shimObjectKeys(){if(Object.keys){var keysWorksWithArguments=function(){return 2===(Object.keys(arguments)||'').length}(1,2);if(!keysWorksWithArguments){var originalKeys=Object.keys;Object.keys=function keys(object){return isArgs(object)?originalKeys(slice.call(object)):originalKeys(object)}}}else Object.keys=keysShim;return Object.keys||keysShim},module.exports=keysShim},function(module){'use strict';var toStr=Object.prototype.toString;module.exports=function isArguments(value){var str=toStr.call(value),isArgs='[object Arguments]'===str;return isArgs||(isArgs='[object Array]'!==str&&null!==value&&'object'==typeof value&&'number'==typeof value.length&&0<=value.length&&'[object Function]'===toStr.call(value.callee)),isArgs}},function(module){'use strict';function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case'string':return v;case'boolean':return v?'true':'false';case'number':return isFinite(v)?v:'';default:return'';}};module.exports=function(obj,sep,eq,name){return sep=sep||'&',eq=eq||'=',null===obj&&(obj=void 0),'object'==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):''};var isArray=Array.isArray||function(xs){return'[object Array]'===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},function(module,exports,__webpack_require__){(function(global,process){(function(global){'use strict';function setImmediate(callback){'function'!=typeof callback&&(callback=new Function(''+callback));for(var args=Array(arguments.length-1),i=0;i<args.length;i++)args[i]=arguments[i+1];var task={callback:callback,args:args};return tasksByHandle[nextHandle]=task,registerImmediate(nextHandle),nextHandle++}function clearImmediate(handle){delete tasksByHandle[handle]}function run(task){var callback=task.callback,args=task.args;switch(args.length){case 0:callback();break;case 1:callback(args[0]);break;case 2:callback(args[0],args[1]);break;case 3:callback(args[0],args[1],args[2]);break;default:callback.apply(void 0,args);}}function runIfPresent(handle){if(currentlyRunningATask)setTimeout(runIfPresent,0,handle);else{var task=tasksByHandle[handle];if(task){currentlyRunningATask=!0;try{run(task)}finally{clearImmediate(handle),currentlyRunningATask=!1}}}}function installNextTickImplementation(){registerImmediate=function(handle){process.nextTick(function(){runIfPresent(handle)})}}function canUsePostMessage(){if(global.postMessage&&!global.importScripts){var postMessageIsAsynchronous=!0,oldOnMessage=global.onmessage;return global.onmessage=function(){postMessageIsAsynchronous=!1},global.postMessage('','*'),global.onmessage=oldOnMessage,postMessageIsAsynchronous}}function installPostMessageImplementation(){var messagePrefix='setImmediate$'+Math.random()+'$',onGlobalMessage=function(event){event.source===global&&'string'==typeof event.data&&0===event.data.indexOf(messagePrefix)&&runIfPresent(+event.data.slice(messagePrefix.length))};global.addEventListener?global.addEventListener('message',onGlobalMessage,!1):global.attachEvent('onmessage',onGlobalMessage),registerImmediate=function(handle){global.postMessage(messagePrefix+handle,'*')}}function installMessageChannelImplementation(){var channel=new MessageChannel;channel.port1.onmessage=function(event){var handle=event.data;runIfPresent(handle)},registerImmediate=function(handle){channel.port2.postMessage(handle)}}function installReadyStateChangeImplementation(){var html=doc.documentElement;registerImmediate=function(handle){var script=doc.createElement('script');script.onreadystatechange=function(){runIfPresent(handle),script.onreadystatechange=null,html.removeChild(script),script=null},html.appendChild(script)}}function installSetTimeoutImplementation(){registerImmediate=function(handle){setTimeout(runIfPresent,0,handle)}}if(!global.setImmediate){var nextHandle=1,tasksByHandle={},currentlyRunningATask=!1,doc=global.document,attachTo=Object.getPrototypeOf&&Object.getPrototypeOf(global),registerImmediate;attachTo=attachTo&&attachTo.setTimeout?attachTo:global,'[object process]'==={}.toString.call(global.process)?installNextTickImplementation():canUsePostMessage()?installPostMessageImplementation():global.MessageChannel?installMessageChannelImplementation():doc&&'onreadystatechange'in doc.createElement('script')?installReadyStateChangeImplementation():installSetTimeoutImplementation(),attachTo.setImmediate=setImmediate,attachTo.clearImmediate=clearImmediate}})('undefined'==typeof self?'undefined'==typeof global?this:global:self)}).call(exports,__webpack_require__(0),__webpack_require__(4))},function(module,exports,__webpack_require__){function addStylesToDom(styles,options){for(var i=0;i<styles.length;i++){var item=styles[i],domStyle=stylesInDom[item.id];if(domStyle){domStyle.refs++;for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j](item.parts[j]);for(;j<item.parts.length;j++)domStyle.parts.push(addStyle(item.parts[j],options))}else{for(var parts=[],j=0;j<item.parts.length;j++)parts.push(addStyle(item.parts[j],options));stylesInDom[item.id]={id:item.id,refs:1,parts:parts}}}}function listToStyles(list,options){for(var styles=[],newStyles={},i=0;i<list.length;i++){var item=list[i],id=options.base?item[0]+options.base:item[0],css=item[1],media=item[2],sourceMap=item[3],part={css:css,media:media,sourceMap:sourceMap};newStyles[id]?newStyles[id].parts.push(part):styles.push(newStyles[id]={id:id,parts:[part]})}return styles}function insertStyleElement(options,style){var target=getElement(options.insertInto);if(!target)throw new Error('Couldn\'t find a style target. This probably means that the value for the \'insertInto\' parameter is invalid.');var lastStyleElementInsertedAtTop=stylesInsertedAtTop[stylesInsertedAtTop.length-1];if('top'===options.insertAt)lastStyleElementInsertedAtTop?lastStyleElementInsertedAtTop.nextSibling?target.insertBefore(style,lastStyleElementInsertedAtTop.nextSibling):target.appendChild(style):target.insertBefore(style,target.firstChild),stylesInsertedAtTop.push(style);else if('bottom'===options.insertAt)target.appendChild(style);else if('object'==typeof options.insertAt&&options.insertAt.before){var nextSibling=getElement(options.insertAt.before,target);target.insertBefore(style,nextSibling)}else throw new Error('[Style Loader]\n\n Invalid value for parameter \'insertAt\' (\'options.insertAt\') found.\n Must be \'top\', \'bottom\', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n')}function removeStyleElement(style){if(null===style.parentNode)return!1;style.parentNode.removeChild(style);var idx=stylesInsertedAtTop.indexOf(style);0<=idx&&stylesInsertedAtTop.splice(idx,1)}function createStyleElement(options){var style=document.createElement('style');if(void 0===options.attrs.type&&(options.attrs.type='text/css'),void 0===options.attrs.nonce){var nonce=getNonce();nonce&&(options.attrs.nonce=nonce)}return addAttrs(style,options.attrs),insertStyleElement(options,style),style}function createLinkElement(options){var link=document.createElement('link');return void 0===options.attrs.type&&(options.attrs.type='text/css'),options.attrs.rel='stylesheet',addAttrs(link,options.attrs),insertStyleElement(options,link),link}function addAttrs(el,attrs){Object.keys(attrs).forEach(function(key){el.setAttribute(key,attrs[key])})}function getNonce(){return __webpack_require__.nc}function addStyle(obj,options){var style,update,remove,result;if(options.transform&&obj.css)if(result='function'==typeof options.transform?options.transform(obj.css):options.transform.default(obj.css),result)obj.css=result;else return function(){};if(options.singleton){var styleIndex=singletonCounter++;style=singleton||(singleton=createStyleElement(options)),update=applyToSingletonTag.bind(null,style,styleIndex,!1),remove=applyToSingletonTag.bind(null,style,styleIndex,!0)}else obj.sourceMap&&'function'==typeof URL&&'function'==typeof URL.createObjectURL&&'function'==typeof URL.revokeObjectURL&&'function'==typeof Blob&&'function'==typeof btoa?(style=createLinkElement(options),update=updateLink.bind(null,style,options),remove=function(){removeStyleElement(style),style.href&&URL.revokeObjectURL(style.href)}):(style=createStyleElement(options),update=applyToTag.bind(null,style),remove=function(){removeStyleElement(style)});return update(obj),function updateStyle(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap)return;update(obj=newObj)}else remove()}}function applyToSingletonTag(style,index,remove,obj){var css=remove?'':obj.css;if(style.styleSheet)style.styleSheet.cssText=replaceText(index,css);else{var cssNode=document.createTextNode(css),childNodes=style.childNodes;childNodes[index]&&style.removeChild(childNodes[index]),childNodes.length?style.insertBefore(cssNode,childNodes[index]):style.appendChild(cssNode)}}function applyToTag(style,obj){var css=obj.css,media=obj.media;if(media&&style.setAttribute('media',media),style.styleSheet)style.styleSheet.cssText=css;else{for(;style.firstChild;)style.removeChild(style.firstChild);style.appendChild(document.createTextNode(css))}}function updateLink(link,options,obj){var css=obj.css,sourceMap=obj.sourceMap,autoFixUrls=options.convertToAbsoluteUrls===void 0&&sourceMap;(options.convertToAbsoluteUrls||autoFixUrls)&&(css=fixUrls(css)),sourceMap&&(css+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+' */');var blob=new Blob([css],{type:'text/css'}),oldSrc=link.href;link.href=URL.createObjectURL(blob),oldSrc&&URL.revokeObjectURL(oldSrc)}var stylesInDom={},isOldIE=function(fn){var memo;return function(){return'undefined'==typeof memo&&(memo=fn.apply(this,arguments)),memo}}(function(){return window&&document&&document.all&&!window.atob}),getTarget=function(target,parent){return parent?parent.querySelector(target):document.querySelector(target)},getElement=function(){var memo={};return function(target,parent){if('function'==typeof target)return target();if('undefined'==typeof memo[target]){var styleTarget=getTarget.call(this,target,parent);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement)try{styleTarget=styleTarget.contentDocument.head}catch(e){styleTarget=null}memo[target]=styleTarget}return memo[target]}}(),singleton=null,singletonCounter=0,stylesInsertedAtTop=[],fixUrls=__webpack_require__(150);module.exports=function(list,options){if('undefined'!=typeof DEBUG&&DEBUG&&'object'!=typeof document)throw new Error('The style-loader cannot be used in a non-browser environment');options=options||{},options.attrs='object'==typeof options.attrs?options.attrs:{},options.singleton||'boolean'==typeof options.singleton||(options.singleton=isOldIE()),options.insertInto||(options.insertInto='head'),options.insertAt||(options.insertAt='bottom');var styles=listToStyles(list,options);return addStylesToDom(styles,options),function update(newList){for(var mayRemove=[],i=0;i<styles.length;i++){var item=styles[i],domStyle=stylesInDom[item.id];domStyle.refs--,mayRemove.push(domStyle)}if(newList){var newStyles=listToStyles(newList,options);addStylesToDom(newStyles,options)}for(var i=0,domStyle;i<mayRemove.length;i++)if(domStyle=mayRemove[i],0===domStyle.refs){for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j]();delete stylesInDom[domStyle.id]}}};var replaceText=function(){var textStore=[];return function(index,replacement){return textStore[index]=replacement,textStore.filter(Boolean).join('\n')}}()},function(module){module.exports=function(css){var location='undefined'!=typeof window&&window.location;if(!location)throw new Error('fixUrls requires window.location');if(!css||'string'!=typeof css)return css;var baseUrl=location.protocol+'//'+location.host,currentDir=baseUrl+location.pathname.replace(/\/[^\/]*$/,'/'),fixedCss=css.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(fullMatch,origUrl){var unquotedOrigUrl=origUrl.trim().replace(/^"(.*)"$/,function(o,$1){return $1}).replace(/^'(.*)'$/,function(o,$1){return $1});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(unquotedOrigUrl))return fullMatch;var newUrl;return newUrl=0===unquotedOrigUrl.indexOf('//')?unquotedOrigUrl:0===unquotedOrigUrl.indexOf('/')?baseUrl+unquotedOrigUrl:currentDir+unquotedOrigUrl.replace(/^\.\//,''),'url('+JSON.stringify(newUrl)+')'});return fixedCss}},function(module,exports,__webpack_require__){(function(global){function Timeout(id,clearFn){this._id=id,this._clearFn=clearFn}var scope='undefined'!=typeof global&&global||'undefined'!=typeof self&&self||window,apply=Function.prototype.apply;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,scope,arguments),clearTimeout)},exports.setInterval=function(){return new Timeout(apply.call(setInterval,scope,arguments),clearInterval)},exports.clearTimeout=exports.clearInterval=function(timeout){timeout&&timeout.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(scope,this._id)},exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId),item._idleTimeout=msecs},exports.unenroll=function(item){clearTimeout(item._idleTimeoutId),item._idleTimeout=-1},exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;0<=msecs&&(item._idleTimeoutId=setTimeout(function onTimeout(){item._onTimeout&&item._onTimeout()},msecs))},__webpack_require__(148),exports.setImmediate='undefined'!=typeof self&&self.setImmediate||'undefined'!=typeof global&&global.setImmediate||this&&this.setImmediate,exports.clearImmediate='undefined'!=typeof self&&self.clearImmediate||'undefined'!=typeof global&&global.clearImmediate||this&&this.clearImmediate}).call(exports,__webpack_require__(0))},function(module){module.exports='data:image/png;base64,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'},function(module){module.exports='data:image/jpeg;base64,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'},function(){'use strict';function isDataView(obj){return obj&&DataView.prototype.isPrototypeOf(obj)}function normalizeName(name){if('string'!=typeof name&&(name+=''),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(name))throw new TypeError('Invalid character in header field name');return name.toLowerCase()}function normalizeValue(value){return'string'!=typeof value&&(value+=''),value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:void 0===value,value:value}}};return support.iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator}function Headers(headers){this.map={},headers instanceof Headers?headers.forEach(function(value,name){this.append(name,value)},this):Array.isArray(headers)?headers.forEach(function(header){this.append(header[0],header[1])},this):headers&&Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name])},this)}function consumed(body){return body.bodyUsed?Promise.reject(new TypeError('Already read')):void(body.bodyUsed=!0)}function fileReaderReady(reader){return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)},reader.onerror=function(){reject(reader.error)}})}function readBlobAsArrayBuffer(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsArrayBuffer(blob),promise}function readBlobAsText(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsText(blob),promise}function readArrayBufferAsText(buf){for(var view=new Uint8Array(buf),chars=Array(view.length),i=0;i<view.length;i++)chars[i]=String.fromCharCode(view[i]);return chars.join('')}function bufferClone(buf){if(buf.slice)return buf.slice(0);var view=new Uint8Array(buf.byteLength);return view.set(new Uint8Array(buf)),view.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(body){this._bodyInit=body,body?'string'==typeof body?this._bodyText=body:support.blob&&Blob.prototype.isPrototypeOf(body)?this._bodyBlob=body:support.formData&&FormData.prototype.isPrototypeOf(body)?this._bodyFormData=body:support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)?this._bodyText=body.toString():support.arrayBuffer&&support.blob&&isDataView(body)?(this._bodyArrayBuffer=bufferClone(body.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))?this._bodyArrayBuffer=bufferClone(body):this._bodyText=body=Object.prototype.toString.call(body):this._bodyText='',this.headers.get('content-type')||('string'==typeof body?this.headers.set('content-type','text/plain;charset=UTF-8'):this._bodyBlob&&this._bodyBlob.type?this.headers.set('content-type',this._bodyBlob.type):support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)&&this.headers.set('content-type','application/x-www-form-urlencoded;charset=UTF-8'))},support.blob&&(this.blob=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error('could not read FormData body as blob');else return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?consumed(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return readBlobAsText(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error('could not read FormData body as text');else return Promise.resolve(this._bodyText)},support.formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}function normalizeMethod(method){var upcased=method.toUpperCase();return-1<methods.indexOf(upcased)?upcased:method}function Request(input,options){options=options||{};var body=options.body;if(input instanceof Request){if(input.bodyUsed)throw new TypeError('Already read');this.url=input.url,this.credentials=input.credentials,options.headers||(this.headers=new Headers(input.headers)),this.method=input.method,this.mode=input.mode,this.signal=input.signal,body||null==input._bodyInit||(body=input._bodyInit,input.bodyUsed=!0)}else this.url=input+'';if(this.credentials=options.credentials||this.credentials||'same-origin',(options.headers||!this.headers)&&(this.headers=new Headers(options.headers)),this.method=normalizeMethod(options.method||this.method||'GET'),this.mode=options.mode||this.mode||null,this.signal=options.signal||this.signal,this.referrer=null,('GET'===this.method||'HEAD'===this.method)&&body)throw new TypeError('Body not allowed for GET or HEAD requests');this._initBody(body)}function decode(body){var form=new FormData;return body.trim().split('&').forEach(function(bytes){if(bytes){var split=bytes.split('='),name=split.shift().replace(/\+/g,' '),value=split.join('=').replace(/\+/g,' ');form.append(decodeURIComponent(name),decodeURIComponent(value))}}),form}function parseHeaders(rawHeaders){var headers=new Headers,preProcessedHeaders=rawHeaders.replace(/\r?\n[\t ]+/g,' ');return preProcessedHeaders.split(/\r?\n/).forEach(function(line){var parts=line.split(':'),key=parts.shift().trim();if(key){var value=parts.join(':').trim();headers.append(key,value)}}),headers}function Response(bodyInit,options){options||(options={}),this.type='default',this.status=options.status===void 0?200:options.status,this.ok=200<=this.status&&300>this.status,this.statusText='statusText'in options?options.statusText:'OK',this.headers=new Headers(options.headers),this.url=options.url||'',this._initBody(bodyInit)}function fetch(input,init){return new Promise(function(resolve,reject){function abortXhr(){xhr.abort()}var request=new Request(input,init);if(request.signal&&request.signal.aborted)return reject(new DOMException('Aborted','AbortError'));var xhr=new XMLHttpRequest;xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||'')};options.url='responseURL'in xhr?xhr.responseURL:options.headers.get('X-Request-URL');var body='response'in xhr?xhr.response:xhr.responseText;resolve(new Response(body,options))},xhr.onerror=function(){reject(new TypeError('Network request failed'))},xhr.ontimeout=function(){reject(new TypeError('Network request failed'))},xhr.onabort=function(){reject(new DOMException('Aborted','AbortError'))},xhr.open(request.method,request.url,!0),'include'===request.credentials?xhr.withCredentials=!0:'omit'===request.credentials&&(xhr.withCredentials=!1),'responseType'in xhr&&support.blob&&(xhr.responseType='blob'),request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value)}),request.signal&&(request.signal.addEventListener('abort',abortXhr),xhr.onreadystatechange=function(){4===xhr.readyState&&request.signal.removeEventListener('abort',abortXhr)}),xhr.send('undefined'==typeof request._bodyInit?null:request._bodyInit)})}var support={searchParams:'URLSearchParams'in self,iterable:'Symbol'in self&&'iterator'in Symbol,blob:'FileReader'in self&&'Blob'in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:'FormData'in self,arrayBuffer:'ArrayBuffer'in self};if(support.arrayBuffer)var viewClasses=['[object Int8Array]','[object Uint8Array]','[object Uint8ClampedArray]','[object Int16Array]','[object Uint16Array]','[object Int32Array]','[object Uint32Array]','[object Float32Array]','[object Float64Array]'],isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&-1<viewClasses.indexOf(Object.prototype.toString.call(obj))};Headers.prototype.append=function(name,value){name=normalizeName(name),value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+', '+value:value},Headers.prototype['delete']=function(name){delete this.map[normalizeName(name)]},Headers.prototype.get=function(name){return name=normalizeName(name),this.has(name)?this.map[name]:null},Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))},Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)},Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map)this.map.hasOwnProperty(name)&&callback.call(thisArg,this.map[name],name,this)},Headers.prototype.keys=function(){var items=[];return this.forEach(function(value,name){items.push(name)}),iteratorFor(items)},Headers.prototype.values=function(){var items=[];return this.forEach(function(value){items.push(value)}),iteratorFor(items)},Headers.prototype.entries=function(){var items=[];return this.forEach(function(value,name){items.push([name,value])}),iteratorFor(items)},support.iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var methods=['DELETE','GET','HEAD','OPTIONS','POST','PUT'];Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var response=new Response(null,{status:0,statusText:''});return response.type='error',response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(-1===redirectStatuses.indexOf(status))throw new RangeError('Invalid status code');return new Response(null,{status:status,headers:{location:url}})};var DOMException=self.DOMException;try{new DOMException}catch(err){DOMException=function(message,name){this.message=message,this.name=name;var error=Error(message);this.stack=error.stack},DOMException.prototype=Object.create(Error.prototype),DOMException.prototype.constructor=DOMException}fetch.polyfill=!0,self.fetch||(self.fetch=fetch,self.Headers=Headers,self.Request=Request,self.Response=Response)}]);